{"backend":{"files":{"apps":{"associations":{"txt":"9569a810077d75d689ffc121e636dfbf0353aca405f4ef80da92ee0b0269be16e3408d9ea65bf7f7c51004ee460d10f92c72ea6529d569825b2965a31335e390"},"authui.js":"146ecfed326d3554f0a459421b07a14248fe1e16d234ccc829d59f064bde25544f949c113338bd30349bddc7c526ac6a0c769bd378ff7bfb0492f4a3343fe2f0","consentui.js":"7b0521e58a13c842a16d29b06e7ff0724562511c66c896b9fcaabdfc8f01523a2940079429a554b2dfa6b52aa121009726cf1201ace8752030060e86b4a86802","explorer.js":"e1e36727672a3a14b3b2badfebef8c698ae51f6e5bf14e8093ae71353931d374fcf3dd4b8a350919587dedab106c068026154a8498ab2a02b930aaa56977177f","filePicker.js":"dd214d2aae58e1513ab4a5f5bc4289de702b37eb2d74c6f975f8769e474bccb3527a8ca4d29bedca8f5034e31993c0c727c1ea697ac8a7f2c52fcb0390700dd4","links":{"explorer.lnk":"bf74779015862bd3bd0e09056a6ec6ef152eda019282712c796b48f959739d68b46a4f2687dbc0ecc9711605fe7d20b8a7a948bbefb0945c84e59af5e0e02d8f","textEditor.lnk":"78e6e7a874c3e071fae65185f69bd88ea38a52ff414956947edf11f123212aa28a0aa2892fcacf2afdc392e86fbf11cf4283db92c55f2ed4e090d2fc5111a556"},"startMenu.js":"98fcb02d2244e9544de000eac69b2ba7eb01a55e40e2ab82649168d9d60e2eb01b406c39f6f41e173e36fc9b287091c54cc793665a3cc5006c6d748f3a0871e8","textEditor.js":"010130fdc56d89cd0ffaeed270d44930c39acecc3a282c43bb73fce7bfd4a1e2ff2b1fb378017f24213509d4ef6def5f78969bdcf6ce91f33ec7065433957231"},"etc":{"tlds.json":"31fff1c99201dc486dae8ae82a0c05af8cfd517ef61f8943d15b771c05a0b3bb5faefce6c72dbf268b82d9a5de6fb3053b8d8b9a84c614347f8e202a62ed2f6b"}},"permissions":{"apps/associations/txt":{"world":"rx"},"apps/associations/":{"world":"rx"},"apps/authui.js":{"world":"rx"},"apps/consentui.js":{"world":"rx"},"apps/explorer.js":{"world":"rx"},"apps/filePicker.js":{"world":"rx"},"apps/links/explorer.lnk":{"world":"rx"},"apps/links/textEditor.lnk":{"world":"rx"},"apps/links/":{"world":"rx"},"apps/startMenu.js":{"world":"rx"},"apps/textEditor.js":{"world":"rx"},"apps/":{"world":"rx"},"etc/tlds.json":{"world":"rx"},"etc/":{"world":"rx"},"":{"world":"rx"}}},"files":{"9569a810077d75d689ffc121e636dfbf0353aca405f4ef80da92ee0b0269be16e3408d9ea65bf7f7c51004ee460d10f92c72ea6529d569825b2965a31335e390":"{\"path\":\"system/apps/textEditor.js\",\"localeReferenceName\":\"TEXT_EDITOR\"}","146ecfed326d3554f0a459421b07a14248fe1e16d234ccc829d59f064bde25544f949c113338bd30349bddc7c526ac6a0c769bd378ff7bfb0492f4a3343fe2f0":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: IPC_SEND_PIPE, GET_LOCALE, GET_THEME, ELEVATE_PRIVILEGES, CSP_OPERATIONS\n// signature: 1b241c8934dd85c1af0cf348454e66b83e46059f9d7669cb1840e665357a04ee589b48072a9a1bc97e4788ec9820d77ecefa0a4d4dca21eddde56ae4f3c121f1\n// =====END MANIFEST=====\n\nlet ipc;\n(async function() {\n\t// @pcos-app-mode isolatable\n\texec_args = await availableAPIs.getPrivateData() || [];\n\tif (!(exec_args instanceof Array)) return availableAPIs.terminate();\n\tipc = exec_args[0];\n\tif (!ipc) return availableAPIs.terminate();\n\tlet user = exec_args[1];\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"LOG_IN_INVITATION\"));\n\tlet checklist = [ \"IPC_SEND_PIPE\", \"GET_LOCALE\", \"GET_THEME\", \"ELEVATE_PRIVILEGES\", \"CSP_OPERATIONS\" ];\n\tlet privileges = await availableAPIs.getPrivileges();\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tif (privileges.includes(\"IPC_SEND_PIPE\")) await availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: false } });\n\t\treturn availableAPIs.terminate();\n\t}\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet describe = document.createElement(\"b\");\n\tlet form = document.createElement(\"form\");\n\tlet input = document.createElement(\"input\");\n\tlet submit = document.createElement(\"button\");\n\tdocument.body.appendChild(describe);\n\tdocument.body.appendChild(document.createElement(\"br\"));\n\tdocument.body.appendChild(form);\n\tform.appendChild(input);\n\tform.appendChild(submit);\n\tsubmit.innerText = await availableAPIs.lookupLocale(\"ENTER_BUTTON\");\n\tdescribe.innerText = await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\tasync function userSubmit(e) {\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tlet userLogonSession;\n\t\tlet userLogonID;\n\t\tlet desired_username = input.value;\n\t\ttry {\n\t\t\tuserLogonID = await availableAPIs.automatedLogonCreate({ desiredUser: desired_username });\n\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t} catch {\n\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\tinput.type = \"text\";\n\t\t\tinput.disabled = !!user;\n\t\t\tsubmit.disabled = false;\n\t\t\tinput.value = user || \"\";\n\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\treturn;\n\t\t}\n\t\tasync function updateProgress() {\n\t\t\tsubmit.removeEventListener(\"click\", userSubmit);\n\t\t\tinput.value = \"\";\n\t\t\tsubmit.innerText = await availableAPIs.lookupLocale(\"ENTER_BUTTON\");\n\t\t\tif (userLogonSession.success != \"intermediate\") await availableAPIs.automatedLogonDelete(userLogonID);\n\t\t\tif (userLogonSession.success == true) {\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: userLogonSession });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t}\n\t\t\tif (userLogonSession.success == false) {\n\t\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\t\tinput.type = \"text\";\n\t\t\t\tinput.disabled = !!user;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tinput.value = user || \"\";\n\t\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdescribe.innerText = \"[\" + desired_username + \"] \" + userLogonSession.message;\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"RESPONSE_PLACEHOLDER\");\n\t\t\tinput.type = userLogonSession.type == \"password\" ? \"password\" : \"text\";\n\t\t\tinput.disabled = !userLogonSession.wantsUserInput;\n\t\t\tsubmit.disabled = !userLogonSession.wantsUserInput;\n\t\t\tif (userLogonSession.type == \"zkpp_password\") input.type = \"password\";\n\t\t\tif (userLogonSession.type == \"promise\") {\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t}\n\t\t\tif (userLogonSession.type == \"informative\") {\n\t\t\t\tinput.disabled = true;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tsubmit.innerText = \"OK\";\n\t\t\t\tinput.placeholder = \"--->\";\n\t\t\t}\n\t\t\tsubmit.addEventListener(\"click\", async function updater(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tsubmit.removeEventListener(\"click\", updater);\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tif (userLogonSession.type == \"zkpp_password\") {\n\t\t\t\t\t\tlet passwordAsKey = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(input.value),\n\t\t\t\t\t\t\t\talgorithm: \"PBKDF2\",\n\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tlet rngSeed = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseKey: passwordAsKey,\n\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\tcspArgument: passwordAsKey\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\tlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\n\t\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID, input: u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\toperation: \"sign\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tsecretKey: (await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\t\t\t\t\tseed: new Uint8Array(rngSeed)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})).secretKey,\n\t\t\t\t\t\t\t\tmessage: hexToU8A(userLogonSession.challenge)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}))});\n\t\t\t\t\t} else await availableAPIs.automatedLogonInput({ session: userLogonID, input: input.value });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t});\n\t\t}\n\t\tawait updateProgress();\n\t\treturn false;\n\t}\n\tsubmit.addEventListener(\"click\", userSubmit);\n\tif (user) {\n\t\tinput.disabled = true;\n\t\tinput.value = user;\n\t\tuserSubmit({ preventDefault: () => {}, stopImmediatePropagation: () => {}, stopPropagation: () => {} });\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: true } });\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;","7b0521e58a13c842a16d29b06e7ff0724562511c66c896b9fcaabdfc8f01523a2940079429a554b2dfa6b52aa121009726cf1201ace8752030060e86b4a86802":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: IPC_SEND_PIPE, GET_LOCALE, GET_THEME, ELEVATE_PRIVILEGES, FS_READ, FS_LIST_PARTITIONS, CSP_OPERATIONS\n// signature: b8a552c20c7e4a97626d1c0c2ed718e96aa0943ada355863b33227fc886fa504e09cfa6f305af50456fb890c2d610a87e8d8171162a10e234cc8bbbcd6713691\n// =====END MANIFEST=====\n\nlet ipc;\n(async function() {\n\t// @pcos-app-mode isolatable\n\texec_args = await availableAPIs.getPrivateData() || [];\n\tif (!(exec_args instanceof Array)) return availableAPIs.terminate();\n\tipc = exec_args[0];\n\tif (!ipc) return availableAPIs.terminate();\n\tlet user = exec_args[1];\n\ttry {\n\t\tnew Audio(await availableAPIs.fs_read({ path: (await availableAPIs.getSystemMount()) + \"/etc/sounds/ask.aud\" })).play();\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"ACCESS_REQUEST_TITLE\"));\n\tlet checklist = [ \"IPC_SEND_PIPE\", \"GET_LOCALE\", \"GET_THEME\", \"ELEVATE_PRIVILEGES\", \"CSP_OPERATIONS\" ];\n\tlet privileges = await availableAPIs.getPrivileges();\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tif (privileges.includes(\"IPC_SEND_PIPE\")) await availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: false } });\n\t\treturn availableAPIs.terminate();\n\t}\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet describe = document.createElement(\"span\");\n\tlet form = document.createElement(\"form\");\n\tlet input = document.createElement(\"input\");\n\tlet decline = document.createElement(\"button\");\n\tlet submit = document.createElement(\"button\");\n\tlet metadata = JSON.parse(exec_args[2]);\n\tdecline.type = \"button\";\n\tsubmit.type = \"submit\";\n\tdocument.body.appendChild(describe);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tdocument.body.appendChild(form);\n\tform.appendChild(input);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(decline);\n\tform.appendChild(submit);\n\tdescribe.innerText = (await availableAPIs.lookupLocale(\"DESCRIBE_TEMPLATE\")).replace(\"%s\", metadata.path.split(\"/\").pop()).replace(\"%s\", metadata.submittedName || metadata.path.split(\"/\").pop()).replace(\"%s\", metadata.submittedIntent);\n\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\tdecline.innerText = await availableAPIs.lookupLocale(\"DECLINE\");\n\tsubmit.innerText = await availableAPIs.lookupLocale(\"NEXT\");\n\n\tasync function extraData(e) {\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tdescribe.innerText = (await availableAPIs.lookupLocale(\"EXTRA_DESCRIBE_TEMPLATE\")).replace(\"%s\", metadata.path).replace(\"%s\", metadata.submittedName || metadata.path.split(\"/\").pop()).replace(\"%s\", JSON.stringify(metadata.args)).replace(\"%s\", metadata.submittedIntent);\n\t\tdescribe.removeEventListener(\"contextmenu\", extraData);\n\t}\n\n\tdescribe.addEventListener(\"contextmenu\", extraData);\n\n\tasync function userSubmit(e) {\n\t\tdescribe.removeEventListener(\"contextmenu\", extraData);\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tlet userLogonSession;\n\t\tlet userLogonID;\n\t\tlet desired_username = input.value;\n\t\ttry {\n\t\t\tuserLogonID = await availableAPIs.automatedLogonCreate({ desiredUser: desired_username });\n\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t} catch {\n\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\tinput.type = \"text\";\n\t\t\tinput.disabled = !!user;\n\t\t\tsubmit.disabled = false;\n\t\t\tinput.value = user || \"\";\n\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\treturn;\n\t\t}\n\t\tasync function updateProgress() {\n\t\t\tsubmit.removeEventListener(\"click\", userSubmit);\n\t\t\tinput.value = \"\";\n\t\t\tif (userLogonSession.success != \"intermediate\") await availableAPIs.automatedLogonDelete(userLogonID);\n\t\t\tif (userLogonSession.success == true) {\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: userLogonSession });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t}\n\t\t\tif (userLogonSession.success == false) {\n\t\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\t\tinput.type = \"text\";\n\t\t\t\tinput.disabled = !!user;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tinput.value = user || \"\";\n\t\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdescribe.innerText = \"[\" + desired_username + \"] \" + userLogonSession.message;\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"RESPONSE_PLACEHOLDER\");\n\t\t\tinput.type = userLogonSession.type == \"password\" ? \"password\" : \"text\";\n\t\t\tinput.disabled = !userLogonSession.wantsUserInput;\n\t\t\tsubmit.disabled = !userLogonSession.wantsUserInput;\n\t\t\tif (userLogonSession.type == \"zkpp_password\") input.type = \"password\";\n\t\t\tif (userLogonSession.type == \"promise\") {\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t}\n\t\t\tif (userLogonSession.type == \"informative\") {\n\t\t\t\tinput.disabled = true;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tinput.placeholder = \"\";\n\t\t\t}\n\t\t\tsubmit.addEventListener(\"click\", async function updater(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tsubmit.removeEventListener(\"click\", updater);\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tif (userLogonSession.type == \"zkpp_password\") {\n\t\t\t\t\t\tlet passwordAsKey = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(input.value),\n\t\t\t\t\t\t\t\talgorithm: \"PBKDF2\",\n\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tlet rngSeed = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseKey: passwordAsKey,\n\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\tcspArgument: passwordAsKey\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\tlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\n\t\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID, input: u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\toperation: \"sign\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tsecretKey: (await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\t\t\t\t\tseed: new Uint8Array(rngSeed)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})).secretKey,\n\t\t\t\t\t\t\t\tmessage: hexToU8A(userLogonSession.challenge)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}))});\n\t\t\t\t\t} else await availableAPIs.automatedLogonInput({ session: userLogonID, input: input.value });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t});\n\t\t}\n\t\tawait updateProgress();\n\t\treturn false;\n\t}\n\tsubmit.addEventListener(\"click\", userSubmit);\n\tdecline.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: true } });\n\t\tawait availableAPIs.terminate();\n\t});\n\tif (user) {\n\t\tinput.disabled = true;\n\t\tinput.value = user;\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: true } });\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;","e1e36727672a3a14b3b2badfebef8c698ae51f6e5bf14e8093ae71353931d374fcf3dd4b8a350919587dedab106c068026154a8498ab2a02b930aaa56977177f":"// =====BEGIN MANIFEST=====\n// link: lrn:FILE_EXPLORER\n// signer: automaticSigner\n// allow: FS_READ, FS_LIST_PARTITIONS, ELEVATE_PRIVILEGES, START_TASK, GET_LOCALE, GET_THEME, MANAGE_TOKENS, FS_REMOVE, FS_BYPASS_PERMISSIONS, FS_UNMOUNT, FS_CHANGE_PERMISSION, FS_MOUNT, GET_FILESYSTEMS, FS_WRITE, LLDISK_LIST_PARTITIONS, GET_USER_INFO\n// signature: eec68ad7bf5e4cc8b7fb223d6172a2f024591f7c02614ed036d818fc6f07ead983a7c38d512ccd4843b74d63826b47d51083978685f217515a4f3a72eaa1ed86\n// =====END MANIFEST=====\nlet globalToken;\nlet cachedIcons = {};\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"FILE_EXPLORER\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_LIST_PARTITIONS\" ];\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"GRANT_FEXP_PERM\");\n\t\tlet button = document.createElement(\"button\");\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"GRANT_PERM\");\n\t\tdocument.body.appendChild(button);\n\t\tif (!privileges.includes(\"ELEVATE_PRIVILEGES\")) {\n\t\t\tbutton.disabled = true;\n\t\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"GRANT_FEXP_PERM_ADM\");\n\t\t\treturn;\n\t\t}\n\t\tawait new Promise(function(resolve) {\n\t\t\tbutton.onclick = async function() {\n\t\t\t\tbutton.disabled = true;\n\t\t\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\t\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_FULL_INTENT\"),\n\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\")\n\t\t\t\t});\n\t\t\t\tbutton.disabled = false;\n\t\t\t\tif (!newToken) return;\n\t\t\t\tif (privileges.includes(\"MANAGE_TOKENS\")) globalToken = await availableAPIs.forkToken(newToken);\n\t\t\t\tawait availableAPIs.setProcessToken(newToken);\n\t\t\t\tawait availableAPIs.revokeToken(currentToken);\n\t\t\t\tprivileges = await availableAPIs.getPrivileges();\n\t\t\t\tif (checklist.every(p => privileges.includes(p))) resolve();\n\t\t\t\telse document.body.innerText = await availableAPIs.lookupLocale(\"GRANT_FEXP_PERM_USR\");\n\t\t\t}\n\t\t});\n\t}\n\tlet hideHiddenFiles = true;\n\ttry {\n\t\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\thideHiddenFiles = (await availableAPIs.fs_read({\n\t\t\tpath: homedir + \"/.hiddenFiles\",\n\t\t})) != \"show\";\n\t} catch {}\n\tdocument.body.innerText = \"\";\n\tlet mainComponent = document.createElement(\"div\");\n\tlet pathInputForm = document.createElement(\"form\");\n\tlet pathElement = document.createElement(\"input\");\n\tlet browseButton = document.createElement(\"button\");\n\tlet displayResult = document.createElement(\"div\");\n\tlet previousDirectory = \"\";\n\tlet clipboard = {\n\t\tpath: \"\",\n\t\tcut: false,\n\t\tselected: false\n\t};\n\tmainComponent.style.display = \"flex\";\n\tmainComponent.style.flexDirection = \"column\";\n\tmainComponent.style.width = \"100%\";\n\tmainComponent.style.height = \"100%\";\n\tmainComponent.style.position = \"absolute\";\n\tmainComponent.style.top = \"0\";\n\tmainComponent.style.left = \"0\";\n\tmainComponent.style.padding = \"8px\";\n\tmainComponent.style.boxSizing = \"border-box\";\n\tdisplayResult.style.flex = \"1\";\n\tbrowseButton.innerText = await availableAPIs.lookupLocale(\"BROWSE_FEXP\");\n\tpathInputForm.appendChild(pathElement);\n\tpathInputForm.appendChild(browseButton);\n\tmainComponent.appendChild(pathInputForm);\n\tmainComponent.appendChild(displayResult);\n\tdocument.body.appendChild(mainComponent);\n\tlet availableIcons = [];\n\ttry {\n\t\tavailableIcons = await availableAPIs.fs_ls({ path: await availableAPIs.getSystemMount() + \"/etc/icons\" });\n\t} catch {}\n\tdisplayResult.oncontextmenu = async function(e) {\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tdisplayResult.innerText = \"\";\n\t\tlet showHiddenFilesToggle = document.createElement(\"button\");\n\t\tshowHiddenFilesToggle.innerText = await availableAPIs.lookupLocale(\"TOGGLE_HIDDEN_FILES\");\n\t\tshowHiddenFilesToggle.addEventListener(\"click\", async function() {\n\t\t\thideHiddenFiles = !hideHiddenFiles;\n\t\t\ttry {\n\t\t\t\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\t\t\tavailableAPIs.fs_write({\n\t\t\t\t\tpath: homedir + \"/.hiddenFiles\",\n\t\t\t\t\tdata: (hideHiddenFiles ? \"hide\" : \"show\")\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t\tbrowse();\n\t\t});\n\t\tdisplayResult.appendChild(showHiddenFilesToggle);\n\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\tif (previousDirectory == \"\") {\n\t\t\tlet mountForm = document.createElement(\"form\");\n\t\t\tlet mountpoint = document.createElement(\"input\");\n\t\t\tlet filesystemOptions = document.createElement(\"select\");\n\t\t\tlet autoGenMountOptions = document.createElement(\"select\");\n\t\t\tlet mountOptions = document.createElement(\"textarea\");\n\t\t\tlet mountButton = document.createElement(\"button\");\n\t\t\tmountpoint.placeholder = await availableAPIs.lookupLocale(\"MOUNTPOINT\");\n\t\t\tlet availableFilesystems = await availableAPIs.supportedFilesystems();\n\t\t\tfor (let filesystem of availableFilesystems) {\n\t\t\t\tlet option = document.createElement(\"option\");\n\t\t\t\toption.value = filesystem;\n\t\t\t\toption.innerText = filesystem;\n\t\t\t\tfilesystemOptions.appendChild(option);\n\t\t\t}\n\t\t\tlet availablePartitions = [];\n\t\t\ttry {\n\t\t\t\tavailablePartitions = await availableAPIs.lldaList();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\tlet defaultPartitionOption = document.createElement(\"option\");\n\t\t\tdefaultPartitionOption.value = \"\";\n\t\t\tdefaultPartitionOption.innerText = await availableAPIs.lookupLocale(\"GENERATE_PROMPT\");\n\t\t\tdefaultPartitionOption.selected = true;\n\t\t\tdefaultPartitionOption.disabled = true;\n\t\t\tdefaultPartitionOption.hidden = true;\n\t\t\tautoGenMountOptions.appendChild(defaultPartitionOption);\n\t\t\tfor (let partition of availablePartitions) {\n\t\t\t\tlet option = document.createElement(\"option\");\n\t\t\t\toption.value = partition;\n\t\t\t\toption.innerText = partition;\n\t\t\t\tautoGenMountOptions.appendChild(option);\n\t\t\t}\n\t\t\tautoGenMountOptions.onchange = function() {\n\t\t\t\tmountOptions.value = JSON.stringify({ partition: autoGenMountOptions.value });\n\t\t\t}\n\t\t\tmountOptions.value = \"{}\";\n\t\t\tmountButton.innerText = await availableAPIs.lookupLocale(\"MOUNT_BUTTON\");\n\t\t\tmountButton.onclick = async function() {\n\t\t\t\ttry {\n\t\t\t\t\tlet options = JSON.parse(mountOptions.value);\n\t\t\t\t\tawait availableAPIs.fs_mount({ mountpoint: mountpoint.value, filesystem: filesystemOptions.value, filesystemOptions: options });\n\t\t\t\t\tbrowse();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", e.name + \": \" + e.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmountForm.appendChild(mountpoint);\n\t\t\tmountForm.appendChild(document.createElement(\"br\"));\n\t\t\tmountForm.appendChild(filesystemOptions);\n\t\t\tmountForm.appendChild(document.createElement(\"hr\"));\n\t\t\tmountForm.appendChild(autoGenMountOptions);\n\t\t\tmountForm.appendChild(document.createElement(\"br\"));\n\t\t\tmountForm.appendChild(mountOptions);\n\t\t\tmountForm.appendChild(document.createElement(\"hr\"));\n\t\t\tmountForm.appendChild(mountButton);\n\t\t\tdisplayResult.appendChild(mountForm);\n\t\t} else {\n\t\t\tlet makeDirectoryForm = document.createElement(\"form\");\n\t\t\tlet makeDirectoryInput = document.createElement(\"input\");\n\t\t\tlet makeDirectoryButton = document.createElement(\"button\");\n\t\t\tmakeDirectoryInput.pattern = \"[!-.0-~]+\";\n\t\t\tmakeDirectoryInput.placeholder = await availableAPIs.lookupLocale(\"NEW_DIR_NAME\");\n\t\t\tmakeDirectoryForm.appendChild(makeDirectoryInput);\n\t\t\tmakeDirectoryForm.appendChild(makeDirectoryButton);\n\t\t\tdisplayResult.appendChild(makeDirectoryForm);\n\t\t\tmakeDirectoryButton.innerText = await availableAPIs.lookupLocale(\"MKDIR_BUTTON\");\n\t\t\tmakeDirectoryButton.onclick = async function() {\n\t\t\t\tlet dirName = makeDirectoryInput.value;\n\t\t\t\tif (dirName == \"\") return;\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: previousDirectory + \"/\" + dirName });\n\t\t\t\t\tbrowse();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (clipboard.selected) {\n\t\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\t\t\tlet pasteButton = document.createElement(\"button\");\n\t\t\t\tpasteButton.innerText = await availableAPIs.lookupLocale(\"CLIPBOARD_PASTE\");\n\t\t\t\tpasteButton.onclick = async function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet copyAllowed = await isDirectory(clipboard.path) == \"file\";\n\t\t\t\t\t\tif (!copyAllowed) throw new Error(await availableAPIs.lookupLocale(\"CLIPBOARD_SOURCE_GONE\"));\n\t\t\t\t\t\tlet readFile = await availableAPIs.fs_read({ path: clipboard.path });\n\t\t\t\t\t\tlet basename = clipboard.path.split(\"/\").slice(-1)[0];\n\t\t\t\t\t\tcopyAllowed = await isDirectory(previousDirectory + \"/\" + basename) == \"unknown\";\n\t\t\t\t\t\tif (!copyAllowed) throw new Error(await availableAPIs.lookupLocale(\"CLIPBOARD_CONFLICT\"));\n\t\t\t\t\t\tawait availableAPIs.fs_write({ path: previousDirectory + \"/\" + basename, data: readFile });\n\t\t\t\t\t\tif (clipboard.cut) await availableAPIs.fs_rm({ path: clipboard.path });\n\t\t\t\t\t\tbrowse();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdisplayResult.appendChild(pasteButton);\n\t\t\t}\n\t\t}\n\t}\n\tasync function browse() {\n\t\tlet path = pathElement.value;\n\t\tif (path.endsWith(\"/\")) path = path.substring(0, path.length - 1);\n\t\tdisplayResult.innerText = \"\";\n\t\tif (path == \"\") {\n\t\t\tlet partitions = (await availableAPIs.fs_mounts()).sort((a, b) => a.localeCompare(b));\n\t\t\tfor (let partition of partitions) {\n\t\t\t\tif (partition.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\topenButton.innerText = partition;\n\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\tpathElement.value = partition;\n\t\t\t\t\tbrowse();\n\t\t\t\t}\n\t\t\t\topenButton.oncontextmenu = async function(e) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tdisplayResult.innerText = \"\";\n\t\t\t\t\tlet unmountButton = document.createElement(\"button\");\n\t\t\t\t\tunmountButton.innerText = await availableAPIs.lookupLocale(\"UNMOUNT_BTN\");\n\t\t\t\t\tunmountButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: partition });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tunmountButton.oncontextmenu = async function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: partition, force: true });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(unmountButton);\n\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\n\t\t\t\t\tlet deleteButton = document.createElement(\"button\");\n\t\t\t\t\tlet deleteConfirm = false;\n\t\t\t\t\tdeleteButton.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\t\t\t\tdeleteButton.onclick = async function() {\n\t\t\t\t\t\tif (!deleteConfirm) {\n\t\t\t\t\t\t\tdeleteButton.style.fontWeight = \"bold\";\n\t\t\t\t\t\t\tdeleteConfirm = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait recursiveRemove(partition);\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(deleteButton);\n\n\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"br\"));\n\t\t\t\t\tlet permissions = { owner: \"nobody\", group: \"nobody\", world: \"rx\" };\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpermissions = await availableAPIs.fs_permissions({ path: partition });\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t\tlet chownForm = document.createElement(\"form\");\n\t\t\t\t\tlet chownInput = document.createElement(\"input\");\n\t\t\t\t\tlet chownButton = document.createElement(\"button\");\n\t\t\t\t\tchownInput.value = permissions.owner;\n\t\t\t\t\tchownButton.innerText = await availableAPIs.lookupLocale(\"CHOWN_BUTTON\");\n\t\t\t\t\tchownForm.appendChild(chownInput);\n\t\t\t\t\tchownForm.appendChild(chownButton);\n\t\t\t\t\tdisplayResult.appendChild(chownForm);\n\t\t\t\t\tchownButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_chown({ path: partition, newUser: chownInput.value });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet chgrpForm = document.createElement(\"form\");\n\t\t\t\t\tlet chgrpInput = document.createElement(\"input\");\n\t\t\t\t\tlet chgrpButton = document.createElement(\"button\");\n\t\t\t\t\tchgrpInput.value = permissions.group;\n\t\t\t\t\tchgrpButton.innerText = await availableAPIs.lookupLocale(\"CHGRP_BUTTON\");\n\t\t\t\t\tchgrpForm.appendChild(chgrpInput);\n\t\t\t\t\tchgrpForm.appendChild(chgrpButton);\n\t\t\t\t\tdisplayResult.appendChild(chgrpForm);\n\t\t\t\t\tchgrpButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_chgrp({ path: partition, newGrp: chgrpInput.value });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet chmodForm = document.createElement(\"form\");\n\t\t\t\t\tlet chmodInput = document.createElement(\"input\");\n\t\t\t\t\tlet chmodButton = document.createElement(\"button\");\n\t\t\t\t\tchmodInput.value = permissions.world;\n\t\t\t\t\tchownInput.pattern = \"[rwx]+\";\n\t\t\t\t\tchmodButton.innerText = await availableAPIs.lookupLocale(\"CHMOD_BUTTON\");\n\t\t\t\t\tchmodForm.appendChild(chmodInput);\n\t\t\t\t\tchmodForm.appendChild(chmodButton);\n\t\t\t\t\tdisplayResult.appendChild(chmodForm);\n\t\t\t\t\tchmodButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_chmod({ path: partition, newPermissions: chmodInput.value });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t}\n\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\t\tlet spaceDisplayer = document.createElement(\"div\");\n\t\t\tlet spaces = await availableAPIs.estimateStorage();\n\t\t\tfor (let space in spaces) {\n\t\t\t\tlet newSpace = document.createElement(\"div\");\n\t\t\t\tnewSpace.innerText = (await availableAPIs.lookupLocale(\"SPACE_SHOWER\")).replace(\"%s\", space).replace(\"%s\", await availableAPIs.ufInfoUnits([spaces[space].used])).replace(\"%s\", await availableAPIs.ufInfoUnits([spaces[space].total])).replace(\"%s\", (spaces[space].used / spaces[space].total * 100).toFixed(2));\n\t\t\t\tspaceDisplayer.appendChild(newSpace);\n\t\t\t}\n\t\t\tdisplayResult.appendChild(spaceDisplayer);\n\t\t\tpreviousDirectory = path;\n\t\t\treturn \"browsed\";\n\t\t}\n\t\ttry {\n\t\t\tlet type = await isDirectory(path);\n\t\t\tif (type == \"directory\") {\n\t\t\t\tlet ls = (await availableAPIs.fs_ls({ path: path })).sort((a, b) => a.localeCompare(b));\n\t\t\t\tfor (let file of ls) {\n\t\t\t\t\tif (file.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\t\tlet fileIcon = document.createElement(\"img\");\n\t\t\t\t\tfileIcon.style.width = \"12px\";\n\t\t\t\t\tfileIcon.style.height = \"12px\";\n\t\t\t\t\tlet fileType = file.split(\".\").slice(-1)[0];\n\t\t\t\t\tlet isDir = await isDirectory(path + \"/\" + file);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet wantedIcon;\n\t\t\t\t\t\tif (isDir == \"directory\") wantedIcon = \"foldericon.pic\";\n\t\t\t\t\t\telse if (availableIcons.includes(fileType + \".pic\")) wantedIcon = fileType + \".pic\";\n\t\t\t\t\t\telse wantedIcon = \"fileicon.pic\";\n\t\t\t\t\t\tif (!cachedIcons.hasOwnProperty(wantedIcon)) cachedIcons[wantedIcon] = await availableAPIs.fs_read({ path: await availableAPIs.getSystemMount() + \"/etc/icons/\" + wantedIcon });\n\t\t\t\t\t\tfileIcon.src = cachedIcons[wantedIcon];\n\t\t\t\t\t} catch {}\n\t\t\t\t\topenButton.innerText = file;\n\t\t\t\t\topenButton.insertAdjacentElement(\"afterbegin\", fileIcon);\n\t\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\t\tpathElement.value = path + \"/\" + file;\n\t\t\t\t\t\tbrowse();\n\t\t\t\t\t}\n\t\t\t\t\topenButton.oncontextmenu = async function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tdisplayResult.innerText = \"\";\n\t\t\t\t\t\tlet copyAllow = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcopyAllow = isDir == \"file\";\n\t\t\t\t\t\t} catch {}\n\t\t\t\t\t\tif (copyAllow) {\n\t\t\t\t\t\t\tlet copyButton = document.createElement(\"button\");\n\t\t\t\t\t\t\tcopyButton.innerText = await availableAPIs.lookupLocale(\"CLIPBOARD_COPY\");\n\t\t\t\t\t\t\tcopyButton.onclick = async function() {\n\t\t\t\t\t\t\t\tclipboard = {\n\t\t\t\t\t\t\t\t\tpath: path + \"/\" + file,\n\t\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t\t\tcut: false\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdisplayResult.appendChild(copyButton);\n\n\t\t\t\t\t\t\tlet cutButton = document.createElement(\"button\");\n\t\t\t\t\t\t\tcutButton.innerText = await availableAPIs.lookupLocale(\"CLIPBOARD_CUT\");\n\t\t\t\t\t\t\tcutButton.onclick = async function() {\n\t\t\t\t\t\t\t\tclipboard = {\n\t\t\t\t\t\t\t\t\tpath: path + \"/\" + file,\n\t\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t\t\tcut: true\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdisplayResult.appendChild(cutButton);\n\t\t\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet deleteButton = document.createElement(\"button\");\n\t\t\t\t\t\tlet deleteConfirm = false;\n\t\t\t\t\t\tdeleteButton.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\t\t\t\t\tdeleteButton.onclick = async function() {\n\t\t\t\t\t\t\tif (!deleteConfirm) {\n\t\t\t\t\t\t\t\tdeleteButton.style.fontWeight = \"bold\";\n\t\t\t\t\t\t\t\tdeleteConfirm = true;\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tlet isDir = await isDirectory(path + \"/\" + file);\n\t\t\t\t\t\t\t\tif (isDir == \"directory\") await recursiveRemove(path + \"/\" + file);\n\t\t\t\t\t\t\t\telse if (isDir == \"file\") await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdisplayResult.appendChild(deleteButton);\n\t\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"br\"));\n\t\t\t\t\t\tlet permissions = { owner: \"nobody\", group: \"nobody\", world: \"rx\" };\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tpermissions = await availableAPIs.fs_permissions({ path: path + \"/\" + file });\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet chownForm = document.createElement(\"form\");\n\t\t\t\t\t\tlet chownInput = document.createElement(\"input\");\n\t\t\t\t\t\tlet chownButton = document.createElement(\"button\");\n\t\t\t\t\t\tchownInput.value = permissions.owner;\n\t\t\t\t\t\tchownButton.innerText = await availableAPIs.lookupLocale(\"CHOWN_BUTTON\");\n\t\t\t\t\t\tchownForm.appendChild(chownInput);\n\t\t\t\t\t\tchownForm.appendChild(chownButton);\n\t\t\t\t\t\tdisplayResult.appendChild(chownForm);\n\t\t\t\t\t\tchownButton.onclick = async function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_chown({ path: path + \"/\" + file, newUser: chownInput.value });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet chgrpForm = document.createElement(\"form\");\n\t\t\t\t\t\tlet chgrpInput = document.createElement(\"input\");\n\t\t\t\t\t\tlet chgrpButton = document.createElement(\"button\");\n\t\t\t\t\t\tchgrpInput.value = permissions.group;\n\t\t\t\t\t\tchgrpButton.innerText = await availableAPIs.lookupLocale(\"CHGRP_BUTTON\");\n\t\t\t\t\t\tchgrpForm.appendChild(chgrpInput);\n\t\t\t\t\t\tchgrpForm.appendChild(chgrpButton);\n\t\t\t\t\t\tdisplayResult.appendChild(chgrpForm);\n\t\t\t\t\t\tchgrpButton.onclick = async function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_chgrp({ path: path + \"/\" + file, newGrp: chgrpInput.value });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet chmodForm = document.createElement(\"form\");\n\t\t\t\t\t\tlet chmodInput = document.createElement(\"input\");\n\t\t\t\t\t\tlet chmodButton = document.createElement(\"button\");\n\t\t\t\t\t\tchmodInput.value = permissions.world;\n\t\t\t\t\t\tchownInput.pattern = \"[rwx]+\";\n\t\t\t\t\t\tchmodButton.innerText = await availableAPIs.lookupLocale(\"CHMOD_BUTTON\");\n\t\t\t\t\t\tchmodForm.appendChild(chmodInput);\n\t\t\t\t\t\tchmodForm.appendChild(chmodButton);\n\t\t\t\t\t\tdisplayResult.appendChild(chmodForm);\n\t\t\t\t\t\tchmodButton.onclick = async function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_chmod({ path: path + \"/\" + file, newPermissions: chmodInput.value });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t\t}\n\t\t\t\tpreviousDirectory = path;\n\t\t\t} else if (type == \"file\") {\n\t\t\t\tlet hasError = false;\n\t\t\t\tpathElement.value = previousDirectory;\n\t\t\t\tif (path.endsWith(\".js\")) {\n\t\t\t\t\tif (privileges.includes(\"START_TASK\") && privileges.includes(\"ELEVATE_PRIVILEGES\") && privileges.includes(\"MANAGE_TOKENS\")) {\n\t\t\t\t\t\tif (!globalToken) globalToken = await availableAPIs.consentGetToken({\n\t\t\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_INTENT\"),\n\t\t\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\"),\n\t\t\t\t\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (globalToken) {\n\t\t\t\t\t\t\tlet newToken = await availableAPIs.forkToken(globalToken);\n\t\t\t\t\t\t\tawait availableAPIs.startTask({ file: path, token: newToken });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdisplayResult.innerText = await availableAPIs.lookupLocale(\"MORE_PERMISSION_DENIED\");\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (path.endsWith(\".lnk\") && privileges.includes(\"ELEVATE_PRIVILEGES\") && privileges.includes(\"MANAGE_TOKENS\")) {\n\t\t\t\t\tlet file = await availableAPIs.fs_read({ path: path });\n\t\t\t\t\tfile = JSON.parse(file);\n\t\t\t\t\tif (privileges.includes(\"START_TASK\")) {\n\t\t\t\t\t\tif (!globalToken) globalToken = await availableAPIs.consentGetToken({\n\t\t\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_INTENT\"),\n\t\t\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\"),\n\t\t\t\t\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (globalToken) {\n\t\t\t\t\t\t\tlet newToken = await availableAPIs.forkToken(globalToken);\n\t\t\t\t\t\t\tawait availableAPIs.startTask({ file: file.path, argPassed: [ ...(file.args || []) ], token: newToken });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdisplayResult.innerText = await availableAPIs.lookupLocale(\"MORE_PERMISSION_DENIED\");\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet lookUpAssociation = await availableAPIs.fs_ls({ path: await availableAPIs.getSystemMount() + \"/apps/associations\" });\n\t\t\t\t\tlet fileType = path.split(\".\").slice(-1)[0];\n\t\t\t\t\tif (!lookUpAssociation.includes(fileType)) return displayResult.innerText = await availableAPIs.lookupLocale(\"UNKNOWN_FILE_TYPE\");\n\t\t\t\t\tlet file = await availableAPIs.fs_read({ path: await availableAPIs.getSystemMount() + \"/apps/associations/\" + fileType });\n\t\t\t\t\tlet fileLink = JSON.parse(file);\n\t\t\t\t\tif (privileges.includes(\"START_TASK\") && privileges.includes(\"ELEVATE_PRIVILEGES\") && privileges.includes(\"MANAGE_TOKENS\")) {\n\t\t\t\t\t\tif (!globalToken) globalToken = await availableAPIs.consentGetToken({\n\t\t\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_INTENT\"),\n\t\t\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\"),\n\t\t\t\t\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (globalToken) {\n\t\t\t\t\t\t\tlet newToken = await availableAPIs.forkToken(globalToken);\n\t\t\t\t\t\t\tawait availableAPIs.startTask({ file: fileLink.path, argPassed: [ ...(fileLink.args || []), path ], token: newToken });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdisplayResult.innerText = await availableAPIs.lookupLocale(\"MORE_PERMISSION_DENIED\");\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!hasError) await browse();\n\t\t\t} else {\n\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", (await availableAPIs.lookupLocale(\"UNKNOWN_FS_STRUCT\")).replace(\"%s\", type));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t}\n\t}\n\tif (exec_args[0]) pathElement.value = exec_args[0];\n\tbrowse();\n\tbrowseButton.onclick = browse;\n})();\nasync function recursiveRemove(path) {\n\tlet dirList = await availableAPIs.fs_ls({ path });\n\tfor (let fileIndex in dirList) {\n\t\tlet file = dirList[fileIndex];\n\t\tif (await availableAPIs.fs_isDirectory({ path: path + \"/\" + file })) await recursiveRemove(path + \"/\" + file);\n\t\telse await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t}\n\tawait availableAPIs.fs_rm({ path });\n}\nasync function isDirectory(path) {\n\ttry {\n\t\tlet isDirectoryVar = await availableAPIs.fs_isDirectory({ path });\n\t\treturn isDirectoryVar ? \"directory\" : \"file\";\n\t} catch {\n\t\treturn \"unknown\";\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tif (globalToken) await availableAPIs.revokeToken(globalToken);\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;","dd214d2aae58e1513ab4a5f5bc4289de702b37eb2d74c6f975f8769e474bccb3527a8ca4d29bedca8f5034e31993c0c727c1ea697ac8a7f2c52fcb0390700dd4":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: FS_READ, FS_LIST_PARTITIONS, IPC_SEND_PIPE, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS, GET_USER_INFO\n// signature: 5dc509289892dea99d89dc6a2801fa6070342b532b4dc715c7de4aacd9226a6855be3d3da9b292b03c48bfd924dd79b8bd16f2d06acff7d2b8ae429683c8d5c2\n// =====END MANIFEST=====\nlet ipcChannel = exec_args[0];\n(async function() {\n\t// @pcos-app-mode isolatable\n\tif (!ipcChannel) return availableAPIs.terminate();\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"FILE_PICKER\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\" ];\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tif (privileges.includes(\"IPC_SEND_PIPE\")) await availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: false, reason: \"permissions\" } });\n\t\treturn availableAPIs.terminate();\n\t}\n\tlet hideHiddenFiles = false;\n\ttry {\n\t\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\thideHiddenFiles = true;\n\t\thideHiddenFiles = (await availableAPIs.fs_read({\n\t\t\tpath: homedir + \"/.hiddenFiles\",\n\t\t})) != \"show\";\n\t} catch {}\n\tdocument.body.innerText = \"\";\n\tlet mainComponent = document.createElement(\"div\");\n\tlet pathInputForm = document.createElement(\"form\");\n\tlet pathElement = document.createElement(\"input\");\n\tpathElement.value = exec_args[2] || \"\";\n\tlet browseButton = document.createElement(\"button\");\n\tlet displayResult = document.createElement(\"div\");\n\tlet newItemInput = document.createElement(\"input\");\n\tlet newItemBrowse = document.createElement(\"button\");\n\tlet newItemContainer = document.createElement(\"div\");\n\tlet previousDirectory = \"\";\n\tlet isDefaultChoice = true;\n\tmainComponent.style.display = \"flex\";\n\tmainComponent.style.flexDirection = \"column\";\n\tmainComponent.style.width = \"100%\";\n\tmainComponent.style.height = \"100%\";\n\tmainComponent.style.position = \"absolute\";\n\tmainComponent.style.top = \"0\";\n\tmainComponent.style.left = \"0\";\n\tmainComponent.style.padding = \"8px\";\n\tmainComponent.style.boxSizing = \"border-box\";\n\tdisplayResult.style.flex = \"1\";\n\tnewItemBrowse.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\tnewItemContainer.appendChild(document.createElement(\"hr\"));\n\tnewItemContainer.appendChild(newItemInput);\n\tbrowseButton.innerText = await availableAPIs.lookupLocale(\"BROWSE_FEXP\");\n\tnewItemContainer.appendChild(newItemBrowse);\n\tpathInputForm.appendChild(pathElement);\n\tpathInputForm.appendChild(browseButton);\n\tmainComponent.appendChild(pathInputForm);\n\tmainComponent.appendChild(displayResult);\n\tmainComponent.appendChild(newItemContainer);\n\tdocument.body.appendChild(mainComponent);\n\tnewItemContainer.hidden = exec_args[1] != \"save\";\n\tasync function browse() {\n\t\tlet path = pathElement.value;\n\t\tif (path.endsWith(\"/\")) path = path.substring(0, path.length - 1);\n\t\tdisplayResult.innerText = \"\";\n\t\tif (path == \"\") {\n\t\t\tlet partitions = (await availableAPIs.fs_mounts()).sort((a, b) => a.localeCompare(b));\n\t\t\tfor (let partition of partitions) {\n\t\t\t\tif (partition.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\topenButton.innerText = partition;\n\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\tpathElement.value = partition;\n\t\t\t\t\tbrowse();\n\t\t\t\t}\n\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t}\n\t\t\tpreviousDirectory = path;\n\t\t\treturn \"browsed\";\n\t\t}\n\t\ttry {\n\t\t\tlet type = await isDirectory(path);\n\t\t\tif (type == \"directory\") {\n\t\t\t\tlet ls = (await availableAPIs.fs_ls({ path: path })).sort((a, b) => a.localeCompare(b));\n\t\t\t\tfor (let file of ls) {\n\t\t\t\t\tif (file.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\t\topenButton.innerText = file;\n\t\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\t\tpathElement.value = path + \"/\" + file;\n\t\t\t\t\t\tbrowse();\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t\t}\n\t\t\t\tpreviousDirectory = path;\n\t\t\t} else if (type == \"file\" || (type == \"unknown\" && exec_args[1] == \"save\")) {\n\t\t\t\tif (isDefaultChoice) {\n\t\t\t\t\tpathElement.value = path.split(\"/\").slice(0, -1).join(\"/\");\n\t\t\t\t\tnewItemInput.value = path.split(\"/\").slice(-1)[0];\n\t\t\t\t\treturn browse();\n\t\t\t\t}\n\t\t\t\tdisplayResult.innerText = \"\";\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: true, selected: path } });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t} else {\n\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", (await availableAPIs.lookupLocale(\"UNKNOWN_FS_STRUCT\")).replace(\"%s\", type));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t}\n\t\tisDefaultChoice = false;\n\t}\n\tbrowse();\n\tbrowseButton.onclick = browse;\n\tnewItemBrowse.onclick = async function() {\n\t\tif (previousDirectory == \"\") return displayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(\"NO_SAVE_IN_MTN\"));\n\t\tpathElement.value = previousDirectory + \"/\" + newItemInput.value;\n\t\tbrowse();\n\t}\n})();\nasync function isDirectory(path) {\n\ttry {\n\t\tlet isDirectoryVar = await availableAPIs.fs_isDirectory({ path });\n\t\treturn isDirectoryVar ? \"directory\" : \"file\";\n\t} catch {\n\t\treturn \"unknown\";\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: false, reason: \"closed\" } });\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;","bf74779015862bd3bd0e09056a6ec6ef152eda019282712c796b48f959739d68b46a4f2687dbc0ecc9711605fe7d20b8a7a948bbefb0945c84e59af5e0e02d8f":"{\"path\":\"system/apps/explorer.js\",\"localeReferenceName\":\"FILE_EXPLORER\"}","78e6e7a874c3e071fae65185f69bd88ea38a52ff414956947edf11f123212aa28a0aa2892fcacf2afdc392e86fbf11cf4283db92c55f2ed4e090d2fc5111a556":"{\"path\":\"system/apps/textEditor.js\",\"localeReferenceName\":\"TEXT_EDITOR\"}","98fcb02d2244e9544de000eac69b2ba7eb01a55e40e2ab82649168d9d60e2eb01b406c39f6f41e173e36fc9b287091c54cc793665a3cc5006c6d748f3a0871e8":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: FS_READ, FS_LIST_PARTITIONS, IPC_SEND_PIPE, IPC_LISTEN_PIPE, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS, SYSTEM_SHUTDOWN, GET_USER_INFO, LOGOUT, GET_SCREEN_INFO, GRAB_ATTENTION, LULL_SYSTEM\n// signature: 52ea7106229685eb0d2843209a48d20726cffef153ad71b43f3b8ec8508abba2becdf80950922f18bee231c4ea177d81b9a0113eabe54c00f34cbc18590b2ce0\n// =====END MANIFEST=====\nlet ipcChannel;\nlet shouldShutdown = false;\nlet visibilityState = true;\nlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\nlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n(async function() {\n\t// @pcos-app-mode isolatable\n\tipcChannel = await availableAPIs.getPrivateData();\n\tif (!ipcChannel) return availableAPIs.terminate();\n\tawait visibility(false);\n\tawait window.availableAPIs.windowTitleSet(await window.availableAPIs.lookupLocale(\"START_MENU\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\", \"IPC_LISTEN_PIPE\" ];\n\tif (!checklist.every(p => privileges.includes(p))) return availableAPIs.terminate();\n\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: true } });\n\tdocument.body.innerText = \"\";\n\tlet logoutButton = document.createElement(\"button\");\n\tlogoutButton.innerText = (await availableAPIs.lookupLocale(\"LOG_OUT_BUTTON\")).replace(\"%s\", await availableAPIs.getUser());\n\tdocument.body.appendChild(logoutButton);\n\tlogoutButton.onclick = async function() {\n\t\tshouldShutdown = true;\n\t\tawait visibility(false);\n\t\tawait availableAPIs.logOut(await availableAPIs.getUser());\n\t}\n\tlet lockButton = document.createElement(\"button\");\n\tlockButton.innerText = await availableAPIs.lookupLocale(\"LOCK_BUTTON\");\n\tdocument.body.appendChild(lockButton);\n\tlockButton.onclick = async function() {\n\t\tawait visibility(false);\n\t\tawait availableAPIs.lock();\n\t}\n\tif (privileges.includes(\"SYSTEM_SHUTDOWN\")) {\n\t\tlet shutoff = document.createElement(\"button\");\n\t\tshutoff.innerText = await availableAPIs.lookupLocale(\"TURN_OFF_BUTTON\");\n\t\tdocument.body.appendChild(shutoff);\n\t\tshutoff.onclick = async function() {\n\t\t\tshouldShutdown = true;\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.shutdown({ isReboot: false });\n\t\t}\n\t\tlet reboot = document.createElement(\"button\");\n\t\treboot.innerText = await availableAPIs.lookupLocale(\"RESTART_BUTTON\");\n\t\tdocument.body.appendChild(reboot);\n\t\treboot.onclick = async function() {\n\t\t\tshouldShutdown = true;\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.shutdown({ isReboot: true, isKexec: true });\n\t\t}\n\t\treboot.oncontextmenu = async function(e) {\n\t\t\te.stopImmediatePropagation();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tshouldShutdown = true;\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.shutdown({ isReboot: true, isKexec: false });\n\t\t}\n\t}\n\tif (privileges.includes(\"LULL_SYSTEM\")) {\n\t\tlet lull = document.createElement(\"button\");\n\t\tlull.innerText = await availableAPIs.lookupLocale(\"LULL_SYSTEM\");\n\t\tdocument.body.appendChild(lull);\n\t\tlull.onclick = async function() {\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.lull();\n\t\t}\n\t}\n\ttry {\n\t\tlet enumeration = (await availableAPIs.fs_ls({ path: (await availableAPIs.getSystemMount()) + \"/apps/links\" })).sort((a, b) => a.localeCompare(b));\n\t\tfor (let app of enumeration) {\n\t\t\tlet appLink = await availableAPIs.fs_read({ path: (await availableAPIs.getSystemMount()) + \"/apps/links/\" + app });\n\t\t\tappLink = JSON.parse(appLink);\n\t\t\tif (appLink.disabled) continue;\n\t\t\tlet appBtn = document.createElement(\"button\");\n\t\t\tappBtn.innerText = (appLink.localeReferenceName ? await availableAPIs.lookupLocale(appLink.localeReferenceName) : null) || (appLink.localeDatabaseName ? (appLink.localeDatabaseName[navigator.language.slice(0, 2).toLowerCase()] || appLink.localeDatabaseName[await availableAPIs.osLocale()]) : null) || appLink.name;\n\t\t\tappBtn.title = await availableAPIs.lookupLocale(\"PROVISIONED_PREFERENCE\");\n\t\t\tappBtn.onclick = async function() {\n\t\t\t\tawait visibility(false);\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { run: appLink } });\n\t\t\t}\n\t\t\tdocument.body.appendChild(appBtn);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(\"Failed to enumerate system app links\", e);\n\t}\n\ttry {\n\t\tlet enumeration = await availableAPIs.fs_ls({ path: (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory + \"/.applinks\" });\n\t\tfor (let app of enumeration) {\n\t\t\tlet appLink = await availableAPIs.fs_read({ path: (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory + \"/.applinks/\" + app });\n\t\t\tappLink = JSON.parse(appLink);\n\t\t\tif (appLink.disabled) continue;\n\t\t\tlet appBtn = document.createElement(\"button\");\n\t\t\tappBtn.innerText = (appLink.localeReferenceName ? await availableAPIs.lookupLocale(appLink.localeReferenceName) : null) || (appLink.localeDatabaseName ? (appLink.localeDatabaseName[navigator.language.slice(0, 2).toLowerCase()] || appLink.localeDatabaseName[await availableAPIs.osLocale()]) : null) || appLink.name;\n\t\t\tappBtn.onclick = async function() {\n\t\t\t\tawait visibility(false);\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { run: appLink } });\n\t\t\t}\n\t\t\tdocument.body.appendChild(appBtn);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(\"Failed to enumerate user app links\", e);\n\t}\n\n\tonresize = shapeshift;\n\n\twhile (true) {\n\t\tlet listen = await availableAPIs.listenToPipe(ipcChannel);\n\t\tif (listen.open) {\n\t\t\tawait visibility();\n\t\t\tshapeshift();\n\t\t}\n\t}\n})();\n\nasync function visibility(wantedState) {\n\tif (!wantedState) wantedState = !visibilityState;\n\tif (wantedState == visibilityState) return;\n\tawait availableAPIs.windowVisibility(wantedState);\n\tvisibilityState = wantedState;\n}\n\nasync function shapeshift() {\n\tlet screenInfo = await availableAPIs.getScreenInfo();\n\tlet winSize = await availableAPIs.windowSize();\n\tawait availableAPIs.windowRelocate([ screenInfo.height - (winSize.height / 2) - 35 - 8, winSize.width / 2 + 8 ]);\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\tawait visibility(false);\n\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { dying: true } });\n\t\tawait availableAPIs.terminate();\n\t}\n}); null;","010130fdc56d89cd0ffaeed270d44930c39acecc3a282c43bb73fce7bfd4a1e2ff2b1fb378017f24213509d4ef6def5f78969bdcf6ce91f33ec7065433957231":"// =====BEGIN MANIFEST=====\n// link: lrn:TEXT_EDITOR\n// association: txt\n// signer: automaticSigner\n// allow: FS_READ, FS_WRITE, FS_LIST_PARTITIONS, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, GET_LOCALE, GET_THEME, START_TASK, IPC_SEND_PIPE, FS_BYPASS_PERMISSIONS, GET_USER_INFO\n// signature: b8e75dd8b27d5dc3186e15b0f2473456282481a469f89e6949bdf99d5a9d40aa9adf539023c428c997f99b90fe2c0160ab0e586dd4db1f965483e4f02ba82821\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"TEXT_EDITOR\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.documentElement.style.height = \"100%\";\n\tdocument.documentElement.style.width = \"100%\";\n\tdocument.body.style.height = \"100%\";\n\tdocument.body.style.width = \"100%\";\n\tdocument.body.style.margin = \"0\";\n\tlet flexContainer = document.createElement(\"div\");\n\tlet buttonContainer = document.createElement(\"div\");\n\tlet loadButton = document.createElement(\"button\");\n\tlet saveButton = document.createElement(\"button\");\n\tlet statusMessage = document.createElement(\"span\");\n\tlet data = document.createElement(\"textarea\");\n\tlet hr = document.createElement(\"hr\");\n\tlet hrContainer = document.createElement(\"div\");\n\tlet lastFile = \"\";\n\tloadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\tsaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\tflexContainer.style.display = \"flex\";\n\tflexContainer.style.flexDirection = \"column\";\n\tflexContainer.style.width = \"100%\";\n\tflexContainer.style.height = \"100%\";\n\tdata.style.flexGrow = 1000;\n\tdata.style.resize = \"none\";\n\tif (await availableAPIs.isDarkThemed()) {\n\t\tdata.style.backgroundColor = \"#2b2a33\";\n\t\tdata.style.color = \"white\";\n\t}\n\tbuttonContainer.appendChild(loadButton);\n\tbuttonContainer.appendChild(saveButton);\n\tbuttonContainer.appendChild(statusMessage);\n\thrContainer.appendChild(hr);\n\tflexContainer.appendChild(buttonContainer);\n\tflexContainer.appendChild(hrContainer);\n\tflexContainer.appendChild(data);\n\tdocument.body.appendChild(flexContainer);\n\ttry {\n\t\tif (exec_args[0]) {\n\t\t\tdata.value = await availableAPIs.fs_read({ path: exec_args[0] });\n\t\t\tlastFile = exec_args[0];\n\t\t\tstatusMessage.innerText = exec_args[0].split(\"/\").pop();\n\t\t}\n\t} catch (e) {\n\t\tstatusMessage.innerText = e.name + \": \" + e.message;\n\t}\n\tloadButton.onclick = async function() {\n\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\tawait availableAPIs.windowVisibility(false);\n\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\", lastFile] });\n\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\tawait availableAPIs.windowVisibility(true);\n\t\ttry {\n\t\t\tif (result.success) {\n\t\t\t\tdata.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t\t\tlastFile = result.selected;\n\t\t\t\tstatusMessage.innerText = result.selected.split(\"/\").pop();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tstatusMessage.innerText = e.name + \": \" + e.message;\n\t\t}\n\t}\n\tsaveButton.onclick = async function() {\n\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\tawait availableAPIs.windowVisibility(false);\n\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\", lastFile] });\n\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\tawait availableAPIs.windowVisibility(true);\n\t\ttry {\n\t\t\tif (result.success) {\n\t\t\t\tawait availableAPIs.fs_write({ path: result.selected, data: data.value });\n\t\t\t\tlastFile = result.selected;\n\t\t\t\tstatusMessage.innerText = result.selected.split(\"/\").pop();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tstatusMessage.innerText = e.name + \": \" + e.message;\n\t\t}\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","31fff1c99201dc486dae8ae82a0c05af8cfd517ef61f8943d15b771c05a0b3bb5faefce6c72dbf268b82d9a5de6fb3053b8d8b9a84c614347f8e202a62ed2f6b":"{\n\t\"basic\": \"7f00000150434f53334e6574776f726b\",\n\t\"pc\": \"7f00000150434f53334e6574776f726b\"\n}"},"buildInfo":{"for":"1323","when":1750879701569,"signer":"moduleSigner","critical":true,"signature":"06f3171af774210ad1b3f2512ae4d2817d764b2b536cd6c3e5ee1e934e42efbc3a62110c4bdd9ba768d17a6a51b00d3df44686222eeb8e405ddc901d54fdce8a"}}