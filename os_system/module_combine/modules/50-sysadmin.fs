{"backend":{"files":{"apps":{"links":{"moduleManager.lnk":"17e94101c150df5a046fa12f357ec7b825666e8dde94dfd6cc00ae812d6b791fd5fc7cb7f986d227b6c6806ddc2e0075f8c07b850623c8885a81feeaca1ebdb4","pcosNetwork.lnk":"991178b0fb8e65e7fbee163a980ecc5e40bd3babd29365ef5f74296774a128a6fbb2b183c4b0f619dc70c8adaaceaa4160eaaea0accbba65a395bdb88701e93c","personalSecurity.lnk":"4a0aa7728de91c907646516466a348c3a1aa8031c178c0a20ff16553506b643dbd06469727e18ba8233983b4e1bff7f6dcad2953333ac5ce3b4c4a3ad903713c","sysAdmin.lnk":"8669c1a4801945d19e0cf20ba61b3497c4c419295cad93a79c0160b4ed92a55f2ccfe41a900f7f03f28a6edf38a0bd06216576bf81de5660046f51902d7aca77","systemSecurity.lnk":"7f4e57bef374c98e7c315d06ea6e2a508af1d9e3c1d012bfbd3bf6978e90622ec08a9a8f3f33bf5838afed664691714ae0c9d930dae61538d354b5ea97a8ccf3","taskManager.lnk":"1b9360c4512676bd67d3d564dbe4b38b582f4d1aa44848a1020bdbb275ed1204dc0a8fb699eff20ff80bc4ed63b94c55e42834ef2246a17632c01e1cbc664c79","userPreferences.lnk":"c46c4e569ccd12365e5763f35514cf2ae2442e6ac67fcbe297ba3d54468403747736d66e8563556581632468a3413c6d04db362781e3ee47193423109debc67e"},"moduleManager.js":"cfb4a7370d6c47f5f8d873a3a33de08b7c2997c7d6ba1a15b115009c1cf04cf85123000a4148c017fd66a7f1f00121676b78206e2147a898c9340c3812b7aeb5","pcosNetwork.js":"782342a026d4094eba32fda7e3c1908ab73eaecdc6ecbd237c316d2d06555adef8264c521e4c97b0ce1286db684e66ba6359a79af5e9cded808c3c4330c52436","personalSecurity.js":"d9c79171bbd012a10044f5796316a51d2a4d30ea4d3be26d75733b4c11f8f25e4f67377978ae8443d29061dd6ae40a4d1728ba7d71451922b2d61da6afeb8c25","sysAdmin.js":"9949f0e032b4a9ab1f10ed5e843dd240662be39981e3b59016ae5cc09ddd8df8059f2fcb7be3a12b51ee6261b1bb24f88477d4045e34bdae89eb310332ca3f80","systemSecurity.js":"c71ad41f89e57631996f21ff1a635819a2a0a957cfc981eaabe2ab338a22231e00deeebdd0d81db73885bd7e66540a32aabe25d30b4612d0648e6f8f546dfe8b","taskManager.js":"48c08266d2cc2a399b58701fd0b166c2613cd2262a973c44236b868fb0e8adce8c547b1c9c526c2fb313efa14e245d26eaf077f6b235e22606f11feb3ddfedcd","userPreferences.js":"2c8b7d121f8ea4275bf0f6e759f23f7f0fe9bba866537ac52a6f2a58639ed3351097cd866e395505d6d663a6f10669818ce0b5c20d51e1afbc650dc5863fd954"}},"permissions":{"apps/links/moduleManager.lnk":{"world":"rx"},"apps/links/pcosNetwork.lnk":{"world":"rx"},"apps/links/personalSecurity.lnk":{"world":"rx"},"apps/links/sysAdmin.lnk":{"world":"rx"},"apps/links/systemSecurity.lnk":{"world":"rx"},"apps/links/taskManager.lnk":{"world":"rx"},"apps/links/userPreferences.lnk":{"world":"rx"},"apps/links/":{"world":"rx"},"apps/moduleManager.js":{"world":"rx"},"apps/pcosNetwork.js":{"world":"rx"},"apps/personalSecurity.js":{"world":"rx"},"apps/sysAdmin.js":{"world":"rx"},"apps/systemSecurity.js":{"world":"rx"},"apps/taskManager.js":{"world":"rx"},"apps/userPreferences.js":{"world":"rx"},"apps/":{"world":"rx"},"":{"world":"rx"}}},"files":{"17e94101c150df5a046fa12f357ec7b825666e8dde94dfd6cc00ae812d6b791fd5fc7cb7f986d227b6c6806ddc2e0075f8c07b850623c8885a81feeaca1ebdb4":"{\"path\":\"system/apps/moduleManager.js\",\"localeReferenceName\":\"MODMGR_TITLE\"}","991178b0fb8e65e7fbee163a980ecc5e40bd3babd29365ef5f74296774a128a6fbb2b183c4b0f619dc70c8adaaceaa4160eaaea0accbba65a395bdb88701e93c":"{\"path\":\"system/apps/pcosNetwork.js\",\"localeReferenceName\":\"NETCONFIG_TITLE\"}","4a0aa7728de91c907646516466a348c3a1aa8031c178c0a20ff16553506b643dbd06469727e18ba8233983b4e1bff7f6dcad2953333ac5ce3b4c4a3ad903713c":"{\"path\":\"system/apps/personalSecurity.js\",\"localeReferenceName\":\"PERSONAL_SECURITY_TITLE\"}","8669c1a4801945d19e0cf20ba61b3497c4c419295cad93a79c0160b4ed92a55f2ccfe41a900f7f03f28a6edf38a0bd06216576bf81de5660046f51902d7aca77":"{\"path\":\"system/apps/sysAdmin.js\",\"localeReferenceName\":\"SYSADMIN_TOOLS_TITLE\"}","7f4e57bef374c98e7c315d06ea6e2a508af1d9e3c1d012bfbd3bf6978e90622ec08a9a8f3f33bf5838afed664691714ae0c9d930dae61538d354b5ea97a8ccf3":"{\"path\":\"system/apps/systemSecurity.js\",\"localeReferenceName\":\"SYSTEM_SECURITY_TITLE\"}","1b9360c4512676bd67d3d564dbe4b38b582f4d1aa44848a1020bdbb275ed1204dc0a8fb699eff20ff80bc4ed63b94c55e42834ef2246a17632c01e1cbc664c79":"{\"path\":\"system/apps/taskManager.js\",\"localeReferenceName\":\"TASK_MANAGER\"}","c46c4e569ccd12365e5763f35514cf2ae2442e6ac67fcbe297ba3d54468403747736d66e8563556581632468a3413c6d04db362781e3ee47193423109debc67e":"{\"path\":\"system/apps/userPreferences.js\",\"localeReferenceName\":\"USER_PREFERENCES\"}","cfb4a7370d6c47f5f8d873a3a33de08b7c2997c7d6ba1a15b115009c1cf04cf85123000a4148c017fd66a7f1f00121676b78206e2147a898c9340c3812b7aeb5":"// =====BEGIN MANIFEST=====\n// allow: GET_ROOT_KEY, FS_UNMOUNT, FS_MOUNT, CSP_OPERATIONS, GET_THEME, GET_LOCALE, FS_REMOVE, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, FS_BYPASS_PERMISSIONS, RESOLVE_NAME, CONNFUL_CONNECT, CONNFUL_READ, CONNFUL_WRITE, CONNFUL_DISCONNECT, GET_UPDATE_SERVICE, SYSTEM_SHUTDOWN, MANAGE_TOKENS, ELEVATE_PRIVILEGES, IPC_SEND_PIPE, GET_USER_INFO, START_TASK, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, GET_BOOT_MODE\n// signer: automaticSigner\n// signature: 6fb9c63bd7c0e25e6a35ae3e0a9f08d04885bf51ba8d64b22abde68625b7baa7dce5e3c906fd6f94ad35f873c4592f3a628f635782661676d4265f4b28424007\n// =====END MANIFEST=====\nlet cachedKeys = {};\nlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"MODMGR_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet checklist = [ \"FS_UNMOUNT\", \"FS_MOUNT\", \"CSP_OPERATIONS\", \"FS_REMOVE\", \"FS_READ\", \"FS_WRITE\", \"FS_LIST_PARTITIONS\", \"FS_BYPASS_PERMISSIONS\", \"RESOLVE_NAME\", \"CONNFUL_CONNECT\", \"CONNFUL_READ\", \"CONNFUL_WRITE\", \"CONNFUL_DISCONNECT\", \"GET_UPDATE_SERVICE\", \"SYSTEM_SHUTDOWN\", \"MANAGE_TOKENS\", \"ELEVATE_PRIVILEGES\" ];\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"MODMGR_PRIVFAIL\");\n\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\tintent: await availableAPIs.lookupLocale(\"MODMGR_INTENT\"),\n\t\t\tname: await availableAPIs.lookupLocale(\"MODMGR_TITLE\")\n\t\t});\n\t\tif (!newToken) return;\n\t\tawait availableAPIs.setProcessToken(newToken);\n\t\tawait availableAPIs.revokeToken(currentToken);\n\t\tprivileges = await availableAPIs.getPrivileges();\n\t\tif (!checklist.every(p => privileges.includes(p))) return;\n\t}\n\tdocument.body.innerText = \"\";\n\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tasync function regenerateKernel() {\n\t\ttry {\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"GENERATING_KERNEL\");\n\t\t\tlet entireBoot = [];\n\t\t\tlet bootFiles = await availableAPIs.fs_ls({ path: (await availableAPIs.getSystemMount()) + \"/boot\" });\n\t\t\tif (bootFiles.includes(\"00-compiled.js\")) bootFiles.splice(bootFiles.indexOf(\"00-compiled.js\"), 1);\n\t\t\tif (bootFiles.includes(\"99-zzpatchfinisher.js\")) bootFiles.splice(bootFiles.indexOf(\"99-zzpatchfinisher.js\"), 1);\n\t\t\tfor (let bootFile of bootFiles) {\n\t\t\t\tentireBoot.push([ bootFile, await availableAPIs.fs_read({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/\" + bootFile\n\t\t\t\t}) ]);\n\t\t\t}\n\t\t\tentireBoot = entireBoot.sort((a, b) => a[0].localeCompare(b[0]))\n\t\t\t\t.map(a => \"// modules/.../boot/\" + a[0] + \"\\n\" + a[1]).join(\"\\n\");\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/00-compiled.js\",\n\t\t\t\tdata: entireBoot + \"\\nreturn;/*\"\n\t\t\t});\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/99-zzpatchfinisher.js\",\n\t\t\t\tdata: \"*/\"\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"REGENERATING_KERNEL_FAILED\");\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync function coreFunction(program, env) {\n\t\tlet { moduleConfig, updateService } = env;\n\t\tlet statementNum = 0;\n\t\tlet isRegenNeeded = false;\n\t\tfor (let statement of program) {\n\t\t\tlet moduleName = statement.moduleName;\n\t\t\tlet localInfo = (moduleConfig.local || {})[moduleName];\n\t\t\tlet remoteInfo = (moduleConfig.remote || {})[moduleName];\n\t\t\tlet remoteFileName = remoteInfo?.bootOrder + \"-\" + remoteInfo?.commonName + \".fs\";\n\t\t\tlet localFileName = localInfo?.bootOrder + \"-\" + moduleName + \".fs\";\n\t\t\tactivityNote.innerText = (await availableAPIs.lookupLocale(\"MANAGING_MODULE\"))\n\t\t\t\t.replace(\"%s\", moduleName || (await availableAPIs.lookupLocale(\"UNKNOWN_PLACEHOLDER\"))).replace(\"%s\", statementNum + 1)\n\t\t\t\t.replace(\"%s\", program.length).replace(\"%s\", (statementNum / program.length * 100).toFixed(2));\n\t\t\tif (statement.type == \"install\") {\n\t\t\t\tif (statement.file) {\n\t\t\t\t\tremoteInfo = JSON.parse(await availableAPIs.fs_read({ path: statement.file })).buildInfo;\n\t\t\t\t\tremoteFileName = remoteInfo?.bootOrder + \"-\" + remoteInfo?.commonName + \".fs\";\n\t\t\t\t\tmoduleName = remoteInfo?.commonName;\n\t\t\t\t}\n\t\t\t\tif (localInfo && localInfo?.bootOrder != remoteInfo?.bootOrder)\n\t\t\t\t\tawait availableAPIs.fs_rm({\n\t\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/modules/\" + localFileName\n\t\t\t\t\t});\n\t\t\t\tlet moduleContent = statement.file ? (await availableAPIs.fs_read({ path: statement.file })) :\n\t\t\t\t\t(await bdpGet(new URL(\"/module_repository/\" + remoteFileName, updateService))).content;\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/modules/\" + remoteFileName,\n\t\t\t\t\tdata: moduleContent\n\t\t\t\t});\n\t\t\t\tlet parsedModule = JSON.parse(moduleContent);\n\t\t\t\tmoduleConfig.local[moduleName] = parsedModule?.buildInfo || remoteInfo;\n\t\t\t\tisRegenNeeded = parsedModule.backend?.files?.boot;\n\t\t\t} else if (statement.type == \"remove\") {\n\t\t\t\tisRegenNeeded = !!(JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/modules/\" + localFileName\n\t\t\t\t})).backend?.files?.boot);\n\t\t\t\tawait availableAPIs.fs_rm({ path: (await availableAPIs.getSystemMount()) + \"/modules/\" + localFileName });\n\t\t\t\tdelete moduleConfig.local[moduleName];\n\t\t\t}\n\t\t\tstatementNum++;\n\t\t}\n\t\tawait availableAPIs.fs_write({\n\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\",\n\t\t\tdata: JSON.stringify(moduleConfig)\n\t\t});\n\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"RELOADING_MODULES\");\n\t\tawait reloadModules(await availableAPIs.getSystemMount());\n\t\tif (isRegenNeeded) await regenerateKernel();\n\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\tif (isRegenNeeded) activityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP_REBOOT\");\n\t}\n\n\tlet styleElement = document.createElement(\"style\");\n\tstyleElement.innerText = `th, td { border: 1px solid black; }\n\ttable { overflow: scroll; min-width: 100%; width: max-content; }`;\n\tdocument.head.appendChild(styleElement);\n\tlet container = document.createElement(\"div\");\n\tlet activityNote = document.createElement(\"div\");\n\tlet updateModCfgBtn = document.createElement(\"button\");\n\tlet installOnlineModuleBtn = document.createElement(\"button\");\n\tlet installOfflineModuleBtn = document.createElement(\"button\");\n\tlet removeModuleBtn = document.createElement(\"button\");\n\tlet updateSystemButton = document.createElement(\"button\");\n\tlet regenerateKernelBtn = document.createElement(\"button\");\n\tlet repairOSBtn = document.createElement(\"button\");\n\tlet mountOfflineBtn = document.createElement(\"button\");\n\tlet umountOfflineBtn = document.createElement(\"button\");\n\tlet swapToSystemBtn = document.createElement(\"button\");\n\tlet reinventorizeBtn = document.createElement(\"button\");\n\n\tupdateModCfgBtn.innerText = await availableAPIs.lookupLocale(\"UPDATE_MODCFG\");\n\tinstallOnlineModuleBtn.innerText = await availableAPIs.lookupLocale(\"INSTALL_ONLINE_MODULE\");\n\tinstallOfflineModuleBtn.innerText = await availableAPIs.lookupLocale(\"INSTALL_OFFLINE_MODULE\");\n\tremoveModuleBtn.innerText = await availableAPIs.lookupLocale(\"REMOVE_MODULES\");\n\tupdateSystemButton.innerText = await availableAPIs.lookupLocale(\"UPDATE_BUTTON\");\n\tregenerateKernelBtn.innerText = await availableAPIs.lookupLocale(\"REGENERATE_KERNEL\");\n\trepairOSBtn.innerText = await availableAPIs.lookupLocale(\"REPAIR_OS\");\n\tmountOfflineBtn.innerText = await availableAPIs.lookupLocale(\"MOUNT_OFFLINE_OS\");\n\tumountOfflineBtn.innerText = await availableAPIs.lookupLocale(\"UMOUNT_OFFLINE_OS\");\n\tswapToSystemBtn.innerText = await availableAPIs.lookupLocale(\"SWAP_OFFLINE_OS\");\n\treinventorizeBtn.innerText = await availableAPIs.lookupLocale(\"REINVENTORIZE_MODULES\");\n\n\tupdateModCfgBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"UPDATING_MODCFG\");\n\t\ttry {\n\t\t\tlet updateService = new URL(\"bdp://localhost\");\n\t\t\tupdateService.hostname = (await availableAPIs.getUpdateService()) || \"pcosserver.pc\";\n\t\t\tlet moduleConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\"\n\t\t\t}));\n\t\t\tmoduleConfig.remote = JSON.parse((await bdpGet(new URL(\"/module_repository/moduleConfig.json\", updateService))).content);\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\",\n\t\t\t\tdata: JSON.stringify(moduleConfig)\n\t\t\t});\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"UPDATE_COUNTING\");\n\t\t\tlet forUpdate = [];\n\t\t\tfor (let module in moduleConfig.local) if (moduleConfig.remote.hasOwnProperty(module))\n\t\t\t\tif (moduleConfig.remote[module].version > moduleConfig.local[module].version) \n\t\t\t\t\tforUpdate.push(module);\n\t\t\tactivityNote.innerText = (await availableAPIs.lookupLocale(\"UPDATE_COUNT\")).replace(\"%s\", forUpdate.length);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_TO_UPDATE\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tinstallOnlineModuleBtn.addEventListener(\"click\", async function() {\n\t\tcontainer.hidden = true;\n\t\tawait availableAPIs.closeability(false);\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tlet updateService = new URL(\"bdp://localhost\");\n\t\t\tupdateService.hostname = (await availableAPIs.getUpdateService()) || \"pcosserver.pc\";\n\t\t\tlet moduleConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\"\n\t\t\t}));\n\t\t\tlet table = document.createElement(\"table\");\n\t\t\tlet tableHead = document.createElement(\"thead\");\n\t\t\tlet tableHeadRow = document.createElement(\"tr\");\n\t\t\tlet tableCellInstalled = document.createElement(\"th\");\n\t\t\tlet tableCellModName = document.createElement(\"th\");\n\t\t\tlet tableCellTrustedBy = document.createElement(\"th\");\n\t\t\tlet tableCellModVersion = document.createElement(\"th\");\n\t\t\tlet tableCellTargeting = document.createElement(\"th\");\n\t\t\tlet tableBody = document.createElement(\"tbody\");\n\t\t\tlet applyChangesBtn = document.createElement(\"button\");\n\t\t\tlet discardChangesBtn = document.createElement(\"button\");\n\t\t\ttableCellModName.innerText = await availableAPIs.lookupLocale(\"MODNAME_CELL\");\n\t\t\ttableCellTrustedBy.innerText = await availableAPIs.lookupLocale(\"MODTRUST_CELL\");\n\t\t\ttableCellModVersion.innerText = await availableAPIs.lookupLocale(\"MODVER_CELL\");\n\t\t\ttableCellTargeting.innerText = await availableAPIs.lookupLocale(\"MODTGT_CELL\");\n\t\t\tapplyChangesBtn.innerText = await availableAPIs.lookupLocale(\"APPLY_CHANGES\");\n\t\t\tdiscardChangesBtn.innerText = await availableAPIs.lookupLocale(\"DISCARD_CHANGES\");\n\t\t\tlet lostModules = Object.keys(moduleConfig.local).filter(a => !(moduleConfig.remote || {})[a]).sort((a, b) => a.localeCompare(b));\n\t\t\tlet remoteModules = Object.keys(moduleConfig.remote || {}).sort((a, b) => a.localeCompare(b));\n\t\t\tlet toInstall = [];\n\t\t\tfor (let module of lostModules) {\n\t\t\t\tlet tableRow = document.createElement(\"tr\");\n\t\t\t\tlet tableCellInstalled = document.createElement(\"td\");\n\t\t\t\tlet tableCellModName = document.createElement(\"td\");\n\t\t\t\tlet tableCellTrustedBy = document.createElement(\"td\");\n\t\t\t\tlet tableCellModVersion = document.createElement(\"td\");\n\t\t\t\tlet tableCellTargeting = document.createElement(\"td\");\n\t\t\t\tlet checkboxInstalled = document.createElement(\"input\");\n\t\t\t\tcheckboxInstalled.type = \"checkbox\";\n\t\t\t\tcheckboxInstalled.checked = true;\n\t\t\t\tcheckboxInstalled.disabled = true;\n\t\t\t\tlet friendlyName = await findModuleFriendlyName(moduleConfig.local[module]);\n\t\t\t\tlet signFriendlyName = await findModKeyFriendlyName(moduleConfig.local[module]);\n\t\t\t\ttableCellModName.innerText = friendlyName ? (friendlyName + \" (\" + module + \")\") : module;\n\t\t\t\ttableCellTrustedBy.innerText = signFriendlyName;\n\t\t\t\ttableCellModVersion.innerText = moduleConfig.local[module].version;\n\t\t\t\ttableCellTargeting.innerText = moduleConfig.local[module].for;\n\t\t\t\ttableCellInstalled.appendChild(checkboxInstalled);\n\t\t\t\ttableRow.appendChild(tableCellInstalled);\n\t\t\t\ttableRow.appendChild(tableCellModName);\n\t\t\t\ttableRow.appendChild(tableCellTrustedBy);\n\t\t\t\ttableRow.appendChild(tableCellModVersion);\n\t\t\t\ttableRow.appendChild(tableCellTargeting);\n\t\t\t\ttableBody.appendChild(tableRow);\n\t\t\t}\n\t\t\tfor (let module of remoteModules) {\n\t\t\t\tlet tableRow = document.createElement(\"tr\");\n\t\t\t\tlet tableCellInstalled = document.createElement(\"td\");\n\t\t\t\tlet tableCellModName = document.createElement(\"td\");\n\t\t\t\tlet tableCellTrustedBy = document.createElement(\"td\");\n\t\t\t\tlet tableCellModVersion = document.createElement(\"td\");\n\t\t\t\tlet tableCellTargeting = document.createElement(\"td\");\n\t\t\t\tlet checkboxInstalled = document.createElement(\"input\");\n\t\t\t\tcheckboxInstalled.type = \"checkbox\";\n\t\t\t\tlet isInstalled = false, isUpdatable = false;\n\t\t\t\tcheckboxInstalled.checked = checkboxInstalled.disabled = moduleConfig.local[module];\n\t\t\t\tif (checkboxInstalled.checked) isInstalled = true;\n\t\t\t\tif (checkboxInstalled.checked && moduleConfig.remote[module].version > moduleConfig.local[module].version) {\n\t\t\t\t\tcheckboxInstalled.checked = checkboxInstalled.disabled = false;\n\t\t\t\t\tcheckboxInstalled.indeterminate = true;\n\t\t\t\t\tisUpdatable = true;\n\t\t\t\t}\n\n\t\t\t\tcheckboxInstalled.onchange = function() {\n\t\t\t\t\tif (!checkboxInstalled.checked && isUpdatable) checkboxInstalled.indeterminate = true;\n\t\t\t\t\tif (toInstall.includes(module)) toInstall.splice(toInstall.indexOf(module), 1);\n\t\t\t\t\telse toInstall.push(module);\n\t\t\t\t};\n\n\t\t\t\tlet localFriendlyName = await findModuleFriendlyName(moduleConfig.local[module]);\n\t\t\t\tlet remoteFriendlyName = await findModuleFriendlyName(moduleConfig.remote[module]);\n\t\t\t\ttableCellModName.innerText = module;\n\t\t\t\tif ((localFriendlyName == remoteFriendlyName || !localFriendlyName) && remoteFriendlyName)\n\t\t\t\t\ttableCellModName.innerText = remoteFriendlyName + \" (\" + module + \")\";\n\t\t\t\telse if (remoteFriendlyName)\n\t\t\t\t\ttableCellModName.innerText = localFriendlyName + \" -> \" + remoteFriendlyName + \" (\" + module + \")\";\n\n\t\t\t\tlet localSignFriendlyName = await findModKeyFriendlyName(moduleConfig.local[module]);\n\t\t\t\tlet remoteSignFriendlyName = await findModKeyFriendlyName(moduleConfig.remote[module]);\n\t\t\t\tif (localSignFriendlyName == remoteSignFriendlyName || !isInstalled)\n\t\t\t\t\ttableCellTrustedBy.innerText = remoteSignFriendlyName;\n\t\t\t\telse if (remoteSignFriendlyName)\n\t\t\t\t\ttableCellTrustedBy.innerText = localSignFriendlyName + \" -> \" + remoteSignFriendlyName + \" (\" + module + \")\";\n\t\t\t\t\n\t\t\t\ttableCellModVersion.innerText = moduleConfig.remote[module].version;\n\t\t\t\tif (isInstalled && moduleConfig.remote[module].version > moduleConfig.local[module].version)\n\t\t\t\t\ttableCellModVersion.innerText = moduleConfig.local[module].version + \" -> \" + tableCellModVersion.innerText;\n\t\t\t\telse if (isInstalled && moduleConfig.remote[module].version < moduleConfig.local[module].version)\n\t\t\t\t\ttableCellModVersion.innerText = moduleConfig.local[module].version + \" <- \" + tableCellModVersion.innerText;\n\t\t\t\ttableCellTargeting.innerText = moduleConfig.remote[module].for;\n\t\t\t\tif (isInstalled && moduleConfig.remote[module].for != moduleConfig.local[module].for)\n\t\t\t\t\ttableCellTargeting.innerText = moduleConfig.local[module].version + \" -> \" + tableCellTargeting.innerText;\n\n\t\t\t\ttableCellInstalled.appendChild(checkboxInstalled);\n\t\t\t\ttableRow.appendChild(tableCellInstalled);\n\t\t\t\ttableRow.appendChild(tableCellModName);\n\t\t\t\ttableRow.appendChild(tableCellTrustedBy);\n\t\t\t\ttableRow.appendChild(tableCellModVersion);\n\t\t\t\ttableRow.appendChild(tableCellTargeting);\n\t\t\t\ttableBody.appendChild(tableRow);\n\t\t\t}\n\t\t\ttableHeadRow.appendChild(tableCellInstalled);\n\t\t\ttableHeadRow.appendChild(tableCellModName);\n\t\t\ttableHeadRow.appendChild(tableCellTrustedBy);\n\t\t\ttableHeadRow.appendChild(tableCellModVersion);\n\t\t\ttableHeadRow.appendChild(tableCellTargeting);\n\t\t\ttableHead.appendChild(tableHeadRow);\n\t\t\ttable.appendChild(tableHead);\n\t\t\ttable.appendChild(tableBody);\n\t\t\tactivityNote.appendChild(table);\n\t\t\tactivityNote.appendChild(applyChangesBtn);\n\t\t\tactivityNote.appendChild(discardChangesBtn);\n\t\t\tawait new Promise(async function(resolve, reject) {\n\t\t\t\tdiscardChangesBtn.onclick = _ => reject();\n\t\t\t\tapplyChangesBtn.onclick = async function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait coreFunction(toInstall.map(a => {return{ type: \"install\", moduleName: a }}), { updateService, moduleConfig });\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} catch (e) { reject(e); }\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tinstallOfflineModuleBtn.addEventListener(\"click\", async function() {\n\t\tcontainer.hidden = true;\n\t\tawait availableAPIs.closeability(false);\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tlet moduleConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\"\n\t\t\t}));\n\t\t\tlet result = {};\n\t\t\ttry {\n\t\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\t\tresult = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\t} catch (e) {\n\t\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\tif (result.selected)\n\t\t\t\tawait coreFunction([ { type: \"install\", file: result.selected } ], { moduleConfig });\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tremoveModuleBtn.addEventListener(\"click\", async function() {\n\t\tcontainer.hidden = true;\n\t\tawait availableAPIs.closeability(false);\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tlet updateService = new URL(\"bdp://localhost\");\n\t\t\tupdateService.hostname = (await availableAPIs.getUpdateService()) || \"pcosserver.pc\";\n\t\t\tlet moduleConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\"\n\t\t\t}));\n\t\t\tlet table = document.createElement(\"table\");\n\t\t\tlet tableHead = document.createElement(\"thead\");\n\t\t\tlet tableHeadRow = document.createElement(\"tr\");\n\t\t\tlet tableCellInstalled = document.createElement(\"th\");\n\t\t\tlet tableCellModName = document.createElement(\"th\");\n\t\t\tlet tableCellTargeting = document.createElement(\"th\");\n\t\t\tlet tableCellModVersion = document.createElement(\"th\");\n\t\t\tlet tableCellTrustedBy = document.createElement(\"th\");\n\t\t\tlet tableBody = document.createElement(\"tbody\");\n\t\t\tlet applyChangesBtn = document.createElement(\"button\");\n\t\t\tlet discardChangesBtn = document.createElement(\"button\");\n\t\t\ttableCellModName.innerText = await availableAPIs.lookupLocale(\"MODNAME_CELL\");\n\t\t\ttableCellTrustedBy.innerText = await availableAPIs.lookupLocale(\"MODTRUST_CELL\");\n\t\t\ttableCellModVersion.innerText = await availableAPIs.lookupLocale(\"MODVER_CELL\");\n\t\t\ttableCellTargeting.innerText = await availableAPIs.lookupLocale(\"MODTGT_CELL\");\n\t\t\tapplyChangesBtn.innerText = await availableAPIs.lookupLocale(\"APPLY_CHANGES\");\n\t\t\tdiscardChangesBtn.innerText = await availableAPIs.lookupLocale(\"DISCARD_CHANGES\");\n\t\t\tlet toRemove = [];\n\t\t\tlet unremovable = pargs.unremovable ? (pargs.unremovable instanceof Array ? pargs.unremovable : [ pargs.unremovable ]) : [ \"bootable\", \"core\", \"keys\" ];\n\t\t\tlet localModules = Object.keys(moduleConfig.local).sort((a, b) => a.localeCompare(b));\n\t\t\tfor (let module of localModules) {\n\t\t\t\tlet tableRow = document.createElement(\"tr\");\n\t\t\t\tlet tableCellInstalled = document.createElement(\"td\");\n\t\t\t\tlet tableCellModName = document.createElement(\"td\");\n\t\t\t\tlet tableCellTrustedBy = document.createElement(\"td\");\n\t\t\t\tlet tableCellModVersion = document.createElement(\"td\");\n\t\t\t\tlet tableCellTargeting = document.createElement(\"td\");\n\t\t\t\tlet checkboxInstalled = document.createElement(\"input\");\n\t\t\t\tcheckboxInstalled.type = \"checkbox\";\n\t\t\t\tcheckboxInstalled.checked = true;\n\t\t\t\tcheckboxInstalled.disabled = unremovable.includes(module);\n\n\t\t\t\tcheckboxInstalled.onchange = function() {\n\t\t\t\t\tif (toRemove.includes(module)) toRemove.splice(toRemove.indexOf(module), 1);\n\t\t\t\t\telse toRemove.push(module);\n\t\t\t\t};\n\n\t\t\t\tlet friendlyName = await findModuleFriendlyName(moduleConfig.local[module]);\n\t\t\t\tlet signFriendlyName = await findModKeyFriendlyName(moduleConfig.local[module]);\n\t\t\t\ttableCellModName.innerText = friendlyName ? (friendlyName + \" (\" + module + \")\") : module;\n\t\t\t\ttableCellTrustedBy.innerText = signFriendlyName;\n\t\t\t\ttableCellModVersion.innerText = moduleConfig.local[module].version;\n\t\t\t\ttableCellTargeting.innerText = moduleConfig.local[module].for;\n\n\t\t\t\ttableCellInstalled.appendChild(checkboxInstalled);\n\t\t\t\ttableRow.appendChild(tableCellInstalled);\n\t\t\t\ttableRow.appendChild(tableCellModName);\n\t\t\t\ttableRow.appendChild(tableCellTrustedBy);\n\t\t\t\ttableRow.appendChild(tableCellModVersion);\n\t\t\t\ttableRow.appendChild(tableCellTargeting);\n\t\t\t\ttableBody.appendChild(tableRow);\n\t\t\t}\n\t\t\ttableHeadRow.appendChild(tableCellInstalled);\n\t\t\ttableHeadRow.appendChild(tableCellModName);\n\t\t\ttableHeadRow.appendChild(tableCellTrustedBy);\n\t\t\ttableHeadRow.appendChild(tableCellModVersion);\n\t\t\ttableHeadRow.appendChild(tableCellTargeting);\n\t\t\ttableHead.appendChild(tableHeadRow);\n\t\t\ttable.appendChild(tableHead);\n\t\t\ttable.appendChild(tableBody);\n\t\t\tactivityNote.appendChild(table);\n\t\t\tactivityNote.appendChild(applyChangesBtn);\n\t\t\tactivityNote.appendChild(discardChangesBtn);\n\t\t\tawait new Promise(async function(resolve, reject) {\n\t\t\t\tdiscardChangesBtn.onclick = _ => reject();\n\t\t\t\tapplyChangesBtn.onclick = async function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait coreFunction(toRemove.map(a => {return{ type: \"remove\", moduleName: a }}), { updateService, moduleConfig });\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} catch (e) { reject(e); }\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tupdateSystemButton.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"UPDATING_MODULES\");\n\t\ttry {\n\t\t\tlet updateService = new URL(\"bdp://localhost\");\n\t\t\tupdateService.hostname = (await availableAPIs.getUpdateService()) || \"pcosserver.pc\";\n\t\t\tlet moduleConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\"\n\t\t\t}));\n\t\t\tlet forUpdate = [];\n\t\t\tfor (let module in moduleConfig.local) if (moduleConfig.remote.hasOwnProperty(module))\n\t\t\t\tif (moduleConfig.remote[module].version > moduleConfig.local[module].version) \n\t\t\t\t\tforUpdate.push(module);\n\t\t\tif (forUpdate.length) await coreFunction(forUpdate.map(a => {return{ type: \"install\", moduleName: a }}), { updateService, moduleConfig });\n\t\t\telse if (!forUpdate.length) activityNote.innerText = await availableAPIs.lookupLocale(\"SYSTEM_UP_TO_DATE\");\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_TO_UPDATE\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tregenerateKernelBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\ttry {\n\t\t\tawait regenerateKernel();\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t} catch {}\n\t\tawait availableAPIs.closeability(true);\n\t\tcontainer.hidden = false;\n\t});\n\n\trepairOSBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"REPAIRING_SYSTEM\");\n\t\ttry {\n\t\t\tlet updateService = new URL(\"bdp://localhost\");\n\t\t\tupdateService.hostname = (await availableAPIs.getUpdateService()) || \"pcosserver.pc\";\n\t\t\tlet moduleConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\"\n\t\t\t}));\n\t\t\tlet toRepair = Object.keys(moduleConfig.local).filter(a => !!(moduleConfig.remote || {})[a]).sort((a, b) => a.localeCompare(b));\n\t\t\tlet modNum = 0;\n\t\t\tfor (let module of toRepair) {\n\t\t\t\tactivityNote.innerText = (await availableAPIs.lookupLocale(\"REPAIRING_MODULE\")).replace(\"%s\", module).replace(\"%s\", modNum + 1).replace(\"%s\", toRepair.length).replace(\"%s\", (modNum / toRepair.length * 100).toFixed(2));\n\t\t\t\tlet moduleContent = (await bdpGet(new URL(\"/module_repository/\" + moduleConfig.remote[module].bootOrder + \"-\" + module + \".fs\", updateService))).content;\n\t\t\t\tawait availableAPIs.fs_rm({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/modules/\" + moduleConfig.local[module].bootOrder + \"-\" + module + \".fs\"\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/modules/\" + moduleConfig.remote[module].bootOrder + \"-\" + module + \".fs\",\n\t\t\t\t\tdata: moduleContent\n\t\t\t\t});\n\t\t\t\tmoduleConfig.local[module] = JSON.parse(moduleContent).buildInfo;\n\t\t\t\tmodNum++;\n\t\t\t}\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\",\n\t\t\t\tdata: JSON.stringify(moduleConfig)\n\t\t\t});\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"RELOADING_MODULES\");\n\t\t\tawait reloadModules(await availableAPIs.getSystemMount());\n\t\t\tawait regenerateKernel();\n\t\t\tawait availableAPIs.shutdown({ isReboot: true });\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"REPAIR_FAILED\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tmountOfflineBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tlet modSys = JSON.parse(await availableAPIs.fs_read({ path: \"ram/run/moduleSystem.json\" }));\n\t\t\tlet mountRelated = Object.entries(modSys).flat(Infinity);\n\t\t\tawait new Promise(async function(resolve, reject) {\n\t\t\t\tlet discardChangesBtn = document.createElement(\"button\");\n\t\t\t\tdiscardChangesBtn.onclick = _ => reject();\n\t\t\t\tdiscardChangesBtn.innerText = await availableAPIs.lookupLocale(\"DISCARD_CHANGES\");\n\t\t\t\tactivityNote.appendChild(discardChangesBtn);\n\t\t\t\tlet mountpoints = (await availableAPIs.fs_mounts()).filter(a => !mountRelated.includes(a));\n\t\t\t\tfor (let mountpoint of mountpoints) {\n\t\t\t\t\tlet mountBtn = document.createElement(\"button\");\n\t\t\t\t\tmountBtn.innerText = mountpoint;\n\t\t\t\t\tmountBtn.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"RELOADING_MODULES\");\n\t\t\t\t\t\t\tawait reloadModules(mountpoint, await availableAPIs.getSystemMount(), mountpoint + \"-sys\");\n\t\t\t\t\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tactivityNote.appendChild(mountBtn);\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tumountOfflineBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tlet modSys = JSON.parse(await availableAPIs.fs_read({ path: \"ram/run/moduleSystem.json\" }));\n\t\t\tlet systemMount = await availableAPIs.getSystemMount();\n\t\t\tawait new Promise(async function(resolve, reject) {\n\t\t\t\tlet discardChangesBtn = document.createElement(\"button\");\n\t\t\t\tdiscardChangesBtn.onclick = _ => reject();\n\t\t\t\tdiscardChangesBtn.innerText = await availableAPIs.lookupLocale(\"DISCARD_CHANGES\");\n\t\t\t\tactivityNote.appendChild(discardChangesBtn);\n\t\t\t\tlet mountpoints = (await availableAPIs.fs_mounts()).filter(a => modSys.hasOwnProperty(a) && a != systemMount);\n\t\t\t\tfor (let mountpoint of mountpoints) {\n\t\t\t\t\tlet mountBtn = document.createElement(\"button\");\n\t\t\t\t\tmountBtn.innerText = mountpoint;\n\t\t\t\t\tmountBtn.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"UNMOUNTING_MOUNTS\");\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: mountpoint });\n\t\t\t\t\t\t\tfor (let mount of modSys[mountpoint].slice(1))\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount });\n\t\t\t\t\t\t\tdelete modSys[mountpoint];\n\t\t\t\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\t\t\t\tpath: \"ram/run/moduleSystem.json\",\n\t\t\t\t\t\t\t\tdata: JSON.stringify(modSys)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tactivityNote.appendChild(mountBtn);\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tswapToSystemBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tlet modSys = JSON.parse(await availableAPIs.fs_read({ path: \"ram/run/moduleSystem.json\" }));\n\t\t\tlet systemMount = await availableAPIs.getSystemMount();\n\t\t\tawait new Promise(async function(resolve, reject) {\n\t\t\t\tlet discardChangesBtn = document.createElement(\"button\");\n\t\t\t\tdiscardChangesBtn.onclick = _ => reject();\n\t\t\t\tdiscardChangesBtn.innerText = await availableAPIs.lookupLocale(\"DISCARD_CHANGES\");\n\t\t\t\tactivityNote.appendChild(discardChangesBtn);\n\t\t\t\tlet mountpoints = (await availableAPIs.fs_mounts()).filter(a => modSys.hasOwnProperty(a) && a != systemMount);\n\t\t\t\tfor (let mountpoint of mountpoints) {\n\t\t\t\t\tlet mountBtn = document.createElement(\"button\");\n\t\t\t\t\tmountBtn.innerText = mountpoint;\n\t\t\t\t\tmountBtn.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SWAPPING_SYSTEMS\");\n\t\t\t\t\t\t\tlet oldSysName = await availableAPIs.getSystemMount();\n\t\t\t\t\t\t\tlet newOldSysName = await availableAPIs.getSystemMount();\n\t\t\t\t\t\t\twhile (modSys[newOldSysName]) newOldSysName = newOldSysName + \"~\";\n\t\t\t\t\t\t\tmodSys[newOldSysName] = modSys[oldSysName];\n\t\t\t\t\t\t\tmodSys[oldSysName] = modSys[mountpoint];\n\t\t\t\t\t\t\tdelete modSys[mountpoint];\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: oldSysName });\n\t\t\t\t\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\t\t\t\t\tmountpoint: newOldSysName,\n\t\t\t\t\t\t\t\tfilesystem: \"overlayMount\",\n\t\t\t\t\t\t\t\tfilesystemOptions: {\n\t\t\t\t\t\t\t\t\tmounts: modSys[newOldSysName]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: mountpoint });\n\t\t\t\t\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\t\t\t\t\tmountpoint: oldSysName,\n\t\t\t\t\t\t\t\tfilesystem: \"overlayMount\",\n\t\t\t\t\t\t\t\tfilesystemOptions: {\n\t\t\t\t\t\t\t\t\tmounts: modSys[oldSysName]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\t\t\t\tpath: \"ram/run/moduleSystem.json\",\n\t\t\t\t\t\t\t\tdata: JSON.stringify(modSys)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tactivityNote.appendChild(mountBtn);\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\treinventorizeBtn.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\tactivityNote.innerText = \"\";\n\t\ttry {\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"REINVENTORIZING_MODULES\");\n\t\t\tlet basePath = (await availableAPIs.getSystemMount()) + \"/modules\";\n\t\t\tlet installedModules = await availableAPIs.fs_ls({ path: basePath });\n\t\t\tlet moduleNum = 0;\n\t\t\tlet moduleConfig = { local: {} };\n\t\t\tfor (let moduleName of installedModules) {\n\t\t\t\tactivityNote.innerText = (await availableAPIs.lookupLocale(\"MANAGING_MODULE\")).replace(\"%s\", moduleName).replace(\"%s\", moduleNum + 1)\n\t\t\t\t\t.replace(\"%s\", installedModules.length).replace(\"%s\", (moduleNum / installedModules.length * 100).toFixed(2));\n\t\t\t\t\n\t\t\t\tlet buildInfo = JSON.parse(await availableAPIs.fs_read({ path: basePath + \"/\" + moduleName })).buildInfo;\n\t\t\t\tmoduleConfig.local[buildInfo.commonName] = buildInfo;\n\t\t\t\t\n\t\t\t\tmoduleNum++;\n\t\t\t}\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/moduleConfig.json\",\n\t\t\t\tdata: JSON.stringify(moduleConfig)\n\t\t\t});\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tactivityNote.innerText = await availableAPIs.lookupLocale(\"FAILED_OP\");\n\t\t}\n\t\tcontainer.hidden = false;\n\t\tawait availableAPIs.closeability(true);\n\t});\n\n\tcontainer.appendChild(updateModCfgBtn);\n\tcontainer.appendChild(installOnlineModuleBtn);\n\tcontainer.appendChild(installOfflineModuleBtn);\n\tcontainer.appendChild(removeModuleBtn);\n\tcontainer.appendChild(updateSystemButton);\n\tcontainer.appendChild(regenerateKernelBtn);\n\tcontainer.appendChild(repairOSBtn);\n\tcontainer.appendChild(mountOfflineBtn);\n\tcontainer.appendChild(umountOfflineBtn);\n\tcontainer.appendChild(swapToSystemBtn);\n\tcontainer.appendChild(reinventorizeBtn);\n\tdocument.body.appendChild(container);\n\tdocument.body.appendChild(activityNote);\n})();\nasync function findModuleFriendlyName(moduleConfig) {\n\tif (moduleConfig?.friendlyNameDB) return moduleConfig.friendlyNameDB[await availableAPIs.lookupLocale(\"OS_LOCALE\")];\n\tif (moduleConfig?.friendlyNameRef) return await availableAPIs.lookupLocale(moduleConfig.friendlyNameRef);\n\treturn moduleConfig?.friendlyName;\n}\nasync function findModKeyFriendlyName(moduleConfig) {\n\tif (!moduleConfig?.signer) {\n\t\tif (moduleConfig?.commonName == \"keys\" && moduleConfig?.bootOrder == \"00\")\n\t\t\treturn await availableAPIs.lookupLocale(\"ROOT_KEY_CELL\");\n\t\treturn await availableAPIs.lookupLocale(\"UNSIGNED_CELL\");\n\t}\n\tif (!cachedKeys[moduleConfig.signer]) try {\n\t\tcachedKeys[moduleConfig.signer] = JSON.parse(await availableAPIs.fs_read({\n\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/keys/\" + moduleConfig.signer\n\t\t}));\n\t} catch { cachedKeys[moduleConfig.signer] = {}; }\n\tif (!cachedKeys.hasOwnProperty(moduleConfig.signer)) return moduleConfig.signer;\n\tlet signatureKey = cachedKeys[moduleConfig.signer]?.keyInfo;\n\tconsole.log(signatureKey);\n\tif (signatureKey?.friendlyNameDB) return signatureKey.friendlyNameDB[await availableAPIs.lookupLocale(\"OS_LOCALE\")] + \" (\" + moduleConfig.signer + \")\";\n\tif (signatureKey?.friendlyName) return signatureKey.friendlyName + \" (\" + moduleConfig.signer + \")\";\n\treturn moduleConfig.signer;\n}\nasync function recursiveKeyVerify(mnt, key, khrl) {\n\tif (!key) throw new Error(\"NO_KEY\");\n\tif (key.keyInfo.dates?.since > Date.now()) throw new Error(\"KEY_NOT_IN_TIME\");\n\tif (Date.now() > key.keyInfo.dates?.until) throw new Error(\"KEY_NOT_IN_TIME\");\n\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\tlet hash = u8aToHex(new Uint8Array(await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"digest\",\n\t\tcspArgument: {\n\t\t\talgorithm: \"SHA-256\",\n\t\t\tdata: new TextEncoder().encode((key.keyInfo.key).x)\n\t\t}\n\t})));\n\tif (khrl.includes(hash)) throw new Error(\"KEY_REVOKED\");\n\tlet signedByKey;\n\tif (key.keyInfo.signedBy) {\n\t\tsignedByKey = JSON.parse(await availableAPIs.fs_read({ path: mnt + \"/etc/keys/\" + key.keyInfo.signedBy }));\n\t\tif (!signedByKey.keyInfo.usages.includes(\"keyTrust\")) throw new Error(\"NOT_KEY_AUTHORITY\");\n\t\tawait recursiveKeyVerify(mnt, signedByKey, khrl);\n\t} else signedByKey = { keyInfo: { key: await availableAPIs.getRootKey() } };\n\tsignedByKey = await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"importKey\",\n\t\tcspArgument: {\n\t\t\tformat: \"jwk\",\n\t\t\tkeyData: signedByKey.keyInfo.key,\n\t\t\talgorithm: { name: \"Ed25519\" },\n\t\t\textractable: false,\n\t\t\tkeyUsages: [ \"verify\" ]\n\t\t}\n\t});\n\tlet verify = await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"verify\",\n\t\tcspArgument: {\n\t\t\talgorithm: { name: \"Ed25519\" },\n\t\t\tkey: signedByKey,\n\t\t\tsignature: hexToU8A(key.signature),\n\t\t\tdata: new TextEncoder().encode(JSON.stringify(key.keyInfo))\n\t\t}\n\t});\n\tawait availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"unloadKey\",\n\t\tcspArgument: signedByKey\n\t});\n\tif (!verify) throw new Error(\"KEY_SIGNATURE_VERIFICATION_FAILED\");\n\treturn true;\n}\nasync function reloadModules(mnt, getKeysFrom, newName) {\n\tlet khrlFiles = await availableAPIs.fs_ls({ path: (getKeysFrom || mnt) + \"/etc/keys/khrl\" });\n\tlet khrl = [];\n\tlet rootKeyImport = await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"importKey\",\n\t\tcspArgument: {\n\t\t\tformat: \"jwk\",\n\t\t\tkeyData: await availableAPIs.getRootKey(),\n\t\t\talgorithm: { name: \"Ed25519\" },\n\t\t\textractable: false,\n\t\t\tkeyUsages: [ \"verify\" ]\n\t\t}\n\t});\n\tfor (let file of khrlFiles) {\n\t\tlet khrlFile = JSON.parse(await availableAPIs.fs_read({ path: (getKeysFrom || mnt) + \"/etc/keys/khrl/\" + file }));\n\t\tif (await availableAPIs.cspOperation({\n\t\t\tcspProvider: \"basic\",\n\t\t\toperation: \"verify\",\n\t\t\tcspArgument: {\n\t\t\t\talgorithm: { name: \"Ed25519\" },\n\t\t\t\tkey: rootKeyImport,\n\t\t\t\tsignature: hexToU8A(khrlFile.signature),\n\t\t\t\tdata: new TextEncoder().encode(JSON.stringify(khrlFile.list))\n\t\t\t}\n\t\t})) khrl.push(...khrlFile.list);\n\t}\n\tawait availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"unloadKey\",\n\t\tcspArgument: rootKeyImport\n\t});\n\tlet modSys = JSON.parse(await availableAPIs.fs_read({ path: \"ram/run/moduleSystem.json\" }));\n\tlet prevMnt = modSys[mnt];\n\tif (prevMnt) prevMnt = prevMnt[0];\n\tlet moduleFiles = (await availableAPIs.fs_ls({ path: mnt + \"/modules\" })).sort((a, b) => a.localeCompare(b));\n\tlet mntList = [];\n\tfor (let moduleName of moduleFiles) {\n\t\ttry {\n\t\t\tlet fullModuleFile = {};\n\t\t\ttry {\n\t\t\t\tfullModuleFile = JSON.parse(await availableAPIs.fs_read({ path: mnt + \"/modules/\" + moduleName }));\n\t\t\t} catch {}\n\t\t\tif (!fullModuleFile.buildInfo) continue;\n\t\t\tlet fullModuleSignature = fullModuleFile.buildInfo.signature;\n\t\t\tdelete fullModuleFile.buildInfo.signature;\n\t\t\tif (await availableAPIs.checkBootMode() != \"disable-harden\") {\n\t\t\t\tlet critical = moduleName != \"00-keys.fs\" || fullModuleFile.buildInfo.critical;\n\t\t\t\ttry {\n\t\t\t\t\tlet signingKey;\n\t\t\t\t\tif (moduleName != \"00-keys.fs\") {\n\t\t\t\t\t\tsigningKey = JSON.parse(await availableAPIs.fs_read({ path: (getKeysFrom || mnt) + \"/etc/keys/\" + fullModuleFile.buildInfo.signer }));\n\t\t\t\t\t\tif (!signingKey.keyInfo.usages.includes(\"moduleTrust\")) throw new Error(\"NOT_MODULE_SIGNING_KEY\");\n\t\t\t\t\t\tawait recursiveKeyVerify(getKeysFrom || mnt, signingKey, khrl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsigningKey = { keyInfo: { key: await availableAPIs.getRootKey() } };\n\t\t\t\t\t}\n\t\t\t\t\tlet importSigningKey = await availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\tformat: \"jwk\",\n\t\t\t\t\t\t\tkeyData: signingKey.keyInfo.key,\n\t\t\t\t\t\t\talgorithm: { name: \"Ed25519\" },\n\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\tkeyUsages: [ \"verify\" ]\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfullModuleFile = JSON.stringify(fullModuleFile);\n\t\t\t\t\tlet verify = await availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"verify\",\n\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\talgorithm: { name: \"Ed25519\" },\n\t\t\t\t\t\t\tkey: importSigningKey,\n\t\t\t\t\t\t\tsignature: hexToU8A(fullModuleSignature),\n\t\t\t\t\t\t\tdata: new TextEncoder().encode(fullModuleFile)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\tcspArgument: importSigningKey\n\t\t\t\t\t});\n\t\t\t\t\tif (!verify) throw new Error(\"MODULE_SIGNATURE_VERIFICATION_FAILED\");\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (critical) throw e;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet randomMntName = \".\" + (await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(8)\n\t\t\t})).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\tmountpoint: randomMntName,\n\t\t\t\tfilesystem: \"fileMount\",\n\t\t\t\tfilesystemOptions: {\n\t\t\t\t\tsrcFile: mnt + \"/modules/\" + moduleName,\n\t\t\t\t\tread_only: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tmntList.push(randomMntName);\n\t\t} catch (e) {\n\t\t\tfor (let mount of mntList)\n\t\t\t\tawait availableAPIs.fs_unmount({ mount });\n\t\t\tthrow e;\n\t\t}\n\t}\n\tif (!newName) {\n\t\tawait availableAPIs.fs_unmount({ mount: mnt });\n\t\tfor (let mount of modSys[mnt].slice(1))\n\t\t\tawait availableAPIs.fs_unmount({ mount });\n\t}\n\tmodSys[newName || mnt] = [ prevMnt || mnt, ...mntList ];\n\tawait availableAPIs.fs_mount({\n\t\tmountpoint: newName || mnt,\n\t\tfilesystem: \"overlayMount\",\n\t\tfilesystemOptions: {\n\t\t\tmounts: modSys[newName || mnt]\n\t\t}\n\t});\n\tawait availableAPIs.fs_write({\n\t\tpath: \"ram/run/moduleSystem.json\",\n\t\tdata: JSON.stringify(modSys)\n\t});\n}\nasync function bdpGet(path) {\n\tlet url = new URL(path);\n\tif (url.protocol != \"bdp:\") throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_PROTO\"));\n\tif (url.port) throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_GATESET\"));\n\tlet hostname = url.hostname, address;\n\tif (url.hostname.includes(\"[\")) {\n\t\thostname = IPv6Decompressor(url.hostname.slice(1, -1)).replaceAll(\":\", \"\");\n\t\taddress = hostname;\n\t} else address = await availableAPIs.resolve(hostname);\n\tif (!address) throw new Error(await availableAPIs.lookupLocale(\"HOSTNAME_RESOLUTION_FAILED\"));\n\tlet connection = await availableAPIs.connfulConnect({\n\t\tgate: url.username || \"blog\",\n\t\taddress,\n\t\tverifyByDomain: hostname\n\t});\n\tawait availableAPIs.connfulConnectionSettled(connection);\n\tawait availableAPIs.connfulWrite({\n\t\tconnectionID: connection,\n\t\tdata: new TextEncoder().encode(url.pathname + url.search),\n\t\thost: hostname\n\t});\n\tlet data = new TextDecoder().decode(await availableAPIs.connfulRead(connection));\n\tdata = JSON.parse(data);\n\tlet chunks = [];\n\twhile (chunks.length != data.length) {\n\t\tlet newData = new TextDecoder().decode(await availableAPIs.connfulRead(connection));\n\t\tnewData = JSON.parse(newData);\n\t\tchunks[newData.ctr] = newData.chunk;\n\t}\n\ttry {\n\t\tawait availableAPIs.connfulDisconnect(connection);\n\t} catch {}\n\treturn { ...data, content: chunks.join(\"\") };\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","782342a026d4094eba32fda7e3c1908ab73eaecdc6ecbd237c316d2d06555adef8264c521e4c97b0ce1286db684e66ba6359a79af5e9cded808c3c4330c52436":"// =====BEGIN MANIFEST=====\n// link: lrn:NETCONFIG_TITLE\n// signer: automaticSigner\n// fnName: networkInstaller\n// allow: RELOAD_NETWORK_CONFIG, IDENTIFY_SYSTEM, CSP_OPERATIONS, FS_READ, FS_WRITE, FS_REMOVE, FS_LIST_PARTITIONS, GET_LOCALE, GET_SERVER_URL, LIST_TASKS, GET_THEME, FS_BYPASS_PERMISSIONS\n// signature: 8d78822790599b659686e43d7fac117380c8c7b09f171af0b23d6fd29732a0f18e59ef461e8ab91d11509a49170153e0935f02fe5e70118302408bfd8a9dea05\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"NETCONFIG_TITLE\") || \"PCOS Network configurator\");\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"IDENTIFY_SYSTEM\", \"CSP_OPERATIONS\", \"FS_READ\", \"FS_WRITE\", \"FS_LIST_PARTITIONS\", \"GET_LOCALE\", \"GET_SERVER_URL\", \"LIST_TASKS\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\ttry {\n\t\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\t} catch {}\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_DENY\") || \"Insufficient privileges.\";\n\t\treturn;\n\t}\n\tlet existingConfig = {};\n\ttry {\n\t\texistingConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/network.json\"\n\t\t}));\n\t} catch {}\n\tlet descriptionNetworkURL = document.createElement(\"span\");\n\tlet descriptionUCBits = document.createElement(\"span\");\n\tlet descriptionHostname = document.createElement(\"span\");\n\tlet descriptionUpdates = document.createElement(\"span\");\n\tlet paramNetworkURL = document.createElement(\"input\");\n\tlet ucBits = document.createElement(\"input\");\n\tlet paramHostname = document.createElement(\"input\");\n\tlet paramUpdates = document.createElement(\"input\");\n\tlet saveBtn = document.createElement(\"button\");\n\tlet updatePredictBtn = document.createElement(\"button\");\n\tlet addressPrediction = document.createElement(\"span\");\n\tlet form = document.createElement(\"form\");\n\tlet originUrl = new URL(await availableAPIs.runningServer());\n\toriginUrl.protocol = \"ws\" + (originUrl.protocol == \"https:\" ? \"s\" : \"\") + \":\";\n\tdescriptionNetworkURL.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_URLF\");\n\tdescriptionUCBits.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_UC\");\n\tdescriptionHostname.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_HOSTNAME\");\n\tdescriptionUpdates.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_UPDATES\");\n\tparamNetworkURL.value = existingConfig.url || originUrl.origin;\n\tucBits.type = \"number\";\n\tucBits.min = 0;\n\tucBits.max = 4294967295;\n\tucBits.value = existingConfig.ucBits;\n\tparamHostname.value = existingConfig.hostname || \"\";\n\tparamUpdates.value = existingConfig.updates || \"pcosserver.pc\";\n\tsaveBtn.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SAVE\");\n\tupdatePredictBtn.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_PREDICT\");\n\tform.appendChild(descriptionNetworkURL);\n\tform.appendChild(paramNetworkURL);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(descriptionUCBits);\n\tform.appendChild(ucBits);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(descriptionHostname);\n\tform.appendChild(paramHostname);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(descriptionUpdates);\n\tform.appendChild(paramUpdates);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(saveBtn);\n\tform.appendChild(updatePredictBtn);\n\taddressPrediction.innerText = await availableAPIs.lookupLocale(\"EMPTY_STATUSBAR\");\n\tdocument.body.appendChild(form);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tdocument.body.appendChild(addressPrediction);\n\tsaveBtn.addEventListener(\"click\", async function(e) {\n\t\te.preventDefault();\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/network.json\",\n\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\turl: paramNetworkURL.value,\n\t\t\t\t\tucBits: Math.round(Math.abs(Number(ucBits.value))),\n\t\t\t\t\thostname: paramHostname.value,\n\t\t\t\t\tupdates: paramUpdates.value\n\t\t\t\t}, null, \"\\t\")\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_rm({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/apps/services/networkd.lnk\"\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.reloadNetworkConfig();\n\t\t\t} catch {}\n\t\t\taddressPrediction.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SAVE_OK\");\n\t\t} catch {\n\t\t\taddressPrediction.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SAVE_FAIL\");\n\t\t}\n\t});\n\tupdatePredictBtn.addEventListener(\"click\", function(e) {\n\t\te.preventDefault();\n\t\tupdatePrediction({ addressPrediction, ucBits });\n\t});\n})();\nfunction findInputNumberString(output, chars) {\n\tlet inputNum = 0n;\n\tfor (let i = 0n; i < output.length; i++) {\n\t\tconst charIndex = chars.indexOf(output[i]);\n\t\tif (charIndex === -1) throw new Error(`Invalid character '${output[i]}' in output string`);\n\t\tinputNum = inputNum * BigInt(chars.length) + BigInt(charIndex);\n\t}\n\treturn inputNum;\n}\nfunction generateString(num, chars) {\n\tlet base = BigInt(chars.length), result = '';\n\twhile (num > 0n) result = chars[Number(num % base)] + result, num /= base;\n\treturn result;\n}\n\nasync function updatePrediction(elementInterface) {\n\tlet publicSystemID = await availableAPIs.getPublicSystemID();\n\tif (!publicSystemID) return elementInterface.addressPrediction.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SYSIDM\");\n\tlet sysIDx = u8aToHex(new Uint8Array(await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"digest\",\n\t\tcspArgument: {\n\t\t\talgorithm: \"SHA-256\",\n\t\t\tdata: Uint8Array.from(atob(publicSystemID.x.replaceAll(\"-\", \"+\").replaceAll(\"_\", \"/\")).split(\"\").map(a => a.charCodeAt()))\n\t\t}\n\t}))).slice(0, 12);\n\tlet ucPredict = Math.round(Math.abs(Number(elementInterface.ucBits.value))).toString(16).padStart(8, \"0\").slice(0, 8);\n\treturn elementInterface.addressPrediction.innerText = (\"xxxxxxxxxxxx\" + sysIDx + ucPredict).match(/.{1,4}/g).join(\":\");\n}\nlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","d9c79171bbd012a10044f5796316a51d2a4d30ea4d3be26d75733b4c11f8f25e4f67377978ae8443d29061dd6ae40a4d1728ba7d71451922b2d61da6afeb8c25":"// =====BEGIN MANIFEST=====\n// link: lrn:PERSONAL_SECURITY_TITLE\n// signer: automaticSigner\n// allow: SET_SECURITY_CHECKS, GET_USER_INFO, CSP_OPERATIONS, GET_LOCALE, GET_THEME\n// signature: 47bb79d1a5ae03ce70f114bdf97edbc701381bf91e4decdc365484bc8a32540a019ff758cf5fbefeba398ff53db2ba91d9a12e055046da13458afd56389cd00f\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"SET_SECURITY_CHECKS\", \"GET_USER_INFO\", \"CSP_OPERATIONS\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_DENY\");\n\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\tintent: await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_INTENT\"),\n\t\t\tname: await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_TITLE\"),\n\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t});\n\t\tif (!newToken) return;\n\t\tawait availableAPIs.setProcessToken(newToken);\n\t\tawait availableAPIs.revokeToken(currentToken);\n\t\tprivileges = await availableAPIs.getPrivileges();\n\t\tif (!checklist.every(p => privileges.includes(p))) return;\n\t}\n\tlet toolbar = document.createElement(\"div\");\n\tlet saveBtn = document.createElement(\"button\");\n\tlet loadBtn = document.createElement(\"button\");\n\tlet addBtn = document.createElement(\"button\");\n\ttoolbar.appendChild(saveBtn);\n\ttoolbar.appendChild(loadBtn);\n\ttoolbar.appendChild(addBtn);\n\tsaveBtn.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\tloadBtn.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\taddBtn.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\tsaveBtn.onclick = async function() {\n\t\tawait availableAPIs.setOwnSecurityChecks({ checks });\n\t\tchecks = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser(), sensitive: true })).securityChecks;\n\t\treparse();\n\t};\n\tloadBtn.onclick = async function() {\n\t\tchecks = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser(), sensitive: true })).securityChecks;\n\t\treparse();\n\t};\n\taddBtn.onclick = function() {\n\t\tadd();\n\t}\n\tdocument.body.appendChild(toolbar);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tlet secCheck = document.createElement(\"div\");\n\tlet types = [\n\t\t\"pbkdf2\",\n\t\t\"informative\",\n\t\t\"informative_deny\",\n\t\t\"timeout\",\n\t\t\"timeout_deny\",\n\t\t\"serverReport\",\n\t\t\"pc-totp\",\n\t\t\"totp\",\n\t\t\"workingHours\",\n\t\t\"zkpp\",\n\t\t\"privrestrict\"\n\t];\n\tlet checks = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser(), sensitive: true })).securityChecks;\n\n\tlet checkLocales = {\n\t\t\"pbkdf2\": \"PBKDF2_OPTION\",\n\t\t\"informative\": \"INFORMATIVE_MESSAGE_OPTION\",\n\t\t\"informative_deny\": \"INFORMATIVE_MESSAGE_DENY_OPTION\",\n\t\t\"timeout\": \"TIMEOUT_OPTION\",\n\t\t\"timeout_deny\": \"TIMEOUT_DENY_OPTION\",\n\t\t\"serverReport\": \"SERVER_REPORT_OPTION\",\n\t\t\"pc-totp\": \"PCTOTP_OPTION\",\n\t\t\"totp\": \"RFCTOTP_OPTION\",\n\t\t\"workingHours\": \"WORKING_HOURS_OPTION\",\n\t\t\"zkpp\": \"ZKPP_OPTION\",\n\t\t\"privrestrict\": \"RESTRICT_OPTION\"\n\t};\n\n\tasync function reparse() {\n\t\tsecCheck.remove();\n\t\tsecCheck = document.createElement(\"div\");\n\n\t\tfor (let check in checks) {\n\t\t\tlet checkInfo = checks[check];\n\t\t\tlet checkDiv = document.createElement(\"div\");\n\t\t\tcheckDiv.style.display = \"flex\";\n\t\t\tlet checkTitle = document.createElement(\"div\");\n\t\t\tcheckTitle.style.flex = 100;\n\t\t\tlet checkBtns = document.createElement(\"div\");\n\t\t\tcheckTitle.innerText = await availableAPIs.lookupLocale(checkLocales[checkInfo.type]);\n\t\t\tlet btnConfig = document.createElement(\"button\");\n\t\t\tlet btnUp = document.createElement(\"button\");\n\t\t\tlet btnDown = document.createElement(\"button\");\n\t\t\tlet btnDelete = document.createElement(\"button\");\n\t\t\tbtnConfig.innerText = \"*\";\n\t\t\tbtnUp.innerText = \"/\\\\\";\n\t\t\tbtnUp.disabled = check == 0;\n\t\t\tbtnDown.disabled = check == checks.length - 1;\n\t\t\tbtnDown.innerText = \"\\\\/\";\n\t\t\tbtnDelete.innerText = \"x\";\n\t\t\tcheckBtns.appendChild(btnConfig);\n\t\t\tcheckBtns.appendChild(btnUp);\n\t\t\tcheckBtns.appendChild(btnDown);\n\t\t\tcheckBtns.appendChild(btnDelete);\n\t\t\tcheckDiv.appendChild(checkTitle);\n\t\t\tcheckDiv.appendChild(checkBtns);\n\t\t\tbtnDelete.addEventListener(\"click\", function() {\n\t\t\t\tchecks.splice(check, 1);\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tsecCheck.appendChild(checkDiv);\n\t\t\tbtnUp.addEventListener(\"click\", function() {\n\t\t\t\tchecks.splice(check, 1);\n\t\t\t\tchecks.splice(check - 1, 0, checkInfo);\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tbtnDown.addEventListener(\"click\", function() {\n\t\t\t\tchecks.splice(check, 1);\n\t\t\t\tchecks.splice(check - 1 + 2, 0, checkInfo);\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tbtnConfig.addEventListener(\"click\", function() {\n\t\t\t\tcheckConfig(check);\n\t\t\t});\n\t\t}\n\t\tdocument.body.appendChild(secCheck);\n\t}\n\n\tasync function checkConfig(check) {\n\t\tsecCheck.remove();\n\t\tsecCheck = document.createElement(\"div\");\n\t\tlet checkInfo = checks[check];\n\t\tlet checkBack = document.createElement(\"button\");\n\t\tlet checkName = document.createElement(\"b\");\n\t\tcheckBack.innerText = \"<-\";\n\t\tcheckName.innerText = await availableAPIs.lookupLocale(checkLocales[checkInfo.type]);\n\t\tsecCheck.appendChild(checkBack);\n\t\tsecCheck.appendChild(checkName);\n\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\tcheckBack.addEventListener(\"click\", function() {\n\t\t\treparse();\n\t\t});\n\t\tif (checkInfo.type == \"pbkdf2\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"PASSWORD\") + \": \";\n\t\t\tinputBox.type = \"password\";\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tinputAccept.addEventListener(\"click\", async function() {\n\t\t\t\tlet salt = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t});\n\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\tkeyData: new TextEncoder().encode(inputBox.value),\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\tsalt: salt,\n\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\tlength: 256\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key\n\t\t\t\t});\n\t\t\t\tchecks[check] = {\n\t\t\t\t\ttype: \"pbkdf2\",\n\t\t\t\t\thash: u8aToHex(derived),\n\t\t\t\t\tsalt: u8aToHex(salt)\n\t\t\t\t};\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"informative\" || checkInfo.type == \"informative_deny\") {\n\t\t\tlet textarea = document.createElement(\"textarea\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\ttextarea.placeholder = await availableAPIs.lookupLocale(\"MESSAGE_ENTER\");\n\t\t\ttextarea.value = checkInfo.message;\n\t\t\tsecCheck.appendChild(textarea);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].message = textarea.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"timeout\" || checkInfo.type == \"timeout_deny\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"TIMEOUT_FIELD\") + \": \";\n\t\t\tinputBox.type = \"number\";\n\t\t\tinputBox.value = checkInfo.timeout;\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].timeout = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"serverReport\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = \"URL: \";\n\t\t\tinputBox.type = \"text\";\n\t\t\tinputBox.placeholder = \"https://example.org/report\";\n\t\t\tinputBox.value = checkInfo.url;\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].url = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"pc-totp\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet regen = document.createElement(\"button\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"SECRET_FIELD_TXT\") + \": \";\n\t\t\tinputBox.type = \"text\";\n\t\t\tinputBox.value = checkInfo.secret;\n\t\t\tregen.innerText = await availableAPIs.lookupLocale(\"REGENERATE\");\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(regen);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tregen.addEventListener(\"click\", async function() {\n\t\t\t\tlet randomValues = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(32)\n\t\t\t\t});\n\t\t\t\tinputBox.value = Array.from(randomValues).map(x => x.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t});\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].secret = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"totp\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet regen = document.createElement(\"button\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"SECRET_FIELD_HEX\") + \": \";\n\t\t\tinputBox.type = \"text\";\n\t\t\tinputBox.value = checkInfo.secret;\n\t\t\tregen.innerText = await availableAPIs.lookupLocale(\"REGENERATE\");\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(regen);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tregen.addEventListener(\"click\", async function() {\n\t\t\t\tlet randomValues = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(10)\n\t\t\t\t});\n\t\t\t\tinputBox.value = Array.from(randomValues).map(x => x.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t});\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].secret = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"workingHours\") {\n\t\t\tlet inputStartDescribe = document.createElement(\"span\");\n\t\t\tlet inputEndDescribe = document.createElement(\"span\");\n\t\t\tlet inputBoxStart = document.createElement(\"input\");\n\t\t\tlet inputBoxEnd = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputStartDescribe.innerText = await availableAPIs.lookupLocale(\"START_TIME_FIELD\") + \": \";\n\t\t\tinputBoxStart.type = \"time\";\n\t\t\tinputBoxStart.step = 1;\n\t\t\tif (checkInfo.start) inputBoxStart.value = String(checkInfo.start.hours).padStart(2, \"0\") + \":\" + String(checkInfo.start.minutes).padStart(2, \"0\") + \":\" + String(checkInfo.start.seconds).padStart(2, \"0\");\n\t\t\tinputEndDescribe.innerText = await availableAPIs.lookupLocale(\"END_TIME_FIELD\") + \": \";\n\t\t\tinputBoxEnd.type = \"time\";\n\t\t\tinputBoxEnd.step = 1;\n\t\t\tif (checkInfo.end) inputBoxEnd.value = String(checkInfo.end.hours).padStart(2, \"0\") + \":\" + String(checkInfo.end.minutes).padStart(2, \"0\") + \":\" + String(checkInfo.end.seconds).padStart(2, \"0\");\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputStartDescribe);\n\t\t\tsecCheck.appendChild(inputBoxStart);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(inputEndDescribe);\n\t\t\tsecCheck.appendChild(inputBoxEnd);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].start = {\n\t\t\t\t\thours: Number(inputBoxStart.value.split(\":\")[0]),\n\t\t\t\t\tminutes: Number(inputBoxStart.value.split(\":\")[1]),\n\t\t\t\t\tseconds: Number(inputBoxStart.value.split(\":\")[2])\n\t\t\t\t};\n\t\t\t\tchecks[check].end = {\n\t\t\t\t\thours: Number(inputBoxEnd.value.split(\":\")[0]),\n\t\t\t\t\tminutes: Number(inputBoxEnd.value.split(\":\")[1]),\n\t\t\t\t\tseconds: Number(inputBoxEnd.value.split(\":\")[2])\n\t\t\t\t};\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"zkpp\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"PASSWORD\") + \": \";\n\t\t\tinputBox.type = \"password\";\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tinputAccept.addEventListener(\"click\", async function() {\n\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\tkeyData: new TextEncoder().encode(inputBox.value),\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\tlength: 256\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key\n\t\t\t\t});\n\t\t\t\tlet publicKey = (await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\tseed: derived\n\t\t\t\t\t}\n\t\t\t\t})).publicKey;\n\t\t\t\tchecks[check] = {\n\t\t\t\t\ttype: \"zkpp\",\n\t\t\t\t\tpublicKey: u8aToHex(publicKey)\n\t\t\t\t};\n\t\t\t\treparse();\n\t\t\t});\n\t\t}\n\t\tdocument.body.appendChild(secCheck);\n\t}\n\n\tasync function add() {\n\t\tsecCheck.remove();\n\t\tsecCheck = document.createElement(\"div\");\n\t\tlet backBtn = document.createElement(\"button\");\n\t\tbackBtn.innerText = \"<-\";\n\t\tbackBtn.addEventListener(\"click\", function() {\n\t\t\treparse();\n\t\t});\n\t\tsecCheck.appendChild(backBtn);\n\t\tfor (let type of types) {\n\t\t\tlet btn = document.createElement(\"button\");\n\t\t\tbtn.innerText = await availableAPIs.lookupLocale(checkLocales[type]);\n\t\t\tbtn.addEventListener(\"click\", function() {\n\t\t\t\tchecks.push({ type });\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tsecCheck.appendChild(btn);\n\t\t}\n\t\tdocument.body.appendChild(secCheck);\n\t}\n\treparse();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","9949f0e032b4a9ab1f10ed5e843dd240662be39981e3b59016ae5cc09ddd8df8059f2fcb7be3a12b51ee6261b1bb24f88477d4045e34bdae89eb310332ca3f80":"// =====BEGIN MANIFEST=====\n// link: lrn:SYSADMIN_TOOLS_TITLE\n// signer: automaticSigner\n// fnName: sysadminInstaller\n// allow: SYSTEM_SHUTDOWN, FETCH_SEND, LLDISK_WRITE, RUN_KLVL_CODE, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, GET_LOCALE, GET_THEME, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, FS_BYPASS_PERMISSIONS, LLDISK_READ, LLDISK_LIST_PARTITIONS, LLDISK_INIT_PARTITIONS, LLDISK_REMOVE, LLDISK_IDB_READ, LLDISK_IDB_WRITE, LLDISK_IDB_REMOVE, LLDISK_IDB_LIST, LLDISK_IDB_SYNC, IPC_SEND_PIPE, START_TASK, FS_REMOVE, FS_MOUNT, SET_FIRMWARE, GET_USER_INFO\n// signature: 94dbc2335fba220812b7a26fd0ff5c95b251900c9a49901f40604c7232348b4c354db07a84fcda8a784928b4c4fd8bdc701e2cfc5c16e149964804afe220b901\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet container = document.createElement(\"div\");\n\tlet extraActivities = document.createElement(\"div\");\n\tlet fsckOrderButton = document.createElement(\"button\");\n\tlet fsckDiscardButton = document.createElement(\"button\");\n\tlet wipeSystemButton = document.createElement(\"button\");\n\tlet updateFirmwareButton = document.createElement(\"button\");\n\tlet imagingButton = document.createElement(\"button\");\n\tlet changeLocale = document.createElement(\"button\");\n\tfsckOrderButton.innerText = await availableAPIs.lookupLocale(\"FSCK_BUTTON\");\n\tfsckDiscardButton.innerText = await availableAPIs.lookupLocale(\"DISCARD_BUTTON\");\n\twipeSystemButton.innerText = await availableAPIs.lookupLocale(\"SWIPE_BUTTON\");\n\tupdateFirmwareButton.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_BUTTON\");\n\timagingButton.innerText = await availableAPIs.lookupLocale(\"SYSTEM_IMAGING\");\n\tchangeLocale.innerText = await availableAPIs.lookupLocale(\"CHANGE_LOCALE\");\n\tfsckOrderButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"SYSTEM_SHUTDOWN\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG\");\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/.fsck\",\n\t\t\t\tdata: \"recover\"\n\t\t\t});\n\t\t} catch {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\tfsckDiscardButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"SYSTEM_SHUTDOWN\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG\");\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/.fsck\",\n\t\t\t\tdata: \"discard\"\n\t\t\t});\n\t\t} catch {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\twipeSystemButton.addEventListener(\"click\", async function() {\n\t\tcontainer.hidden = true;\n\t\tlet promptMessage = document.createElement(\"span\");\n\t\tlet inputBox = document.createElement(\"input\");\n\t\tlet randomString = Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16);\n\t\tpromptMessage.innerText = \"Copy-paste \" + randomString + \" to confirm: \";\n\t\textraActivities.innerText = \"\";\n\t\textraActivities.appendChild(promptMessage);\n\t\textraActivities.appendChild(inputBox);\n\t\tawait new Promise(function(resolve, reject) {\n\t\t\tinputBox.oninput = async function() {\n\t\t\t\tif (inputBox.value.trim() == randomString) resolve();\n\t\t\t\telse {\n\t\t\t\t\tcontainer.hidden = false;\n\t\t\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\t\t\treject(\"Invalid confirmation\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tlet checklist = [ \"FS_REMOVE\", \"FS_MOUNT\", \"FS_READ\", \"LLDISK_IDB_READ\", \"LLDISK_IDB_WRITE\", \"LLDISK_IDB_REMOVE\", \"LLDISK_IDB_LIST\", \"LLDISK_IDB_SYNC\", \"SYSTEM_SHUTDOWN\", \"FS_BYPASS_PERMISSIONS\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\tcontainer.hidden = false;\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"WIPING_SYSTEM\");\n\t\ttry {\n\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\tmountpoint: \"pref\",\n\t\t\t\tfilesystem: \"preferenceMount\",\n\t\t\t\tfilesystemOptions: {}\n\t\t\t});\n\t\t\tlet prefOpts = await availableAPIs.fs_ls({ path: \"pref\" });\n\t\t\tfor (let prefOpt of prefOpts) await availableAPIs.fs_rm({ path: \"pref/\" + prefOpt });\n\t\t\tlet idb_keys = await availableAPIs.lldaIDBList();\n\t\t\tfor (let key of idb_keys) {\n\t\t\t\tlet partLen = (await availableAPIs.lldaIDBRead({ key })).length;\n\t\t\t\tlet randomness = \"\";\n\t\t\t\twhile (randomness.length < partLen) {\n\t\t\t\t\tlet remainingBytes = Math.round((partLen - randomness.length) / 2);\n\t\t\t\t\tif (remainingBytes > 65536) remainingBytes = 65536;\n\t\t\t\t\trandomness += crypto.getRandomValues(new Uint8Array(remainingBytes)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\t\t}\n\t\t\t\tawait availableAPIs.lldaIDBWrite({ key, value: randomness });\n\t\t\t\tawait availableAPIs.lldaIDBSync();\n\t\t\t\tawait availableAPIs.lldaIDBRemove({ key });\n\t\t\t\tawait availableAPIs.lldaIDBSync();\n\t\t\t}\n\t\t\t\n\t\t\tawait availableAPIs.shutdown({});\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tconsole.error(e);\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"WIPING_SYSTEM_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t});\n\t\n\tupdateFirmwareButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"FETCH_SEND\", \"SYSTEM_SHUTDOWN\", \"SET_FIRMWARE\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOADING\");\n\t\tlet fwArchive;\n\t\ttry {\n\t\t\tfwArchive = await availableAPIs.fetchSend({\n\t\t\t\turl: \"/init.js\",\n\t\t\t\tinit: {}\n\t\t\t});\n\t\t\tif (!fwArchive.ok) throw new Error(\"Download failed\");\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tconsole.error(e);\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOAD_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_DECODING\");\n\t\tfwArchive = fwArchive.arrayBuffer;\n\t\tfwArchive = new TextDecoder().decode(fwArchive);\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_SETTING\");\n\t\tawait availableAPIs.setFirmware(fwArchive);\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\timagingButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"GET_THEME\", \"LLDISK_READ\", \"LLDISK_WRITE\", \"LLDISK_LIST_PARTITIONS\", \"LLDISK_INIT_PARTITIONS\", \"LLDISK_REMOVE\", \"LLDISK_IDB_READ\", \"LLDISK_IDB_WRITE\", \"LLDISK_IDB_REMOVE\", \"LLDISK_IDB_LIST\", \"LLDISK_IDB_SYNC\", \"FS_READ\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"SYSTEM_SHUTDOWN\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\", \"GET_LOCALE\", \"IPC_CREATE_PIPE\", \"IPC_LISTEN_PIPE\", \"START_TASK\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SYSTEM_IMAGING\"));\n\t\timaging();\n\t});\n\tchangeLocale.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"GET_THEME\", \"GET_LOCALE\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"RUN_KLVL_CODE\", \"FS_LIST_PARTITIONS\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = \"\";\n\t\tlet locales = await availableAPIs.installedLocales();\n\t\tlet localeSelect = document.createElement(\"select\");\n\t\tlet localeZero = document.createElement(\"option\");\n\t\tlocaleZero.value = \"\";\n\t\tlocaleZero.innerText = \"  Language  \";\n\t\tlocaleZero.selected = true;\n\t\tlocaleZero.disabled = true;\n\t\tlocaleZero.hidden = true;\n\t\tlocaleSelect.appendChild(localeZero);\n\t\tfor (let locale of locales) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = locale;\n\t\t\toption.innerText = await availableAPIs.lookupOtherLocale({ key: \"LOCALE_NAME\", locale });\n\t\t\tlocaleSelect.appendChild(option);\n\t\t}\n\t\tlocaleSelect.addEventListener(\"change\", async function() {\n\t\t\tawait availableAPIs.runKlvlCode(\"modules.locales.defaultLocale = \" + JSON.stringify(localeSelect.value));\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/06-localeset.js\", \n\t\t\t\tdata: \"modules.locales.defaultLocale = \" + JSON.stringify(await availableAPIs.osLocale()) + \";\\n\"\n\t\t\t});\n\t\t\ttry {\n\t\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"GENERATING_KERNEL\");\n\t\t\t\tlet entireBoot = [];\n\t\t\t\tlet bootFiles = await availableAPIs.fs_ls({ path: (await availableAPIs.getSystemMount()) + \"/boot\" });\n\t\t\t\tif (bootFiles.includes(\"00-compiled.js\")) bootFiles.splice(bootFiles.indexOf(\"00-compiled.js\"), 1);\n\t\t\t\tif (bootFiles.includes(\"99-zzpatchfinisher.js\")) bootFiles.splice(bootFiles.indexOf(\"99-zzpatchfinisher.js\"), 1);\n\t\t\t\tfor (let bootFile of bootFiles) {\n\t\t\t\t\tentireBoot.push([ bootFile, await availableAPIs.fs_read({\n\t\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/\" + bootFile\n\t\t\t\t\t}) ]);\n\t\t\t\t}\n\t\t\t\tentireBoot = entireBoot.sort((a, b) => a[0].localeCompare(b[0]))\n\t\t\t\t\t.map(a => \"// modules/.../boot/\" + a[0] + \"\\n\" + a[1]).join(\"\\n\");\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/00-compiled.js\",\n\t\t\t\t\tdata: entireBoot + \"\\nreturn;/*\"\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/99-zzpatchfinisher.js\",\n\t\t\t\t\tdata: \"*/\"\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"REGENERATING_KERNEL_FAILED\");\n\t\t\t}\n\t\t\tlocaleSelect.remove();\n\t\t\tcontainer.hidden = false;\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t});\n\t\textraActivities.appendChild(localeSelect);\n\t});\n\tcontainer.appendChild(fsckOrderButton);\n\tcontainer.appendChild(fsckDiscardButton);\n\tcontainer.appendChild(wipeSystemButton);\n\tcontainer.appendChild(updateFirmwareButton);\n\tcontainer.appendChild(imagingButton);\n\tcontainer.appendChild(changeLocale);\n\tdocument.body.appendChild(container);\n\tdocument.body.appendChild(extraActivities);\n})();\nfunction imaging() {\n\tasync function mainPage() {\n\t\tdocument.body.innerText = \"\";\n\t\tlet create = document.createElement(\"button\");\n\t\tlet restore = document.createElement(\"button\");\n\t\tcreate.innerText = await availableAPIs.lookupLocale(\"CREATE_IMAGE\");\n\t\trestore.innerText = await availableAPIs.lookupLocale(\"RESTORE_IMAGE\");\n\t\tcreate.onclick = createPage;\n\t\trestore.onclick = restorePage;\n\t\tdocument.body.appendChild(create);\n\t\tdocument.body.appendChild(restore);\n\t}\n\n\tasync function createPage() {\n\t\tdocument.body.innerText = \"\";\n\t\tlet backBtn = document.createElement(\"button\");\n\t\tlet pageTitle = document.createElement(\"span\");\n\t\tlet selectedFileLabel = document.createElement(\"label\");\n\t\tlet selectedFile = document.createElement(\"input\");\n\t\tlet selectedFileButton = document.createElement(\"button\");\n\t\tlet createBtn = document.createElement(\"button\");\n\t\tlet progressBar = document.createElement(\"progress\");\n\t\tlet outcome = document.createElement(\"span\");\n\t\tbackBtn.innerText = \"<-\";\n\t\tpageTitle.innerText = await availableAPIs.lookupLocale(\"CREATE_IMAGE\");\n\t\tselectedFileLabel.innerText = await availableAPIs.lookupLocale(\"SELECT_FILE_PROMPT\");\n\t\tselectedFileButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\t\tcreateBtn.innerText = await availableAPIs.lookupLocale(\"CREATE_IMAGE\");\n\t\toutcome.innerText = await availableAPIs.lookupLocale(\"EMPTY_STATUSBAR\");\n\t\tprogressBar.hidden = true;\n\t\tdocument.body.appendChild(backBtn);\n\t\tdocument.body.appendChild(pageTitle);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(selectedFileLabel);\n\t\tdocument.body.appendChild(selectedFile);\n\t\tdocument.body.appendChild(selectedFileButton);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(createBtn);\n\t\tdocument.body.appendChild(progressBar);\n\t\tdocument.body.appendChild(outcome);\n\n\t\tbackBtn.onclick = mainPage;\n\t\tselectedFileButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) selectedFile.value = result.selected;\n\t\t}\n\n\t\tcreateBtn.onclick = async function() {\n\t\t\tbackBtn.disabled = true;\n\t\t\tselectedFile.disabled = true;\n\t\t\tselectedFileButton.disabled = true;\n\t\t\tcreateBtn.disabled = true;\n\t\t\tprogressBar.hidden = false;\n\t\t\toutcome.hidden = true;\n\t\t\tprogressBar.max = 0;\n\t\t\tprogressBar.value = 0;\n\t\t\tawait availableAPIs.closeability(false);\n\n\t\t\tasync function stopProduction(oc) {\n\t\t\t\tbackBtn.disabled = false;\n\t\t\t\tselectedFile.disabled = false;\n\t\t\t\tselectedFileButton.disabled = false;\n\t\t\t\tcreateBtn.disabled = false;\n\t\t\t\tprogressBar.hidden = true;\n\t\t\t\toutcome.hidden = false;\n\t\t\t\toutcome.innerText = oc;\n\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t}\n\n\t\t\tif (selectedFile.value == \"\") return stopProduction(await availableAPIs.lookupLocale(\"FILE_NOT_SPECIFIED\"));\n\t\t\tlet image = { metadata: {}, data: {} };\n\t\t\tlet subImage = [];\n\t\t\ttry { subImage = await availableAPIs.lldaList(); progressBar.max = subImage.length;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_PARTITIONS_FAILED\")); }\n\t\t\tfor (let partition of subImage) try { image.metadata[partition] = await availableAPIs.lldaRead({ partition }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction((await availableAPIs.lookupLocale(\"READING_PARTITION_FAILED\")).replace(\"%s\", partition)); }\n\t\t\ttry { subImage = await availableAPIs.lldaIDBList(); progressBar.max += subImage.length;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_DATA_FAILED\")); } \n\t\t\tfor (let dataPart of subImage) try { image.data[dataPart] = await availableAPIs.lldaIDBRead({ key: dataPart }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"READING_DATA_FAILED\")); }\n\t\t\tsubImage = [];\n\t\t\ttry { await availableAPIs.fs_write({ path: selectedFile.value, data: JSON.stringify(image) });\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"WRITING_IMAGE_FAILED\")); }\n\t\t\tstopProduction(await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\"));\n\t\t}\n\t}\n\n\tasync function restorePage() {\n\t\tdocument.body.innerText = \"\";\n\t\tlet backBtn = document.createElement(\"button\");\n\t\tlet pageTitle = document.createElement(\"span\");\n\t\tlet selectedFileLabel = document.createElement(\"label\");\n\t\tlet selectedFile = document.createElement(\"input\");\n\t\tlet selectedFileButton = document.createElement(\"button\");\n\t\tlet rebootOnRestore = document.createElement(\"input\");\n\t\tlet rebootOnRestoreLabel = document.createElement(\"label\");\n\t\tlet mergeFlag = document.createElement(\"input\");\n\t\tlet mergeFlagLabel = document.createElement(\"label\");\n\t\tlet restoreBtn = document.createElement(\"button\");\n\t\tlet progressBar = document.createElement(\"progress\");\n\t\tlet outcome = document.createElement(\"span\");\n\t\tbackBtn.innerText = \"<-\";\n\t\tpageTitle.innerText = await availableAPIs.lookupLocale(\"RESTORE_IMAGE\");\n\t\tselectedFileLabel.innerText = await availableAPIs.lookupLocale(\"SELECT_FILE_PROMPT\");\n\t\tselectedFileButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\trestoreBtn.innerText = await availableAPIs.lookupLocale(\"RESTORE_IMAGE\");\n\t\trebootOnRestoreLabel.innerText = await availableAPIs.lookupLocale(\"REBOOT_ON_RESTORE\");\n\t\tmergeFlagLabel.innerText = await availableAPIs.lookupLocale(\"MERGE_STATES\");\n\t\toutcome.innerText = await availableAPIs.lookupLocale(\"EMPTY_STATUSBAR\");\n\t\trebootOnRestore.type = \"checkbox\";\n\t\tmergeFlag.type = \"checkbox\";\n\t\trebootOnRestore.id = \"rebootOnRestore\";\n\t\tmergeFlag.id = \"mergeFlag\";\n\t\trebootOnRestoreLabel.htmlFor = \"rebootOnRestore\";\n\t\tmergeFlagLabel.htmlFor = \"mergeFlag\";\n\t\tprogressBar.hidden = true;\n\t\tdocument.body.appendChild(backBtn);\n\t\tdocument.body.appendChild(pageTitle);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(selectedFileLabel);\n\t\tdocument.body.appendChild(selectedFile);\n\t\tdocument.body.appendChild(selectedFileButton);\n\t\tdocument.body.appendChild(document.createElement(\"br\"));\n\t\tdocument.body.appendChild(rebootOnRestore);\n\t\tdocument.body.appendChild(rebootOnRestoreLabel);\n\t\tdocument.body.appendChild(document.createElement(\"br\"));\n\t\tdocument.body.appendChild(mergeFlag);\n\t\tdocument.body.appendChild(mergeFlagLabel);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(restoreBtn);\n\t\tdocument.body.appendChild(progressBar);\n\t\tdocument.body.appendChild(outcome);\n\n\t\tbackBtn.onclick = mainPage;\n\t\tselectedFileButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) selectedFile.value = result.selected;\n\t\t}\n\n\t\trestoreBtn.onclick = async function() {\n\t\t\tbackBtn.disabled = true;\n\t\t\tselectedFile.disabled = true;\n\t\t\tselectedFileButton.disabled = true;\n\t\t\trestoreBtn.disabled = true;\n\t\t\trebootOnRestore.disabled = true;\n\t\t\tmergeFlag.disabled = true;\n\t\t\toutcome.hidden = true;\n\t\t\tprogressBar.hidden = false;\n\t\t\tprogressBar.max = 0;\n\t\t\tprogressBar.value = 0;\n\t\t\tawait availableAPIs.closeability(false);\n\n\t\t\tasync function stopProduction(oc) {\n\t\t\t\tbackBtn.disabled = false;\n\t\t\t\tselectedFile.disabled = false;\n\t\t\t\tselectedFileButton.disabled = false;\n\t\t\t\trestoreBtn.disabled = false;\n\t\t\t\trebootOnRestore.disabled = false;\n\t\t\t\tmergeFlag.disabled = false;\n\t\t\t\toutcome.hidden = false;\n\t\t\t\tprogressBar.hidden = true;\n\t\t\t\toutcome.innerText = oc;\n\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t}\n\n\t\t\tif (selectedFile.value == \"\") return stopProduction(await availableAPIs.lookupLocale(\"FILE_NOT_SPECIFIED\"));\n\t\t\ttry { await availableAPIs.lldaList();\n\t\t\t\t} catch { await availableAPIs.lldaInitPartitions(); }\n\n\t\t\tlet image;\n\t\t\ttry { image = JSON.parse(await availableAPIs.fs_read({ path: selectedFile.value }));\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"READING_IMAGE_FAILED\")); }\n\n\t\t\tprogressBar.max += Object.keys(image.metadata).length + Object.keys(image.data).length;\n\t\t\tfor (let partition in image.metadata) try { await availableAPIs.lldaWrite({ partition, data: image.metadata[partition] }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction((await availableAPIs.lookupLocale(\"WRITING_PARTITION_FAILED\")).replace(\"%s\", partition)); }\n\t\t\tfor (let dataPart in image.data) try { await availableAPIs.lldaIDBWrite({ key: dataPart, value: image.data[dataPart] }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"WRITING_DATA_FAILED\")); }\n\t\t\t\n\t\t\tif (!mergeFlag.checked) {\n\t\t\t\tlet currentSubImage = [];\n\t\t\t\ttry { currentSubImage = (await availableAPIs.lldaList()).filter(a => !Object.keys(image.metadata).includes(a)); progressBar.max += currentSubImage.length;\n\t\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_PARTITIONS_FAILED\")); }\n\t\t\t\tfor (let partition of currentSubImage) try { await availableAPIs.lldaRemove({ partition }); progressBar.value++;\n\t\t\t\t\t} catch { return stopProduction((await availableAPIs.lookupLocale(\"DELETING_PARTITION_FAILED\")).replace(\"%s\", partition)); }\n\t\t\t\t\n\t\t\t\ttry { currentSubImage = (await availableAPIs.lldaIDBList()).filter(a => !Object.keys(image.data).includes(a)); progressBar.max += currentSubImage.length;\n\t\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_DATA_FAILED\")); }\n\t\t\t\tfor (let dataPart of currentSubImage) try { await availableAPIs.lldaIDBRemove({ key: dataPart }); progressBar.value++;\n\t\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"DELETING_DATA_FAILED\")); }\n\t\t\t\tcurrentSubImage = [];\n\t\t\t}\n\n\t\t\ttry { await availableAPIs.lldaIDBSync();\n\t\t\t} catch {}\n\n\t\t\tif (rebootOnRestore.checked) try { await availableAPIs.shutdown({ isReboot: true });\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"SHUTTING_DOWN_FAILED\")); }\n\t\t\tstopProduction(await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\"));\n\t\t}\n\t}\n\tmainPage();\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","c71ad41f89e57631996f21ff1a635819a2a0a957cfc981eaabe2ab338a22231e00deeebdd0d81db73885bd7e66540a32aabe25d30b4612d0648e6f8f546dfe8b":"// =====BEGIN MANIFEST=====\n// link: lrn:SYSTEM_SECURITY_TITLE\n// signer: automaticSigner\n// allow: GET_USER_INFO, USER_INFO_OTHERS, SENSITIVE_USER_INFO_OTHERS, SET_USER_INFO, GET_LOCALE, GET_THEME, CSP_OPERATIONS, SET_SECURITY_CHECKS, FS_LIST_PARTITIONS, FS_READ, FS_REMOVE, FS_WRITE, FS_CHANGE_PERMISSION, START_TASK, FS_BYPASS_PERMISSIONS, MANAGE_TOKENS, SWITCH_USERS_AUTOMATICALLY, ELEVATE_PRIVILEGES, GET_USER_LIST\n// signature: b65bfd704ab78ac9ce099a8b641984359af507907348d52c59bd95b1062a180312d5b05993b67e1d806a961d986f4eeed7aca606b382f4bb073f822782a3d401\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"GET_USER_INFO\", \"USER_INFO_OTHERS\", \"SENSITIVE_USER_INFO_OTHERS\", \"SET_USER_INFO\", \"FS_LIST_PARTITIONS\", \"FS_READ\", \"FS_REMOVE\", \"FS_WRITE\", \"FS_CHANGE_PERMISSION\", \"START_TASK\", \"FS_BYPASS_PERMISSIONS\", \"MANAGE_TOKENS\", \"SWITCH_USERS_AUTOMATICALLY\", \"ELEVATE_PRIVILEGES\", \"GET_USER_LIST\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_DENY\");\n\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\tintent: await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_INTENT\"),\n\t\t\tname: await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_TITLE\"),\n\t\t});\n\t\tif (!newToken) return;\n\t\tawait availableAPIs.setProcessToken(newToken);\n\t\tawait availableAPIs.revokeToken(currentToken);\n\t\tprivileges = await availableAPIs.getPrivileges();\n\t\tif (!checklist.every(p => privileges.includes(p))) return;\n\t}\n\tdocument.body.innerText = \"\";\n\tlet pageHeader = document.createElement(\"b\");\n\tlet actionSpecificField = document.createElement(\"div\");\n\tdocument.body.appendChild(pageHeader);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tdocument.body.appendChild(actionSpecificField);\n\tlet username, userData;\n\tasync function main() {\n\t\tusername = null;\n\t\tuserData = null;\n\t\tactionSpecificField.innerText = \"\";\n\t\tlet usernameField = document.createElement(\"input\");\n\t\tlet editButton = document.createElement(\"button\");\n\t\tpageHeader.innerText = await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\teditButton.innerText = await availableAPIs.lookupLocale(\"EDIT\");\n\t\tusernameField.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\tactionSpecificField.appendChild(usernameField);\n\t\tactionSpecificField.appendChild(editButton);\n\t\tactionSpecificField.appendChild(document.createElement(\"hr\"));\n\t\tfor (let user of await availableAPIs.getUsers()) {\n\t\t\tlet userButton = document.createElement(\"button\");\n\t\t\tuserButton.innerText = user;\n\t\t\tuserButton.addEventListener(\"click\", async function() {\n\t\t\t\tusernameField.value = user;\n\t\t\t\teditButton.click();\n\t\t\t});\n\t\t\tactionSpecificField.appendChild(userButton);\n\t\t}\n\t\teditButton.addEventListener(\"click\", async function() {\n\t\t\tif (!usernameField.value) return;\n\t\t\tusername = usernameField.value;\n\t\t\tuserData = await availableAPIs.getUserInfo({ desiredUser: username, sensitive: true });\n\t\t\tif (!userData) {\n\t\t\t\tuserData = {\n\t\t\t\t\tgroups: [username],\n\t\t\t\t\thomeDirectory: await availableAPIs.getSystemMount() + \"/home/\" + username,\n\t\t\t\t\tsecurityChecks: [],\n\t\t\t\t\tblankPrivileges: false\n\t\t\t\t};\n\t\t\t\tawait availableAPIs.setUserInfo({ desiredUser: username, info: userData });\n\t\t\t}\n\t\t\tuserEditPage();\n\t\t});\n\t}\n\n\tasync function userEditPage() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = username;\n\t\tlet homeDirectoryChanger = document.createElement(\"button\");\n\t\tlet securityChecksButton = document.createElement(\"button\");\n\t\tlet groupChanger = document.createElement(\"button\");\n\t\tlet privilegeSetButton = document.createElement(\"button\");\n\t\tlet removeButton = document.createElement(\"button\");\n\t\tlet leaveButton = document.createElement(\"button\");\n\t\thomeDirectoryChanger.innerText = await availableAPIs.lookupLocale(\"USER_HOMEDIR\");\n\t\tsecurityChecksButton.innerText = await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_TITLE\");\n\t\tgroupChanger.innerText = await availableAPIs.lookupLocale(\"USER_GROUPS\");\n\t\tprivilegeSetButton.innerText = await availableAPIs.lookupLocale(\"USER_EXT_PRIVILEGES\");\n\t\tremoveButton.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tleaveButton.innerText = await availableAPIs.lookupLocale(\"EXIT\");\n\t\thomeDirectoryChanger.addEventListener(\"click\", changeHomeDir);\n\t\tsecurityChecksButton.addEventListener(\"click\", async function() {\n\t\t\tawait availableAPIs.switchUser(username);\n\t\t\tawait availableAPIs.startTask({\n\t\t\t\tfile: await availableAPIs.getSystemMount() + \"/apps/personalSecurity.js\",\n\t\t\t\targPassed: []\n\t\t\t});\n\t\t\tawait availableAPIs.terminate();\n\t\t});\n\t\tgroupChanger.addEventListener(\"click\", changeGroups);\n\t\tprivilegeSetButton.addEventListener(\"click\", privilegeSet);\n\t\tremoveButton.addEventListener(\"click\", removeUser);\n\t\tleaveButton.addEventListener(\"click\", main);\n\t\tactionSpecificField.appendChild(homeDirectoryChanger);\n\t\tactionSpecificField.appendChild(securityChecksButton);\n\t\tactionSpecificField.appendChild(groupChanger);\n\t\tactionSpecificField.appendChild(privilegeSetButton);\n\t\tactionSpecificField.appendChild(removeButton);\n\t\tactionSpecificField.appendChild(leaveButton);\n\t}\n\n\tasync function changeHomeDir() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"USER_HOMEDIR\");\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet homeDirectoryField = document.createElement(\"input\");\n\t\tlet changeButton = document.createElement(\"button\");\n\t\tlet createButton = document.createElement(\"button\");\n\t\tlet status = document.createElement(\"div\");\n\t\tbackButton.innerText = \"<-\";\n\t\tchangeButton.innerText = await availableAPIs.lookupLocale(\"EDIT\");\n\t\tcreateButton.innerText = await availableAPIs.lookupLocale(\"CREATE_HD\");\n\t\thomeDirectoryField.value = userData.homeDirectory;\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\tchangeButton.addEventListener(\"click\", async function() {\n\t\t\tif (!homeDirectoryField.value) return;\n\t\t\tuserData.homeDirectory = homeDirectoryField.value;\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tuserEditPage();\n\t\t});\n\t\tcreateButton.addEventListener(\"click\", async function() {\n\t\t\ttry {\n\t\t\t\tawait mkrecursive(homeDirectoryField.value);\n\t\t\t\tawait availableAPIs.fs_chown({ path: homeDirectoryField.value, newUser: username });\n\t\t\t\tawait availableAPIs.fs_chgrp({ path: homeDirectoryField.value, newGrp: userData.groups[0] || username });\n\t\t\t\tawait availableAPIs.fs_chmod({ path: homeDirectoryField.value, newPermissions: \"rx\" });\n\t\t\t\tstatus.innerText = await availableAPIs.lookupLocale(\"CREATING_HD_OK\");\n\t\t\t} catch {\n\t\t\t\tstatus.innerText = await availableAPIs.lookupLocale(\"CREATING_HD_FAIL\");\n\t\t\t}\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(homeDirectoryField);\n\t\tactionSpecificField.appendChild(changeButton);\n\t\tactionSpecificField.appendChild(createButton);\n\t\tactionSpecificField.appendChild(status);\n\t}\n\n\tasync function changeGroups() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"USER_GROUPS\");\n\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet addGroup = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\taddGroup.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\taddGroup.addEventListener(\"click\", addGroupAction);\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(addGroup);\n\n\t\tfor (let group in userData.groups) {\n\t\t\tlet groupInfo = userData.groups[group];\n\t\t\tlet groupDiv = document.createElement(\"div\");\n\t\t\tgroupDiv.style.display = \"flex\";\n\t\t\tlet groupNameDiv = document.createElement(\"div\");\n\t\t\tgroupNameDiv.style.flex = 100;\n\t\t\tlet groupBtns = document.createElement(\"div\");\n\t\t\tgroupNameDiv.innerText = groupInfo;\n\t\t\tlet btnUp = document.createElement(\"button\");\n\t\t\tlet btnDown = document.createElement(\"button\");\n\t\t\tlet btnDelete = document.createElement(\"button\");\n\t\t\tbtnUp.innerText = \"/\\\\\";\n\t\t\tbtnUp.disabled = group == 0;\n\t\t\tbtnDown.disabled = group == userData.groups.length - 1;\n\t\t\tbtnDown.innerText = \"\\\\/\";\n\t\t\tbtnDelete.innerText = \"x\";\n\t\t\tgroupBtns.appendChild(btnUp);\n\t\t\tgroupBtns.appendChild(btnDown);\n\t\t\tgroupBtns.appendChild(btnDelete);\n\t\t\tgroupDiv.appendChild(groupNameDiv);\n\t\t\tgroupDiv.appendChild(groupBtns);\n\t\t\tbtnDelete.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.groups.splice(group, 1);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tchangeGroups();\n\t\t\t});\n\t\t\tactionSpecificField.appendChild(groupDiv);\n\t\t\tbtnUp.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.groups.splice(group, 1);\n\t\t\t\tuserData.groups.splice(group - 1, 0, groupInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tchangeGroups();\n\t\t\t});\n\t\t\tbtnDown.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.groups.splice(group, 1);\n\t\t\t\tuserData.groups.splice(group - 1 + 2, 0, groupInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tchangeGroups();\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function addGroupAction() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet groupNameField = document.createElement(\"input\");\n\t\tlet createButton = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\tcreateButton.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\t\tbackButton.addEventListener(\"click\", changeGroups);\n\t\tcreateButton.addEventListener(\"click\", async function() {\n\t\t\tuserData.groups.push(groupNameField.value);\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tchangeGroups();\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(groupNameField);\n\t\tactionSpecificField.appendChild(createButton);\n\t}\n\n\tasync function removeUser() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet removeWithHomedir = document.createElement(\"button\");\n\t\tlet removeAlone = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\tremoveWithHomedir.innerText = await availableAPIs.lookupLocale(\"REMOVE_USER_WITH_HD\");\n\t\tremoveAlone.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\tremoveWithHomedir.addEventListener(\"click\", async function() {\n\t\t\trecursiveRemove(userData.homeDirectory);\n\t\t\tawait availableAPIs.setUserInfo({\n\t\t\t\tdesiredUser: username,\n\t\t\t\tinfo: undefined\n\t\t\t});\n\t\t\tmain();\n\t\t});\n\t\tremoveAlone.addEventListener(\"click\", async function() {\n\t\t\tawait availableAPIs.setUserInfo({\n\t\t\t\tdesiredUser: username,\n\t\t\t\tinfo: undefined\n\t\t\t});\n\t\t\tmain();\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(removeWithHomedir);\n\t\tactionSpecificField.appendChild(removeAlone);\n\t}\n\n\tasync function privilegeSet() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"USER_EXT_PRIVILEGES\");\n\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet addPrivilege = document.createElement(\"button\");\n\t\tlet removeAll = document.createElement(\"button\");\n\t\tlet warning = document.createElement(\"b\");\n\t\tlet blankPrivsCheck = document.createElement(\"input\");\n\t\tlet blankPrivsCheckLabel = document.createElement(\"label\");\n\t\tbackButton.innerText = \"<-\";\n\t\taddPrivilege.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\t\tremoveAll.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tblankPrivsCheck.type = \"checkbox\";\n\t\tblankPrivsCheck.id = \"blankPrivCheck\";\n\t\tblankPrivsCheckLabel.innerText = await availableAPIs.lookupLocale(\"BLANK_PRIVILEGE_FLAG\");\n\t\tblankPrivsCheckLabel.htmlFor = \"blankPrivCheck\";\n\t\tblankPrivsCheck.checked = userData.blankPrivileges;\n\t\twarning.innerText = await availableAPIs.lookupLocale(\"WARNING_PRIVILEGES\");\n\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\taddPrivilege.addEventListener(\"click\", addPrivilegeAction);\n\t\tremoveAll.addEventListener(\"click\", async function() {\n\t\t\tuserData.additionalPrivilegeSet = undefined;\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tprivilegeSet();\n\t\t})\n\t\tblankPrivsCheck.addEventListener(\"change\", async function() {\n\t\t\tuserData.blankPrivileges = blankPrivsCheck.checked;\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t})\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(addPrivilege);\n\t\tactionSpecificField.appendChild(removeAll);\n\t\tactionSpecificField.appendChild(blankPrivsCheck);\n\t\tactionSpecificField.appendChild(blankPrivsCheckLabel);\n\t\tactionSpecificField.appendChild(document.createElement(\"br\"));\n\t\tactionSpecificField.appendChild(warning);\n\n\t\tif (!userData.additionalPrivilegeSet) userData.additionalPrivilegeSet = [];\n\t\tfor (let privilege in userData.additionalPrivilegeSet) {\n\t\t\tlet privilegeInfo = userData.additionalPrivilegeSet[privilege];\n\t\t\tlet privilegeDiv = document.createElement(\"div\");\n\t\t\tprivilegeDiv.style.display = \"flex\";\n\t\t\tlet privilegeNameDiv = document.createElement(\"div\");\n\t\t\tprivilegeNameDiv.style.flex = 100;\n\t\t\tlet privilegeBtns = document.createElement(\"div\");\n\t\t\tprivilegeNameDiv.innerText = privilegeInfo;\n\t\t\tlet btnUp = document.createElement(\"button\");\n\t\t\tlet btnDown = document.createElement(\"button\");\n\t\t\tlet btnDelete = document.createElement(\"button\");\n\t\t\tbtnUp.innerText = \"/\\\\\";\n\t\t\tbtnUp.disabled = privilege == 0;\n\t\t\tbtnDown.disabled = privilege == userData.additionalPrivilegeSet.length - 1;\n\t\t\tbtnDown.innerText = \"\\\\/\";\n\t\t\tbtnDelete.innerText = \"x\";\n\t\t\tprivilegeBtns.appendChild(btnUp);\n\t\t\tprivilegeBtns.appendChild(btnDown);\n\t\t\tprivilegeBtns.appendChild(btnDelete);\n\t\t\tprivilegeDiv.appendChild(privilegeNameDiv);\n\t\t\tprivilegeDiv.appendChild(privilegeBtns);\n\t\t\tbtnDelete.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege, 1);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tprivilegeSet();\n\t\t\t});\n\t\t\tactionSpecificField.appendChild(privilegeDiv);\n\t\t\tbtnUp.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege, 1);\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege - 1, 0, privilegeInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tprivilegeSet();\n\t\t\t});\n\t\t\tbtnDown.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege, 1);\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege - 1 + 2, 0, privilegeInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tprivilegeSet();\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function addPrivilegeAction() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet privilegeNameField = document.createElement(\"input\");\n\t\tlet createButton = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\tcreateButton.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\t\tbackButton.addEventListener(\"click\", privilegeSet);\n\t\tcreateButton.addEventListener(\"click\", async function() {\n\t\t\tif (!userData.additionalPrivilegeSet) userData.additionalPrivilegeSet = [];\n\t\t\tuserData.additionalPrivilegeSet.push(...(privilegeNameField.value.match(/[A-Z_]+/g) || []));\n\t\t\tuserData.additionalPrivilegeSet = Array.from(new Set(userData.additionalPrivilegeSet));\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tprivilegeSet();\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(privilegeNameField);\n\t\tactionSpecificField.appendChild(createButton);\n\t}\n\n\tasync function mkrecursive(dir) {\n\t\tlet slices = dir.split(\"/\");\n\t\tfor (let i = 2; i <= slices.length; i++) {\n\t\t\tlet browse = await availableAPIs.fs_ls({ path: slices.slice(0, i - 1).join(\"/\") });\n\t\t\tif (!browse.includes(slices[i - 1])) await availableAPIs.fs_mkdir({ path: slices.slice(0, i).join(\"/\") });\n\t\t}\n\t}\n\n\tasync function recursiveRemove(path) {\n\t\tlet dirList = await availableAPIs.fs_ls({ path });\n\t\tfor (let fileIndex in dirList) {\n\t\t\tlet file = dirList[fileIndex];\n\t\t\tif (await availableAPIs.fs_isDirectory({ path: path + \"/\" + file })) await recursiveRemove(path + \"/\" + file);\n\t\t\telse await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t\t}\n\t\tawait availableAPIs.fs_rm({ path });\n\t}\n\tmain();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","48c08266d2cc2a399b58701fd0b166c2613cd2262a973c44236b868fb0e8adce8c547b1c9c526c2fb313efa14e245d26eaf077f6b235e22606f11feb3ddfedcd":"// =====BEGIN MANIFEST=====\n// link: lrn:TASK_MANAGER\n// signer: automaticSigner\n// fnName: taskMgrInstaller\n// allow: LIST_TASKS, SIGNAL_TASK, GET_LOCALE, GET_THEME, TASK_BYPASS_PERMISSIONS, GRAB_ATTENTION\n// signature: 7c764a1dcbe3a40ab15a8e180aed8a9b08c292f91939a42a77e2f41cbdedddca782e87c28b0622a027e59cf1d0f7baed6398f3b26fd2af4de792f6c17a104a0f\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"TASK_MANAGER\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"LIST_TASKS\", \"SIGNAL_TASK\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = (await availableAPIs.lookupLocale(\"TMGR_PERMISSION\")).replace(\"%s\", checklist.join(\", \"));\n\t\treturn;\n\t}\n\tlet styleElement = document.createElement(\"style\");\n\tstyleElement.innerText = `th, td { border: 1px solid black; }\n\ttable { overflow: scroll; min-width: 100%; width: max-content; }`;\n\tdocument.head.appendChild(styleElement);\n\tlet table = document.createElement(\"table\");\n\tlet thead = document.createElement(\"thead\");\n\tlet theadRow = document.createElement(\"tr\");\n\tlet thBasename = document.createElement(\"th\");\n\tlet thUser = document.createElement(\"th\");\n\tlet thTerminate = document.createElement(\"th\");\n\tlet thFP = document.createElement(\"th\");\n\tlet thArgs = document.createElement(\"th\");\n\tlet tbody = document.createElement(\"tbody\");\n\tthBasename.innerText = await availableAPIs.lookupLocale(\"BASENAME_TASK\");\n\tthUser.innerText = await availableAPIs.lookupLocale(\"USER_TASK\");\n\tthTerminate.innerText = await availableAPIs.lookupLocale(\"TERMINATE_TASK\");\n\tthFP.innerText = await availableAPIs.lookupLocale(\"FULL_PATH_TASK\");\n\tthArgs.innerText = await availableAPIs.lookupLocale(\"ARGUMENTS_TASK\");\n\ttheadRow.appendChild(thBasename);\n\ttheadRow.appendChild(thUser);\n\ttheadRow.appendChild(thTerminate);\n\ttheadRow.appendChild(thFP);\n\ttheadRow.appendChild(thArgs);\n\tthead.appendChild(theadRow);\n\ttable.appendChild(thead);\n\ttable.appendChild(tbody);\n\tdocument.body.appendChild(table);\n\tasync function refresh() {\n\t\tlet prevtb = tbody;\n\t\tlet newtb = document.createElement(\"tbody\");\n\t\tlet tasks = await availableAPIs.listTasks();\n\t\tfor (let task of tasks) {\n\t\t\tlet tr = document.createElement(\"tr\");\n\t\t\tlet tdBasename = document.createElement(\"td\");\n\t\t\tlet tdUser = document.createElement(\"td\");\n\t\t\tlet tdTerminate = document.createElement(\"td\");\n\t\t\tlet tdFP = document.createElement(\"td\");\n\t\t\tlet tdArgs = document.createElement(\"td\");\n\t\t\tlet taskInfo;\n\t\t\ttry {\n\t\t\t\ttaskInfo = await availableAPIs.taskInfo(task);\n\t\t\t} catch {}\n\t\t\tif (!taskInfo) continue;\n\t\t\tlet terminateBtn = document.createElement(\"button\");\n\t\t\ttdBasename.innerText = taskInfo.file.split(\"/\").slice(-1)[0];\n\t\t\ttdUser.innerText = taskInfo.runBy;\n\t\t\ttdFP.innerText = taskInfo.file;\n\t\t\ttdArgs.innerText = \"[\" + (taskInfo.arg || []).map(a => JSON.stringify(a)).join(\", \") + \"]\";\n\t\t\tterminateBtn.innerText = await availableAPIs.lookupLocale(\"TERMINATE_TASK\");\n\t\t\tterminateBtn.addEventListener(\"click\", async function() {\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.signalTask({ taskId: task, signal: 15 });\n\t\t\t\t} catch {}\n\t\t\t});\n\t\t\tterminateBtn.addEventListener(\"contextmenu\", async function(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.signalTask({ taskId: task, signal: 9 });\n\t\t\t\t} catch {}\n\t\t\t});\n\t\t\ttdTerminate.appendChild(terminateBtn);\n\t\t\ttr.appendChild(tdBasename);\n\t\t\ttr.appendChild(tdUser);\n\t\t\ttr.appendChild(tdTerminate);\n\t\t\ttr.appendChild(tdFP);\n\t\t\ttr.appendChild(tdArgs);\n\t\t\tnewtb.appendChild(tr);\n\t\t}\n\t\ttable.appendChild(newtb);\n\t\tprevtb.remove();\n\t\ttbody = newtb;\n\t\ttry {\n\t\t\tawait availableAPIs.windowFocus();\n\t\t} catch {}\n\t\tsetTimeout(refresh, 1000);\n\t}\n\tawait refresh();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","2c8b7d121f8ea4275bf0f6e759f23f7f0fe9bba866537ac52a6f2a58639ed3351097cd866e395505d6d663a6f10669818ce0b5c20d51e1afbc650dc5863fd954":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_THEME, START_TASK, IPC_CREATE_PIPE, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, IPC_SEND_PIPE, GET_USER_INFO, IPC_LISTEN_PIPE\n// signature: 0a8ca7749862759f162303a29f3a4b3a3a7cd633f7f88f07ed6520f213ecce494e96b18b03dfc352fecd279ac47bc26222253618eca5f8e346b89b72cd61120d\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"USER_PREFERENCES\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_WRITE\", \"GET_USER_INFO\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"USER_PREFS_ERROR\");\n\t\treturn;\n\t}\n\t\n\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\n\tlet wallpaperInputName = document.createElement(\"label\");\n\tlet wallpaperInput = document.createElement(\"input\");\n\tlet wallpaperChooser = document.createElement(\"button\");\n\tlet localeInputName = document.createElement(\"label\");\n\tlet localeInput = document.createElement(\"select\");\n\tlet darkModeInput = document.createElement(\"input\");\n\tlet darkModeInputName = document.createElement(\"label\");\n\tlet updatePreferences = document.createElement(\"button\");\n\tlet wallpaperPreview = document.createElement(\"img\");\n\tlet updateCooldown;\n\n\tdarkModeInput.type = \"checkbox\";\n\n\tlet locales = await availableAPIs.installedLocales();\n\tfor (let locale of locales) {\n\t\tlet option = document.createElement(\"option\");\n\t\toption.value = locale;\n\t\toption.innerText = await availableAPIs.lookupOtherLocale({ key: \"LOCALE_NAME\", locale });\n\t\tlocaleInput.appendChild(option);\n\t}\n\n\tlocaleInput.value = await availableAPIs.locale();\n\twallpaperInput.value = homedir + \"/.wallpaper\";\n\n\tdarkModeInput.checked = await availableAPIs.isDarkThemed();\n\n\twallpaperInput.id = \"wallpaperInput\";\n\tlocaleInput.id = \"localeInput\";\n\tdarkModeInput.id = \"darkModeInput\";\n\twallpaperInputName.htmlFor = \"wallpaperInput\";\n\tlocaleInputName.htmlFor = \"localeInput\";\n\tdarkModeInputName.htmlFor = \"darkModeInput\";\n\n\twallpaperInputName.innerText = await availableAPIs.lookupLocale(\"WALLPAPER_PATH\");\n\twallpaperChooser.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\tlocaleInputName.innerText = await availableAPIs.lookupLocale(\"LANGUAGE_SELECT\");\n\tdarkModeInputName.innerText = await availableAPIs.lookupLocale(\"DARK_MODE\");\n\tupdatePreferences.innerText = await availableAPIs.lookupLocale(\"UPDATE_PREFERENCES\");\n\n\twallpaperPreview.width = \"340\";\n\twallpaperPreview.height = \"192\";\n\n\tfunction updatePreview() {\n\t\tclearTimeout(updateCooldown);\n\t\tupdateCooldown = setTimeout(async function() {\n\t\t\ttry {\n\t\t\t\twallpaperPreview.src = await availableAPIs.fs_read({ path: wallpaperInput.value });\n\t\t\t} catch {}\n\t\t}, 100);\n\t}\n\n\twallpaperInput.oninput = updatePreview;\n\n\twallpaperChooser.onclick = async function() {\n\t\ttry {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({\n\t\t\t\tfile: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\",\n\t\t\t\targPassed: [ipcPipe, \"load\", (await availableAPIs.getSystemMount()) + \"/etc/wallpapers\" ]\n\t\t\t});\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) {\n\t\t\t\twallpaperInput.value = result.selected;\n\t\t\t\tupdatePreview();\n\t\t\t}\n\t\t} catch {\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t}\n\t};\n\n\tupdatePreferences.onclick = async function() {\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({ path: homedir + \"/.wallpaper\", data: await availableAPIs.fs_read({ path: wallpaperInput.value }) });\n\t\t\tawait availableAPIs.fs_write({ path: homedir + \"/.darkmode\", data: JSON.stringify(darkModeInput.checked) });\n\t\t\tawait availableAPIs.fs_write({ path: homedir + \"/.locale\", data: localeInput.value });\n\t\t\thtmlAlert(await availableAPIs.lookupLocale(\"USER_PREFS_UPDATED\"));\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\thtmlAlert(await availableAPIs.lookupLocale(\"PREF_UPDATE_FAILED\"));\n\t\t}\n\t};\n\n\tdocument.body.appendChild(wallpaperInputName);\n\tdocument.body.appendChild(wallpaperInput);\n\tdocument.body.appendChild(wallpaperChooser);\n\tdocument.body.appendChild(document.createElement(\"br\"));\n\tdocument.body.appendChild(localeInputName);\n\tdocument.body.appendChild(localeInput);\n\tdocument.body.appendChild(document.createElement(\"br\"));\n\tdocument.body.appendChild(darkModeInput);\n\tdocument.body.appendChild(darkModeInputName);\n\tdocument.body.appendChild(document.createElement(\"br\"));\n\tdocument.body.appendChild(updatePreferences);\n\tdocument.body.appendChild(document.createElement(\"br\"));\n\tdocument.body.appendChild(wallpaperPreview);\n\tupdatePreview();\n})();\nfunction htmlAlert(msg) {\n\tlet overlay = document.createElement(\"div\");\n\tlet overlayingMessage = document.createElement(\"div\");\n\tlet description = document.createElement(\"span\");\n\tlet buttonAccept = document.createElement(\"button\");\n\toverlay.style = \"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; opacity: 85%;\";\n\toverlayingMessage.style = \"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; padding: 8px; box-sizing: border-box; color: white;\";\n\tdescription.innerText = msg;\n\tbuttonAccept.innerText = \"Ok\";\n\toverlayingMessage.appendChild(description);\n\toverlayingMessage.appendChild(document.createElement(\"hr\"));\n\toverlayingMessage.appendChild(buttonAccept);\n\tdocument.body.appendChild(overlay);\n\tdocument.body.appendChild(overlayingMessage);\n\tbuttonAccept.onclick = function() {\n\t\toverlay.remove();\n\t\toverlayingMessage.remove();\n\t};\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;"},"buildInfo":{"for":"1572","version":1572,"when":1765630205907,"signer":"moduleSigner","critical":true,"bootOrder":"50","commonName":"sysadmin","friendlyNameRef":"SYSADMIN_TOOLS_TITLE","signature":"a368feab6e61ed166dd34f97481ea5143daf0164ba130b82b70626561eef4158304139bafbefa91d2ecceeb75d2ffbdd8fdcb4b34edd4b922629b5feb26f7a07"}}