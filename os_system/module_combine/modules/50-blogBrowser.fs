{"backend":{"files":{"apps":{"blogBrowser.js":"224c38ec345b786634fc5730a831e1fe16cf1252823878b14c318153b42372f09a56219c4763117cb02bac2174f075ce444d455a9026585a96b8484baf260acd","links":{"blogBrowser.lnk":"1b0a8c88d29a4ca60fedf71820b3525b9c5f8f00686a6e7dd1d6eea2dc257adbdee6ce47492c1b3dfcc091aacff4f7cffd3483b9c6ad501bbb1b91da0cd2a087"}}},"permissions":{"apps/blogBrowser.js":{"world":"rx"},"apps/links/blogBrowser.lnk":{"world":"rx"},"apps/links/":{"world":"rx"},"apps/":{"world":"rx"},"":{"world":"rx"}}},"files":{"224c38ec345b786634fc5730a831e1fe16cf1252823878b14c318153b42372f09a56219c4763117cb02bac2174f075ce444d455a9026585a96b8484baf260acd":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// link: lrn:BLOG_BROWSER_NAME\n// allow: GET_LOCALE, GET_THEME, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, START_TASK, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, IPC_SEND_PIPE, FS_BYPASS_PERMISSIONS, RESOLVE_NAME, CONNFUL_CONNECT, CONNFUL_DISCONNECT, CONNFUL_WRITE, CONNFUL_READ, CONNFUL_ADDRESS_GET, CONNFUL_IDENTITY_GET, GET_USER_INFO\n// signature: d4cd2fec3df36ea5198ca0c6fe89c3380f0590d53eb2f592dc0c405b5cc3375bd7035a2cdebecb01d27d552dacdd67e22aaf5f5c9ffe230bb44820dbf8abfd03\n// =====END MANIFEST=====\nfunction createREE(direction) {\n\tlet ownIframeID = undefined;\n\ttry {\n\t\townIframeID = iframeId;\n\t} catch {}\n\treturn new Promise(function(resolve) {\n\t\tlet iframe = document.createElement(\"iframe\");\n\t\tlet iframeId = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\tlet prefix = ownIframeID ? (ownIframeID + \"_\") : \"\";\n\t\tiframeId = prefix + iframeId;\n\t\tiframe.src = \"data:text/html;base64,\" + btoa(\"<!DOCTYPE HTML>\\n<script>const iframeId = \" + JSON.stringify(iframeId) + \";\\n\" + reed.toString() + \"\\nreed();</script>\");\n\t\tiframe.style.border = \"none\";\n\t\tiframe.setAttribute(\"credentialless\", \"true\");\n\t\tiframe.sandbox = \"allow-scripts\";\n\t\tdirection.appendChild(iframe);\n\t\tlet prezhn = [];\n\t\tlet prerm = [];\n\t\tiframe.addEventListener(\"load\", function s() {\n\t\t\tiframe.removeEventListener(\"load\", s);\n\t\t\treturn resolve({\n\t\t\t\tiframe,\n\t\t\t\texportAPI: function(id, fn) {\n\t\t\t\t\tiframe.contentWindow.postMessage({type: \"export_api\", id: id, iframeId}, \"*\");\n\t\t\t\t\tasync function prezhn_it(e) {\n\t\t\t\t\t\tif (e.data.iframeId != iframeId) return;\n\t\t\t\t\t\tif (e.data.id != id) return;\n\t\t\t\t\t\tif (e.data.type != \"call_api\") return;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\t\t\tresult: await fn({\n\t\t\t\t\t\t\t\t\tcaller: iframeId,\n\t\t\t\t\t\t\t\t\targ: e.data.arg\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\ttype: \"api_response\",\n\t\t\t\t\t\t\t\tresponseToken: e.data.responseToken,\n\t\t\t\t\t\t\t\tiframeId\n\t\t\t\t\t\t\t}, \"*\");\n\t\t\t\t\t\t} catch (er) {\n\t\t\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\t\t\tname: er.name,\n\t\t\t\t\t\t\t\t\tmessage: er.message\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: \"api_error\",\n\t\t\t\t\t\t\t\tresponseToken: e.data.responseToken,\n\t\t\t\t\t\t\t\tiframeId\n\t\t\t\t\t\t\t}, \"*\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twindow.addEventListener(\"message\", prezhn_it);\n\t\t\t\t\tprezhn.push(prezhn_it);\n\t\t\t\t},\n\t\t\t\teval: function(code) {\n\t\t\t\t\tlet responseToken = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\tiframe.contentWindow.postMessage({type: \"run\", code, responseToken, iframeId}, \"*\");\n\t\t\t\t\t\tfunction sel(e) {\n\t\t\t\t\t\t\tif (e.data.iframeId != iframeId) return;\n\t\t\t\t\t\t\tif (e.data.responseToken != responseToken) return;\n\t\t\t\t\t\t\tprezhn = prezhn.filter(x => x != sel);\n\t\t\t\t\t\t\twindow.removeEventListener(\"message\", sel);\n\t\t\t\t\t\t\tif (e.data.type == \"ran_response\")\n\t\t\t\t\t\t\t\tresolve(e.data.result);\n\t\t\t\t\t\t\telse if (e.data.type == \"ran_error\")\n\t\t\t\t\t\t\t\treject(e.data.result);\n\t\t\t\t\t\t};\n\t\t\t\t\t\twindow.addEventListener(\"message\", sel);\n\t\t\t\t\t\tprezhn.push(sel);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tcloseDown: async function() {\n\t\t\t\t\tfor (let i of prerm) await i(this);\n\t\t\t\t\tprerm = [];\n\t\t\t\t\tfor (let i in prezhn) window.removeEventListener(\"message\", prezhn[i]);\n\t\t\t\t\tiframe.remove();\n\t\t\t\t\tiframe = null;\n\t\t\t\t},\n\t\t\t\tbeforeCloseDown: function(fn) {\n\t\t\t\t\tprerm.push(fn);\n\t\t\t\t},\n\t\t\t\tiframeId\n\t\t\t});\n\t\t});\n\t});\n}\nfunction IPv6Decompressor(ip) {\n\tlet array = ip.split(\":\");\n\tarray = array.slice(0, 8);\n\tlet foundTwoOrMoreZeroes = array.indexOf(\"\");\n\twhile (array.length != 8 && foundTwoOrMoreZeroes !== null) array.splice(foundTwoOrMoreZeroes, 0, \"0000\");\n\tarray = array.map(a => parseInt(a || \"0\", 16).toString(16).padStart(4, \"0\"));\n\treturn array.join(\":\");\n}\n(async function() {\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"BLOG_BROWSER_NAME\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.body.innerText = \"\";\n\tdocument.documentElement.style.height = \"100%\";\n\tdocument.documentElement.style.width = \"100%\";\n\tdocument.body.style.height = \"100%\";\n\tdocument.body.style.width = \"100%\";\n\tdocument.body.style.margin = \"0\";\n\tlet browserContainer = document.createElement(\"div\");\n\tlet urlBar = document.createElement(\"form\");\n\tlet urlInput = document.createElement(\"input\");\n\tlet urlButton = document.createElement(\"button\");\n\tlet theWebsite = document.createElement(\"div\");\n\tbrowserContainer.style.display = \"flex\";\n\tbrowserContainer.style.flexDirection = \"column\";\n\tbrowserContainer.style.width = \"100%\";\n\tbrowserContainer.style.height = \"100%\";\n\turlBar.style.display = \"flex\";\n\turlBar.style.flexDirection = \"row\";\n\turlBar.style.width = \"100%\";\n\turlInput.style.flexGrow = \"1\";\n\ttheWebsite.style.flexGrow = \"1\";\n\turlBar.appendChild(urlInput);\n\turlBar.appendChild(urlButton);\n\turlButton.innerText = \"->\";\n\tbrowserContainer.appendChild(urlBar);\n\tbrowserContainer.appendChild(theWebsite);\n\tdocument.body.appendChild(browserContainer);\n\tlet ree;\n\turlButton.onclick = async function() {\n\t\turlInput.disabled = true;\n\t\turlButton.disabled = true;\n\t\tif (ree) ree.closeDown();\n\t\tree = null;\n\t\ttheWebsite.hidden = false;\n\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\ttry {\n\t\t\tlet url = new URL(urlInput.value);\n\t\t\turlInput.value = url.href;\n\t\t\tif (url.protocol != \"bdp:\") throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_PROTO\"));\n\t\t\tif (url.port) throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_GATESET\"));\n\t\t\tif (pargs[\"no-verification\"]) \n\t\t\t\tawait new Promise(async function(ok, ab) {\n\t\t\t\t\tlet allowNoVerify = document.createElement(\"button\");\n\t\t\t\t\tlet abort = document.createElement(\"button\");\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_NOVERIFY\");\n\t\t\t\t\tallowNoVerify.innerText = await availableAPIs.lookupLocale(\"YES\");\n\t\t\t\t\tabort.innerText = await availableAPIs.lookupLocale(\"NO\");\n\t\t\t\t\tallowNoVerify.onclick = async function() {\n\t\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\t\t\t\t\tok();\n\t\t\t\t\t}\n\t\t\t\t\tabort.onclick = async _ => ab(new Error(await availableAPIs.lookupLocale(\"SERVER_SIGNATURE_VERIFICATION_FAILED\")));\n\t\t\t\t\ttheWebsite.appendChild(allowNoVerify);\n\t\t\t\t\ttheWebsite.appendChild(abort);\n\t\t\t\t});\n\t\t\tif (pargs[\"no-sandbox\"]) \n\t\t\t\tawait new Promise(async function(ok, ab) {\n\t\t\t\t\tlet allowNoVerify = document.createElement(\"button\");\n\t\t\t\t\tlet abort = document.createElement(\"button\");\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_NOSANDBOX\");\n\t\t\t\t\tallowNoVerify.innerText = await availableAPIs.lookupLocale(\"YES\");\n\t\t\t\t\tabort.innerText = await availableAPIs.lookupLocale(\"NO\");\n\t\t\t\t\tallowNoVerify.onclick = async function() {\n\t\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\t\t\t\t\tok();\n\t\t\t\t\t}\n\t\t\t\t\tabort.onclick = async _ => ab(new Error(await availableAPIs.lookupLocale(\"PERMISSION_DENIED\")));\n\t\t\t\t\ttheWebsite.appendChild(allowNoVerify);\n\t\t\t\t\ttheWebsite.appendChild(abort);\n\t\t\t\t});\n\t\t\tlet hostname = url.hostname, address;\n\t\t\tif (url.hostname.includes(\"[\")) {\n\t\t\t\thostname = IPv6Decompressor(url.hostname.slice(1, -1)).replaceAll(\":\", \"\");\n\t\t\t\taddress = hostname;\n\t\t\t} else address = await availableAPIs.resolve(hostname);\n\t\t\tif (!address) throw new Error(await availableAPIs.lookupLocale(\"HOSTNAME_RESOLUTION_FAILED\"));\n\t\t\tlet connection = await availableAPIs.connfulConnect({\n\t\t\t\tgate: url.username || \"blog\",\n\t\t\t\taddress,\n\t\t\t\tverifyByDomain: hostname,\n\t\t\t\tkey: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: pargs.key\n\t\t\t\t})).key : undefined,\n\t\t\t\tprivate: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: pargs.key\n\t\t\t\t})).private : undefined,\n\t\t\t\tdoNotVerifyServer: pargs[\"no-verification\"]\n\t\t\t});\n\t\t\tawait availableAPIs.connfulConnectionSettled(connection);\n\t\t\tawait availableAPIs.connfulWrite({\n\t\t\t\tconnectionID: connection,\n\t\t\t\tdata: url.pathname + url.search,\n\t\t\t\thost: hostname\n\t\t\t});\n\t\t\tlet data = await availableAPIs.connfulRead(connection);\n\t\t\tdata = JSON.parse(data);\n\t\t\tlet chunks = [];\n\t\t\ttheWebsite.innerText = (await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING_PROGRESS\")).replace(\"%s\", \"0\").replace(\"%s\", data.length);\n\t\t\twhile (chunks.length != data.length) {\n\t\t\t\tlet newData = await availableAPIs.connfulRead(connection);\n\t\t\t\tnewData = JSON.parse(newData);\n\t\t\t\tchunks[newData.ctr] = newData.chunk;\n\t\t\t\ttheWebsite.innerText = (await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING_PROGRESS\")).replace(\"%s\", chunks.length).replace(\"%s\", data.length);\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.connfulClose(connection);\n\t\t\t} catch {}\n\t\t\tdata.content = chunks.join(\"\");\n\t\t\tif (data.type == \"script\") {\n\t\t\t\ttheWebsite.innerText = \"\";\n\t\t\t\tree = await createREE(browserContainer);\n\t\t\t\tree.iframe.style = \"flex-grow: 1; border: none; overflow: auto;\";\n\t\t\t\ttheWebsite.hidden = true;\n\t\t\t\tlet passthroughAPIs = [\n\t\t\t\t\t// UI class\n\t\t\t\t\t\"isDarkThemed\", \"locale\", \"osLocale\", \"lookupLocale\", \"installedLocales\",\n\t\t\t\t\t// cryptographic class\n\t\t\t\t\t\"cspOperations\", \"availableCsps\",\n\t\t\t\t\t// connful connections class\n\t\t\t\t\t\"connfulConnect\", \"connfulConnectionSettled\", \"connfulDisconnect\", \"connfulForceDisconnect\", \"connfulWrite\", \"connfulRead\", \"connfulAddressGet\", \"connfulIdentityGet\"\n\t\t\t\t];\n\t\t\t\tif (pargs[\"no-sandbox\"]) passthroughAPIs = Object.keys(availableAPIs);\n\t\t\t\tfor (let api of passthroughAPIs) await ree.exportAPI(api, e => availableAPIs[api](e.arg));\n\t\t\t\tawait ree.exportAPI(\"terminate\", _ => ree.closeDown());\n\t\t\t\tawait ree.exportAPI(\"navigate\", function(newUrl) {\n\t\t\t\t\turlInput.value = new URL(newUrl.arg, urlInput.value).href;\n\t\t\t\t\turlButton.click();\n\t\t\t\t\tree.closeDown();\n\t\t\t\t});\n\t\t\t\tawait ree.exportAPI(\"currentLocation\", _ => urlInput.value);\n\t\t\t\tree.beforeCloseDown(async function() {\n\t\t\t\t\ttheWebsite.hidden = false;\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_POSTCLOSE\");\n\t\t\t\t});\n\t\t\t\tawait ree.eval(data.content);\n\t\t\t} else if (data.type == \"file\") {\n\t\t\t\ttheWebsite.innerHTML = await availableAPIs.lookupLocale(\"BLOG_BROWSER_FILEPOST\");\n\t\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\", data.filename || urlBar.value.split(\"/\").slice(-1)[0]] });\n\t\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\t\tif (result.success) {\n\t\t\t\t\tawait availableAPIs.fs_write({ path: result.selected, data: data.content });\n\t\t\t\t\ttheWebsite.innerHTML = await availableAPIs.lookupLocale(\"BLOG_BROWSER_DLFILEPOST\");\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (ree) ree.closeDown();\n\t\t\ttheWebsite.hidden = false;\n\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(e.message);\n\t\t}\n\t\turlInput.disabled = false;\n\t\turlButton.disabled = false;\n\t}\n\tif (ppos[0]) {\n\t\turlInput.value = ppos[0];\n\t\turlButton.click();\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","1b0a8c88d29a4ca60fedf71820b3525b9c5f8f00686a6e7dd1d6eea2dc257adbdee6ce47492c1b3dfcc091aacff4f7cffd3483b9c6ad501bbb1b91da0cd2a087":"{\"path\":\"system/apps/blogBrowser.js\",\"localeReferenceName\":\"BLOG_BROWSER_NAME\"}"},"buildInfo":{"for":"1331","version":"1331","when":1751655715421,"signer":"moduleSigner","critical":false,"bootOrder":"50","signature":"56ae0c9d9eef67b29640b95345d4cf0193018610fe801fb41be1d99d0f3a96371b8617d641525ce6a4cf9c913687737f421a351c1043a60b5e30431610925f0c"}}