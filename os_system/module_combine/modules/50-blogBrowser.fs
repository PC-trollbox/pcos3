{"backend":{"files":{"apps":{"blogBrowser.js":"3980a45f092611c1661d1437b994ce095ba44310c2934214291a06937d686ae07655cf88e60062aac3e6139a7e7feb0e711e302e07ca9ed5a7ca392aee1517a7","links":{"blogBrowser.lnk":"dfd824a03e52e683acc7ea7dc38da61358bccc50058b133132c5ecc73948463c002932cc275d8c2513cff38f09d2acebe814dd296645bc8a08a1da5ef9acd9da"}}},"permissions":{"apps/blogBrowser.js":{"world":"rx"},"apps/links/blogBrowser.lnk":{"world":"rx"},"apps/links/":{"world":"rx"},"apps/":{"world":"rx"},"":{"world":"rx"}}},"files":{"3980a45f092611c1661d1437b994ce095ba44310c2934214291a06937d686ae07655cf88e60062aac3e6139a7e7feb0e711e302e07ca9ed5a7ca392aee1517a7":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// link: lrn:BLOG_BROWSER_NAME\n// allow: GET_LOCALE, GET_THEME, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, START_TASK, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, IPC_SEND_PIPE, FS_BYPASS_PERMISSIONS, RESOLVE_NAME, CONNFUL_CONNECT, CONNFUL_DISCONNECT, CONNFUL_WRITE, CONNFUL_READ, CONNFUL_ADDRESS_GET, CONNFUL_IDENTITY_GET, GET_USER_INFO\n// signature: cdf994d8470840fc3e243c97f388c0ff370bd224f3aedaa8844e354a6f2eba3515b2f52c3956b85ac3458af7539f776f4c8fc439a0174bcff9c407c9cd92a707\n// =====END MANIFEST=====\nfunction createREE(direction) {\n\tlet ownIframeID = undefined;\n\ttry {\n\t\townIframeID = iframeId;\n\t} catch {}\n\treturn new Promise(function(resolve) {\n\t\tlet iframe = document.createElement(\"iframe\");\n\t\tlet iframeId = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\tlet prefix = ownIframeID ? (ownIframeID + \"_\") : \"\";\n\t\tiframeId = prefix + iframeId;\n\t\tiframe.src = \"data:text/html;base64,\" + btoa(\"<!DOCTYPE HTML>\\n<script>const iframeId = \" + JSON.stringify(iframeId) + \";\\n\" + reed.toString() + \"\\nreed();</script>\");\n\t\tiframe.style.border = \"none\";\n\t\tiframe.setAttribute(\"credentialless\", \"true\");\n\t\tiframe.sandbox = \"allow-scripts\";\n\t\tdirection.appendChild(iframe);\n\t\tlet prezhn = [];\n\t\tlet prerm = [];\n\t\tiframe.addEventListener(\"load\", function s() {\n\t\t\tiframe.removeEventListener(\"load\", s);\n\t\t\treturn resolve({\n\t\t\t\tiframe,\n\t\t\t\texportAPI: function(id, fn) {\n\t\t\t\t\tiframe.contentWindow.postMessage({type: \"export_api\", id: id, iframeId}, \"*\");\n\t\t\t\t\tasync function prezhn_it(e) {\n\t\t\t\t\t\tif (e.data.iframeId != iframeId) return;\n\t\t\t\t\t\tif (e.data.id != id) return;\n\t\t\t\t\t\tif (e.data.type != \"call_api\") return;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\t\t\tresult: await fn({\n\t\t\t\t\t\t\t\t\tcaller: iframeId,\n\t\t\t\t\t\t\t\t\targ: e.data.arg\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\ttype: \"api_response\",\n\t\t\t\t\t\t\t\tresponseToken: e.data.responseToken,\n\t\t\t\t\t\t\t\tiframeId\n\t\t\t\t\t\t\t}, \"*\");\n\t\t\t\t\t\t} catch (er) {\n\t\t\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\t\t\tname: er.name,\n\t\t\t\t\t\t\t\t\tmessage: er.message\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: \"api_error\",\n\t\t\t\t\t\t\t\tresponseToken: e.data.responseToken,\n\t\t\t\t\t\t\t\tiframeId\n\t\t\t\t\t\t\t}, \"*\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twindow.addEventListener(\"message\", prezhn_it);\n\t\t\t\t\tprezhn.push(prezhn_it);\n\t\t\t\t},\n\t\t\t\teval: function(code) {\n\t\t\t\t\tlet responseToken = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\tiframe.contentWindow.postMessage({type: \"run\", code, responseToken, iframeId}, \"*\");\n\t\t\t\t\t\tfunction sel(e) {\n\t\t\t\t\t\t\tif (e.data.iframeId != iframeId) return;\n\t\t\t\t\t\t\tif (e.data.responseToken != responseToken) return;\n\t\t\t\t\t\t\tprezhn = prezhn.filter(x => x != sel);\n\t\t\t\t\t\t\twindow.removeEventListener(\"message\", sel);\n\t\t\t\t\t\t\tif (e.data.type == \"ran_response\")\n\t\t\t\t\t\t\t\tresolve(e.data.result);\n\t\t\t\t\t\t\telse if (e.data.type == \"ran_error\")\n\t\t\t\t\t\t\t\treject(e.data.result);\n\t\t\t\t\t\t};\n\t\t\t\t\t\twindow.addEventListener(\"message\", sel);\n\t\t\t\t\t\tprezhn.push(sel);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tcloseDown: async function() {\n\t\t\t\t\tfor (let i of prerm) await i(this);\n\t\t\t\t\tprerm = [];\n\t\t\t\t\tfor (let i in prezhn) window.removeEventListener(\"message\", prezhn[i]);\n\t\t\t\t\tiframe.remove();\n\t\t\t\t\tiframe = null;\n\t\t\t\t},\n\t\t\t\tbeforeCloseDown: function(fn) {\n\t\t\t\t\tprerm.push(fn);\n\t\t\t\t},\n\t\t\t\tiframeId\n\t\t\t});\n\t\t});\n\t});\n}\nfunction IPv6Decompressor(ip) {\n    let array = ip.split(\":\");\n    array = array.slice(0, 8);\n    let foundTwoOrMoreZeroes = array.indexOf(\"\");\n    while (array.length != 8 && foundTwoOrMoreZeroes !== null) array.splice(foundTwoOrMoreZeroes, 0, \"0000\");\n    array = array.map(a => parseInt(a || \"0\", 16).toString(16).padStart(4, \"0\"));\n    return array.join(\":\");\n}\n(async function() {\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"BLOG_BROWSER_NAME\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.body.innerText = \"\";\n    document.documentElement.style.height = \"100%\";\n\tdocument.documentElement.style.width = \"100%\";\n\tdocument.body.style.height = \"100%\";\n\tdocument.body.style.width = \"100%\";\n\tdocument.body.style.margin = \"0\";\n    let browserContainer = document.createElement(\"div\");\n    let urlBar = document.createElement(\"form\");\n    let urlInput = document.createElement(\"input\");\n    let urlButton = document.createElement(\"button\");\n    let theWebsite = document.createElement(\"div\");\n    browserContainer.style.display = \"flex\";\n    browserContainer.style.flexDirection = \"column\";\n    browserContainer.style.width = \"100%\";\n    browserContainer.style.height = \"100%\";\n    urlBar.style.display = \"flex\";\n    urlBar.style.flexDirection = \"row\";\n    urlBar.style.width = \"100%\";\n    urlInput.style.flexGrow = \"1\";\n    theWebsite.style.flexGrow = \"1\";\n    urlBar.appendChild(urlInput);\n    urlBar.appendChild(urlButton);\n    urlButton.innerText = \"->\";\n    browserContainer.appendChild(urlBar);\n    browserContainer.appendChild(theWebsite);\n    document.body.appendChild(browserContainer);\n    let ree;\n    urlButton.onclick = async function() {\n        urlInput.disabled = true;\n        urlButton.disabled = true;\n        if (ree) ree.closeDown();\n        ree = null;\n        theWebsite.hidden = false;\n        theWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n        try {\n            let url = new URL(urlInput.value);\n\t\t\turlInput.value = url.href;\n            if (url.protocol != \"bdp:\") throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_PROTO\"));\n            if (url.port) throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_GATESET\"));\n\t\t\tif (pargs[\"no-verification\"]) \n\t\t\t\tawait new Promise(async function(ok, ab) {\n\t\t\t\t\tlet allowNoVerify = document.createElement(\"button\");\n\t\t\t\t\tlet abort = document.createElement(\"button\");\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_NOVERIFY\");\n\t\t\t\t\tallowNoVerify.innerText = await availableAPIs.lookupLocale(\"YES\");\n\t\t\t\t\tabort.innerText = await availableAPIs.lookupLocale(\"NO\");\n\t\t\t\t\tallowNoVerify.onclick = async function() {\n\t\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\t\t\t\t\tok();\n\t\t\t\t\t}\n\t\t\t\t\tabort.onclick = async _ => ab(new Error(await availableAPIs.lookupLocale(\"SERVER_SIGNATURE_VERIFICATION_FAILED\")));\n\t\t\t\t\ttheWebsite.appendChild(allowNoVerify);\n\t\t\t\t\ttheWebsite.appendChild(abort);\n\t\t\t\t});\n\t\t\tif (pargs[\"no-sandbox\"]) \n\t\t\t\tawait new Promise(async function(ok, ab) {\n\t\t\t\t\tlet allowNoVerify = document.createElement(\"button\");\n\t\t\t\t\tlet abort = document.createElement(\"button\");\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_NOSANDBOX\");\n\t\t\t\t\tallowNoVerify.innerText = await availableAPIs.lookupLocale(\"YES\");\n\t\t\t\t\tabort.innerText = await availableAPIs.lookupLocale(\"NO\");\n\t\t\t\t\tallowNoVerify.onclick = async function() {\n\t\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\t\t\t\t\tok();\n\t\t\t\t\t}\n\t\t\t\t\tabort.onclick = async _ => ab(new Error(await availableAPIs.lookupLocale(\"PERMISSION_DENIED\")));\n\t\t\t\t\ttheWebsite.appendChild(allowNoVerify);\n\t\t\t\t\ttheWebsite.appendChild(abort);\n\t\t\t\t});\n            let hostname = url.hostname, address;\n            if (url.hostname.includes(\"[\")) {\n                hostname = IPv6Decompressor(url.hostname.slice(1, -1)).replaceAll(\":\", \"\");\n                address = hostname;\n            } else address = await availableAPIs.resolve(hostname);\n            if (!address) throw new Error(await availableAPIs.lookupLocale(\"HOSTNAME_RESOLUTION_FAILED\"));\n            let connection = await availableAPIs.connfulConnect({\n                gate: url.username || \"blog\",\n                address,\n                verifyByDomain: hostname,\n\t\t\t\tkey: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: pargs.key\n\t\t\t\t})).key : undefined,\n\t\t\t\tprivate: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: pargs.key\n\t\t\t\t})).private : undefined,\n\t\t\t\tdoNotVerifyServer: pargs[\"no-verification\"]\n            });\n            await availableAPIs.connfulConnectionSettled(connection);\n            await availableAPIs.connfulWrite({\n                connectionID: connection,\n                data: url.pathname + url.search,\n\t\t\t\thost: hostname\n            });\n            let data = await availableAPIs.connfulRead(connection);\n            data = JSON.parse(data);\n\t\t\tlet chunks = [];\n\t\t\ttheWebsite.innerText = (await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING_PROGRESS\")).replace(\"%s\", \"0\").replace(\"%s\", data.length);\n\t\t\twhile (chunks.length != data.length) {\n\t\t\t\tlet newData = await availableAPIs.connfulRead(connection);\n\t\t\t\tnewData = JSON.parse(newData);\n\t\t\t\tchunks[newData.ctr] = newData.chunk;\n\t\t\t\ttheWebsite.innerText = (await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING_PROGRESS\")).replace(\"%s\", chunks.length).replace(\"%s\", data.length);\n\t\t\t}\n            try {\n                await availableAPIs.connfulClose(connection);\n            } catch {}\n\t\t\tdata.content = chunks.join(\"\");\n            if (data.type == \"script\") {\n                theWebsite.innerText = \"\";\n                ree = await createREE(browserContainer);\n                ree.iframe.style = \"flex-grow: 1; border: none; overflow: auto;\";\n                theWebsite.hidden = true;\n\t\t\t\tlet passthroughAPIs = [\n\t\t\t\t\t// UI class\n\t\t\t\t\t\"isDarkThemed\", \"locale\", \"osLocale\", \"lookupLocale\", \"installedLocales\",\n\t\t\t\t\t// cryptographic class\n\t\t\t\t\t\"cspOperations\", \"availableCsps\",\n\t\t\t\t\t// connful connections class\n\t\t\t\t\t\"connfulConnect\", \"connfulConnectionSettled\", \"connfulDisconnect\", \"connfulForceDisconnect\", \"connfulWrite\", \"connfulRead\", \"connfulAddressGet\", \"connfulIdentityGet\"\n\t\t\t\t];\n\t\t\t\tif (pargs[\"no-sandbox\"]) passthroughAPIs = Object.keys(availableAPIs);\n\t\t\t\tfor (let api of passthroughAPIs) await ree.exportAPI(api, e => availableAPIs[api](e.arg));\n                await ree.exportAPI(\"terminate\", _ => ree.closeDown());\n                await ree.exportAPI(\"navigate\", function(newUrl) {\n                    urlInput.value = new URL(newUrl.arg, urlInput.value).href;\n                    urlButton.click();\n                    ree.closeDown();\n                });\n                await ree.exportAPI(\"currentLocation\", _ => urlInput.value);\n                ree.beforeCloseDown(async function() {\n                    theWebsite.hidden = false;\n                    theWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_POSTCLOSE\");\n                });\n                await ree.eval(data.content);\n            } else if (data.type == \"file\") {\n                theWebsite.innerHTML = await availableAPIs.lookupLocale(\"BLOG_BROWSER_FILEPOST\");\n                let ipcPipe = await availableAPIs.createPipe();\n                await availableAPIs.windowVisibility(false);\n                await availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\", data.filename || urlBar.value.split(\"/\").slice(-1)[0]] });\n                let result = await availableAPIs.listenToPipe(ipcPipe);\n                await availableAPIs.closePipe(ipcPipe);\n                await availableAPIs.windowVisibility(true);\n                if (result.success) {\n                    await availableAPIs.fs_write({ path: result.selected, data: data.content });\n                    theWebsite.innerHTML = await availableAPIs.lookupLocale(\"BLOG_BROWSER_DLFILEPOST\");\n                }\n            }\n        } catch (e) {\n\t\t\tif (ree) ree.closeDown();\n\t\t\ttheWebsite.hidden = false;\n            theWebsite.innerText = await availableAPIs.lookupLocale(e.message);\n        }\n        urlInput.disabled = false;\n        urlButton.disabled = false;\n    }\n\tif (ppos[0]) {\n\t\turlInput.value = ppos[0];\n\t\turlButton.click();\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;","dfd824a03e52e683acc7ea7dc38da61358bccc50058b133132c5ecc73948463c002932cc275d8c2513cff38f09d2acebe814dd296645bc8a08a1da5ef9acd9da":"{\"path\":\"system/apps/blogBrowser.js\",\"localeReferenceName\":\"BLOG_BROWSER_NAME\"}"},"buildInfo":{"for":"1329","when":1751635146736,"signer":"moduleSigner","critical":false,"signature":"ef28502e15300a572b038b1432954e9791448139efc5b83ce05c488550815e78c42a70ac84c9e5e51791aa9bb36914ee86b4ccce636024bd31b989ef5975d70e"}}