// This is a generated file. Please modify the corresponding files, not this file directly.
// (c) Copyright 2024 PCsoft. MIT license: https://spdx.org/licenses/MIT.html

// 00-pcos.js
// @pcos-app-mode native
const pcos_version = "1296";
const build_time = 1748524682316;
 
let modules = {
	core: coreExports,
	pcos_version,
	build_time
};
globalThis.modules = modules;

async function panic(code, component) {
	modules.shuttingDown = true;
	if (modules.session) modules.session.muteAllSessions();
	let baseLocales = {
		"PANIC_LINE1": "A critical problem has been detected while using the operating system. Its stability is at risk now.",
		"PANIC_LINE2": "Problem code: %s",
		"PANIC_UNSPECIFIED_ERROR": "UNSPECIFIED_ERROR",
		"PROBLEMATIC_COMPONENT": "Problematic component: %s",
		"PROBLEMATIC_PARAMS": "Problematic parameters: %s",
		"PROBLEMATIC_JS": "Problematic JavaScript: %s: %s",
		"PANIC_LINE3": "If you have seen this error message the first time, attempt rebooting.",
		"PANIC_LINE4": "If you see this error message once more, there is something wrong with the system.",
		"PANIC_LINE5": "You can try repairing the filesystem by placing a .fsck file on the system root mountpoint, with the value \"recover\" in it.",
		"PANIC_LINE6": "Proper shutdown procedure follows now:",
		"PANIC_TASK_KILLED": "task:%s: killed",
		"PANIC_MOUNT_UNMOUNTED": "mount:%s: unmounted",
		"PANIC_MOUNT_FAILED": "mount:%s: %s: %s"
	}
	let currentLocales = modules.locales;
	if (currentLocales) currentLocales = currentLocales[navigator.language.slice(0, 2).toLowerCase()];
	if (!currentLocales) currentLocales = baseLocales;
	if (!Object.keys(baseLocales).every(key => currentLocales.hasOwnProperty(key))) currentLocales = baseLocales;

	modules.core.tty_bios_api.println(currentLocales.PANIC_LINE1);
	modules.core.tty_bios_api.println(currentLocales.PANIC_LINE2.replace("%s", (code || currentLocales.PANIC_UNSPECIFIED_ERROR)));
	if (component) {
		if (component.name) modules.core.tty_bios_api.println(currentLocales.PROBLEMATIC_COMPONENT.replace("%s", component.name));
		if (component.params) modules.core.tty_bios_api.println(currentLocales.PROBLEMATIC_PARAMS.replace("%s", JSON.stringify(component.params, null, "\t")));
		if (component.underlyingJS) {
			modules.core.tty_bios_api.println(currentLocales.PROBLEMATIC_JS.replace("%s", component.underlyingJS.name).replace("%s", component.underlyingJS.message));
			if (component.underlyingJS.stack) modules.core.tty_bios_api.println(component.underlyingJS.stack);
		}
	}
	modules.core.tty_bios_api.println(currentLocales.PANIC_LINE3);
	modules.core.tty_bios_api.println(currentLocales.PANIC_LINE4);
	modules.core.tty_bios_api.println(currentLocales.PANIC_LINE5);
	modules.core.tty_bios_api.println(currentLocales.PANIC_LINE6);
	try {
		modules.websocket._handles[modules.network.ws].ws.onclose = null;
		modules.websocket._handles[modules.network.ws].ws.close();
		delete modules.websocket._handles[modules.network.ws];
	} catch {}
	if (modules.tasks) for (let task in modules.tasks.tracker) {
		modules.core.tty_bios_api.println(currentLocales.PANIC_TASK_KILLED.replace("%s", modules.tasks.tracker[task].file));
		modules.tasks.tracker[task].ree.closeDown();
	}
	if (modules.fs) for (let mount in modules.fs.mounts) {
		try {
			await modules.fs.unmount(mount);
			modules.core.tty_bios_api.println(currentLocales.PANIC_MOUNT_UNMOUNTED.replace("%s", mount));
		} catch (e) {
			modules.core.tty_bios_api.println(currentLocales.PANIC_MOUNT_FAILED.replace("%s", mount).replace("%s", e.name).replace("%s", e.message));
		}
	}
	if (modules.session) modules.session.destroy();
	throw (component ? component.underlyingJS : null) || code || "UNSPECIFIED_ERROR";
}

function startupMemo() {
	modules.core.tty_bios_api.println("PCsoft PCOS 3, build " + pcos_version);
	modules.core.tty_bios_api.println("Logical processors: " + navigator.hardwareConcurrency);
	modules.core.tty_bios_api.println("Memory available: " + ((navigator.deviceMemory * 1024) || "<unavailable>") + " MB");
}
startupMemo();
// 01-fs.js
function loadFs() {
	// @pcos-app-mode native
	let fs = {
		read: async function(file, sessionToken) {
			let mount = file.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			return await this.mounts[mount].read(file.split("/").slice(1).join("/"), sessionToken);
		},
		write: async function(file, data, sessionToken) {
			let filePath = file.split("/").slice(1);
			if (filePath.includes("")) throw new Error("PATH_INCLUDES_EMPTY");
			let mount = file.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (modules.core.bootMode == "readonly") throw new Error("READ_ONLY_BMGR");
			if (this.mounts[mount].read_only) throw new Error("READ_ONLY_DEV");
			return await this.mounts[mount].write(file.split("/").slice(1).join("/"), data, sessionToken);
		},
		rm: async function(file, sessionToken) {
			let mount = file.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (modules.core.bootMode == "readonly") throw new Error("READ_ONLY_BMGR");
			if (this.mounts[mount].read_only) throw new Error("READ_ONLY_DEV");
			return await this.mounts[mount].rm(file.split("/").slice(1).join("/"), sessionToken);
		},
		mkdir: async function(folder, sessionToken) {
			let filePath = folder.split("/").slice(1);
			if (filePath.includes("")) throw new Error("PATH_INCLUDES_EMPTY");
			let mount = folder.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (modules.core.bootMode == "readonly") throw new Error("READ_ONLY_BMGR");
			if (this.mounts[mount].read_only) throw new Error("READ_ONLY_DEV");
			if (!this.mounts[mount].directory_supported) throw new Error("NO_DIRECTORY_SUPPORT");
			return await this.mounts[mount].mkdir(folder.split("/").slice(1).join("/"), sessionToken);
		},
		permissions: async function(folder, sessionToken) {
			let mount = folder.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			if (!this.mounts[mount].permissions_supported) return { owner: randomNames, group: randomNames, world: "rwx" };
			return await this.mounts[mount].permissions(folder.split("/").slice(1).join("/"), sessionToken);
		},
		lsmounts: function() {
			return Object.keys(this.mounts);
		},
		unmount: async function(mount, sessionToken, force) {
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (!this.mounts[mount].read_only && modules.core.bootMode != "readonly" && !force) await this.sync(mount, sessionToken);
			if (!force) await this.mounts[mount].unmount(sessionToken);
			delete this.mounts[mount];
		},
		chown: async function(file, owner, sessionToken) {
			let filePath = file.split("/").slice(1);
			if (filePath.includes("")) throw new Error("PATH_INCLUDES_EMPTY");
			let mount = file.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (modules.core.bootMode == "readonly") throw new Error("READ_ONLY_BMGR");
			if (this.mounts[mount].read_only) throw new Error("READ_ONLY_DEV");
			if (!this.mounts[mount].permissions_supported) throw new Error("NO_PERMIS_SUPPORT");
			return await this.mounts[mount].chown(file.split("/").slice(1).join("/"), owner, sessionToken);
		},
		chgrp: async function(file, group, sessionToken) {
			let filePath = file.split("/").slice(1);
			if (filePath.includes("")) throw new Error("PATH_INCLUDES_EMPTY");
			let mount = file.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (modules.core.bootMode == "readonly") throw new Error("READ_ONLY_BMGR");
			if (this.mounts[mount].read_only) throw new Error("READ_ONLY_DEV");
			if (!this.mounts[mount].permissions_supported) throw new Error("NO_PERMIS_SUPPORT");
			return await this.mounts[mount].chgrp(file.split("/").slice(1).join("/"), group, sessionToken);
		},
		chmod: async function(file, permissions, sessionToken) {
			let filePath = file.split("/").slice(1);
			if (filePath.includes("")) throw new Error("PATH_INCLUDES_EMPTY");
			let mount = file.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (modules.core.bootMode == "readonly") throw new Error("READ_ONLY_BMGR");
			if (this.mounts[mount].read_only) throw new Error("READ_ONLY_DEV");
			if (!this.mounts[mount].permissions_supported) throw new Error("NO_PERMIS_SUPPORT");
			return await this.mounts[mount].chmod(file.split("/").slice(1).join("/"), permissions, sessionToken);
		},
		ls: async function(folder, sessionToken) {
			let mount = folder.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			return await this.mounts[mount].ls(folder.split("/").slice(1).join("/"), sessionToken);
		},
		isDirectory: async function(path, sessionToken) {
			let mount = path.split("/")[0];
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (!path.split("/").slice(1).join("/")) return true;
			if (!this.mounts[mount].directory_supported) return false;
			return await this.mounts[mount].isDirectory(path.split("/").slice(1).join("/"), sessionToken);
		},
		mountInfo: async function(mount) {
			return {
				read_only: this.mounts[mount].read_only || false,
				permissions_supported: this.mounts[mount].permissions_supported || false,
				directory_supported: this.mounts[mount].directory_supported || false,
				filesystem: this.mounts[mount].filesystem || "unknown"
			}
		},
		sync: async function(mount, sessionToken) {
			if (!this.mounts.hasOwnProperty(mount)) throw new Error("NO_SUCH_DEVICE");
			if (!this.mounts[mount].read_only && modules.core.bootMode != "readonly") return await this.mounts[mount].sync(sessionToken);
		},
		mounts: {}
	}
	
	async function PCFSiDBMount(options) {
		let partition;
		try {
			partition = modules.core.disk.partition(options.partition);
			partition = partition.getData();
		} catch (e) {
			throw new Error("PARTITION_FAILED: " + e.toString() + "\n---begin stack---\n" + e.stack + "\n---end stack---");
		}
		if (!Object.keys(partition).includes("files") || !Object.keys(partition).includes("permissions") || !Object.keys(partition).includes("id")) throw new Error("PARTITION_NOT_PCFS");
		let partitionId = partition.id;
		partition = null;
		return {
			read: async function(key) {
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE");
				}
				if (typeof files === "object") throw new Error("IS_A_DIR");
				return String(await modules.core.idb.readPart(partitionId + "-" + files));
			},
			write: async function(key, value) {
				key = String(key);
				value = String(value);
				let existenceChecks = key.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = this.backend.files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files[basename] === "object") throw new Error("IS_A_DIR");
				let id = files[basename] || crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				await modules.core.idb.writePart(partitionId + "-" + id, value);
				if (!files.hasOwnProperty(basename)) this.backend = this._recursive_op(this.backend, "files/" + key, { type: "write", value: id });
			},
			rm: async function(key) {
				key = String(key);
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE_DIR");
				}
				if (typeof files === "object" && Object.keys(files).length > 0) throw new Error("NON_EMPTY_DIR");
				if (typeof files === "string") await modules.core.idb.removePart(partitionId + "-" + files);
				this.backend = this._recursive_op(this.backend, "files/" + key, { type: "delete" });
				let backend = this.backend;
				delete backend.permissions[key];
				this.backend = backend;
			},
			ls: async function(directory) {
				directory = String(directory);
				let pathParts = directory.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files !== "object") throw new Error("IS_A_FILE");
				return Object.keys(files);
			},
			mkdir: async function(directory) {
				directory = String(directory);
				let existenceChecks = directory.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let files = this.backend.files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (Object.keys(files).includes(directory.split("/").slice(-1)[0])) throw new Error("DIR_EXISTS");
				this.backend = this._recursive_op(this.backend, "files/" + directory, { type: "write", value: {} });
			},
			permissions: async function(file) {
				file = String(file);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let permissions = this.backend.permissions[properFile] || {};
				return {
					owner: permissions.owner || randomNames,
					group: permissions.group || randomNames,
					world: permissions.world || "",
					random: !(permissions.owner && permissions.group && permissions.world) ? true : undefined
				};
			},
			chown: async function(file, owner) {
				file = String(file);
				owner = String(owner);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.owner = owner;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			chgrp: async function(file, group) {
				file = String(file);
				group = String(group);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.group = group;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			chmod: async function(file, permissions) {
				file = String(file);
				permissions = String(permissions);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.world = permissions;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			sync: async function() {
				await modules.core.disk.sync();
			},
			isDirectory: function(key) {
				key = String(key);
				let pathParts = key.split("/").slice(0, -1);
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (!files.hasOwnProperty(basename)) throw new Error("NO_SUCH_FILE_DIR");
				if (typeof files[basename] === "object") return true;
				return false;
			},
			unmount: () => true,
			_recursive_op: function(obj, path, action, stage = 0) {
				if (path.split("/").length == (stage + 1)) {
					if (action.type == "delete") delete obj[path.split("/").slice(-1)[0]];
					if (action.type == "write") obj[path.split("/").slice(-1)[0]] = action.value;
				} else obj[path.split("/")[stage]] = this._recursive_op(obj[path.split("/")[stage]], path, action, stage + 1);
				return obj;
			},
			directory_supported: true,
			read_only: !!options.read_only,
			filesystem: "PCFS",
			permissions_supported: true,
			partition: null,
			get backend() {
				if (!this.partition) this.partition = modules.core.disk.partition(options.partition);
				return this.partition.getData();
			},
			set backend(data) {
				if (!this.partition) this.partition = modules.core.disk.partition(options.partition);
				this.partition.setData(data);
			}
		};
	};

	async function PCFSiDBAESCryptMount(options) {
		let partition;
		try {
			partition = modules.core.disk.partition(options.partition);
			partition = partition.getData();
		} catch (e) {
			throw new Error("PARTITION_FAILED: " + e.toString() + "\n---begin stack---\n" + e.stack + "\n---end stack---");
		}
		if (!Object.keys(partition).includes("files") || !Object.keys(partition).includes("permissions") || !Object.keys(partition).includes("cryptodata") || !Object.keys(partition).includes("id")) throw new Error("PARTITION_NOT_PCFS_ENCRYPTED");
		if (options.interactivePassword) {
			let passwordInput = "";
			let tbi = modules.core.tty_bios_api;
			function outputPasswordAsking() {
				tbi.clear();
				tbi.println("|--------------------------------------------|")
				tbi.println("| Mounting encrypted partition               |");
				tbi.println("|--------------------------------------------|");
				tbi.println("| Enter your password. Typed " + passwordInput.length + " characters. " + " ".repeat(Math.max((3 - (passwordInput.length).toString().length), 0)) + "|");
				tbi.println("| Press Enter to mount.                      |");
				tbi.println("|--------------------------------------------|");
			}
			while (true) {
				outputPasswordAsking();
				let key = await tbi.inputKey();
				if (key.key == "Enter") break;
				if (key.key.length == 1) passwordInput += key.key;
				if (key.key == "Backspace") passwordInput = passwordInput.slice(0, -1);
			}
			options.password = passwordInput;
		}
		if (options.password) options.key = await modules.core.pbkdf2(options.password, partition.cryptodata.salt);
		if (!options.key) throw new Error("GETTING_KEY_FAILED");
		let importedKey = await crypto.subtle.importKey("raw", Uint8Array.from(options.key.match(/.{1,2}/g).map(a => parseInt(a, 16))), { name: "AES-GCM" }, false, [ "encrypt", "decrypt" ]);
		options.key = options.key.length + "L";
		options.password = options.password.length + "L";
		if (partition.cryptodata.passwordLockingInitial) {
			let baseData = crypto.getRandomValues(new Uint8Array(32));
			let iv = crypto.getRandomValues(new Uint8Array(16));
			let ct = new Uint8Array(await crypto.subtle.encrypt({ name: "AES-GCM", iv }, importedKey, baseData));
			let passwordLocking = new Uint8Array(iv.length + ct.length);
			passwordLocking.set(iv);
			passwordLocking.set(ct, iv.length);
			partition.cryptodata.passwordLocking = passwordLocking.reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			if (partition.encryptedFileTable) {
				let fileIV = crypto.getRandomValues(new Uint8Array(16));
				let fileCT = new Uint8Array(await crypto.subtle.encrypt({ name: "AES-GCM", iv: fileIV }, importedKey, new TextEncoder().encode(JSON.stringify({
					files: partition.files,
					permissions: partition.permissions
				}))));
				partition.files = {};
				partition.permissions = {};
				let ept = new Uint8Array(fileIV.length + fileCT.length);
				ept.set(fileIV);
				ept.set(fileCT, fileIV.length);
				partition.encryptedFileTable = ept.reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			}
			delete partition.cryptodata.passwordLockingInitial;
			modules.core.disk.partition(options.partition).setData(partition);
		}
		if (partition.cryptodata.passwordLocking) {
			let iv = new Uint8Array(partition.cryptodata.passwordLocking.slice(0, 32).match(/.{1,2}/g).map(a => parseInt(a, 16)));
			let ct = new Uint8Array(partition.cryptodata.passwordLocking.slice(32).match(/.{1,2}/g).map(a => parseInt(a, 16)));
			await crypto.subtle.decrypt({ name: "AES-GCM", iv }, importedKey, ct);
		}
		let partitionId = partition.id;
		partition = null;
		return {
			read: async function(key) {
				key = String(key);          
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				let files = (await this.getBackend()).files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE");
				}
				if (typeof files === "object") throw new Error("IS_A_DIR");
				let part = await modules.core.idb.readPart(partitionId + "-" + files);
				let iv = new Uint8Array(part.slice(0, 32).match(/.{1,2}/g).map(a => parseInt(a, 16)));
				let ct = new Uint8Array(part.slice(32).match(/.{1,2}/g).map(a => parseInt(a, 16)));
				return new TextDecoder().decode(new Uint8Array(await crypto.subtle.decrypt({ name: "AES-GCM", iv }, this.key, ct)));
			},
			write: async function(key, value) {
				key = String(key);
				value = String(value);
				let existenceChecks = key.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = (await this.getBackend()).files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files[basename] === "object") throw new Error("IS_A_DIR");
				let id = files[basename] || crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let newIV = crypto.getRandomValues(new Uint8Array(16));
				let newCT = new Uint8Array(await crypto.subtle.encrypt({ name: "AES-GCM", iv: newIV }, this.key, new TextEncoder().encode(value)));
				let newPart = new Uint8Array(newIV.length + newCT.length);
				newPart.set(newIV);
				newPart.set(newCT, newIV.length);
				newPart = newPart.reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				await modules.core.idb.writePart(partitionId + "-" + id, newPart);
				if (!files.hasOwnProperty(basename)) await this.setBackend(this._recursive_op(await this.getBackend(), "files/" + key, { type: "write", value: id }));
			},
			rm: async function(key) {
				key = String(key);
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = (await this.getBackend()).files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE_DIR");
				}
				if (typeof files === "object" && Object.keys(files).length > 0) throw new Error("NON_EMPTY_DIR");
				if (typeof files === "string") await modules.core.idb.removePart(partitionId + "-" + files);
				await this.setBackend(this._recursive_op(await this.getBackend(), "files/" + key, { type: "delete" }));
				let backend = await this.getBackend();
				delete backend.permissions[key];
				await this.setBackend(backend);
			},
			ls: async function(directory) {
				directory = String(directory);
				let pathParts = directory.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = (await this.getBackend()).files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files !== "object") throw new Error("IS_A_FILE");
				return Object.keys(files);
			},
			mkdir: async function(directory) {
				directory = String(directory);
				let existenceChecks = directory.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let files = (await this.getBackend()).files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (Object.keys(files).includes(directory.split("/").slice(-1)[0])) throw new Error("DIR_EXISTS");
				await this.setBackend(this._recursive_op(await this.getBackend(), "files/" + directory, { type: "write", value: {} }));
			},
			permissions: async function(file) {
				file = String(file);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let permissions = (await this.getBackend()).permissions[properFile] || {};
				return {
					owner: permissions.owner || randomNames,
					group: permissions.group || randomNames,
					world: permissions.world || "",
					random: !(permissions.owner && permissions.group && permissions.world) ? true : undefined
				};
			},
			chown: async function(file, owner) {
				file = String(file);
				owner = String(owner);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = await this.getBackend();
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.owner = owner;
				backend.permissions[properFile] = filePermissions;
				await this.setBackend(backend);
			},
			chgrp: async function(file, group) {
				file = String(file);
				group = String(group);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = await this.getBackend();
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.group = group;
				backend.permissions[properFile] = filePermissions;
				await this.setBackend(backend);
			},
			chmod: async function(file, permissions) {
				file = String(file);
				permissions = String(permissions);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = await this.getBackend();
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.world = permissions;
				backend.permissions[properFile] = filePermissions;
				await this.setBackend(backend);
			},
			isDirectory: async function(key) {
				key = String(key);
				let pathParts = key.split("/").slice(0, -1);
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = (await this.getBackend()).files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (!files.hasOwnProperty(basename)) throw new Error("NO_SUCH_FILE_DIR");
				if (typeof files[basename] === "object") return true;
				return false;
			},
			sync: async function() {
				await modules.core.disk.sync();
			},
			unmount: () => true,
			_recursive_op: function(obj, path, action, stage = 0) {
				if (path.split("/").length == (stage + 1)) {
					if (action.type == "delete") delete obj[path.split("/").slice(-1)[0]];
					if (action.type == "write") obj[path.split("/").slice(-1)[0]] = action.value;
				} else obj[path.split("/")[stage]] = this._recursive_op(obj[path.split("/")[stage]], path, action, stage + 1);
				return obj;
			},
			directory_supported: true,
			filesystem: "PCFS-AES",
			read_only: !!options.read_only,
			permissions_supported: true,
			partition: null,
			getBackend: async function() {
				if (!this.partition) this.partition = modules.core.disk.partition(options.partition);
				let returnedData = this.partition.getData();
				if (returnedData.encryptedFileTable) {
					let iv = new Uint8Array(returnedData.encryptedFileTable.slice(0, 32).match(/.{1,2}/g).map(a => parseInt(a, 16)));
					let ct = new Uint8Array(returnedData.encryptedFileTable.slice(32).match(/.{1,2}/g).map(a => parseInt(a, 16)));
					return JSON.parse(new TextDecoder().decode(new Uint8Array(await crypto.subtle.decrypt({ name: "AES-GCM", iv }, this.key, ct))));   
				}
				return returnedData;
			},
			setBackend: async function(data) {
				if (!this.partition) this.partition = modules.core.disk.partition(options.partition);
				let returnedData = this.partition.getData();
				if (returnedData.encryptedFileTable) {
					let newIV = crypto.getRandomValues(new Uint8Array(16));
					let newCT = new Uint8Array(await crypto.subtle.encrypt({ name: "AES-GCM", iv: newIV }, this.key, new TextEncoder().encode(JSON.stringify(data))));
					let newPart = new Uint8Array(newIV.length + newCT.length);
					newPart.set(newIV);
					newPart.set(newCT, newIV.length);
					newPart = newPart.reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
					return this.partition.setData({ ...returnedData, encryptedFileTable: newPart });
				}
				this.partition.setData(data);
			},
			key: importedKey
		};
	};
	
	function ramMount(options) {
		let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
		return {
			read: async function(key) {
				key = String(key);
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE");
				}
				if (typeof files === "object") throw new Error("IS_A_DIR");
				return String(this.ramFiles.get(files));
			},
			write: async function(key, value) {
				key = String(key);
				value = String(value);
				let existenceChecks = key.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = this.backend.files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files[basename] === "object") throw new Error("IS_A_DIR");
				let id = files[basename] || crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				this.ramFiles.set(id, value);
				if (!files.hasOwnProperty(basename)) this.backend = this._recursive_op(this.backend, "files/" + key, { type: "write", value: id });
			},
			rm: async function(key) {
				key = String(key);
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE_DIR");
				}
				if (typeof files === "object" && Object.keys(files).length > 0) throw new Error("NON_EMPTY_DIR");
				if (typeof files === "string") this.ramFiles.delete(files);
				this.backend = this._recursive_op(this.backend, "files/" + key, { type: "delete" });
				let backend = this.backend;
				delete backend.permissions[key];
				this.backend = backend;
			},
			ls: async function(directory) {
				directory = String(directory);
				let pathParts = directory.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files !== "object") throw new Error("IS_A_FILE");
				return Object.keys(files);
			},
			mkdir: async function(directory) {
				directory = String(directory);
				let existenceChecks = directory.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let files = this.backend.files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (Object.keys(files).includes(directory.split("/").slice(-1)[0])) throw new Error("DIR_EXISTS");
				this.backend = this._recursive_op(this.backend, "files/" + directory, { type: "write", value: {} });
			},
			permissions: async function(file) {
				file = String(file);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let permissions = this.backend.permissions[properFile] || {};
				return {
					owner: permissions.owner || randomNames,
					group: permissions.group || randomNames,
					world: permissions.world || "",
					random: !(permissions.owner && permissions.group && permissions.world) ? true : undefined
				};
			},
			chown: async function(file, owner) {
				file = String(file);
				owner = String(owner);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.owner = owner;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			chgrp: async function(file, group) {
				file = String(file);
				group = String(group);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.group = group;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			chmod: async function(file, permissions) {
				file = String(file);
				permissions = String(permissions);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.world = permissions;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			isDirectory: function(key) {
				key = String(key);
				let pathParts = key.split("/").slice(0, -1);
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (!files.hasOwnProperty(basename)) throw new Error("NO_SUCH_FILE_DIR");
				if (typeof files[basename] === "object") return true;
				return false;
			},
			_recursive_op: function(obj, path, action, stage = 0) {
				if (path.split("/").length == (stage + 1)) {
					if (action.type == "delete") delete obj[path.split("/").slice(-1)[0]];
					if (action.type == "write") obj[path.split("/").slice(-1)[0]] = action.value;
				} else obj[path.split("/")[stage]] = this._recursive_op(obj[path.split("/")[stage]], path, action, stage + 1);
				return obj;
			},
			sync: () => true,
			unmount: () => true,
			directory_supported: true,
			read_only: !!options.read_only,
			filesystem: "extramfs",
			permissions_supported: true,
			backend: options.type == "run" ? { files: { run: {} }, permissions: {
				"": {
					owner: randomNames,
					group: randomNames,
					world: "rx"
				},
				run: {
					owner: randomNames,
					group: randomNames,
					world: "rwx"
				}
			}} : { files: {}, permissions: {
				"": {
					owner: randomNames,
					group: randomNames,
					world: "rx"
				}
			} },
			ramFiles: new Map()
		};
	}
	
	function preferenceMount(options) {
		return {
			read: a => JSON.stringify(modules.core.prefs.read(a), null, "\t"),
			write: (a, b) => modules.core.prefs.write(a, JSON.parse(b)),
			rm: a => modules.core.prefs.rm(a),
			ls: a => modules.core.prefs.ls(a),
			permissions: function() {
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				return {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
			},
			chown: _ => !1,
			chgrp: _ => !1,
			chmod: _ => !1,
			sync: () => true,
			unmount: () => true,
			directory_supported: false,
			read_only: !!options.read_only,
			filesystem: "preffs",
			permissions_supported: true
		};
	}

	async function SFSPMount(options) {
		let session, serverData;
		try {
			session = await fetch(options.url + "/session");
			session = await session.json();
			serverData = await fetch(options.url + "/properties", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({
					...options,
					sessionToken: session
				})
			});
			serverData = await serverData.json();
		} catch (e) {
			throw new Error("Could not connect to server");
		}
		return {
			read: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "read",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			write: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "write",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			rm: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "rm",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			ls: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "ls",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			mkdir: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "mkdir",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			permissions: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "permissions",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			chown: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "chown",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			chgrp: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "chgrp",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			chmod: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "chmod",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			sync: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "sync",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			isDirectory: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "isDirectory",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			unmount: async function(...a) {
				let req = await fetch(options.url + "/file_operation", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						sessionToken: session,
						operation: "unmount",
						parameters: a
					})
				});
				if (!req.ok) throw (await req.json());
				return await req.json();
			},
			...serverData
		};
	};

	async function IPCMount(options) { // ChatGPT code below
		if (!options.inputPipeId || !options.outputPipeId) throw new Error("PIPE_IDS_REQUIRED");
	
		const inputPipeId = options.inputPipeId;
		const outputPipeId = options.outputPipeId;
		let lock = false;
	
		async function acquireLock() {
			return new Promise((resolve) => {
				const tryLock = () => {
					if (!lock) {
						lock = true;
						resolve();
					} else {
						setTimeout(tryLock, 10); // retry after 10ms
					}
				};
				setTimeout(tryLock, 10);
			});
		}
	
		async function releaseLock() {
			lock = false;
		}
	
		// Function to send request and receive response
		async function ipcRequest(action, payload = {}) {
			await acquireLock();
			return new Promise((resolve, reject) => {
				modules.ipc.listenFor(outputPipeId).then((response) => {
					releaseLock();
					if (response.error) return reject(new Error(response.error));
					return resolve(response.data);
				});
				modules.ipc.send(inputPipeId, { action, ...payload });
			});
		}
	
		// Initial request to get filesystem properties
		const filesystemData = await ipcRequest("properties", { data: options });
	
		return {
			read: async function(key) {
				return ipcRequest("read", { key: String(key) });
			},
			write: async function(key, value) {
				return ipcRequest("write", { key: String(key), value: String(value) });
			},
			rm: async function(key) {
				return ipcRequest("rm", { key: String(key) });
			},
			ls: async function(directory) {
				return ipcRequest("ls", { directory: String(directory) });
			},
			mkdir: async function(directory) {
				return ipcRequest("mkdir", { directory: String(directory) });
			},
			permissions: async function(file) {
				return ipcRequest("permissions", { file: String(file) });
			},
			chown: async function(file, owner) {
				return ipcRequest("chown", { file: String(file), owner: String(owner) });
			},
			chgrp: async function(file, group) {
				return ipcRequest("chgrp", { file: String(file), group: String(group) });
			},
			chmod: async function(file, permissions) {
				return ipcRequest("chmod", { file: String(file), permissions: String(permissions) });
			},
			isDirectory: async function(key) {
				return ipcRequest("isDirectory", { key: String(key) });
			},
			sync: async function() {
				return ipcRequest("sync");
			},
			unmount: async function() {
				return ipcRequest("unmount");
			},
			...filesystemData
		};
	} // ChatGPT code ends here

	async function fileMount(options) {
		let file = JSON.parse(await modules.fs.read(options.srcFile));
		let backend = file.backend;
		delete file.backend;
		let files = file.files;
		delete file.files;
		return {
			read: async function(key) {
				key = String(key);
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE");
				}	
				if (typeof files === "object") throw new Error("IS_A_DIR");
				return String(this.files[files]);
			},
			write: async function(key, value) {
				key = String(key);
				value = String(value);
				let existenceChecks = key.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = this.backend.files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files[basename] === "object") throw new Error("IS_A_DIR");
				let id = files[basename] || crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				this.files[id] = value;
				if (!files.hasOwnProperty(basename)) this.backend = this._recursive_op(this.backend, "files/" + key, { type: "write", value: id });
			},
			rm: async function(key) {
				key = String(key);
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_FILE_DIR");
				}
				if (typeof files === "object" && Object.keys(files).length > 0) throw new Error("NON_EMPTY_DIR");
				if (typeof files === "string") delete this.files[files];
				this.backend = this._recursive_op(this.backend, "files/" + key, { type: "delete" });
				let backend = this.backend;
				delete backend.permissions[key];
				this.backend = backend;
			},
			ls: async function(directory) {
				directory = String(directory);
				let pathParts = directory.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (typeof files !== "object") throw new Error("IS_A_FILE");
				return Object.keys(files);
			},
			mkdir: async function(directory) {
				directory = String(directory);
				let existenceChecks = directory.split("/").slice(0, -1);
				if (existenceChecks[0] == "") existenceChecks = existenceChecks.slice(1);
				if (existenceChecks[existenceChecks.length - 1] == "") existenceChecks = existenceChecks.slice(0, -1);
				let files = this.backend.files;
				for (let part of existenceChecks) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (Object.keys(files).includes(directory.split("/").slice(-1)[0])) throw new Error("DIR_EXISTS");
				this.backend = this._recursive_op(this.backend, "files/" + directory, { type: "write", value: {} });
			},
			permissions: async function(file) {
				file = String(file);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let permissions = this.backend.permissions[properFile] || {};
				return {
					owner: permissions.owner || randomNames,
					group: permissions.group || randomNames,
					world: permissions.world || "",
					random: !(permissions.owner && permissions.group && permissions.world) ? true : undefined
				};
			},
			chown: async function(file, owner) {
				file = String(file);
				owner = String(owner);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.owner = owner;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			chgrp: async function(file, group) {
				file = String(file);
				group = String(group);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.group = group;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			chmod: async function(file, permissions) {
				file = String(file);
				permissions = String(permissions);
				let properFile = file.split("/")
				if (properFile[0] == "") properFile = properFile.slice(1);
				if (properFile[properFile.length - 1] == "") properFile = properFile.slice(0, -1);
				properFile = properFile.join("/");
				let backend = this.backend;
				let randomNames = crypto.getRandomValues(new Uint8Array(8)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
				let filePermissions = backend.permissions[properFile] || {
					owner: randomNames,
					group: randomNames,
					world: "",
				};
				filePermissions.world = permissions;
				backend.permissions[properFile] = filePermissions;
				this.backend = backend;
			},
			isDirectory: function(key) {
				key = String(key);
				let pathParts = key.split("/").slice(0, -1);
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				let basename = key.split("/").slice(-1)[0];
				let files = this.backend.files;
				for (let part of pathParts) {
					files = files[part];
					if (!files) throw new Error("NO_SUCH_DIR");
				}
				if (!files.hasOwnProperty(basename)) throw new Error("NO_SUCH_FILE_DIR");
				if (typeof files[basename] === "object") return true;
				return false;
			},
			_recursive_op: function(obj, path, action, stage = 0) {
				if (path.split("/").length == (stage + 1)) {
					if (action.type == "delete") delete obj[path.split("/").slice(-1)[0]];
					if (action.type == "write") obj[path.split("/").slice(-1)[0]] = action.value;
				} else obj[path.split("/")[stage]] = this._recursive_op(obj[path.split("/")[stage]], path, action, stage + 1);
				return obj;
			},
			sync: async function() {
				return await modules.fs.write(options.srcFile, JSON.stringify({ ...file, backend: this.backend, files: this.files }));
			},
			unmount: () => true,
			directory_supported: true,
			read_only: !!options.read_only,
			filesystem: "filefs",
			permissions_supported: true,
			backend: backend,
			files: files
		};
	}

	async function overlayMount(options) {
		return {
			read: function(key, token) {
				return this._basic_first_op("read", key, token);
			},
			write: function(key, value, token) {
				return this._basic_first_op("write", key, value, token);
			},
			rm: function(key, token) {
				return this._basic_first_op("rm", key, token);
			},
			ls: async function(directory, token) {
				let listing = [], commonErrorMessages = {}, errors = 0;
				for (let mount of options.mounts) {
					try {
						listing.push(...(await modules.fs.ls(mount + "/" + directory, token)));
					} catch (e) {
						errors++;
						commonErrorMessages[e.message] = (commonErrorMessages[e.message] || 0) + 1;
					}
				}
				if (errors == options.mounts.length) throw new Error(Object.entries(commonErrorMessages).sort((a, b) => b[1] - a[1])[0][0]);
				return Array.from(new Set(listing));
			},
			mkdir: function(directory, token) {
				return this._basic_first_op("mkdir", directory, token);
			},
			permissions: async function(file, token) {
				let commonErrorMessages = {}, checkedHowMany = 0;
				for (let mount of options.mounts) {
					try {
						checkedHowMany++;
						let permissions = await modules.fs.permissions(mount + "/" + file, token);
						if (permissions.random && checkedHowMany != options.mounts.length)
							throw new Error("PERMISSION_DENIED");
						return permissions;
					} catch (e) {
						commonErrorMessages[e.message] = (commonErrorMessages[e.message] || 0) + 1;
					}
				}
				throw new Error(Object.entries(commonErrorMessages).sort((a, b) => b[1] - a[1])[0][0]);
			},
			chown: function(file, owner, token) {
				return this._basic_first_op("chown", file, owner, token);
			},
			chgrp: function(file, group, token) {
				return this._basic_first_op("chgrp", file, group, token);
			},
			chmod: function(file, permissions, token) {
				return this._basic_first_op("chmod", file, permissions, token);
			},
			isDirectory: function(key, token) {
				return this._basic_first_op("isDirectory", key, token);
			},
			sync: function(token) {
				return this._every_op("sync", token);
			},
			unmount: function(token) {
				if (options.autoManage) return this._every_op("unmount", token);
			},
			_basic_first_op: async function(op, key, ...args) {
				let pathParts = key.split("/");
				if (pathParts[0] == "") pathParts = pathParts.slice(1);
				if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
				key = pathParts.join("/");
				let previousKey = key.split("/").slice(0, -1).join("/");
				let basename = key.split("/").slice(-1).join("/");
				let lookedForMount;
				for (let mount of options.mounts) {
					try {
						let listing = await modules.fs.ls(mount + "/" + previousKey, args[args.length - 1]);
						if (listing.includes(basename)) {
							lookedForMount = mount;
							break;
						}
					} catch {}
				}
				if (lookedForMount) return modules.fs[op](lookedForMount + "/" + key, ...args);
				let commonErrorMessages = {};
				for (let mount of options.mounts) {
					try {
						return await modules.fs[op](mount + "/" + key, ...args);
					} catch (e) {
						commonErrorMessages[e.message] = (commonErrorMessages[e.message] || 0) + 1;
					}
				}
				throw new Error(Object.entries(commonErrorMessages).sort((a, b) => b[1] - a[1])[0][0]);
			},
			_every_op: async function(op) {
				let commonErrorMessages = {}, gotError;
				for (let mount of options.mounts) {
					try {
						await modules.fs[op](mount);
					} catch (e) {
						gotError = true;
						commonErrorMessages[e.message] = (commonErrorMessages[e.message] || 0) + 1;
					}
				}
				if (gotError) throw new Error(Object.entries(commonErrorMessages).sort((a, b) => b[1] - a[1])[0][0]);
			},
			directory_supported: true,
			read_only: !!options.read_only,
			filesystem: "overlayfs",
			permissions_supported: true
		};
	}
	
	fs.mounts["ram"] = ramMount({
		type: "run"
	});
	modules.mounts = {
		PCFSiDBMount,
		PCFSiDBAESCryptMount,
		ramMount,
		preferenceMount,
		SFSPMount,
		IPCMount,
		fileMount,
		overlayMount
	};
	modules.fs = fs;
	modules.defaultSystem = "ram";
}

loadFs();
// 01-fsck.js
async function fsck() {
	// @pcos-app-mode native
	function println(str) {
		modules.core.tty_bios_api.println(str);
		return new Promise(function(resolve) {
			requestAnimationFrame(resolve);
		})
	}
	let fsckMode;
	try {
		fsckMode = await modules.fs.read(modules.defaultSystem + "/.fsck");
		await modules.fs.rm(modules.defaultSystem + "/.fsck");
	} catch {
		await println("Skipping file system checking.");
		return;
	}
	async function scanLLDA() {
		let fs = modules.fs;
		if (fs.mounts[modules.defaultSystem].read_only) {
			await println("File system is read-only.");
			return { lldaPoints: "abort", lldaId: "abort" };
		}
		if (fs.mounts[modules.defaultSystem].partition.getData) {
			let llda = fs.mounts[modules.defaultSystem].partition.getData().files;
			let lldaId = fs.mounts[modules.defaultSystem].partition.getData().id;
			llda = Object.values(llda);
			while (llda.some(a => typeof a === "object")) llda = llda.map(a => typeof a === "object" ? Object.values(a) : a).flat(); 
			return { lldaPoints: llda, lldaId: lldaId };
		} else {
			await println("Low-level disk access is impossible.");
			return { lldaPoints: "abort", lldaId: "abort" };
		}
	}
	await println("A file system check has been requested.");
	await println("Scanning for file points.");
	let { lldaPoints, lldaId } = await scanLLDA();
	if (lldaPoints === "abort") {
		await println("Skipping file system checking.");
		return;
	}
	await println("File points found: " + lldaPoints.length);
	await println("Reading indexedDB keys.");
	let idb_keys = modules.core.idb._db.transaction("disk").objectStore("disk").getAllKeys();
	idb_keys = await new Promise(function(resolve) {
		idb_keys.onsuccess = () => resolve(idb_keys.result);
	});
	idb_keys.splice(idb_keys.indexOf("disk"), 1);
	await println("IndexedDB keys found: " + idb_keys.length);
	await println("Filtering IndexedDB keys...");
	if (fsckMode != "discard-all") idb_keys = idb_keys.filter(a => a.startsWith(lldaId + "-")).map(a => a.slice(lldaId.length + 1));
	await println("Filtered keys: " + idb_keys.length);
	let missingFiles = idb_keys.filter(a => !lldaPoints.includes(a.slice(fsckMode == "discard-all" ? (lldaId + "-").length : 0)));
	await println("Missing files: " + missingFiles.length);
	let llda = modules.fs.mounts[modules.defaultSystem].partition.getData();
	if (fsckMode == "recover") {
		try {
			await modules.fs.mkdir(modules.defaultSystem + "/lost+found");
			await println("Created lost+found directory.");
		} catch {
			await println("Lost+found directory already exists.");
		}
		for (let file of missingFiles) {
			await println("Moving " + file + " to lost+found.");
			llda.files["lost+found"][file] = file;
		}
	} else if (fsckMode == "discard" || fsckMode == "discard-all") {
		for (let file of missingFiles) {
			await println("Deleting " + file + ".");
			await modules.core.idb.removePart((fsckMode == "discard" ? (lldaId + "-") : "") + file);
		}
	} else {
		await println("Unsure what to do, not doing anything.");
	}
	await println("Saving modified file table.");
	modules.fs.mounts[modules.defaultSystem].partition.setData(llda);
	await modules.core.idb.sync();
	await println("File system check complete.");
}
await fsck();
// 01-fsmodules.js
async function loadModules() {
    try {
        let moduleList = await modules.fs.ls(modules.defaultSystem + "/modules");
        for (let moduleName of moduleList) {
            modules.fs.mounts["." + moduleName] = await modules.mounts.fileMount({
                srcFile: modules.defaultSystem + "/modules/" + moduleName,
                read_only: true
            });
            if (modules.core.bootMode == "logboot") modules.core.tty_bios_api.println("\t../modules/" + moduleName);
        }
        let newSystemMount = "system";
        if (modules.defaultSystem == "system") newSystemMount = "system-" + crypto.getRandomValues(new Uint8Array(4)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
        modules.fs.mounts[newSystemMount] = await modules.mounts.overlayMount({
            mounts: [ modules.defaultSystem, ...moduleList.map(a => "." + a) ]
        });
        modules.defaultSystem = newSystemMount;
    } catch (e) {
        console.error("Module system failed:", e);
    }
}
await loadModules();
// 02-ui.js
function loadUi() {
	// @pcos-app-mode native
	let uiStyle = document.createElement("style");
	uiStyle.innerHTML = `body {
		overflow: hidden;
		background: black;
		cursor: none;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}

	.taskbar {
		width: 100%;
		background: ${modules.core.bootMode == "safe" ? "rgb(128, 128, 128)" : "rgba(128, 128, 128, 0.85)"};
		left: 0;
		bottom: 0;
		position: absolute;
		padding: 4px;
		box-sizing: border-box;
		border-radius: 4px;
		display: flex;
	}

	.taskbar .clock {
		margin-right: 4px;
	}

	.taskbar .icon {
		width: 27px;
		height: 27px;
		background-size: contain;
		margin: 0 4px;
	}

	.filler {
		flex: 1;
	}

	.window {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		background-color: ${modules.core.bootMode == "safe" ? "rgb(240, 240, 240)" : "rgba(240, 240, 240, 0.5)"};
		border: 1px solid #ccc;
		box-shadow: ${modules.core.bootMode == "safe" ? "none" : "0 0 5px rgba(0, 0, 0, 0.3)"};
		z-index: 1;
		resize: both;
		width: 320px;
		height: 180px;
		display: flex;
		flex-direction: column;
		overflow: auto;
		backdrop-filter: ${modules.core.bootMode == "safe" ? "none" : "blur(8px)"};
		animation: ${modules.core.bootMode == "safe" ? "none" : "fade-in 0.1s ease-in forwards"};
		border-radius: 4px;
	}


	.window.icon {
		top: 72px;
		left: 72px;
		resize: none;
		width: 128px;
		height: 128px;
	}

	.window.dark {
		background-color: ${modules.core.bootMode == "safe" ? "rgb(55, 55, 55)" : "rgba(55, 55, 55, 0.5)"};
		color: white;
		border: 1px solid #1b1b1b;
	}

	.window .title-bar {
		padding: 6px;
		background-color: ${modules.core.bootMode == "safe" ? "rgb(204, 204, 204)" : "rgba(204, 204, 204, 0.5)"};
		cursor: move;
		display: flex;
		flex: 1;
		user-select: none;
	}

	.window.dark .title-bar {
		background-color: ${modules.core.bootMode == "safe" ? "rgb(27, 27, 27)" : "rgba(27, 27, 27, 0.5)"};
	}

	.window .button {
		cursor: pointer;
		padding: 4px;
		border: none;
		flex: 1;
		margin: 0 0 0 2px;
		border-radius: 4px;
	}

	.window .button:hover {
		opacity: 75%;
	}

	.window .close-button {
		background: red;
		color: white;
	}

	.window .title-displayer {
		flex: 100;
	}

	.window .close-button:disabled {
		opacity: 25%;
	}

	.window.fullscreen .resize-handle {
		display: none;
	}

	.window.fullscreen {
		width: 100% !important;
		height: 100% !important;
		position: fixed;
		top: 0 !important;
		left: 0 !important;
		transform: none;
		resize: none;
		border: none;
		box-shadow: none;
	}

	.window.fullscreen .title-bar {
		cursor: default;
	}

	.window .content {
		flex: 100;
		overflow: auto;
		position: relative;
		background-color: #f0f0f0;
	}

	.window.dark .content {
		background-color: #373737;
	}

	.session {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: black;
		cursor: default;
		animation: ${modules.core.bootMode == "safe" ? "none" : "fade-in 0.1s ease-in forwards"};
	}

	.session.secure {
		background: none${modules.core.bootMode == "safe" ? " !important" : ""};
		backdrop-filter: ${modules.core.bootMode == "safe" ? "none" : "blur(8px) brightness(50%)"};
		animation: ${modules.core.bootMode == "safe" ? "none" : "fade 0.1s ease-out forwards"};
	}

	.hidden {
		display: none;
	}
	
	@keyframes fade-in {
		0% {
			opacity: 0;
		}

		100% {
			opacity: 1;
		}
	}

	@keyframes fade {
		0% {
			backdrop-filter: blur(0px) brightness(100%);
		}

		100% {
			backdrop-filter: blur(8px) brightness(50%);
		}
	}`;
	document.head.appendChild(uiStyle);

	function createWindow(sessionId, makeFullscreenOnAllScreens, asIconWindow, reportMovement) {
		let fullscreen = makeFullscreenOnAllScreens || matchMedia("(max-width: 600px)").matches;
		if (asIconWindow) fullscreen = false;
		let id = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
		let windowDiv = document.createElement('div');
		windowDiv.className = 'window ' + (fullscreen ? "fullscreen " : "") + " " + (asIconWindow ? "icon" : "");
		if (session.attrib(sessionId, "dark")) windowDiv.classList.add("dark");
		windowDiv.id = 'window-' + id;
		let titleBar = document.createElement('div');
		titleBar.className = 'title-bar';
		let title = document.createElement('span');
		title.className = 'title-displayer';
		let closeButton = document.createElement('button');
		closeButton.className = 'button close-button';
		closeButton.innerHTML = '&#10005;';
		titleBar.appendChild(title);
		if (!fullscreen && !asIconWindow) {
			let fullscreenButton = document.createElement('button');
			fullscreenButton.className = 'button';
			fullscreenButton.innerHTML = '&#x25a1;';
			fullscreenButton.onclick = function() {
				windowDiv.classList.toggle("fullscreen");
			}
			titleBar.appendChild(fullscreenButton);
		}
		if (!asIconWindow) titleBar.appendChild(closeButton);
		windowDiv.appendChild(titleBar);
		let content = document.createElement('div');
		content.className = 'content';
		windowDiv.appendChild(content);
		session.tracker[sessionId].html.appendChild(windowDiv);
		if (!fullscreen) makeDraggable(windowDiv, titleBar, reportMovement);
		return {
			windowDiv,
			title,
			closeButton,
			content,
			sessionId
		};
	}

	function makeDraggable(windowDiv, titleBar, reportMovement) {
		let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

		titleBar.onmousedown = dragMouseDown;
		titleBar.ontouchstart = dragMouseDown;

		function dragMouseDown(e) {
			if (e.type != "touchstart") e.preventDefault();
			if (e.type == "touchstart") e = e.touches[0];
			pos3 = e.clientX;
			pos4 = e.clientY;

			document.onmouseup = closeDragElement;
			document.ontouchend = closeDragElement;
			document.ontouchcancel = closeDragElement;
			document.onmousemove = elementDrag;
			document.ontouchmove = elementDrag;
		}

		function elementDrag(e) {
			e.preventDefault();
			if (e.type == "touchmove") e = e.touches[0];
			pos1 = pos3 - e.clientX;
			pos2 = pos4 - e.clientY;
			pos3 = e.clientX;
			pos4 = e.clientY;

			if (!windowDiv.classList.contains("fullscreen")) {
				if (reportMovement) reportMovement(windowDiv.offsetLeft - pos1, windowDiv.offsetTop - pos2);
				windowDiv.style.top = windowDiv.offsetTop - pos2 + 'px';
				windowDiv.style.left = windowDiv.offsetLeft - pos1 + 'px';
			}
		}

		function closeDragElement() {
			document.onmouseup = null;
			document.ontouchend = null;
			document.ontouchcancel = null;
			document.onmousemove = null;
			document.ontouchmove = null;
		}
	}

	let session = {
		mksession: function() {
			if (modules.shuttingDown) throw new Error("SYSTEM_SHUTDOWN_REQUESTED");
			let identifier = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			let session = document.createElement('div');
			session.className = "session hidden";
			document.body.appendChild(session);
			this.tracker[identifier] = {
				html: session,
				attrib: {}
			};
			return identifier;
		},
		rmsession: function(session) {
			this.tracker[session].html.remove();
			delete this.tracker[session];
		},
		muteAllSessions: function() {
			for (let session in this.tracker) this.tracker[session].html.classList.add("hidden");
			this.active = null;
		},
		activateSession: function(session) {
			this.tracker[this.active]?.html?.classList?.add("hidden");
			this.tracker[session].html.classList.remove("hidden");
			this.active = session;
		},
		attrib: function(session, key, val) {
			if (val !== undefined) this.tracker[session].attrib[key] = val;
			if (key !== undefined) return this.tracker[session].attrib[key];
			return this.tracker[session].attrib;
		},
		destroy: function() {
			for (let session in this.tracker) this.rmsession(session);
			this.tracker = {};
			delete this.systemSession;
			delete modules.liu;
			delete modules.serviceSession;
			uiStyle.remove();
			delete modules.uiStyle;
		},
		tracker: {},
		active: null
	}

	modules.window = createWindow;
	modules.session = session;
	modules.uiStyle = uiStyle;

	modules.session.systemSession = session.mksession();
	session.muteAllSessions();
	session.activateSession(modules.session.systemSession);
	modules.startupWindow = modules.window(modules.session.systemSession);
	modules.startupWindowProgress = document.createElement("progress");
	modules.startupWindow.title.innerText = "PCOS 3";
	modules.startupWindow.content.style.padding = "8px";
	modules.startupWindow.closeButton.classList.toggle("hidden", true);
	modules.startupWindow.content.innerText = "PCOS is starting...";
	modules.startupWindow.content.appendChild(document.createElement("br"));
	modules.startupWindow.content.appendChild(modules.startupWindowProgress);
}

loadUi();
// 03-diff.js
function loadDiff() {
	// fast-myers-diff, version 3.2.0
	// @pcos-app-mode native
	"use strict";function diff_internal(e,t){var{b:a,eq:l,stack_base:s}=e;let{i:f,N:c,j:n,M:p,Z:h,stack_top:y}=e;for(;;)switch(t){case 0:e:for(;0<c&&0<p;){a.fill(0,0,2*h);var u=c-p,r=c+p,x=1&r,d=f+c-1,v=n+p-1,M=(r+x)/2;let o;t:for(let i=0;i<=M;i++){var b=2*Math.max(0,i-p)-i,_=i-2*Math.max(0,i-c);for(let r=b;r<=_;r+=2){var m=a[r-1-h*Math.floor((r-1)/h)],S=a[r+1-h*Math.floor((r+1)/h)],S=r===-i||r!==i&&m<S?S:m+1,m=S-r;let e=S,t=m;for(;e<c&&t<p&&l(f+e,n+t);)e++,t++;if(a[r-h*Math.floor(r/h)]=e,1==x&&(o=u-r)>=1-i&&o<i&&e+a[h+o-h*Math.floor(o/h)]>=c){if(1<i||e!==S){s[y++]=f+e,s[y++]=c-e,s[y++]=n+t,s[y++]=p-t,c=S,p=m,h=2*(Math.min(c,p)+1);continue e}break t}}for(let r=b;r<=_;r+=2){var A=a[h+r-1-h*Math.floor((r-1)/h)],P=a[h+r+1-h*Math.floor((r+1)/h)],P=r===-i||r!==i&&A<P?P:A+1,A=P-r;let e=P,t=A;for(;e<c&&t<p&&l(d-e,v-t);)e++,t++;if(a[h+r-h*Math.floor(r/h)]=e,0==x&&(o=u-r)>=-i&&o<=i&&e+a[o-h*Math.floor(o/h)]>=c){if(0<i||e!==P){s[y++]=f+c-P,s[y++]=P,s[y++]=n+p-A,s[y++]=A,c-=e,p-=t,h=2*(Math.min(c,p)+1);continue e}break t}}}if(c!==p){p>c?(f+=c,n+=c,p-=c,c=0):(f+=p,n+=p,c-=p,p=0);break}}if(c+p!==0)if(e.pxe===f||e.pye===n)e.pxe=f+c,e.pye=n+p;else{var i=e.pxs;if(e.oxs=e.pxs,e.oxe=e.pxe,e.oys=e.pys,e.oye=e.pye,e.pxs=f,e.pxe=f+c,e.pys=n,e.pye=n+p,0<=i)return e.i=f,e.N=c,e.j=n,e.M=p,e.Z=h,e.stack_top=y,1}case 1:if(0===y)return 2;p=s[--y],n=s[--y],c=s[--y],f=s[--y],h=2*(Math.min(c,p)+1),t=0}};class DiffGen{constructor(e){this.state=e,this.c=0,this.result={value:null,done:!1}}[Symbol.iterator](){return this}next(){var e,{state:t,result:r}=this;return 1<this.c?(r.done=!0,r.value=void 0):(e=diff_internal(t,this.c),1===(this.c=e)?r.value=[t.oxs,t.oxe,t.oys,t.oye]:0<=t.pxs?r.value=[t.pxs,t.pxe,t.pys,t.pye]:(r.done=!0,r.value=void 0)),r}}function diff_core(e,t,r,i,o){var a=2*(Math.min(t,i)+1),l=t+i,l=new(l<256?Uint8Array:l<65536?Uint16Array:Uint32Array)(2*a);return new DiffGen({i:e,N:t,j:r,M:i,Z:a,b:l,eq:o,pxs:-1,pxe:-1,pys:-1,pye:-1,oxs:-1,oxe:-1,oys:-1,oye:-1,stack_top:0,stack_base:[]})}function diff(r,i,e){let[t,o,a]=[0,r.length,i.length];if("function"==typeof e){for(;t<o&&t<a&&e(t,t);)t++;if(t===o&&t===a)return[][Symbol.iterator]();for(;e(--o,--a)&&o>t&&a>t;);}else{for(;t<o&&t<a&&r[t]===i[t];)t++;if(t===o&&t===a)return[][Symbol.iterator]();for(;r[--o]===i[--a]&&o>t&&a>t;);e=(e,t)=>r[e]===i[t]}return diff_core(t,o+1-t,t,a+1-t,e)}globalThis.diff_core=diff_core,globalThis.diff=diff;class LCSGen{constructor(e,t){this.diff=e,this.N=t,this.i=0,this.j=0}[Symbol.iterator](){return this}next(){var i=this.diff.next();if(i.done){let{i:e,j:t,N:r}=this;e<r&&(i.done=!1,i.value=[e,t,r-e],this.i=r)}else{var r=i.value,o=r[0],a=r[1],l=r[3];let{i:e,j:t}=this;e!==o&&(r.length--,r[0]=e,r[1]=t,r[2]=o-e),this.i=a,this.j=l}return i}}function lcs(e,t,r){return new LCSGen(diff(e,t,r),e.length)}function*calcPatch(e,t,r){var i=ArrayBuffer.isView(e)?Uint8Array.prototype.subarray:e.slice;for(const o of diff(e,t,r))o[2]=i.call(t,o[2],o[3]),yield o}function*applyPatch(e,t){let r=0;var i,o,a,l=ArrayBuffer.isView(e)?Uint8Array.prototype.subarray:e.slice;for([i,o,a]of t)r<i&&(yield l.call(e,r,i)),0<a.length&&(yield a),r=o;r<e.length&&(yield l.call(e,r))}function*calcSlices(e,t,r){let i=0;var o,a,l,s,f=ArrayBuffer.isView(e)?Uint8Array.prototype.subarray:e.slice;for([o,a,l,s]of diff(e,t,r))i<o&&(yield[0,f.call(e,i,o)]),o<a&&(yield[-1,f.call(e,o,a)]),l<s&&(yield[1,f.call(t,l,s)]),i=a;i<e.length&&(yield[0,e.slice(i)])}globalThis.lcs=lcs,globalThis.calcPatch=calcPatch,globalThis.applyPatch=applyPatch,globalThis.calcSlices=calcSlices;
}
loadDiff();
// 03-xterm.js
function xterm_export() {
    if (globalThis.xterm_loaded) return;
   // xterm, version 5.5.0
   // @pcos-app-mode native
   let xterm_style = document.createElement("style");
   xterm_style.innerHTML = `/**
   * Copyright (c) 2014 The xterm.js authors. All rights reserved.
   * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
   * https://github.com/chjj/term.js
   * @license MIT
   *
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   *
   * The above copyright notice and this permission notice shall be included in
   * all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   * THE SOFTWARE.
   *
   * Originally forked from (with the author's permission):
   *   Fabrice Bellard's javascript vt100 for jslinux:
   *   http://bellard.org/jslinux/
   *   Copyright (c) 2011 Fabrice Bellard
   *   The original design remains. The terminal itself
   *   has been extended to include xterm CSI codes, among
   *   other features.
   */
  
  /**
   *  Default styles for xterm.js
   */
  
  .xterm {
      cursor: text;
      position: relative;
      user-select: none;
      -ms-user-select: none;
      -webkit-user-select: none;
  }
  
  .xterm.focus,
  .xterm:focus {
      outline: none;
  }
  
  .xterm .xterm-helpers {
      position: absolute;
      top: 0;
      /**
       * The z-index of the helpers must be higher than the canvases in order for
       * IMEs to appear on top.
       */
      z-index: 5;
  }
  
  .xterm .xterm-helper-textarea {
      padding: 0;
      border: 0;
      margin: 0;
      /* Move textarea out of the screen to the far left, so that the cursor is not visible */
      position: absolute;
      opacity: 0;
      left: -9999em;
      top: 0;
      width: 0;
      height: 0;
      z-index: -5;
      /** Prevent wrapping so the IME appears against the textarea at the correct position */
      white-space: nowrap;
      overflow: hidden;
      resize: none;
  }
  
  .xterm .composition-view {
      /* TODO: Composition position got messed up somewhere */
      background: #000;
      color: #FFF;
      display: none;
      position: absolute;
      white-space: nowrap;
      z-index: 1;
  }
  
  .xterm .composition-view.active {
      display: block;
  }
  
  .xterm .xterm-viewport {
      /* On OS X this is required in order for the scroll bar to appear fully opaque */
      background-color: #000;
      overflow-y: scroll;
      cursor: default;
      position: absolute;
      right: 0;
      left: 0;
      top: 0;
      bottom: 0;
  }
  
  .xterm .xterm-screen {
      position: relative;
  }
  
  .xterm .xterm-screen canvas {
      position: absolute;
      left: 0;
      top: 0;
  }
  
  .xterm .xterm-scroll-area {
      visibility: hidden;
  }
  
  .xterm-char-measure-element {
      display: inline-block;
      visibility: hidden;
      position: absolute;
      top: 0;
      left: -9999em;
      line-height: normal;
  }
  
  .xterm.enable-mouse-events {
      /* When mouse events are enabled (eg. tmux), revert to the standard pointer cursor */
      cursor: default;
  }
  
  .xterm.xterm-cursor-pointer,
  .xterm .xterm-cursor-pointer {
      cursor: pointer;
  }
  
  .xterm.column-select.focus {
      /* Column selection mode */
      cursor: crosshair;
  }
  
  .xterm .xterm-accessibility:not(.debug),
  .xterm .xterm-message {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      right: 0;
      z-index: 10;
      color: transparent;
      pointer-events: none;
  }
  
  .xterm .xterm-accessibility-tree:not(.debug) *::selection {
    color: transparent;
  }
  
  .xterm .xterm-accessibility-tree {
    user-select: text;
    white-space: pre;
  }
  
  .xterm .live-region {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
  }
  
  .xterm-dim {
      /* Dim should not apply to background, so the opacity of the foreground color is applied
       * explicitly in the generated class and reset to 1 here */
      opacity: 1 !important;
  }
  
  .xterm-underline-1 { text-decoration: underline; }
  .xterm-underline-2 { text-decoration: double underline; }
  .xterm-underline-3 { text-decoration: wavy underline; }
  .xterm-underline-4 { text-decoration: dotted underline; }
  .xterm-underline-5 { text-decoration: dashed underline; }
  
  .xterm-overline {
      text-decoration: overline;
  }
  
  .xterm-overline.xterm-underline-1 { text-decoration: overline underline; }
  .xterm-overline.xterm-underline-2 { text-decoration: overline double underline; }
  .xterm-overline.xterm-underline-3 { text-decoration: overline wavy underline; }
  .xterm-overline.xterm-underline-4 { text-decoration: overline dotted underline; }
  .xterm-overline.xterm-underline-5 { text-decoration: overline dashed underline; }
  
  .xterm-strikethrough {
      text-decoration: line-through;
  }
  
  .xterm-screen .xterm-decoration-container .xterm-decoration {
      z-index: 6;
      position: absolute;
  }
  
  .xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer {
      z-index: 7;
  }
  
  .xterm-decoration-overview-ruler {
      z-index: 8;
      position: absolute;
      top: 0;
      right: 0;
      pointer-events: none;
  }
  
  .xterm-decoration-top {
      z-index: 2;
      position: relative;
  }  
  `;
   document.head.appendChild(xterm_style);
   !function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var s in i)("object"==typeof exports?exports:e)[s]=i[s]}}(globalThis,(()=>(()=>{"use strict";var e={4567:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const n=i(9042),o=i(9924),a=i(844),h=i(4725),c=i(2585),l=i(3656);let d=t.AccessibilityManager=class extends a.Disposable{constructor(e,t,i,s){super(),this._terminal=e,this._coreBrowserService=i,this._renderService=s,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let e=0;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);if(this._topBoundaryFocusListener=e=>this._handleBoundaryFocus(e,0),this._bottomBoundaryFocusListener=e=>this._handleBoundaryFocus(e,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new o.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((e=>this._handleResize(e.rows)))),this.register(this._terminal.onRender((e=>this._refreshRows(e.start,e.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((e=>this._handleChar(e)))),this.register(this._terminal.onLineFeed((()=>this._handleChar("\n")))),this.register(this._terminal.onA11yTab((e=>this._handleTab(e)))),this.register(this._terminal.onKey((e=>this._handleKey(e.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,l.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,a.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,"\n"===e&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=n.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const i=this._terminal.buffer,s=i.lines.length.toString();for(let r=e;r<=t;r++){const e=i.lines.get(i.ydisp+r),t=[],n=e?.translateToString(!0,void 0,void 0,t)||"",o=(i.ydisp+r+1).toString(),a=this._rowElements[r];a&&(0===n.length?(a.innerText="",this._rowColumns.set(a,[0,1])):(a.textContent=n,this._rowColumns.set(a,t)),a.setAttribute("aria-posinset",o),a.setAttribute("aria-setsize",s))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){const i=e.target,s=this._rowElements[0===t?1:this._rowElements.length-2];if(i.getAttribute("aria-posinset")===(0===t?"1":`${this._terminal.buffer.lines.length}`))return;if(e.relatedTarget!==s)return;let r,n;if(0===t?(r=i,n=this._rowElements.pop(),this._rowContainer.removeChild(n)):(r=this._rowElements.shift(),n=i,this._rowContainer.removeChild(r)),r.removeEventListener("focus",this._topBoundaryFocusListener),n.removeEventListener("focus",this._bottomBoundaryFocusListener),0===t){const e=this._createAccessibilityTreeNode();this._rowElements.unshift(e),this._rowContainer.insertAdjacentElement("afterbegin",e)}else{const e=this._createAccessibilityTreeNode();this._rowElements.push(e),this._rowContainer.appendChild(e)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===t?-1:1),this._rowElements[0===t?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(0===this._rowElements.length)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let t={node:e.anchorNode,offset:e.anchorOffset},i={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(i.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===i.node&&t.offset>i.offset)&&([t,i]=[i,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;const s=this._rowElements.slice(-1)[0];if(i.node.compareDocumentPosition(s)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(i={node:s,offset:s.textContent?.length??0}),!this._rowContainer.contains(i.node))return;const r=({node:e,offset:t})=>{const i=e instanceof Text?e.parentNode:e;let s=parseInt(i?.getAttribute("aria-posinset"),10)-1;if(isNaN(s))return console.warn("row is invalid. Race condition?"),null;const r=this._rowColumns.get(i);if(!r)return console.warn("columns is null. Race condition?"),null;let n=t<r.length?r[t]:r.slice(-1)[0]+1;return n>=this._terminal.cols&&(++s,n=0),{row:s,column:n}},n=r(t),o=r(i);if(n&&o){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let e=this._rowContainer.children.length;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=d=s([r(1,c.IInstantiationService),r(2,h.ICoreBrowserService),r(3,h.IRenderService)],d)},3614:(e,t)=>{function i(e){return e.replace(/\r?\n/g,"\r")}function s(e,t){return t?"[200~"+e+"[201~":e}function r(e,t,r,n){e=s(e=i(e),r.decPrivateModes.bracketedPasteMode&&!0!==n.rawOptions.ignoreBracketedPasteMode),r.triggerDataEvent(e,!0),t.value=""}function n(e,t,i){const s=i.getBoundingClientRect(),r=e.clientX-s.left-10,n=e.clientY-s.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${r}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=i,t.bracketTextForPaste=s,t.copyHandler=function(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()},t.handlePasteEvent=function(e,t,i,s){e.stopPropagation(),e.clipboardData&&r(e.clipboardData.getData("text/plain"),t,i,s)},t.paste=r,t.moveTextAreaUnderMouseCursor=n,t.rightClickHandler=function(e,t,i,s,r){n(e,t,i),r&&s.rightClickSelect(e),t.value=s.selectionText,t.select()}},7239:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const s=i(1505);t.ColorContrastCache=class{constructor(){this._color=new s.TwoKeyMap,this._css=new s.TwoKeyMap}setCss(e,t,i){this._css.set(e,t,i)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,i){this._color.set(e,t,i)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}}},3656:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(e,t,i,s){e.addEventListener(t,i,s);let r=!1;return{dispose:()=>{r||(r=!0,e.removeEventListener(t,i,s))}}}},3551:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier=void 0;const n=i(3656),o=i(8460),a=i(844),h=i(2585),c=i(4725);let l=t.Linkifier=class extends a.Disposable{get currentLink(){return this._currentLink}constructor(e,t,i,s,r){super(),this._element=e,this._mouseService=t,this._renderService=i,this._bufferService=s,this._linkProviderService=r,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new o.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new o.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,a.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,a.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){this._lastMouseEvent=e;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;const i=e.composedPath();for(let e=0;e<i.length;e++){const t=i[e];if(t.classList.contains("xterm"))break;if(t.classList.contains("xterm-hover"))return}this._lastBufferCell&&t.x===this._lastBufferCell.x&&t.y===this._lastBufferCell.y||(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){this._activeProviderReplies&&t||(this._activeProviderReplies?.forEach((e=>{e?.forEach((e=>{e.link.dispose&&e.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=e.y);let i=!1;for(const[s,r]of this._linkProviderService.linkProviders.entries())if(t){const t=this._activeProviderReplies?.get(s);t&&(i=this._checkLinkProviderResult(s,e,i))}else r.provideLinks(e.y,(t=>{if(this._isMouseOut)return;const r=t?.map((e=>({link:e})));this._activeProviderReplies?.set(s,r),i=this._checkLinkProviderResult(s,e,i),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)}))}_removeIntersectingLinks(e,t){const i=new Set;for(let s=0;s<t.size;s++){const r=t.get(s);if(r)for(let t=0;t<r.length;t++){const s=r[t],n=s.link.range.start.y<e?0:s.link.range.start.x,o=s.link.range.end.y>e?this._bufferService.cols:s.link.range.end.x;for(let e=n;e<=o;e++){if(i.has(e)){r.splice(t--,1);break}i.add(e)}}}}_checkLinkProviderResult(e,t,i){if(!this._activeProviderReplies)return i;const s=this._activeProviderReplies.get(e);let r=!1;for(let t=0;t<e;t++)this._activeProviderReplies.has(t)&&!this._activeProviderReplies.get(t)||(r=!0);if(!r&&s){const e=s.find((e=>this._linkAtPosition(e.link,t)));e&&(i=!0,this._handleNewLink(e))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!i)for(let e=0;e<this._activeProviderReplies.size;e++){const s=this._activeProviderReplies.get(e)?.find((e=>this._linkAtPosition(e.link,t)));if(s){i=!0,this._handleNewLink(s);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;const t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){this._currentLink&&this._lastMouseEvent&&(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,a.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._lastMouseEvent)return;const t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:e=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",e))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:t=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((e=>{if(!this._currentLink)return;const t=0===e.start?0:e.start+1+this._bufferService.buffer.ydisp,i=this._bufferService.buffer.ydisp+1+e.end;if(this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=i&&(this._clearCurrentLink(t,i),this._lastMouseEvent)){const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._askForLink(e,!1)}}))))}_linkHover(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(i,t.text)}_fireUnderlineEvent(e,t){const i=e.range,s=this._bufferService.buffer.ydisp,r=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-s-1,i.end.x,i.end.y-s-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(r)}_linkLeave(e,t,i){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(i,t.text)}_linkAtPosition(e,t){const i=e.range.start.y*this._bufferService.cols+e.range.start.x,s=e.range.end.y*this._bufferService.cols+e.range.end.x,r=t.y*this._bufferService.cols+t.x;return i<=r&&r<=s}_positionFromMouseEvent(e,t,i){const s=i.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(s)return{x:s[0],y:s[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,i,s,r){return{x1:e,y1:t,x2:i,y2:s,cols:this._bufferService.cols,fg:r}}};t.Linkifier=l=s([r(1,c.IMouseService),r(2,c.IRenderService),r(3,h.IBufferService),r(4,c.ILinkProviderService)],l)},9042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const n=i(511),o=i(2585);let a=t.OscLinkProvider=class{constructor(e,t,i){this._bufferService=e,this._optionsService=t,this._oscLinkService=i}provideLinks(e,t){const i=this._bufferService.buffer.lines.get(e-1);if(!i)return void t(void 0);const s=[],r=this._optionsService.rawOptions.linkHandler,o=new n.CellData,a=i.getTrimmedLength();let c=-1,l=-1,d=!1;for(let t=0;t<a;t++)if(-1!==l||i.hasContent(t)){if(i.loadCell(t,o),o.hasExtendedAttrs()&&o.extended.urlId){if(-1===l){l=t,c=o.extended.urlId;continue}d=o.extended.urlId!==c}else-1!==l&&(d=!0);if(d||-1!==l&&t===a-1){const i=this._oscLinkService.getLinkData(c)?.uri;if(i){const n={start:{x:l+1,y:e},end:{x:t+(d||t!==a-1?0:1),y:e}};let o=!1;if(!r?.allowNonHttpProtocols)try{const e=new URL(i);["http:","https:"].includes(e.protocol)||(o=!0)}catch(e){o=!0}o||s.push({text:i,range:n,activate:(e,t)=>r?r.activate(e,t,n):h(0,t),hover:(e,t)=>r?.hover?.(e,t,n),leave:(e,t)=>r?.leave?.(e,t,n)})}d=!1,o.hasExtendedAttrs()&&o.extended.urlId?(l=t,c=o.extended.urlId):(l=-1,c=-1)}}t(s)}};function h(e,t){if(confirm(`Do you want to navigate to ${t}?\n\nWARNING: This link could potentially be dangerous`)){const e=window.open();if(e){try{e.opener=null}catch{}e.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=a=s([r(0,o.IBufferService),r(1,o.IOptionsService),r(2,o.IOscLinkService)],a)},6193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(e,t,i){this._rowCount=i,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}}},3236:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const s=i(3614),r=i(3656),n=i(3551),o=i(9042),a=i(3730),h=i(1680),c=i(3107),l=i(5744),d=i(2950),_=i(1296),u=i(428),f=i(4269),v=i(5114),p=i(8934),g=i(3230),m=i(9312),S=i(4725),C=i(6731),b=i(8055),w=i(8969),y=i(8460),E=i(844),k=i(6114),L=i(8437),D=i(2584),R=i(7399),x=i(5941),A=i(9074),B=i(2585),T=i(5435),M=i(4567),O=i(779);class P extends w.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(e={}){super(e),this.browser=k,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new E.MutableDisposable),this._onCursorMove=this.register(new y.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new y.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new y.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new y.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new y.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new y.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new y.EventEmitter),this._onBlur=this.register(new y.EventEmitter),this._onA11yCharEmitter=this.register(new y.EventEmitter),this._onA11yTabEmitter=this.register(new y.EventEmitter),this._onWillOpen=this.register(new y.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(A.DecorationService),this._instantiationService.setService(B.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(O.LinkProviderService),this._instantiationService.setService(S.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(a.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((e,t)=>this.refresh(e,t)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((e=>this._reportWindowsOptions(e)))),this.register(this._inputHandler.onColor((e=>this._handleColorEvent(e)))),this.register((0,y.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,y.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,y.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,y.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((e=>this._afterResize(e.cols,e.rows)))),this.register((0,E.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(e){if(this._themeService)for(const t of e){let e,i="";switch(t.index){case 256:e="foreground",i="10";break;case 257:e="background",i="11";break;case 258:e="cursor",i="12";break;default:e="ansi",i="4;"+t.index}switch(t.type){case 0:const s=b.color.toColorRGB("ansi"===e?this._themeService.colors.ansi[t.index]:this._themeService.colors[e]);this.coreService.triggerDataEvent(`${D.C0.ESC}]${i};${(0,x.toRgbString)(s)}${D.C1_ESCAPED.ST}`);break;case 1:if("ansi"===e)this._themeService.modifyColors((e=>e.ansi[t.index]=b.channels.toColor(...t.color)));else{const i=e;this._themeService.modifyColors((e=>e[i]=b.channels.toColor(...t.color)))}break;case 2:this._themeService.restoreColor(t.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(M.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(D.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(D.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;const i=Math.min(this.buffer.x,this.cols-1),s=this._renderService.dimensions.css.cell.height,r=t.getWidth(i),n=this._renderService.dimensions.css.cell.width*r,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=i*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=s+"px",this.textarea.style.lineHeight=s+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,r.addDisposableDomListener)(this.element,"copy",(e=>{this.hasSelection()&&(0,s.copyHandler)(e,this._selectionService)})));const e=e=>(0,s.handlePasteEvent)(e,this.textarea,this.coreService,this.optionsService);this.register((0,r.addDisposableDomListener)(this.textarea,"paste",e)),this.register((0,r.addDisposableDomListener)(this.element,"paste",e)),k.isFirefox?this.register((0,r.addDisposableDomListener)(this.element,"mousedown",(e=>{2===e.button&&(0,s.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,r.addDisposableDomListener)(this.element,"contextmenu",(e=>{(0,s.rightClickHandler)(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),k.isLinux&&this.register((0,r.addDisposableDomListener)(this.element,"auxclick",(e=>{1===e.button&&(0,s.moveTextAreaUnderMouseCursor)(e,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,r.addDisposableDomListener)(this.textarea,"keyup",(e=>this._keyUp(e)),!0)),this.register((0,r.addDisposableDomListener)(this.textarea,"keydown",(e=>this._keyDown(e)),!0)),this.register((0,r.addDisposableDomListener)(this.textarea,"keypress",(e=>this._keyPress(e)),!0)),this.register((0,r.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,r.addDisposableDomListener)(this.textarea,"compositionupdate",(e=>this._compositionHelper.compositionupdate(e)))),this.register((0,r.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,r.addDisposableDomListener)(this.textarea,"input",(e=>this._inputEvent(e)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(e){if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);const t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,r.addDisposableDomListener)(this.screenElement,"mousemove",(e=>this.updateCursorStyle(e)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",o.promptLabel),k.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(v.CoreBrowserService,this.textarea,e.ownerDocument.defaultView??window,this._document??"undefined"!=typeof window?window.document:null)),this._instantiationService.setService(S.ICoreBrowserService,this._coreBrowserService),this.register((0,r.addDisposableDomListener)(this.textarea,"focus",(e=>this._handleTextAreaFocus(e)))),this.register((0,r.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(u.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(S.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(C.ThemeService),this._instantiationService.setService(S.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(f.CharacterJoinerService),this._instantiationService.setService(S.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(g.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(S.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((e=>this._onRender.fire(e)))),this.onResize((e=>this._renderService.resize(e.cols,e.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(d.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(p.MouseService),this._instantiationService.setService(S.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(n.Linkifier,this.screenElement)),this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(h.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((e=>this.scrollLines(e.amount,e.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(m.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(S.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((e=>this.scrollLines(e.amount,e.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((e=>this._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((e=>{this.textarea.value=e,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((e=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,r.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(c.BufferDecorationRenderer,this.screenElement)),this.register((0,r.addDisposableDomListener)(this.element,"mousedown",(e=>this._selectionService.handleMouseDown(e)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(M.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(e=>this._handleScreenReaderModeOptionChange(e)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(l.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(e=>{!this._overviewRulerRenderer&&e&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(l.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(_.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const e=this,t=this.element;function i(t){const i=e._mouseService.getMouseReportCoords(t,e.screenElement);if(!i)return!1;let s,r;switch(t.overrideType||t.type){case"mousemove":r=32,void 0===t.buttons?(s=3,void 0!==t.button&&(s=t.button<3?t.button:3)):s=1&t.buttons?0:4&t.buttons?1:2&t.buttons?2:3;break;case"mouseup":r=0,s=t.button<3?t.button:3;break;case"mousedown":r=1,s=t.button<3?t.button:3;break;case"wheel":if(e._customWheelEventHandler&&!1===e._customWheelEventHandler(t))return!1;if(0===e.viewport.getLinesScrolled(t))return!1;r=t.deltaY<0?0:1,s=4;break;default:return!1}return!(void 0===r||void 0===s||s>4)&&e.coreMouseService.triggerMouseEvent({col:i.col,row:i.row,x:i.x,y:i.y,button:s,action:r,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey})}const s={mouseup:null,wheel:null,mousedrag:null,mousemove:null},n={mouseup:e=>(i(e),e.buttons||(this._document.removeEventListener("mouseup",s.mouseup),s.mousedrag&&this._document.removeEventListener("mousemove",s.mousedrag)),this.cancel(e)),wheel:e=>(i(e),this.cancel(e,!0)),mousedrag:e=>{e.buttons&&i(e)},mousemove:e=>{e.buttons||i(e)}};this.register(this.coreMouseService.onProtocolChange((e=>{e?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(e)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&e?s.mousemove||(t.addEventListener("mousemove",n.mousemove),s.mousemove=n.mousemove):(t.removeEventListener("mousemove",s.mousemove),s.mousemove=null),16&e?s.wheel||(t.addEventListener("wheel",n.wheel,{passive:!1}),s.wheel=n.wheel):(t.removeEventListener("wheel",s.wheel),s.wheel=null),2&e?s.mouseup||(s.mouseup=n.mouseup):(this._document.removeEventListener("mouseup",s.mouseup),s.mouseup=null),4&e?s.mousedrag||(s.mousedrag=n.mousedrag):(this._document.removeEventListener("mousemove",s.mousedrag),s.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,r.addDisposableDomListener)(t,"mousedown",(e=>{if(e.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(e))return i(e),s.mouseup&&this._document.addEventListener("mouseup",s.mouseup),s.mousedrag&&this._document.addEventListener("mousemove",s.mousedrag),this.cancel(e)}))),this.register((0,r.addDisposableDomListener)(t,"wheel",(e=>{if(!s.wheel){if(this._customWheelEventHandler&&!1===this._customWheelEventHandler(e))return!1;if(!this.buffer.hasScrollback){const t=this.viewport.getLinesScrolled(e);if(0===t)return;const i=D.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(e.deltaY<0?"A":"B");let s="";for(let e=0;e<Math.abs(t);e++)s+=i;return this.coreService.triggerDataEvent(s,!0),this.cancel(e,!0)}return this.viewport.handleWheel(e)?this.cancel(e):void 0}}),{passive:!1})),this.register((0,r.addDisposableDomListener)(t,"touchstart",(e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(e),this.cancel(e)}),{passive:!0})),this.register((0,r.addDisposableDomListener)(t,"touchmove",(e=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(e)?void 0:this.cancel(e)}),{passive:!1}))}refresh(e,t){this._renderService?.refreshRows(e,t)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t,i=0){1===i?(super.scrollLines(e,t,i),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(e)}paste(e){(0,s.paste)(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(e,t,i){this._selectionService.setSelection(e,t,i)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,t){this._selectionService?.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;const t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;t||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);const i=(0,R.evaluateKeyboardEvent)(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===i.type||2===i.type){const t=this.rows-1;return this.scrollLines(2===i.type?-t:t),this.cancel(e,!0)}return 1===i.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,e)||(i.cancel&&this.cancel(e,!0),!i.key||!!(e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(i.key!==D.C0.ETX&&i.key!==D.C0.CR||(this.textarea.value=""),this._onKey.fire({key:i.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey?this.cancel(e,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(e,t){const i=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return"keypress"===t.type?i:i&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(function(e){return 16===e.keyCode||17===e.keyCode||18===e.keyCode}(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(null===e.which||void 0===e.which)t=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;t=e.which}return!(!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)||(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){e!==this.cols||t!==this.rows?super.resize(e,t):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(e,t){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(L.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(D.C0.ESC+"[I"):this.coreService.triggerDataEvent(D.C0.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case T.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const e=this._renderService.dimensions.css.canvas.width.toFixed(0),t=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${D.C0.ESC}[4;${t};${e}t`);break;case T.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const i=this._renderService.dimensions.css.cell.width.toFixed(0),s=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${D.C0.ESC}[6;${s};${i}t`)}}cancel(e,t){if(this.options.cancelEvents||t)return e.preventDefault(),e.stopPropagation(),!1}}t.Terminal=P},9924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(e,t=1e3){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,i){this._rowCount=i,e=void 0!==e?e:0,t=void 0!==t?t:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,t):t;const s=Date.now();if(s-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=s,this._innerRefresh();else if(!this._additionalRefreshRequested){const e=s-this._lastRefreshMs,t=this._debounceThresholdMS-e;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),t)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}}},1680:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const n=i(3656),o=i(4725),a=i(8460),h=i(844),c=i(2585);let l=t.Viewport=class extends h.Disposable{constructor(e,t,i,s,r,o,h,c){super(),this._viewportElement=e,this._scrollArea=t,this._bufferService=i,this._optionsService=s,this._charSizeService=r,this._renderService=o,this._coreBrowserService=h,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new a.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((e=>this._activeBuffer=e.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((e=>this._renderDimensions=e))),this._handleThemeChange(c.colors),this.register(c.onChangeColors((e=>this._handleThemeChange(e)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(e){if(e)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,t){const i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&0!==this._viewportElement.scrollTop||t>0&&i<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const t=this._getPixelsScrolled(e);return 0!==t&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}scrollLines(e){if(0!==e)if(this._optionsService.rawOptions.smoothScrollDuration){const t=e*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!1})}_getPixelsScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(e,t){let i,s="";const r=[],n=t??this._bufferService.buffer.lines.length,o=this._bufferService.buffer.lines;for(let t=e;t<n;t++){const e=o.get(t);if(!e)continue;const n=o.get(t+1)?.isWrapped;if(s+=e.translateToString(!n),!n||t===o.length-1){const e=document.createElement("div");e.textContent=s,r.push(e),s.length>0&&(i=e),s=""}}return{bufferElements:r,cursorElement:i}}getLinesScrolled(e){if(0===e.deltaY||e.shiftKey)return 0;let t=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(e,t){const i=this._optionsService.rawOptions.fastScrollModifier;return"alt"===i&&t.altKey||"ctrl"===i&&t.ctrlKey||"shift"===i&&t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const t=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,0!==t&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(e,t))}};t.Viewport=l=s([r(2,c.IBufferService),r(3,c.IOptionsService),r(4,o.ICharSizeService),r(5,o.IRenderService),r(6,o.ICoreBrowserService),r(7,o.IThemeService)],l)},3107:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const n=i(4725),o=i(844),a=i(2585);let h=t.BufferDecorationRenderer=class extends o.Disposable{constructor(e,t,i,s,r){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=i,this._decorationService=s,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((e=>this._removeDecoration(e)))),this.register((0,o.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){const t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer","top"===e?.options?.layer),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",t.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const i=e.options.x??0;return i&&i>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){const t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let i=this._decorationElements.get(e);i||(i=this._createElement(e),e.element=i,this._decorationElements.set(e,i),this._container.appendChild(i),e.onDispose((()=>{this._decorationElements.delete(e),i.remove()}))),i.style.top=t*this._renderService.dimensions.css.cell.height+"px",i.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(i)}}_refreshXPosition(e,t=e.element){if(!t)return;const i=e.options.x??0;"right"===(e.options.anchor||"left")?t.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":t.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};t.BufferDecorationRenderer=h=s([r(1,a.IBufferService),r(2,n.ICoreBrowserService),r(3,a.IDecorationService),r(4,n.IRenderService)],h)},5871:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(const t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(t,e.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,i){return t>=e.startBufferLine-this._linePadding[i||"full"]&&t<=e.endBufferLine+this._linePadding[i||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}}},5744:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const n=i(5871),o=i(4725),a=i(844),h=i(2585),c={full:0,left:0,center:0,right:0},l={full:0,left:0,center:0,right:0},d={full:0,left:0,center:0,right:0};let _=t.OverviewRulerRenderer=class extends a.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(e,t,i,s,r,o,h){super(),this._viewportElement=e,this._screenElement=t,this._bufferService=i,this._decorationService=s,this._renderService=r,this._optionsService=o,this._coreBrowserService=h,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const c=this._canvas.getContext("2d");if(!c)throw new Error("Ctx cannot be null");this._ctx=c,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,a.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const e=Math.floor(this._canvas.width/3),t=Math.ceil(this._canvas.width/3);l.full=this._canvas.width,l.left=e,l.center=t,l.right=e,this._refreshDrawHeightConstants(),d.full=0,d.left=0,d.center=l.left,d.right=l.left+l.center}_refreshDrawHeightConstants(){c.full=Math.round(2*this._coreBrowserService.dpr);const e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);c.left=t,c.center=t,c.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*c.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const e of this._decorationService.decorations)this._colorZoneStore.addDecoration(e);this._ctx.lineWidth=1;const e=this._colorZoneStore.zones;for(const t of e)"full"!==t.position&&this._renderColorZone(t);for(const t of e)"full"===t.position&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(d[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-c[e.position||"full"]/2),l[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+c[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};t.OverviewRulerRenderer=_=s([r(2,h.IBufferService),r(3,h.IDecorationService),r(4,o.IRenderService),r(5,h.IOptionsService),r(6,o.ICoreBrowserService)],_)},2950:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const n=i(4725),o=i(2585),a=i(2584);let h=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(e,t,i,s,r,n){this._textarea=e,this._compositionView=t,this._bufferService=i,this._optionsService=s,this._coreService=r,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(229===e.keyCode)return!1;if(16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let t;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,t=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),t.length>0&&this._coreService.triggerDataEvent(t,!0)}}),0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const e=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const t=this._textarea.value,i=t.replace(e,"");this._dataAlreadySent=i,t.length>e.length?this._coreService.triggerDataEvent(i,!0):t.length<e.length?this._coreService.triggerDataEvent(`${a.C0.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}}),0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),t=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,s=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=s+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=t+"px",this._compositionView.style.lineHeight=t+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const r=this._compositionView.getBoundingClientRect();this._textarea.style.left=s+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(r.width,1)+"px",this._textarea.style.height=Math.max(r.height,1)+"px",this._textarea.style.lineHeight=r.height+"px"}e||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};t.CompositionHelper=h=s([r(2,o.IBufferService),r(3,o.IOptionsService),r(4,o.ICoreService),r(5,n.IRenderService)],h)},9806:(e,t)=>{function i(e,t,i){const s=i.getBoundingClientRect(),r=e.getComputedStyle(i),n=parseInt(r.getPropertyValue("padding-left")),o=parseInt(r.getPropertyValue("padding-top"));return[t.clientX-s.left-n,t.clientY-s.top-o]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=i,t.getCoords=function(e,t,s,r,n,o,a,h,c){if(!o)return;const l=i(e,t,s);return l?(l[0]=Math.ceil((l[0]+(c?a/2:0))/a),l[1]=Math.ceil(l[1]/h),l[0]=Math.min(Math.max(l[0],1),r+(c?1:0)),l[1]=Math.min(Math.max(l[1],1),n),l):void 0}},9504:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const s=i(2584);function r(e,t,i,s){const r=e-n(e,i),a=t-n(t,i),l=Math.abs(r-a)-function(e,t,i){let s=0;const r=e-n(e,i),a=t-n(t,i);for(let n=0;n<Math.abs(r-a);n++){const a="A"===o(e,t)?-1:1,h=i.buffer.lines.get(r+a*n);h?.isWrapped&&s++}return s}(e,t,i);return c(l,h(o(e,t),s))}function n(e,t){let i=0,s=t.buffer.lines.get(e),r=s?.isWrapped;for(;r&&e>=0&&e<t.rows;)i++,s=t.buffer.lines.get(--e),r=s?.isWrapped;return i}function o(e,t){return e>t?"A":"B"}function a(e,t,i,s,r,n){let o=e,a=t,h="";for(;o!==i||a!==s;)o+=r?1:-1,r&&o>n.cols-1?(h+=n.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!r&&o<0&&(h+=n.buffer.translateBufferLineToString(a,!1,0,e+1),o=n.cols-1,e=o,a--);return h+n.buffer.translateBufferLineToString(a,!1,e,o)}function h(e,t){const i=t?"O":"[";return s.C0.ESC+i+e}function c(e,t){e=Math.floor(e);let i="";for(let s=0;s<e;s++)i+=t;return i}t.moveToCellSequence=function(e,t,i,s){const o=i.buffer.x,l=i.buffer.y;if(!i.buffer.hasScrollback)return function(e,t,i,s,o,l){return 0===r(t,s,o,l).length?"":c(a(e,t,e,t-n(t,o),!1,o).length,h("D",l))}(o,l,0,t,i,s)+r(l,t,i,s)+function(e,t,i,s,o,l){let d;d=r(t,s,o,l).length>0?s-n(s,o):t;const _=s,u=function(e,t,i,s,o,a){let h;return h=r(i,s,o,a).length>0?s-n(s,o):t,e<i&&h<=s||e>=i&&h<s?"C":"D"}(e,t,i,s,o,l);return c(a(e,d,i,_,"C"===u,o).length,h(u,l))}(o,l,e,t,i,s);let d;if(l===t)return d=o>e?"D":"C",c(Math.abs(o-e),h(d,s));d=l>t?"D":"C";const _=Math.abs(l-t);return c(function(e,t){return t.cols-e}(l>t?e:o,i)+(_-1)*i.cols+1+((l>t?o:e)-1),h(d,s))}},1296:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const n=i(3787),o=i(2550),a=i(2223),h=i(6171),c=i(6052),l=i(4725),d=i(8055),_=i(8460),u=i(844),f=i(2585),v="xterm-dom-renderer-owner-",p="xterm-rows",g="xterm-fg-",m="xterm-bg-",S="xterm-focus",C="xterm-selection";let b=1,w=t.DomRenderer=class extends u.Disposable{constructor(e,t,i,s,r,a,l,d,f,g,m,S,w){super(),this._terminal=e,this._document=t,this._element=i,this._screenElement=s,this._viewportElement=r,this._helperContainer=a,this._linkifier2=l,this._charSizeService=f,this._optionsService=g,this._bufferService=m,this._coreBrowserService=S,this._themeService=w,this._terminalClass=b++,this._rowElements=[],this._selectionRenderModel=(0,c.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new _.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(p),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(C),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,h.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((e=>this._injectCss(e)))),this._injectCss(this._themeService.colors),this._rowFactory=d.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(v+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((e=>this._handleLinkHover(e)))),this.register(this._linkifier2.onHideLinkUnderline((e=>this._handleLinkLeave(e)))),this.register((0,u.toDisposable)((()=>{this._element.classList.remove(v+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new o.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const e of this._rowElements)e.style.width=`${this.dimensions.css.canvas.width}px`,e.style.height=`${this.dimensions.css.cell.height}px`,e.style.lineHeight=`${this.dimensions.css.cell.height}px`,e.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const t=`${this._terminalSelector} .${p} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${p} { color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${p} .xterm-dim { color: ${d.color.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const i=`blink_underline_${this._terminalClass}`,s=`blink_bar_${this._terminalClass}`,r=`blink_block_${this._terminalClass}`;t+=`@keyframes ${i} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${s} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${r} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${p}.${S} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${p}.${S} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${p}.${S} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${p} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${C} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${C} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${C} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(const[i,s]of e.ansi.entries())t+=`${this._terminalSelector} .${g}${i} { color: ${s.css}; }${this._terminalSelector} .${g}${i}.xterm-dim { color: ${d.color.multiplyOpacity(s,.5).css}; }${this._terminalSelector} .${m}${i} { background-color: ${s.css}; }`;t+=`${this._terminalSelector} .${g}${a.INVERTED_DEFAULT_COLOR} { color: ${d.color.opaque(e.background).css}; }${this._terminalSelector} .${g}${a.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${d.color.multiplyOpacity(d.color.opaque(e.background),.5).css}; }${this._terminalSelector} .${m}${a.INVERTED_DEFAULT_COLOR} { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){const e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let e=this._rowElements.length;e<=t;e++){const e=this._document.createElement("div");this._rowContainer.appendChild(e),this._rowElements.push(e)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(S),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(S),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,i){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,i),this.renderRows(0,this._bufferService.rows-1),!e||!t)return;this._selectionRenderModel.update(this._terminal,e,t,i);const s=this._selectionRenderModel.viewportStartRow,r=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow;if(n>=this._bufferService.rows||o<0)return;const a=this._document.createDocumentFragment();if(i){const i=e[0]>t[0];a.appendChild(this._createSelectionElement(n,i?t[0]:e[0],i?e[0]:t[0],o-n+1))}else{const i=s===n?e[0]:0,h=n===r?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(n,i,h));const c=o-n-1;if(a.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){const e=r===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,e))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,i,s=1){const r=this._document.createElement("div"),n=t*this.dimensions.css.cell.width;let o=this.dimensions.css.cell.width*(i-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),r.style.height=s*this.dimensions.css.cell.height+"px",r.style.top=e*this.dimensions.css.cell.height+"px",r.style.left=`${n}px`,r.style.width=`${o}px`,r}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const e of this._rowElements)e.replaceChildren()}renderRows(e,t){const i=this._bufferService.buffer,s=i.ybase+i.y,r=Math.min(i.x,this._bufferService.cols-1),n=this._optionsService.rawOptions.cursorBlink,o=this._optionsService.rawOptions.cursorStyle,a=this._optionsService.rawOptions.cursorInactiveStyle;for(let h=e;h<=t;h++){const e=h+i.ydisp,t=this._rowElements[h],c=i.lines.get(e);if(!t||!c)break;t.replaceChildren(...this._rowFactory.createRow(c,e,e===s,o,a,r,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${v}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,i,s,r,n){i<0&&(e=0),s<0&&(t=0);const o=this._bufferService.rows-1;i=Math.max(Math.min(i,o),0),s=Math.max(Math.min(s,o),0),r=Math.min(r,this._bufferService.cols);const a=this._bufferService.buffer,h=a.ybase+a.y,c=Math.min(a.x,r-1),l=this._optionsService.rawOptions.cursorBlink,d=this._optionsService.rawOptions.cursorStyle,_=this._optionsService.rawOptions.cursorInactiveStyle;for(let o=i;o<=s;++o){const u=o+a.ydisp,f=this._rowElements[o],v=a.lines.get(u);if(!f||!v)break;f.replaceChildren(...this._rowFactory.createRow(v,u,u===h,d,_,c,l,this.dimensions.css.cell.width,this._widthCache,n?o===i?e:0:-1,n?(o===s?t:r)-1:-1))}}};t.DomRenderer=w=s([r(7,f.IInstantiationService),r(8,l.ICharSizeService),r(9,f.IOptionsService),r(10,f.IBufferService),r(11,l.ICoreBrowserService),r(12,l.IThemeService)],w)},3787:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;const n=i(2223),o=i(643),a=i(511),h=i(2585),c=i(8055),l=i(4725),d=i(4269),_=i(6171),u=i(3734);let f=t.DomRendererRowFactory=class{constructor(e,t,i,s,r,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=i,this._coreBrowserService=s,this._coreService=r,this._decorationService=n,this._themeService=o,this._workCell=new a.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,i){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=i}createRow(e,t,i,s,r,a,h,l,_,f,p){const g=[],m=this._characterJoinerService.getJoinedCharacters(t),S=this._themeService.colors;let C,b=e.getNoBgTrimmedLength();i&&b<a+1&&(b=a+1);let w=0,y="",E=0,k=0,L=0,D=!1,R=0,x=!1,A=0;const B=[],T=-1!==f&&-1!==p;for(let M=0;M<b;M++){e.loadCell(M,this._workCell);let b=this._workCell.getWidth();if(0===b)continue;let O=!1,P=M,I=this._workCell;if(m.length>0&&M===m[0][0]){O=!0;const t=m.shift();I=new d.JoinedCellData(this._workCell,e.translateToString(!0,t[0],t[1]),t[1]-t[0]),P=t[1]-1,b=I.getWidth()}const H=this._isCellInSelection(M,t),F=i&&M===a,W=T&&M>=f&&M<=p;let U=!1;this._decorationService.forEachDecorationAtCell(M,t,void 0,(e=>{U=!0}));let N=I.getChars()||o.WHITESPACE_CELL_CHAR;if(" "===N&&(I.isUnderline()||I.isOverline())&&(N=""),A=b*l-_.get(N,I.isBold(),I.isItalic()),C){if(w&&(H&&x||!H&&!x&&I.bg===E)&&(H&&x&&S.selectionForeground||I.fg===k)&&I.extended.ext===L&&W===D&&A===R&&!F&&!O&&!U){I.isInvisible()?y+=o.WHITESPACE_CELL_CHAR:y+=N,w++;continue}w&&(C.textContent=y),C=this._document.createElement("span"),w=0,y=""}else C=this._document.createElement("span");if(E=I.bg,k=I.fg,L=I.extended.ext,D=W,R=A,x=H,O&&a>=M&&a<=P&&(a=M),!this._coreService.isCursorHidden&&F&&this._coreService.isCursorInitialized)if(B.push("xterm-cursor"),this._coreBrowserService.isFocused)h&&B.push("xterm-cursor-blink"),B.push("bar"===s?"xterm-cursor-bar":"underline"===s?"xterm-cursor-underline":"xterm-cursor-block");else if(r)switch(r){case"outline":B.push("xterm-cursor-outline");break;case"block":B.push("xterm-cursor-block");break;case"bar":B.push("xterm-cursor-bar");break;case"underline":B.push("xterm-cursor-underline")}if(I.isBold()&&B.push("xterm-bold"),I.isItalic()&&B.push("xterm-italic"),I.isDim()&&B.push("xterm-dim"),y=I.isInvisible()?o.WHITESPACE_CELL_CHAR:I.getChars()||o.WHITESPACE_CELL_CHAR,I.isUnderline()&&(B.push(`xterm-underline-${I.extended.underlineStyle}`)," "===y&&(y=""),!I.isUnderlineColorDefault()))if(I.isUnderlineColorRGB())C.style.textDecorationColor=`rgb(${u.AttributeData.toColorRGB(I.getUnderlineColor()).join(",")})`;else{let e=I.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&I.isBold()&&e<8&&(e+=8),C.style.textDecorationColor=S.ansi[e].css}I.isOverline()&&(B.push("xterm-overline")," "===y&&(y="")),I.isStrikethrough()&&B.push("xterm-strikethrough"),W&&(C.style.textDecoration="underline");let $=I.getFgColor(),j=I.getFgColorMode(),z=I.getBgColor(),K=I.getBgColorMode();const q=!!I.isInverse();if(q){const e=$;$=z,z=e;const t=j;j=K,K=t}let V,G,X,J=!1;switch(this._decorationService.forEachDecorationAtCell(M,t,void 0,(e=>{"top"!==e.options.layer&&J||(e.backgroundColorRGB&&(K=50331648,z=e.backgroundColorRGB.rgba>>8&16777215,V=e.backgroundColorRGB),e.foregroundColorRGB&&(j=50331648,$=e.foregroundColorRGB.rgba>>8&16777215,G=e.foregroundColorRGB),J="top"===e.options.layer)})),!J&&H&&(V=this._coreBrowserService.isFocused?S.selectionBackgroundOpaque:S.selectionInactiveBackgroundOpaque,z=V.rgba>>8&16777215,K=50331648,J=!0,S.selectionForeground&&(j=50331648,$=S.selectionForeground.rgba>>8&16777215,G=S.selectionForeground)),J&&B.push("xterm-decoration-top"),K){case 16777216:case 33554432:X=S.ansi[z],B.push(`xterm-bg-${z}`);break;case 50331648:X=c.channels.toColor(z>>16,z>>8&255,255&z),this._addStyle(C,`background-color:#${v((z>>>0).toString(16),"0",6)}`);break;default:q?(X=S.foreground,B.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):X=S.background}switch(V||I.isDim()&&(V=c.color.multiplyOpacity(X,.5)),j){case 16777216:case 33554432:I.isBold()&&$<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&($+=8),this._applyMinimumContrast(C,X,S.ansi[$],I,V,void 0)||B.push(`xterm-fg-${$}`);break;case 50331648:const e=c.channels.toColor($>>16&255,$>>8&255,255&$);this._applyMinimumContrast(C,X,e,I,V,G)||this._addStyle(C,`color:#${v($.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(C,X,S.foreground,I,V,G)||q&&B.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}B.length&&(C.className=B.join(" "),B.length=0),F||O||U?C.textContent=y:w++,A!==this.defaultSpacing&&(C.style.letterSpacing=`${A}px`),g.push(C),M=P}return C&&w&&(C.textContent=y),g}_applyMinimumContrast(e,t,i,s,r,n){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,_.treatGlyphAsBackgroundColor)(s.getCode()))return!1;const o=this._getContrastCache(s);let a;if(r||n||(a=o.getColor(t.rgba,i.rgba)),void 0===a){const e=this._optionsService.rawOptions.minimumContrastRatio/(s.isDim()?2:1);a=c.color.ensureContrastRatio(r||t,n||i,e),o.setColor((r||t).rgba,(n||i).rgba,a??null)}return!!a&&(this._addStyle(e,`color:${a.css}`),!0)}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){const i=this._selectionStart,s=this._selectionEnd;return!(!i||!s)&&(this._columnSelectMode?i[0]<=s[0]?e>=i[0]&&t>=i[1]&&e<s[0]&&t<=s[1]:e<i[0]&&t>=i[1]&&e>=s[0]&&t<=s[1]:t>i[1]&&t<s[1]||i[1]===s[1]&&t===i[1]&&e>=i[0]&&e<s[0]||i[1]<s[1]&&t===s[1]&&e<s[0]||i[1]<s[1]&&t===i[1]&&e>=i[0])}};function v(e,t,i){for(;e.length<i;)e=t+e;return e}t.DomRendererRowFactory=f=s([r(1,l.ICharacterJoinerService),r(2,h.IOptionsService),r(3,l.ICoreBrowserService),r(4,h.ICoreService),r(5,h.IDecorationService),r(6,l.IThemeService)],f)},2550:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const i=e.createElement("span");i.classList.add("xterm-char-measure-element");const s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontWeight="bold";const r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontStyle="italic";const n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[i,s,r,n],this._container.appendChild(i),this._container.appendChild(s),this._container.appendChild(r),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,i,s){e===this._font&&t===this._fontSize&&i===this._weight&&s===this._weightBold||(this._font=e,this._fontSize=t,this._weight=i,this._weightBold=s,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${i}`,this._measureElements[1].style.fontWeight=`${s}`,this._measureElements[2].style.fontWeight=`${i}`,this._measureElements[3].style.fontWeight=`${s}`,this.clear())}get(e,t,i){let s=0;if(!t&&!i&&1===e.length&&(s=e.charCodeAt(0))<256){if(-9999!==this._flat[s])return this._flat[s];const t=this._measure(e,0);return t>0&&(this._flat[s]=t),t}let r=e;t&&(r+="B"),i&&(r+="I");let n=this._holey.get(r);if(void 0===n){let s=0;t&&(s|=1),i&&(s|=2),n=this._measure(e,s),n>0&&this._holey.set(r,n)}return n}_measure(e,t){const i=this._measureElements[t];return i.textContent=e.repeat(32),i.offsetWidth/32}}},2223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const s=i(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=s.isFirefox||s.isLegacyEdge?"bottom":"ideographic"},6171:(e,t)=>{function i(e){return 57508<=e&&e<=57558}function s(e){return e>=128512&&e<=128591||e>=127744&&e<=128511||e>=128640&&e<=128767||e>=9728&&e<=9983||e>=9984&&e<=10175||e>=65024&&e<=65039||e>=129280&&e<=129535||e>=127462&&e<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(e){if(!e)throw new Error("value must not be falsy");return e},t.isPowerlineGlyph=i,t.isRestrictedPowerlineGlyph=function(e){return 57520<=e&&e<=57527},t.isEmoji=s,t.allowRescaling=function(e,t,r,n){return 1===t&&r>Math.ceil(1.5*n)&&void 0!==e&&e>255&&!s(e)&&!i(e)&&!function(e){return 57344<=e&&e<=63743}(e)},t.treatGlyphAsBackgroundColor=function(e){return i(e)||function(e){return 9472<=e&&e<=9631}(e)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(e,t,i=0){return(e-(2*Math.round(t)-i))%(2*Math.round(t))}},6052:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class i{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,i,s=!1){if(this.selectionStart=t,this.selectionEnd=i,!t||!i||t[0]===i[0]&&t[1]===i[1])return void this.clear();const r=e.buffers.active.ydisp,n=t[1]-r,o=i[1]-r,a=Math.max(n,0),h=Math.min(o,e.rows-1);a>=e.rows||h<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=s,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=i[0])}isCellSelected(e,t,i){return!!this.hasSelection&&(i-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&i>=this.viewportCappedStartRow&&t<this.endCol&&i<=this.viewportCappedEndRow:t<this.startCol&&i>=this.viewportCappedStartRow&&t>=this.endCol&&i<=this.viewportCappedEndRow:i>this.viewportStartRow&&i<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&i===this.viewportStartRow&&t>=this.startCol)}}t.createSelectionRenderModel=function(){return new i}},456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const e=this.selectionStart,t=this.selectionEnd;return!(!e||!t)&&(e[1]>t[1]||e[1]===t[1]&&e[0]>t[0])}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const n=i(2585),o=i(8460),a=i(844);let h=t.CharSizeService=class extends a.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,t,i){super(),this._optionsService=i,this.width=0,this.height=0,this._onCharSizeChange=this.register(new o.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new d(this._optionsService))}catch{this._measureStrategy=this.register(new l(e,t,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};t.CharSizeService=h=s([r(2,n.IOptionsService)],h);class c extends a.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){void 0!==e&&e>0&&void 0!==t&&t>0&&(this._result.width=e,this._result.height=t)}}class l extends c{constructor(e,t,i){super(),this._document=e,this._parentElement=t,this._optionsService=i,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class d extends c{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}}},4269:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const n=i(3734),o=i(643),a=i(511),h=i(2585);class c extends n.AttributeData{constructor(e,t,i){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=i}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=c;let l=t.CharacterJoinerService=class e{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new a.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(0===this._characterJoiners.length)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||0===t.length)return[];const i=[],s=t.translateToString(!0);let r=0,n=0,a=0,h=t.getFg(0),c=t.getBg(0);for(let e=0;e<t.getTrimmedLength();e++)if(t.loadCell(e,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==h||this._workCell.bg!==c){if(e-r>1){const e=this._getJoinedRanges(s,a,n,t,r);for(let t=0;t<e.length;t++)i.push(e[t])}r=e,a=n,h=this._workCell.fg,c=this._workCell.bg}n+=this._workCell.getChars().length||o.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-r>1){const e=this._getJoinedRanges(s,a,n,t,r);for(let t=0;t<e.length;t++)i.push(e[t])}return i}_getJoinedRanges(t,i,s,r,n){const o=t.substring(i,s);let a=[];try{a=this._characterJoiners[0].handler(o)}catch(e){console.error(e)}for(let t=1;t<this._characterJoiners.length;t++)try{const i=this._characterJoiners[t].handler(o);for(let t=0;t<i.length;t++)e._mergeRanges(a,i[t])}catch(e){console.error(e)}return this._stringRangesToCellRanges(a,r,n),a}_stringRangesToCellRanges(e,t,i){let s=0,r=!1,n=0,a=e[s];if(a){for(let h=i;h<this._bufferService.cols;h++){const i=t.getWidth(h),c=t.getString(h).length||o.WHITESPACE_CELL_CHAR.length;if(0!==i){if(!r&&a[0]<=n&&(a[0]=h,r=!0),a[1]<=n){if(a[1]=h,a=e[++s],!a)break;a[0]<=n?(a[0]=h,r=!0):r=!1}n+=c}}a&&(a[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let i=!1;for(let s=0;s<e.length;s++){const r=e[s];if(i){if(t[1]<=r[0])return e[s-1][1]=t[1],e;if(t[1]<=r[1])return e[s-1][1]=Math.max(t[1],r[1]),e.splice(s,1),e;e.splice(s,1),s--}else{if(t[1]<=r[0])return e.splice(s,0,t),e;if(t[1]<=r[1])return r[0]=Math.min(t[0],r[0]),e;t[0]<r[1]&&(r[0]=Math.min(t[0],r[0]),i=!0)}}return i?e[e.length-1][1]=t[1]:e.push(t),e}};t.CharacterJoinerService=l=s([r(0,h.IBufferService)],l)},5114:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0;const s=i(844),r=i(8460),n=i(3656);class o extends s.Disposable{constructor(e,t,i){super(),this._textarea=e,this._window=t,this.mainDocument=i,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new a(this._window),this._onDprChange=this.register(new r.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new r.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((e=>this._screenDprMonitor.setWindow(e)))),this.register((0,r.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}t.CoreBrowserService=o;class a extends s.Disposable{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this.register(new s.MutableDisposable),this._onDprChange=this.register(new r.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,s.toDisposable)((()=>this.clearListener())))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,n.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkProviderService=void 0;const s=i(844);class r extends s.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,s.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{const t=this.linkProviders.indexOf(e);-1!==t&&this.linkProviders.splice(t,1)}}}}t.LinkProviderService=r},8934:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const n=i(4725),o=i(9806);let a=t.MouseService=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,i,s,r){return(0,o.getCoords)(window,e,t,i,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,r)}getMouseReportCoords(e,t){const i=(0,o.getCoordsRelativeToElement)(window,e,t);if(this._charSizeService.hasValidSize)return i[0]=Math.min(Math.max(i[0],0),this._renderService.dimensions.css.canvas.width-1),i[1]=Math.min(Math.max(i[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(i[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(i[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(i[0]),y:Math.floor(i[1])}}};t.MouseService=a=s([r(0,n.IRenderService),r(1,n.ICharSizeService)],a)},3230:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const n=i(6193),o=i(4725),a=i(8460),h=i(844),c=i(7226),l=i(2585);let d=t.RenderService=class extends h.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,t,i,s,r,o,l,d){super(),this._rowCount=e,this._charSizeService=s,this._renderer=this.register(new h.MutableDisposable),this._pausedResizeTask=new c.DebouncedIdleTask,this._observerDisposable=this.register(new h.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new a.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new a.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new a.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new a.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new n.RenderDebouncer(((e,t)=>this._renderRows(e,t)),l),this.register(this._renderDebouncer),this.register(l.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(o.onResize((()=>this._fullRefresh()))),this.register(o.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register(i.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(r.onDecorationRegistered((()=>this._fullRefresh()))),this.register(r.onDecorationRemoved((()=>this._fullRefresh()))),this.register(i.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()}))),this.register(i.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(o.buffer.y,o.buffer.y,!0)))),this.register(d.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(l.window,t),this.register(l.onWindowChange((e=>this._registerIntersectionObserver(e,t))))}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){const i=new e.IntersectionObserver((e=>this._handleIntersectionChange(e[e.length-1])),{threshold:0});i.observe(t),this._observerDisposable.value=(0,h.toDisposable)((()=>i.disconnect()))}}_handleIntersectionChange(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,i=!1){this._isPaused?this._needsFullRefresh=!0:(i||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer.value&&(e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw((e=>this.refreshRows(e.start,e.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(e,t))):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,t,i){this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=i,this._renderer.value?.handleSelectionChanged(e,t,i)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};t.RenderService=d=s([r(2,l.IOptionsService),r(3,o.ICharSizeService),r(4,l.IDecorationService),r(5,l.IBufferService),r(6,o.ICoreBrowserService),r(7,o.IThemeService)],d)},9312:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const n=i(9806),o=i(9504),a=i(456),h=i(4725),c=i(8460),l=i(844),d=i(6114),_=i(4841),u=i(511),f=i(2585),v=String.fromCharCode(160),p=new RegExp(v,"g");let g=t.SelectionService=class extends l.Disposable{constructor(e,t,i,s,r,n,o,h,d){super(),this._element=e,this._screenElement=t,this._linkifier=i,this._bufferService=s,this._coreService=r,this._mouseService=n,this._optionsService=o,this._renderService=h,this._coreBrowserService=d,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new u.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new c.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new c.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new c.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new c.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=e=>this._handleMouseMove(e),this._mouseUpListener=e=>this._handleMouseUp(e),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((e=>this._handleTrim(e))),this.register(this._bufferService.buffers.onBufferActivate((e=>this._handleBufferActivate(e)))),this.enable(),this._model=new a.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,l.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!(!e||!t||e[0]===t[0]&&e[1]===t[1])}get selectionText(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";const i=this._bufferService.buffer,s=[];if(3===this._activeSelectionMode){if(e[0]===t[0])return"";const r=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){const e=i.translateBufferLineToString(o,!0,r,n);s.push(e)}}else{const r=e[1]===t[1]?t[0]:void 0;s.push(i.translateBufferLineToString(e[1],!0,e[0],r));for(let r=e[1]+1;r<=t[1]-1;r++){const e=i.lines.get(r),t=i.translateBufferLineToString(r,!0);e?.isWrapped?s[s.length-1]+=t:s.push(t)}if(e[1]!==t[1]){const e=i.lines.get(t[1]),r=i.translateBufferLineToString(t[1],!0,0,t[0]);e&&e.isWrapped?s[s.length-1]+=r:s.push(r)}}return s.map((e=>e.replace(p," "))).join(d.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),d.isLinux&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(e){const t=this._getMouseBufferCoords(e),i=this._model.finalSelectionStart,s=this._model.finalSelectionEnd;return!!(i&&s&&t)&&this._areCoordsInSelection(t,i,s)}isCellInSelection(e,t){const i=this._model.finalSelectionStart,s=this._model.finalSelectionEnd;return!(!i||!s)&&this._areCoordsInSelection([e,t],i,s)}_areCoordsInSelection(e,t,i){return e[1]>t[1]&&e[1]<i[1]||t[1]===i[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<i[0]||t[1]<i[1]&&e[1]===i[1]&&e[0]<i[0]||t[1]<i[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){const i=this._linkifier.currentLink?.link?.range;if(i)return this._model.selectionStart=[i.start.x-1,i.start.y-1],this._model.selectionStartLength=(0,_.getRangeLength)(i,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const s=this._getMouseBufferCoords(e);return!!s&&(this._selectWordAt(s,t),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){const t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,e,this._screenElement)[1];const i=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=i?0:(t>i&&(t-=i),t=Math.min(Math.max(t,-50),50),t/=50,t/Math.abs(t)+Math.round(14*t))}shouldForceSelection(e){return d.isMac?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,(2!==e.button||!this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&0===t.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){const t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(d.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;const t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const i=this._bufferService.buffer;if(this._model.selectionEnd[1]<i.lines.length){const e=i.lines.get(this._model.selectionEnd[1]);e&&0===e.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}t&&t[0]===this._model.selectionEnd[0]&&t[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){const t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const t=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(t&&void 0!==t[0]&&void 0!==t[1]){const e=(0,o.moveToCellSequence)(t[0]-1,t[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(e,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,i=!(!e||!t||e[0]===t[0]&&e[1]===t[1]);i?e&&t&&(this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&t[0]===this._oldSelectionEnd[0]&&t[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,t,i)):this._oldHasSelection&&this._fireOnSelectionChange(e,t,i)}_fireOnSelectionChange(e,t,i){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=i,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim((e=>this._handleTrim(e)))}_convertViewportColToCharacterIndex(e,t){let i=t;for(let s=0;t>=s;s++){const r=e.loadCell(s,this._workCell).getChars().length;0===this._workCell.getWidth()?i--:r>1&&t!==s&&(i+=r-1)}return i}setSelection(e,t,i){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=i,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,i=!0,s=!0){if(e[0]>=this._bufferService.cols)return;const r=this._bufferService.buffer,n=r.lines.get(e[1]);if(!n)return;const o=r.translateBufferLineToString(e[1],!1);let a=this._convertViewportColToCharacterIndex(n,e[0]),h=a;const c=e[0]-a;let l=0,d=0,_=0,u=0;if(" "===o.charAt(a)){for(;a>0&&" "===o.charAt(a-1);)a--;for(;h<o.length&&" "===o.charAt(h+1);)h++}else{let t=e[0],i=e[0];0===n.getWidth(t)&&(l++,t--),2===n.getWidth(i)&&(d++,i++);const s=n.getString(i).length;for(s>1&&(u+=s-1,h+=s-1);t>0&&a>0&&!this._isCharWordSeparator(n.loadCell(t-1,this._workCell));){n.loadCell(t-1,this._workCell);const e=this._workCell.getChars().length;0===this._workCell.getWidth()?(l++,t--):e>1&&(_+=e-1,a-=e-1),a--,t--}for(;i<n.length&&h+1<o.length&&!this._isCharWordSeparator(n.loadCell(i+1,this._workCell));){n.loadCell(i+1,this._workCell);const e=this._workCell.getChars().length;2===this._workCell.getWidth()?(d++,i++):e>1&&(u+=e-1,h+=e-1),h++,i++}}h++;let f=a+c-l+_,v=Math.min(this._bufferService.cols,h-a+l+d-_-u);if(t||""!==o.slice(a,h).trim()){if(i&&0===f&&32!==n.getCodePoint(0)){const t=r.lines.get(e[1]-1);if(t&&n.isWrapped&&32!==t.getCodePoint(this._bufferService.cols-1)){const t=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(t){const e=this._bufferService.cols-t.start;f-=e,v+=e}}}if(s&&f+v===this._bufferService.cols&&32!==n.getCodePoint(this._bufferService.cols-1)){const t=r.lines.get(e[1]+1);if(t?.isWrapped&&32!==t.getCodePoint(0)){const t=this._getWordAt([0,e[1]+1],!1,!1,!0);t&&(v+=t.length)}}return{start:f,length:v}}}_selectWordAt(e,t){const i=this._getWordAt(e,t);if(i){for(;i.start<0;)i.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[i.start,e[1]],this._model.selectionStartLength=i.length}}_selectToWordAt(e){const t=this._getWordAt(e,!0);if(t){let i=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,i--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,i++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,i]}}_isCharWordSeparator(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){const t=this._bufferService.buffer.getWrappedRangeForLine(e),i={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,_.getRangeLength)(i,this._bufferService.cols)}};t.SelectionService=g=s([r(3,f.IBufferService),r(4,f.ICoreService),r(5,h.IMouseService),r(6,f.IOptionsService),r(7,h.IRenderService),r(8,h.ICoreBrowserService)],g)},4725:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ILinkProviderService=t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const s=i(8343);t.ICharSizeService=(0,s.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,s.createDecorator)("CoreBrowserService"),t.IMouseService=(0,s.createDecorator)("MouseService"),t.IRenderService=(0,s.createDecorator)("RenderService"),t.ISelectionService=(0,s.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,s.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,s.createDecorator)("ThemeService"),t.ILinkProviderService=(0,s.createDecorator)("LinkProviderService")},6731:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const n=i(7239),o=i(8055),a=i(8460),h=i(844),c=i(2585),l=o.css.toColor("#ffffff"),d=o.css.toColor("#000000"),_=o.css.toColor("#ffffff"),u=o.css.toColor("#000000"),f={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const e=[o.css.toColor("#2e3436"),o.css.toColor("#cc0000"),o.css.toColor("#4e9a06"),o.css.toColor("#c4a000"),o.css.toColor("#3465a4"),o.css.toColor("#75507b"),o.css.toColor("#06989a"),o.css.toColor("#d3d7cf"),o.css.toColor("#555753"),o.css.toColor("#ef2929"),o.css.toColor("#8ae234"),o.css.toColor("#fce94f"),o.css.toColor("#729fcf"),o.css.toColor("#ad7fa8"),o.css.toColor("#34e2e2"),o.css.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let i=0;i<216;i++){const s=t[i/36%6|0],r=t[i/6%6|0],n=t[i%6];e.push({css:o.channels.toCss(s,r,n),rgba:o.channels.toRgba(s,r,n)})}for(let t=0;t<24;t++){const i=8+10*t;e.push({css:o.channels.toCss(i,i,i),rgba:o.channels.toRgba(i,i,i)})}return e})());let v=t.ThemeService=class extends h.Disposable{get colors(){return this._colors}constructor(e){super(),this._optionsService=e,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new a.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:l,background:d,cursor:_,cursorAccent:u,selectionForeground:void 0,selectionBackgroundTransparent:f,selectionBackgroundOpaque:o.color.blend(d,f),selectionInactiveBackgroundTransparent:f,selectionInactiveBackgroundOpaque:o.color.blend(d,f),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(e={}){const i=this._colors;if(i.foreground=p(e.foreground,l),i.background=p(e.background,d),i.cursor=p(e.cursor,_),i.cursorAccent=p(e.cursorAccent,u),i.selectionBackgroundTransparent=p(e.selectionBackground,f),i.selectionBackgroundOpaque=o.color.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=p(e.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=o.color.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=e.selectionForeground?p(e.selectionForeground,o.NULL_COLOR):void 0,i.selectionForeground===o.NULL_COLOR&&(i.selectionForeground=void 0),o.color.isOpaque(i.selectionBackgroundTransparent)){const e=.3;i.selectionBackgroundTransparent=o.color.opacity(i.selectionBackgroundTransparent,e)}if(o.color.isOpaque(i.selectionInactiveBackgroundTransparent)){const e=.3;i.selectionInactiveBackgroundTransparent=o.color.opacity(i.selectionInactiveBackgroundTransparent,e)}if(i.ansi=t.DEFAULT_ANSI_COLORS.slice(),i.ansi[0]=p(e.black,t.DEFAULT_ANSI_COLORS[0]),i.ansi[1]=p(e.red,t.DEFAULT_ANSI_COLORS[1]),i.ansi[2]=p(e.green,t.DEFAULT_ANSI_COLORS[2]),i.ansi[3]=p(e.yellow,t.DEFAULT_ANSI_COLORS[3]),i.ansi[4]=p(e.blue,t.DEFAULT_ANSI_COLORS[4]),i.ansi[5]=p(e.magenta,t.DEFAULT_ANSI_COLORS[5]),i.ansi[6]=p(e.cyan,t.DEFAULT_ANSI_COLORS[6]),i.ansi[7]=p(e.white,t.DEFAULT_ANSI_COLORS[7]),i.ansi[8]=p(e.brightBlack,t.DEFAULT_ANSI_COLORS[8]),i.ansi[9]=p(e.brightRed,t.DEFAULT_ANSI_COLORS[9]),i.ansi[10]=p(e.brightGreen,t.DEFAULT_ANSI_COLORS[10]),i.ansi[11]=p(e.brightYellow,t.DEFAULT_ANSI_COLORS[11]),i.ansi[12]=p(e.brightBlue,t.DEFAULT_ANSI_COLORS[12]),i.ansi[13]=p(e.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),i.ansi[14]=p(e.brightCyan,t.DEFAULT_ANSI_COLORS[14]),i.ansi[15]=p(e.brightWhite,t.DEFAULT_ANSI_COLORS[15]),e.extendedAnsi){const s=Math.min(i.ansi.length-16,e.extendedAnsi.length);for(let r=0;r<s;r++)i.ansi[r+16]=p(e.extendedAnsi[r],t.DEFAULT_ANSI_COLORS[r+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(void 0!==e)switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}else for(let e=0;e<this._restoreColors.ansi.length;++e)this._colors.ansi[e]=this._restoreColors.ansi[e]}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(e,t){if(void 0!==e)try{return o.css.toColor(e)}catch{}return t}t.ThemeService=v=s([r(0,c.IOptionsService)],v)},6349:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const s=i(8460),r=i(844);class n extends r.Disposable{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this.register(new s.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new s.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new s.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;const t=new Array(e);for(let i=0;i<Math.min(e,this.length);i++)t[i]=this._array[this._getCyclicIndex(i)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...i){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let t=this._length-1;t>=e;t--)this._array[this._getCyclicIndex(t+i.length)]=this._array[this._getCyclicIndex(t)];for(let t=0;t<i.length;t++)this._array[this._getCyclicIndex(e+t)]=i[t];if(i.length&&this.onInsertEmitter.fire({index:e,amount:i.length}),this._length+i.length>this._maxLength){const e=this._length+i.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=i.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,i){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+i<0)throw new Error("Cannot shift elements in list beyond index 0");if(i>0){for(let s=t-1;s>=0;s--)this.set(e+s+i,this.get(e+s));const s=e+t+i-this._length;if(s>0)for(this._length+=s;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let s=0;s<t;s++)this.set(e+s+i,this.get(e+s))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}}t.CircularList=n},1439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function e(t,i=5){if("object"!=typeof t)return t;const s=Array.isArray(t)?[]:{};for(const r in t)s[r]=i<=1?t[r]:t[r]&&e(t[r],i-1);return s}},8055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let i=0,s=0,r=0,n=0;var o,a,h,c,l;function d(e){const t=e.toString(16);return t.length<2?"0"+t:t}function _(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(e){e.toCss=function(e,t,i,s){return void 0!==s?`#${d(e)}${d(t)}${d(i)}${d(s)}`:`#${d(e)}${d(t)}${d(i)}`},e.toRgba=function(e,t,i,s=255){return(e<<24|t<<16|i<<8|s)>>>0},e.toColor=function(t,i,s,r){return{css:e.toCss(t,i,s,r),rgba:e.toRgba(t,i,s,r)}}}(o||(t.channels=o={})),function(e){function t(e,t){return n=Math.round(255*t),[i,s,r]=l.toChannels(e.rgba),{css:o.toCss(i,s,r,n),rgba:o.toRgba(i,s,r,n)}}e.blend=function(e,t){if(n=(255&t.rgba)/255,1===n)return{css:t.css,rgba:t.rgba};const a=t.rgba>>24&255,h=t.rgba>>16&255,c=t.rgba>>8&255,l=e.rgba>>24&255,d=e.rgba>>16&255,_=e.rgba>>8&255;return i=l+Math.round((a-l)*n),s=d+Math.round((h-d)*n),r=_+Math.round((c-_)*n),{css:o.toCss(i,s,r),rgba:o.toRgba(i,s,r)}},e.isOpaque=function(e){return 255==(255&e.rgba)},e.ensureContrastRatio=function(e,t,i){const s=l.ensureContrastRatio(e.rgba,t.rgba,i);if(s)return o.toColor(s>>24&255,s>>16&255,s>>8&255)},e.opaque=function(e){const t=(255|e.rgba)>>>0;return[i,s,r]=l.toChannels(t),{css:o.toCss(i,s,r),rgba:t}},e.opacity=t,e.multiplyOpacity=function(e,i){return n=255&e.rgba,t(e,n*i/255)},e.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]}}(a||(t.color=a={})),function(e){let t,a;try{const e=document.createElement("canvas");e.width=1,e.height=1;const i=e.getContext("2d",{willReadFrequently:!0});i&&(t=i,t.globalCompositeOperation="copy",a=t.createLinearGradient(0,0,1,1))}catch{}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return i=parseInt(e.slice(1,2).repeat(2),16),s=parseInt(e.slice(2,3).repeat(2),16),r=parseInt(e.slice(3,4).repeat(2),16),o.toColor(i,s,r);case 5:return i=parseInt(e.slice(1,2).repeat(2),16),s=parseInt(e.slice(2,3).repeat(2),16),r=parseInt(e.slice(3,4).repeat(2),16),n=parseInt(e.slice(4,5).repeat(2),16),o.toColor(i,s,r,n);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}const h=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(h)return i=parseInt(h[1]),s=parseInt(h[2]),r=parseInt(h[3]),n=Math.round(255*(void 0===h[5]?1:parseFloat(h[5]))),o.toColor(i,s,r,n);if(!t||!a)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=a,t.fillStyle=e,"string"!=typeof t.fillStyle)throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[i,s,r,n]=t.getImageData(0,0,1,1).data,255!==n)throw new Error("css.toColor: Unsupported css format");return{rgba:o.toRgba(i,s,r,n),css:e}}}(h||(t.css=h={})),function(e){function t(e,t,i){const s=e/255,r=t/255,n=i/255;return.2126*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.7152*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))}e.relativeLuminance=function(e){return t(e>>16&255,e>>8&255,255&e)},e.relativeLuminance2=t}(c||(t.rgb=c={})),function(e){function t(e,t,i){const s=e>>24&255,r=e>>16&255,n=e>>8&255;let o=t>>24&255,a=t>>16&255,h=t>>8&255,l=_(c.relativeLuminance2(o,a,h),c.relativeLuminance2(s,r,n));for(;l<i&&(o>0||a>0||h>0);)o-=Math.max(0,Math.ceil(.1*o)),a-=Math.max(0,Math.ceil(.1*a)),h-=Math.max(0,Math.ceil(.1*h)),l=_(c.relativeLuminance2(o,a,h),c.relativeLuminance2(s,r,n));return(o<<24|a<<16|h<<8|255)>>>0}function a(e,t,i){const s=e>>24&255,r=e>>16&255,n=e>>8&255;let o=t>>24&255,a=t>>16&255,h=t>>8&255,l=_(c.relativeLuminance2(o,a,h),c.relativeLuminance2(s,r,n));for(;l<i&&(o<255||a<255||h<255);)o=Math.min(255,o+Math.ceil(.1*(255-o))),a=Math.min(255,a+Math.ceil(.1*(255-a))),h=Math.min(255,h+Math.ceil(.1*(255-h))),l=_(c.relativeLuminance2(o,a,h),c.relativeLuminance2(s,r,n));return(o<<24|a<<16|h<<8|255)>>>0}e.blend=function(e,t){if(n=(255&t)/255,1===n)return t;const a=t>>24&255,h=t>>16&255,c=t>>8&255,l=e>>24&255,d=e>>16&255,_=e>>8&255;return i=l+Math.round((a-l)*n),s=d+Math.round((h-d)*n),r=_+Math.round((c-_)*n),o.toRgba(i,s,r)},e.ensureContrastRatio=function(e,i,s){const r=c.relativeLuminance(e>>8),n=c.relativeLuminance(i>>8);if(_(r,n)<s){if(n<r){const n=t(e,i,s),o=_(r,c.relativeLuminance(n>>8));if(o<s){const t=a(e,i,s);return o>_(r,c.relativeLuminance(t>>8))?n:t}return n}const o=a(e,i,s),h=_(r,c.relativeLuminance(o>>8));if(h<s){const n=t(e,i,s);return h>_(r,c.relativeLuminance(n>>8))?o:n}return o}},e.reduceLuminance=t,e.increaseLuminance=a,e.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}}(l||(t.rgba=l={})),t.toPaddedHex=d,t.contrastRatio=_},8969:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const s=i(844),r=i(2585),n=i(4348),o=i(7866),a=i(744),h=i(7302),c=i(6975),l=i(8460),d=i(1753),_=i(1480),u=i(7994),f=i(9282),v=i(5435),p=i(5981),g=i(2660);let m=!1;class S extends s.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new l.EventEmitter),this._onScroll.event((e=>{this._onScrollApi?.fire(e.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(const t in e)this.optionsService.options[t]=e[t]}constructor(e){super(),this._windowsWrappingHeuristics=this.register(new s.MutableDisposable),this._onBinary=this.register(new l.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new l.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new l.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new l.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new l.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new l.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new h.OptionsService(e)),this._instantiationService.setService(r.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(a.BufferService)),this._instantiationService.setService(r.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(o.LogService)),this._instantiationService.setService(r.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(c.CoreService)),this._instantiationService.setService(r.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(d.CoreMouseService)),this._instantiationService.setService(r.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(_.UnicodeService)),this._instantiationService.setService(r.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(u.CharsetService),this._instantiationService.setService(r.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(g.OscLinkService),this._instantiationService.setService(r.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new v.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,l.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,l.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,l.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,l.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((e=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new p.WriteBuffer(((e,t)=>this._inputHandler.parse(e,t)))),this.register((0,l.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=r.LogLevelEnum.WARN&&!m&&(this._logService.warn("writeSync is unreliable and will be removed soon."),m=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,a.MINIMUM_COLS),t=Math.max(t,a.MINIMUM_ROWS),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t,i){this._bufferService.scrollLines(e,t,i)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){const t=e-this._bufferService.buffer.ydisp;0!==t&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1;const t=this.optionsService.rawOptions.windowsPty;t&&void 0!==t.buildNumber&&void 0!==t.buildNumber?e=!!("conpty"===t.backend&&t.buildNumber<21376):this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const e=[];e.push(this.onLineFeed(f.updateWindowsModeWrappedState.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},(()=>((0,f.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,s.toDisposable)((()=>{for(const t of e)t.dispose()}))}}}t.CoreTerminal=S},8460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const i=[];for(let e=0;e<this._listeners.length;e++)i.push(this._listeners[e]);for(let s=0;s<i.length;s++)i[s].call(void 0,e,t)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(e,t){return e((e=>t.fire(e)))},t.runAndSubscribe=function(e,t){return t(void 0),e((e=>t(e)))}},5435:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const n=i(2584),o=i(7116),a=i(2015),h=i(844),c=i(482),l=i(8437),d=i(8460),_=i(643),u=i(511),f=i(3734),v=i(2585),p=i(1480),g=i(6242),m=i(6351),S=i(5941),C={"(":0,")":1,"*":2,"+":3,"-":1,".":2},b=131072;function w(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var y;!function(e){e[e.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",e[e.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(y||(t.WindowsOptionsReportType=y={}));let E=0;class k extends h.Disposable{getAttrData(){return this._curAttrData}constructor(e,t,i,s,r,h,_,f,v=new a.EscapeSequenceParser){super(),this._bufferService=e,this._charsetService=t,this._coreService=i,this._logService=s,this._optionsService=r,this._oscLinkService=h,this._coreMouseService=_,this._unicodeService=f,this._parser=v,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new c.StringToUtf32,this._utf8Decoder=new c.Utf8ToUtf32,this._workCell=new u.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=l.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=l.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new d.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new d.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new d.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new d.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new d.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new d.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new d.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new d.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new d.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new d.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new d.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new d.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new d.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new L(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((e=>this._activeBuffer=e.activeBuffer))),this._parser.setCsiHandlerFallback(((e,t)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(e),params:t.toArray()})})),this._parser.setEscHandlerFallback((e=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(e)})})),this._parser.setExecuteHandlerFallback((e=>{this._logService.debug("Unknown EXECUTE code: ",{code:e})})),this._parser.setOscHandlerFallback(((e,t,i)=>{this._logService.debug("Unknown OSC code: ",{identifier:e,action:t,data:i})})),this._parser.setDcsHandlerFallback(((e,t,i)=>{"HOOK"===t&&(i=i.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(e),action:t,payload:i})})),this._parser.setPrintHandler(((e,t,i)=>this.print(e,t,i))),this._parser.registerCsiHandler({final:"@"},(e=>this.insertChars(e))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(e=>this.scrollLeft(e))),this._parser.registerCsiHandler({final:"A"},(e=>this.cursorUp(e))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(e=>this.scrollRight(e))),this._parser.registerCsiHandler({final:"B"},(e=>this.cursorDown(e))),this._parser.registerCsiHandler({final:"C"},(e=>this.cursorForward(e))),this._parser.registerCsiHandler({final:"D"},(e=>this.cursorBackward(e))),this._parser.registerCsiHandler({final:"E"},(e=>this.cursorNextLine(e))),this._parser.registerCsiHandler({final:"F"},(e=>this.cursorPrecedingLine(e))),this._parser.registerCsiHandler({final:"G"},(e=>this.cursorCharAbsolute(e))),this._parser.registerCsiHandler({final:"H"},(e=>this.cursorPosition(e))),this._parser.registerCsiHandler({final:"I"},(e=>this.cursorForwardTab(e))),this._parser.registerCsiHandler({final:"J"},(e=>this.eraseInDisplay(e,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(e=>this.eraseInDisplay(e,!0))),this._parser.registerCsiHandler({final:"K"},(e=>this.eraseInLine(e,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(e=>this.eraseInLine(e,!0))),this._parser.registerCsiHandler({final:"L"},(e=>this.insertLines(e))),this._parser.registerCsiHandler({final:"M"},(e=>this.deleteLines(e))),this._parser.registerCsiHandler({final:"P"},(e=>this.deleteChars(e))),this._parser.registerCsiHandler({final:"S"},(e=>this.scrollUp(e))),this._parser.registerCsiHandler({final:"T"},(e=>this.scrollDown(e))),this._parser.registerCsiHandler({final:"X"},(e=>this.eraseChars(e))),this._parser.registerCsiHandler({final:"Z"},(e=>this.cursorBackwardTab(e))),this._parser.registerCsiHandler({final:"`"},(e=>this.charPosAbsolute(e))),this._parser.registerCsiHandler({final:"a"},(e=>this.hPositionRelative(e))),this._parser.registerCsiHandler({final:"b"},(e=>this.repeatPrecedingCharacter(e))),this._parser.registerCsiHandler({final:"c"},(e=>this.sendDeviceAttributesPrimary(e))),this._parser.registerCsiHandler({prefix:">",final:"c"},(e=>this.sendDeviceAttributesSecondary(e))),this._parser.registerCsiHandler({final:"d"},(e=>this.linePosAbsolute(e))),this._parser.registerCsiHandler({final:"e"},(e=>this.vPositionRelative(e))),this._parser.registerCsiHandler({final:"f"},(e=>this.hVPosition(e))),this._parser.registerCsiHandler({final:"g"},(e=>this.tabClear(e))),this._parser.registerCsiHandler({final:"h"},(e=>this.setMode(e))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(e=>this.setModePrivate(e))),this._parser.registerCsiHandler({final:"l"},(e=>this.resetMode(e))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(e=>this.resetModePrivate(e))),this._parser.registerCsiHandler({final:"m"},(e=>this.charAttributes(e))),this._parser.registerCsiHandler({final:"n"},(e=>this.deviceStatus(e))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(e=>this.deviceStatusPrivate(e))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(e=>this.softReset(e))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(e=>this.setCursorStyle(e))),this._parser.registerCsiHandler({final:"r"},(e=>this.setScrollRegion(e))),this._parser.registerCsiHandler({final:"s"},(e=>this.saveCursor(e))),this._parser.registerCsiHandler({final:"t"},(e=>this.windowOptions(e))),this._parser.registerCsiHandler({final:"u"},(e=>this.restoreCursor(e))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(e=>this.insertColumns(e))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(e=>this.deleteColumns(e))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(e=>this.selectProtected(e))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(e=>this.requestMode(e,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(e=>this.requestMode(e,!1))),this._parser.setExecuteHandler(n.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(n.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(n.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(n.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(n.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(n.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(n.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(n.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(n.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new g.OscHandler((e=>(this.setTitle(e),this.setIconName(e),!0)))),this._parser.registerOscHandler(1,new g.OscHandler((e=>this.setIconName(e)))),this._parser.registerOscHandler(2,new g.OscHandler((e=>this.setTitle(e)))),this._parser.registerOscHandler(4,new g.OscHandler((e=>this.setOrReportIndexedColor(e)))),this._parser.registerOscHandler(8,new g.OscHandler((e=>this.setHyperlink(e)))),this._parser.registerOscHandler(10,new g.OscHandler((e=>this.setOrReportFgColor(e)))),this._parser.registerOscHandler(11,new g.OscHandler((e=>this.setOrReportBgColor(e)))),this._parser.registerOscHandler(12,new g.OscHandler((e=>this.setOrReportCursorColor(e)))),this._parser.registerOscHandler(104,new g.OscHandler((e=>this.restoreIndexedColor(e)))),this._parser.registerOscHandler(110,new g.OscHandler((e=>this.restoreFgColor(e)))),this._parser.registerOscHandler(111,new g.OscHandler((e=>this.restoreBgColor(e)))),this._parser.registerOscHandler(112,new g.OscHandler((e=>this.restoreCursorColor(e)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const e in o.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:e},(()=>this.selectCharset("("+e))),this._parser.registerEscHandler({intermediates:")",final:e},(()=>this.selectCharset(")"+e))),this._parser.registerEscHandler({intermediates:"*",final:e},(()=>this.selectCharset("*"+e))),this._parser.registerEscHandler({intermediates:"+",final:e},(()=>this.selectCharset("+"+e))),this._parser.registerEscHandler({intermediates:"-",final:e},(()=>this.selectCharset("-"+e))),this._parser.registerEscHandler({intermediates:".",final:e},(()=>this.selectCharset("."+e))),this._parser.registerEscHandler({intermediates:"/",final:e},(()=>this.selectCharset("/"+e)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((e=>(this._logService.error("Parsing error: ",e),e))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new m.DcsHandler(((e,t)=>this.requestStatusString(e,t))))}_preserveStack(e,t,i,s){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=i,this._parseStack.position=s}_logSlowResolvingAsync(e){this._logService.logLevel<=v.LogLevelEnum.WARN&&Promise.race([e,new Promise(((e,t)=>setTimeout((()=>t("#SLOW_TIMEOUT")),5e3)))]).catch((e=>{if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let i,s=this._activeBuffer.x,r=this._activeBuffer.y,n=0;const o=this._parseStack.paused;if(o){if(i=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(i),i;s=this._parseStack.cursorStartX,r=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>b&&(n=this._parseStack.position+b)}if(this._logService.logLevel<=v.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof e?` "${e}"`:` "${Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("")}"`),"string"==typeof e?e.split("").map((e=>e.charCodeAt(0))):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<b&&(this._parseBuffer=new Uint32Array(Math.min(e.length,b))),o||this._dirtyRowTracker.clearRange(),e.length>b)for(let t=n;t<e.length;t+=b){const n=t+b<e.length?t+b:e.length,o="string"==typeof e?this._stringDecoder.decode(e.substring(t,n),this._parseBuffer):this._utf8Decoder.decode(e.subarray(t,n),this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,o))return this._preserveStack(s,r,o,t),this._logSlowResolvingAsync(i),i}else if(!o){const t="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(i=this._parser.parse(this._parseBuffer,t))return this._preserveStack(s,r,t,0),this._logSlowResolvingAsync(i),i}this._activeBuffer.x===s&&this._activeBuffer.y===r||this._onCursorMove.fire();const a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),h=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);h<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(h,this._bufferService.rows-1),Math.min(a,this._bufferService.rows-1))}print(e,t,i){let s,r;const n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,h=this._coreService.decPrivateModes.wraparound,d=this._coreService.modes.insertMode,u=this._curAttrData;let f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&i-t>0&&2===f.getWidth(this._activeBuffer.x-1)&&f.setCellFromCodepoint(this._activeBuffer.x-1,0,1,u);let v=this._parser.precedingJoinState;for(let g=t;g<i;++g){if(s=e[g],s<127&&n){const e=n[String.fromCharCode(s)];e&&(s=e.charCodeAt(0))}const t=this._unicodeService.charProperties(s,v);r=p.UnicodeService.extractWidth(t);const i=p.UnicodeService.extractShouldJoin(t),m=i?p.UnicodeService.extractWidth(v):0;if(v=t,o&&this._onA11yChar.fire((0,c.stringFromCodePoint)(s)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+r-m>a)if(h){const e=f;let t=this._activeBuffer.x-m;for(this._activeBuffer.x=m,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),m>0&&f instanceof l.BufferLine&&f.copyCellsFrom(e,t,0,m,!1);t<a;)e.setCellFromCodepoint(t++,0,1,u)}else if(this._activeBuffer.x=a-1,2===r)continue;if(i&&this._activeBuffer.x){const e=f.getWidth(this._activeBuffer.x-1)?1:2;f.addCodepointToCell(this._activeBuffer.x-e,s,r);for(let e=r-m;--e>=0;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,u)}else if(d&&(f.insertCells(this._activeBuffer.x,r-m,this._activeBuffer.getNullCell(u)),2===f.getWidth(a-1)&&f.setCellFromCodepoint(a-1,_.NULL_CELL_CODE,_.NULL_CELL_WIDTH,u)),f.setCellFromCodepoint(this._activeBuffer.x++,s,r,u),r>0)for(;--r;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,u)}this._parser.precedingJoinState=v,this._activeBuffer.x<a&&i-t>0&&0===f.getWidth(this._activeBuffer.x)&&!f.hasContent(this._activeBuffer.x)&&f.setCellFromCodepoint(this._activeBuffer.x,0,1,u),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,t):this._parser.registerCsiHandler(e,(e=>!w(e.params[0],this._optionsService.rawOptions.windowOptions)||t(e)))}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new m.DcsHandler(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new g.OscHandler(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){const t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){const t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){const t=e.params[0];return 0===t?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===t&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){const t=e.params[0];return 1===t&&(this._curAttrData.bg|=536870912),2!==t&&0!==t||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,i,s=!1,r=!1){const n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,i,this._activeBuffer.getNullCell(this._eraseAttrData()),r),s&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i&&(i.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),i.isWrapped=!1)}eraseInDisplay(e,t=!1){let i;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);i<this._bufferService.rows;i++)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(i);break;case 1:for(i=this._activeBuffer.y,this._dirtyRowTracker.markDirty(i),this._eraseInBufferLine(i,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(i+1).isWrapped=!1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 2:for(i=this._bufferService.rows,this._dirtyRowTracker.markDirty(i-1);i--;)this._resetBufferLine(i,t);this._dirtyRowTracker.markDirty(0);break;case 3:const e=this._activeBuffer.lines.length-this._bufferService.rows;e>0&&(this._activeBuffer.lines.trimStart(e),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-e,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-e,0),this._onScroll.fire(0))}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const i=this._activeBuffer.ybase+this._activeBuffer.y,s=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-s+1;for(;t--;)this._activeBuffer.lines.splice(r-1,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const i=this._activeBuffer.ybase+this._activeBuffer.y;let s;for(s=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-s;t--;)this._activeBuffer.lines.splice(i,1),this._activeBuffer.lines.splice(s,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(l.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const t=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){const i=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){const t=this._parser.precedingJoinState;if(!t)return!0;const i=e.params[0]||1,s=p.UnicodeService.extractWidth(t),r=this._activeBuffer.x-s,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(r),o=new Uint32Array(n.length*i);let a=0;for(let e=0;e<n.length;){const t=n.codePointAt(e)||0;o[a++]=t,e+=t>65535?2:1}let h=a;for(let e=1;e<i;++e)o.copyWithin(h,0,a),h+=a;return this.print(o,0,h),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,o.DEFAULT_CHARSET),this._charsetService.setgCharset(1,o.DEFAULT_CHARSET),this._charsetService.setgCharset(2,o.DEFAULT_CHARSET),this._charsetService.setgCharset(3,o.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[t]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(e,t){const i=this._coreService.decPrivateModes,{activeProtocol:s,activeEncoding:r}=this._coreMouseService,o=this._coreService,{buffers:a,cols:h}=this._bufferService,{active:c,alt:l}=a,d=this._optionsService.rawOptions,_=e=>e?1:2,u=e.params[0];return f=u,v=t?2===u?4:4===u?_(o.modes.insertMode):12===u?3:20===u?_(d.convertEol):0:1===u?_(i.applicationCursorKeys):3===u?d.windowOptions.setWinLines?80===h?2:132===h?1:0:0:6===u?_(i.origin):7===u?_(i.wraparound):8===u?3:9===u?_("X10"===s):12===u?_(d.cursorBlink):25===u?_(!o.isCursorHidden):45===u?_(i.reverseWraparound):66===u?_(i.applicationKeypad):67===u?4:1e3===u?_("VT200"===s):1002===u?_("DRAG"===s):1003===u?_("ANY"===s):1004===u?_(i.sendFocus):1005===u?4:1006===u?_("SGR"===r):1015===u?4:1016===u?_("SGR_PIXELS"===r):1048===u?1:47===u||1047===u||1049===u?_(c===l):2004===u?_(i.bracketedPasteMode):0,o.triggerDataEvent(`${n.C0.ESC}[${t?"":"?"}${f};${v}$y`),!0;var f,v}_updateAttrColor(e,t,i,s,r){return 2===t?(e|=50331648,e&=-16777216,e|=f.AttributeData.fromColorRGB([i,s,r])):5===t&&(e&=-50331904,e|=33554432|255&i),e}_extractColor(e,t,i){const s=[0,0,-1,0,0,0];let r=0,n=0;do{if(s[n+r]=e.params[t+n],e.hasSubParams(t+n)){const i=e.getSubParams(t+n);let o=0;do{5===s[1]&&(r=1),s[n+o+1+r]=i[o]}while(++o<i.length&&o+n+1+r<s.length);break}if(5===s[1]&&n+r>=2||2===s[1]&&n+r>=5)break;s[1]&&(r=1)}while(++n+t<e.length&&n+r<s.length);for(let e=2;e<s.length;++e)-1===s[e]&&(s[e]=0);switch(s[0]){case 38:i.fg=this._updateAttrColor(i.fg,s[1],s[3],s[4],s[5]);break;case 48:i.bg=this._updateAttrColor(i.bg,s[1],s[3],s[4],s[5]);break;case 58:i.extended=i.extended.clone(),i.extended.underlineColor=this._updateAttrColor(i.extended.underlineColor,s[1],s[3],s[4],s[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,0===e&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=l.DEFAULT_ATTR_DATA.fg,e.bg=l.DEFAULT_ATTR_DATA.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;const t=e.length;let i;const s=this._curAttrData;for(let r=0;r<t;r++)i=e.params[r],i>=30&&i<=37?(s.fg&=-50331904,s.fg|=16777216|i-30):i>=40&&i<=47?(s.bg&=-50331904,s.bg|=16777216|i-40):i>=90&&i<=97?(s.fg&=-50331904,s.fg|=16777224|i-90):i>=100&&i<=107?(s.bg&=-50331904,s.bg|=16777224|i-100):0===i?this._processSGR0(s):1===i?s.fg|=134217728:3===i?s.bg|=67108864:4===i?(s.fg|=268435456,this._processUnderline(e.hasSubParams(r)?e.getSubParams(r)[0]:1,s)):5===i?s.fg|=536870912:7===i?s.fg|=67108864:8===i?s.fg|=1073741824:9===i?s.fg|=2147483648:2===i?s.bg|=134217728:21===i?this._processUnderline(2,s):22===i?(s.fg&=-134217729,s.bg&=-134217729):23===i?s.bg&=-67108865:24===i?(s.fg&=-268435457,this._processUnderline(0,s)):25===i?s.fg&=-536870913:27===i?s.fg&=-67108865:28===i?s.fg&=-1073741825:29===i?s.fg&=2147483647:39===i?(s.fg&=-67108864,s.fg|=16777215&l.DEFAULT_ATTR_DATA.fg):49===i?(s.bg&=-67108864,s.bg|=16777215&l.DEFAULT_ATTR_DATA.bg):38===i||48===i||58===i?r+=this._extractColor(e,r,s):53===i?s.bg|=1073741824:55===i?s.bg&=-1073741825:59===i?(s.extended=s.extended.clone(),s.extended.underlineColor=-1,s.updateExtended()):100===i?(s.fg&=-67108864,s.fg|=16777215&l.DEFAULT_ATTR_DATA.fg,s.bg&=-67108864,s.bg|=16777215&l.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",i);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${e};${t}R`)}return!0}deviceStatusPrivate(e){if(6===e.params[0]){const e=this._activeBuffer.y+1,t=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${e};${t}R`)}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=l.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){const t=e.params[0]||1;switch(t){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const i=t%2==1;return this._optionsService.options.cursorBlink=i,!0}setScrollRegion(e){const t=e.params[0]||1;let i;return(e.length<2||(i=e.params[1])>this._bufferService.rows||0===i)&&(i=this._bufferService.rows),i>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=i-1,this._setCursor(0,0)),!0}windowOptions(e){if(!w(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;const t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==t&&this._onRequestWindowsOptionsReport.fire(y.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(y.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==t&&2!==t||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==t&&1!==t||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==t&&2!==t||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==t&&1!==t||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){const t=[],i=e.split(";");for(;i.length>1;){const e=i.shift(),s=i.shift();if(/^\d+$/.exec(e)){const i=parseInt(e);if(D(i))if("?"===s)t.push({type:0,index:i});else{const e=(0,S.parseColor)(s);e&&t.push({type:1,index:i,color:e})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){const t=e.split(";");return!(t.length<2)&&(t[1]?this._createHyperlink(t[0],t[1]):!t[0]&&this._finishHyperlink())}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();const i=e.split(":");let s;const r=i.findIndex((e=>e.startsWith("id=")));return-1!==r&&(s=i[r].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:s,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){const i=e.split(";");for(let e=0;e<i.length&&!(t>=this._specialColors.length);++e,++t)if("?"===i[e])this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{const s=(0,S.parseColor)(i[e]);s&&this._onColor.fire([{type:1,index:this._specialColors[t],color:s}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;const t=[],i=e.split(";");for(let e=0;e<i.length;++e)if(/^\d+$/.exec(i[e])){const s=parseInt(i[e]);D(s)&&t.push({type:2,index:s})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,o.DEFAULT_CHARSET),!0}selectCharset(e){return 2!==e.length?(this.selectDefaultCharset(),!0):("/"===e[0]||this._charsetService.setgCharset(C[e[0]],o.CHARSETS[e[1]]||o.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=l.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=l.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){const e=new u.CellData;e.content=1<<22|"E".charCodeAt(0),e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){const i=this._activeBuffer.ybase+this._activeBuffer.y+t,s=this._activeBuffer.lines.get(i);s&&(s.fill(e),s.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){const i=this._bufferService.buffer,s=this._optionsService.rawOptions;return(e=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${e}${n.C0.ESC}\\`),!0))('"q'===e?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===e?'P1$r61;1"p':"r"===e?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:"m"===e?"P1$r0m":" q"===e?`P1$r${{block:2,underline:4,bar:6}[s.cursorStyle]-(s.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}}t.InputHandler=k;let L=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(E=e,e=t,t=E),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function D(e){return 0<=e&&e<256}L=s([r(0,v.IBufferService)],L)},844:(e,t)=>{function i(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=i,t.getDisposeArrayDisposable=function(e){return{dispose:()=>i(e)}}},1505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class i{constructor(){this._data={}}set(e,t,i){this._data[e]||(this._data[e]={}),this._data[e][t]=i}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}}t.TwoKeyMap=i,t.FourKeyMap=class{constructor(){this._data=new i}set(e,t,s,r,n){this._data.get(e,t)||this._data.set(e,t,new i),this._data.get(e,t).set(s,r,n)}get(e,t,i,s){return this._data.get(e,t)?.get(i,s)}clear(){this._data.clear()}}},6114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode="undefined"!=typeof process&&"title"in process;const i=t.isNode?"node":navigator.userAgent,s=t.isNode?"node":navigator.platform;t.isFirefox=i.includes("Firefox"),t.isLegacyEdge=i.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(i),t.getSafariVersion=function(){if(!t.isSafari)return 0;const e=i.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(s),t.isIpad="iPad"===s,t.isIphone="iPhone"===s,t.isWindows=["Windows","Win16","Win32","WinCE"].includes(s),t.isLinux=s.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(i)},6106:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let i=0;t.SortedList=class{constructor(e){this._getKey=e,this._array=[]}clear(){this._array.length=0}insert(e){0!==this._array.length?(i=this._search(this._getKey(e)),this._array.splice(i,0,e)):this._array.push(e)}delete(e){if(0===this._array.length)return!1;const t=this._getKey(e);if(void 0===t)return!1;if(i=this._search(t),-1===i)return!1;if(this._getKey(this._array[i])!==t)return!1;do{if(this._array[i]===e)return this._array.splice(i,1),!0}while(++i<this._array.length&&this._getKey(this._array[i])===t);return!1}*getKeyIterator(e){if(0!==this._array.length&&(i=this._search(e),!(i<0||i>=this._array.length)&&this._getKey(this._array[i])===e))do{yield this._array[i]}while(++i<this._array.length&&this._getKey(this._array[i])===e)}forEachByKey(e,t){if(0!==this._array.length&&(i=this._search(e),!(i<0||i>=this._array.length)&&this._getKey(this._array[i])===e))do{t(this._array[i])}while(++i<this._array.length&&this._getKey(this._array[i])===e)}values(){return[...this._array].values()}_search(e){let t=0,i=this._array.length-1;for(;i>=t;){let s=t+i>>1;const r=this._getKey(this._array[s]);if(r>e)i=s-1;else{if(!(r<e)){for(;s>0&&this._getKey(this._array[s-1])===e;)s--;return s}t=s+1}}return t}}},7226:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const s=i(6114);class r{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,s=e.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),i=Math.max(t,i),r=e.timeRemaining(),1.5*i>r)return s-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(s-t))}ms`),void this._start();s=r}this.clear()}}class n extends r{_requestCallback(e){return setTimeout((()=>e(this._createDeadline(16))))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}t.PriorityTaskQueue=n,t.IdleTaskQueue=!s.isNode&&"requestIdleCallback"in window?class extends r{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}}:n,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}}},9282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const s=i(643);t.updateWindowsModeWrappedState=function(e){const t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1),i=t?.get(e.cols-1),r=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);r&&i&&(r.isWrapped=i[s.CHAR_DATA_CODE_INDEX]!==s.NULL_CELL_CODE&&i[s.CHAR_DATA_CODE_INDEX]!==s.WHITESPACE_CELL_CODE)}},3734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class i{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){const e=new i;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return 50331648==(50331648&this.fg)}isBgRGB(){return 50331648==(50331648&this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return 0==(50331648&this.fg)}isBgDefault(){return 0==(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=i;class s{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(e){this._ext&=-469762049,this._ext|=e<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(e){this._ext&=-67108864,this._ext|=67108863&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}get underlineVariantOffset(){const e=(3758096384&this._ext)>>29;return e<0?4294967288^e:e}set underlineVariantOffset(e){this._ext&=536870911,this._ext|=e<<29&3758096384}constructor(e=0,t=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=t}clone(){return new s(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}t.ExtendedAttrs=s},9092:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;const s=i(6349),r=i(7226),n=i(3734),o=i(8437),a=i(4634),h=i(511),c=i(643),l=i(4863),d=i(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(e,t,i){this._hasScrollback=e,this._optionsService=t,this._bufferService=i,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=o.DEFAULT_ATTR_DATA.clone(),this.savedCharset=d.DEFAULT_CHARSET,this.markers=[],this._nullCell=h.CellData.fromCharData([0,c.NULL_CELL_CHAR,c.NULL_CELL_WIDTH,c.NULL_CELL_CODE]),this._whitespaceCell=h.CellData.fromCharData([0,c.WHITESPACE_CELL_CHAR,c.WHITESPACE_CELL_WIDTH,c.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new r.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new s.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new o.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const i=e+this._optionsService.rawOptions.scrollback;return i>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:i}fillViewportRows(e){if(0===this.lines.length){void 0===e&&(e=o.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new s.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const i=this.getNullCell(o.DEFAULT_ATTR_DATA);let s=0;const r=this._getCorrectBufferLength(t);if(r>this.lines.maxLength&&(this.lines.maxLength=r),this.lines.length>0){if(this._cols<e)for(let t=0;t<this.lines.length;t++)s+=+this.lines.get(t).resize(e,i);let n=0;if(this._rows<t)for(let s=this._rows;s<t;s++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new o.BufferLine(e,i)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new o.BufferLine(e,i)));else for(let e=this._rows;e>t;e--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(r<this.lines.maxLength){const e=this.lines.length-r;e>0&&(this.lines.trimStart(e),this.ybase=Math.max(this.ybase-e,0),this.ydisp=Math.max(this.ydisp-e,0),this.savedY=Math.max(this.savedY-e,0)),this.lines.maxLength=r}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let t=0;t<this.lines.length;t++)s+=+this.lines.get(t).resize(e,i);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),s>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&"conpty"===e.backend&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const i=(0,a.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(o.DEFAULT_ATTR_DATA));if(i.length>0){const s=(0,a.reflowLargerCreateNewLayout)(this.lines,i);(0,a.reflowLargerApplyNewLayout)(this.lines,s.layout),this._reflowLargerAdjustViewport(e,t,s.countRemoved)}}_reflowLargerAdjustViewport(e,t,i){const s=this.getNullCell(o.DEFAULT_ATTR_DATA);let r=i;for(;r-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new o.BufferLine(e,s))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-i,0)}_reflowSmaller(e,t){const i=this.getNullCell(o.DEFAULT_ATTR_DATA),s=[];let r=0;for(let n=this.lines.length-1;n>=0;n--){let h=this.lines.get(n);if(!h||!h.isWrapped&&h.getTrimmedLength()<=e)continue;const c=[h];for(;h.isWrapped&&n>0;)h=this.lines.get(--n),c.unshift(h);const l=this.ybase+this.y;if(l>=n&&l<n+c.length)continue;const d=c[c.length-1].getTrimmedLength(),_=(0,a.reflowSmallerGetNewLineLengths)(c,this._cols,e),u=_.length-c.length;let f;f=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+u):Math.max(0,this.lines.length-this.lines.maxLength+u);const v=[];for(let e=0;e<u;e++){const e=this.getBlankLine(o.DEFAULT_ATTR_DATA,!0);v.push(e)}v.length>0&&(s.push({start:n+c.length+r,newLines:v}),r+=v.length),c.push(...v);let p=_.length-1,g=_[p];0===g&&(p--,g=_[p]);let m=c.length-u-1,S=d;for(;m>=0;){const e=Math.min(S,g);if(void 0===c[p])break;if(c[p].copyCellsFrom(c[m],S-e,g-e,e,!0),g-=e,0===g&&(p--,g=_[p]),S-=e,0===S){m--;const e=Math.max(m,0);S=(0,a.getWrappedLineTrimmedLength)(c,e,this._cols)}}for(let t=0;t<c.length;t++)_[t]<e&&c[t].setCell(_[t],i);let C=u-f;for(;C-- >0;)0===this.ybase?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+r)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+t-1)}if(s.length>0){const e=[],t=[];for(let e=0;e<this.lines.length;e++)t.push(this.lines.get(e));const i=this.lines.length;let n=i-1,o=0,a=s[o];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+r);let h=0;for(let c=Math.min(this.lines.maxLength-1,i+r-1);c>=0;c--)if(a&&a.start>n+h){for(let e=a.newLines.length-1;e>=0;e--)this.lines.set(c--,a.newLines[e]);c++,e.push({index:n+1,amount:a.newLines.length}),h+=a.newLines.length,a=s[++o]}else this.lines.set(c,t[n--]);let c=0;for(let t=e.length-1;t>=0;t--)e[t].index+=c,this.lines.onInsertEmitter.fire(e[t]),c+=e[t].amount;const l=Math.max(0,i+r-this.lines.maxLength);l>0&&this.lines.onTrimEmitter.fire(l)}}translateBufferLineToString(e,t,i=0,s){const r=this.lines.get(e);return r?r.translateToString(t,i,s):""}getWrappedRangeForLine(e){let t=e,i=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;i+1<this.lines.length&&this.lines.get(i+1).isWrapped;)i++;return{first:t,last:i}}setupTabStops(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new l.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim((e=>{t.line-=e,t.line<0&&t.dispose()}))),t.register(this.lines.onInsert((e=>{t.line>=e.index&&(t.line+=e.amount)}))),t.register(this.lines.onDelete((e=>{t.line>=e.index&&t.line<e.index+e.amount&&t.dispose(),t.line>e.index&&(t.line-=e.amount)}))),t.register(t.onDispose((()=>this._removeMarker(t)))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const s=i(3734),r=i(511),n=i(643),o=i(482);t.DEFAULT_ATTR_DATA=Object.freeze(new s.AttributeData);let a=0;class h{constructor(e,t,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const s=t||r.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let t=0;t<e;++t)this.setCell(t,s);this.length=e}get(e){const t=this._data[3*e+0],i=2097151&t;return[this._data[3*e+1],2097152&t?this._combined[e]:i?(0,o.stringFromCodePoint)(i):"",t>>22,2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):i]}set(e,t){this._data[3*e+1]=t[n.CHAR_DATA_ATTR_INDEX],t[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=t[1],this._data[3*e+0]=2097152|e|t[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=t[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&t}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const t=this._data[3*e+0];return 2097152&t?this._combined[e]:2097151&t?(0,o.stringFromCodePoint)(2097151&t):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,t){return a=3*e,t.content=this._data[a+0],t.fg=this._data[a+1],t.bg=this._data[a+2],2097152&t.content&&(t.combinedData=this._combined[e]),268435456&t.bg&&(t.extended=this._extendedAttrs[e]),t}setCell(e,t){2097152&t.content&&(this._combined[e]=t.combinedData),268435456&t.bg&&(this._extendedAttrs[e]=t.extended),this._data[3*e+0]=t.content,this._data[3*e+1]=t.fg,this._data[3*e+2]=t.bg}setCellFromCodepoint(e,t,i,s){268435456&s.bg&&(this._extendedAttrs[e]=s.extended),this._data[3*e+0]=t|i<<22,this._data[3*e+1]=s.fg,this._data[3*e+2]=s.bg}addCodepointToCell(e,t,i){let s=this._data[3*e+0];2097152&s?this._combined[e]+=(0,o.stringFromCodePoint)(t):2097151&s?(this._combined[e]=(0,o.stringFromCodePoint)(2097151&s)+(0,o.stringFromCodePoint)(t),s&=-2097152,s|=2097152):s=t|1<<22,i&&(s&=-12582913,s|=i<<22),this._data[3*e+0]=s}insertCells(e,t,i){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),t<this.length-e){const s=new r.CellData;for(let i=this.length-e-t-1;i>=0;--i)this.setCell(e+t+i,this.loadCell(e+i,s));for(let s=0;s<t;++s)this.setCell(e+s,i)}else for(let t=e;t<this.length;++t)this.setCell(t,i);2===this.getWidth(this.length-1)&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(e,t,i){if(e%=this.length,t<this.length-e){const s=new r.CellData;for(let i=0;i<this.length-e-t;++i)this.setCell(e+i,this.loadCell(e+t+i,s));for(let e=this.length-t;e<this.length;++e)this.setCell(e,i)}else for(let t=e;t<this.length;++t)this.setCell(t,i);e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodepoint(e,0,1,i)}replaceCells(e,t,i,s=!1){if(s)for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),t<this.length&&2===this.getWidth(t-1)&&!this.isProtected(t)&&this.setCellFromCodepoint(t,0,1,i);e<t&&e<this.length;)this.isProtected(e)||this.setCell(e,i),e++;else for(e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,i),t<this.length&&2===this.getWidth(t-1)&&this.setCellFromCodepoint(t,0,1,i);e<t&&e<this.length;)this.setCell(e++,i)}resize(e,t){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const i=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*i)this._data=new Uint32Array(this._data.buffer,0,i);else{const e=new Uint32Array(i);e.set(this._data),this._data=e}for(let i=this.length;i<e;++i)this.setCell(i,t)}else{this._data=this._data.subarray(0,i);const t=Object.keys(this._combined);for(let i=0;i<t.length;i++){const s=parseInt(t[i],10);s>=e&&delete this._combined[s]}const s=Object.keys(this._extendedAttrs);for(let t=0;t<s.length;t++){const i=parseInt(s[t],10);i>=e&&delete this._extendedAttrs[i]}}return this.length=e,4*i*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,t=!1){if(t)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const t in e._combined)this._combined[t]=e._combined[t];this._extendedAttrs={};for(const t in e._extendedAttrs)this._extendedAttrs[t]=e._extendedAttrs[t];this.isWrapped=e.isWrapped}clone(){const e=new h(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const t in this._combined)e._combined[t]=this._combined[t];for(const t in this._extendedAttrs)e._extendedAttrs[t]=this._extendedAttrs[t];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,t,i,s,r){const n=e._data;if(r)for(let r=s-1;r>=0;r--){for(let e=0;e<3;e++)this._data[3*(i+r)+e]=n[3*(t+r)+e];268435456&n[3*(t+r)+2]&&(this._extendedAttrs[i+r]=e._extendedAttrs[t+r])}else for(let r=0;r<s;r++){for(let e=0;e<3;e++)this._data[3*(i+r)+e]=n[3*(t+r)+e];268435456&n[3*(t+r)+2]&&(this._extendedAttrs[i+r]=e._extendedAttrs[t+r])}const o=Object.keys(e._combined);for(let s=0;s<o.length;s++){const r=parseInt(o[s],10);r>=t&&(this._combined[r-t+i]=e._combined[r])}}translateToString(e,t,i,s){t=t??0,i=i??this.length,e&&(i=Math.min(i,this.getTrimmedLength())),s&&(s.length=0);let r="";for(;t<i;){const e=this._data[3*t+0],i=2097151&e,a=2097152&e?this._combined[t]:i?(0,o.stringFromCodePoint)(i):n.WHITESPACE_CELL_CHAR;if(r+=a,s)for(let e=0;e<a.length;++e)s.push(t);t+=e>>22||1}return s&&s.push(t),r}}t.BufferLine=h},4841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}},4634:(e,t)=>{function i(e,t,i){if(t===e.length-1)return e[t].getTrimmedLength();const s=!e[t].hasContent(i-1)&&1===e[t].getWidth(i-1),r=2===e[t+1].getWidth(0);return s&&r?i-1:i}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(e,t,s,r,n){const o=[];for(let a=0;a<e.length-1;a++){let h=a,c=e.get(++h);if(!c.isWrapped)continue;const l=[e.get(a)];for(;h<e.length&&c.isWrapped;)l.push(c),c=e.get(++h);if(r>=a&&r<h){a+=l.length-1;continue}let d=0,_=i(l,d,t),u=1,f=0;for(;u<l.length;){const e=i(l,u,t),r=e-f,o=s-_,a=Math.min(r,o);l[d].copyCellsFrom(l[u],f,_,a,!1),_+=a,_===s&&(d++,_=0),f+=a,f===e&&(u++,f=0),0===_&&0!==d&&2===l[d-1].getWidth(s-1)&&(l[d].copyCellsFrom(l[d-1],s-1,_++,1,!1),l[d-1].setCell(s-1,n))}l[d].replaceCells(_,s,n);let v=0;for(let e=l.length-1;e>0&&(e>d||0===l[e].getTrimmedLength());e--)v++;v>0&&(o.push(a+l.length-v),o.push(v)),a+=l.length-1}return o},t.reflowLargerCreateNewLayout=function(e,t){const i=[];let s=0,r=t[s],n=0;for(let o=0;o<e.length;o++)if(r===o){const i=t[++s];e.onDeleteEmitter.fire({index:o-n,amount:i}),o+=i-1,n+=i,r=t[++s]}else i.push(o);return{layout:i,countRemoved:n}},t.reflowLargerApplyNewLayout=function(e,t){const i=[];for(let s=0;s<t.length;s++)i.push(e.get(t[s]));for(let t=0;t<i.length;t++)e.set(t,i[t]);e.length=t.length},t.reflowSmallerGetNewLineLengths=function(e,t,s){const r=[],n=e.map(((s,r)=>i(e,r,t))).reduce(((e,t)=>e+t));let o=0,a=0,h=0;for(;h<n;){if(n-h<s){r.push(n-h);break}o+=s;const c=i(e,a,t);o>c&&(o-=c,a++);const l=2===e[a].getWidth(o-1);l&&o--;const d=l?s-1:s;r.push(d),h+=d}return r},t.getWrappedLineTrimmedLength=i},5295:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const s=i(8460),r=i(844),n=i(9092);class o extends r.Disposable{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this.register(new s.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}}t.BufferSet=o},511:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const s=i(482),r=i(643),n=i(3734);class o extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(e){const t=new o;return t.setFromCharData(e),t}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,s.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[r.CHAR_DATA_ATTR_INDEX],this.bg=0;let t=!1;if(e[r.CHAR_DATA_CHAR_INDEX].length>2)t=!0;else if(2===e[r.CHAR_DATA_CHAR_INDEX].length){const i=e[r.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){const s=e[r.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(i-55296)+s-56320+65536|e[r.CHAR_DATA_WIDTH_INDEX]<<22:t=!0}else t=!0}else this.content=e[r.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[r.CHAR_DATA_WIDTH_INDEX]<<22;t&&(this.combinedData=e[r.CHAR_DATA_CHAR_INDEX],this.content=2097152|e[r.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=o},643:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const s=i(8460),r=i(844);class n{get id(){return this._id}constructor(e){this.line=e,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new s.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,r.disposeArray)(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}}t.Marker=n,n._nextId=1},7116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},t.CHARSETS.A={"#":""},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},t.CHARSETS.C=t.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},t.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},t.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.E=t.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},t.CHARSETS.H=t.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},t.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(e,t)=>{var i,s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(e){e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="",e.BS="\b",e.HT="\t",e.LF="\n",e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""}(i||(t.C0=i={})),function(e){e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""}(s||(t.C1=s={})),function(e){e.ST=`${i.ESC}\\`}(r||(t.C1_ESCAPED=r={}))},7399:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const s=i(2584),r={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(e,t,i,n){const o={type:0,cancel:!1,key:void 0},a=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?o.key=t?s.C0.ESC+"OA":s.C0.ESC+"[A":"UIKeyInputLeftArrow"===e.key?o.key=t?s.C0.ESC+"OD":s.C0.ESC+"[D":"UIKeyInputRightArrow"===e.key?o.key=t?s.C0.ESC+"OC":s.C0.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(o.key=t?s.C0.ESC+"OB":s.C0.ESC+"[B");break;case 8:o.key=e.ctrlKey?"\b":s.C0.DEL,e.altKey&&(o.key=s.C0.ESC+o.key);break;case 9:if(e.shiftKey){o.key=s.C0.ESC+"[Z";break}o.key=s.C0.HT,o.cancel=!0;break;case 13:o.key=e.altKey?s.C0.ESC+s.C0.CR:s.C0.CR,o.cancel=!0;break;case 27:o.key=s.C0.ESC,e.altKey&&(o.key=s.C0.ESC+s.C0.ESC),o.cancel=!0;break;case 37:if(e.metaKey)break;a?(o.key=s.C0.ESC+"[1;"+(a+1)+"D",o.key===s.C0.ESC+"[1;3D"&&(o.key=s.C0.ESC+(i?"b":"[1;5D"))):o.key=t?s.C0.ESC+"OD":s.C0.ESC+"[D";break;case 39:if(e.metaKey)break;a?(o.key=s.C0.ESC+"[1;"+(a+1)+"C",o.key===s.C0.ESC+"[1;3C"&&(o.key=s.C0.ESC+(i?"f":"[1;5C"))):o.key=t?s.C0.ESC+"OC":s.C0.ESC+"[C";break;case 38:if(e.metaKey)break;a?(o.key=s.C0.ESC+"[1;"+(a+1)+"A",i||o.key!==s.C0.ESC+"[1;3A"||(o.key=s.C0.ESC+"[1;5A")):o.key=t?s.C0.ESC+"OA":s.C0.ESC+"[A";break;case 40:if(e.metaKey)break;a?(o.key=s.C0.ESC+"[1;"+(a+1)+"B",i||o.key!==s.C0.ESC+"[1;3B"||(o.key=s.C0.ESC+"[1;5B")):o.key=t?s.C0.ESC+"OB":s.C0.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(o.key=s.C0.ESC+"[2~");break;case 46:o.key=a?s.C0.ESC+"[3;"+(a+1)+"~":s.C0.ESC+"[3~";break;case 36:o.key=a?s.C0.ESC+"[1;"+(a+1)+"H":t?s.C0.ESC+"OH":s.C0.ESC+"[H";break;case 35:o.key=a?s.C0.ESC+"[1;"+(a+1)+"F":t?s.C0.ESC+"OF":s.C0.ESC+"[F";break;case 33:e.shiftKey?o.type=2:e.ctrlKey?o.key=s.C0.ESC+"[5;"+(a+1)+"~":o.key=s.C0.ESC+"[5~";break;case 34:e.shiftKey?o.type=3:e.ctrlKey?o.key=s.C0.ESC+"[6;"+(a+1)+"~":o.key=s.C0.ESC+"[6~";break;case 112:o.key=a?s.C0.ESC+"[1;"+(a+1)+"P":s.C0.ESC+"OP";break;case 113:o.key=a?s.C0.ESC+"[1;"+(a+1)+"Q":s.C0.ESC+"OQ";break;case 114:o.key=a?s.C0.ESC+"[1;"+(a+1)+"R":s.C0.ESC+"OR";break;case 115:o.key=a?s.C0.ESC+"[1;"+(a+1)+"S":s.C0.ESC+"OS";break;case 116:o.key=a?s.C0.ESC+"[15;"+(a+1)+"~":s.C0.ESC+"[15~";break;case 117:o.key=a?s.C0.ESC+"[17;"+(a+1)+"~":s.C0.ESC+"[17~";break;case 118:o.key=a?s.C0.ESC+"[18;"+(a+1)+"~":s.C0.ESC+"[18~";break;case 119:o.key=a?s.C0.ESC+"[19;"+(a+1)+"~":s.C0.ESC+"[19~";break;case 120:o.key=a?s.C0.ESC+"[20;"+(a+1)+"~":s.C0.ESC+"[20~";break;case 121:o.key=a?s.C0.ESC+"[21;"+(a+1)+"~":s.C0.ESC+"[21~";break;case 122:o.key=a?s.C0.ESC+"[23;"+(a+1)+"~":s.C0.ESC+"[23~";break;case 123:o.key=a?s.C0.ESC+"[24;"+(a+1)+"~":s.C0.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if(i&&!n||!e.altKey||e.metaKey)!i||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&1===e.key.length?o.key=e.key:e.key&&e.ctrlKey&&("_"===e.key&&(o.key=s.C0.US),"@"===e.key&&(o.key=s.C0.NUL)):65===e.keyCode&&(o.type=1);else{const t=r[e.keyCode],i=t?.[e.shiftKey?1:0];if(i)o.key=s.C0.ESC+i;else if(e.keyCode>=65&&e.keyCode<=90){const t=e.ctrlKey?e.keyCode-64:e.keyCode+32;let i=String.fromCharCode(t);e.shiftKey&&(i=i.toUpperCase()),o.key=s.C0.ESC+i}else if(32===e.keyCode)o.key=s.C0.ESC+(e.ctrlKey?s.C0.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){let t=e.code.slice(3,4);e.shiftKey||(t=t.toLowerCase()),o.key=s.C0.ESC+t,o.cancel=!0}}else e.keyCode>=65&&e.keyCode<=90?o.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?o.key=s.C0.NUL:e.keyCode>=51&&e.keyCode<=55?o.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?o.key=s.C0.DEL:219===e.keyCode?o.key=s.C0.ESC:220===e.keyCode?o.key=s.C0.FS:221===e.keyCode&&(o.key=s.C0.GS)}return o}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10))+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)},t.utf32ToString=function(e,t=0,i=e.length){let s="";for(let r=t;r<i;++r){let t=e[r];t>65535?(t-=65536,s+=String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):s+=String.fromCharCode(t)}return s},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){const i=e.length;if(!i)return 0;let s=0,r=0;if(this._interim){const i=e.charCodeAt(r++);56320<=i&&i<=57343?t[s++]=1024*(this._interim-55296)+i-56320+65536:(t[s++]=this._interim,t[s++]=i),this._interim=0}for(let n=r;n<i;++n){const r=e.charCodeAt(n);if(55296<=r&&r<=56319){if(++n>=i)return this._interim=r,s;const o=e.charCodeAt(n);56320<=o&&o<=57343?t[s++]=1024*(r-55296)+o-56320+65536:(t[s++]=r,t[s++]=o)}else 65279!==r&&(t[s++]=r)}return s}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){const i=e.length;if(!i)return 0;let s,r,n,o,a=0,h=0,c=0;if(this.interim[0]){let s=!1,r=this.interim[0];r&=192==(224&r)?31:224==(240&r)?15:7;let n,o=0;for(;(n=63&this.interim[++o])&&o<4;)r<<=6,r|=n;const h=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,l=h-o;for(;c<l;){if(c>=i)return 0;if(n=e[c++],128!=(192&n)){c--,s=!0;break}this.interim[o++]=n,r<<=6,r|=63&n}s||(2===h?r<128?c--:t[a++]=r:3===h?r<2048||r>=55296&&r<=57343||65279===r||(t[a++]=r):r<65536||r>1114111||(t[a++]=r)),this.interim.fill(0)}const l=i-4;let d=c;for(;d<i;){for(;!(!(d<l)||128&(s=e[d])||128&(r=e[d+1])||128&(n=e[d+2])||128&(o=e[d+3]));)t[a++]=s,t[a++]=r,t[a++]=n,t[a++]=o,d+=4;if(s=e[d++],s<128)t[a++]=s;else if(192==(224&s)){if(d>=i)return this.interim[0]=s,a;if(r=e[d++],128!=(192&r)){d--;continue}if(h=(31&s)<<6|63&r,h<128){d--;continue}t[a++]=h}else if(224==(240&s)){if(d>=i)return this.interim[0]=s,a;if(r=e[d++],128!=(192&r)){d--;continue}if(d>=i)return this.interim[0]=s,this.interim[1]=r,a;if(n=e[d++],128!=(192&n)){d--;continue}if(h=(15&s)<<12|(63&r)<<6|63&n,h<2048||h>=55296&&h<=57343||65279===h)continue;t[a++]=h}else if(240==(248&s)){if(d>=i)return this.interim[0]=s,a;if(r=e[d++],128!=(192&r)){d--;continue}if(d>=i)return this.interim[0]=s,this.interim[1]=r,a;if(n=e[d++],128!=(192&n)){d--;continue}if(d>=i)return this.interim[0]=s,this.interim[1]=r,this.interim[2]=n,a;if(o=e[d++],128!=(192&o)){d--;continue}if(h=(7&s)<<18|(63&r)<<12|(63&n)<<6|63&o,h<65536||h>1114111)continue;t[a++]=h}}return a}}},225:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const s=i(1480),r=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],n=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let o;t.UnicodeV6=class{constructor(){if(this.version="6",!o){o=new Uint8Array(65536),o.fill(1),o[0]=0,o.fill(0,1,32),o.fill(0,127,160),o.fill(2,4352,4448),o[9001]=2,o[9002]=2,o.fill(2,11904,42192),o[12351]=1,o.fill(2,44032,55204),o.fill(2,63744,64256),o.fill(2,65040,65050),o.fill(2,65072,65136),o.fill(2,65280,65377),o.fill(2,65504,65511);for(let e=0;e<r.length;++e)o.fill(0,r[e][0],r[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?o[e]:function(e,t){let i,s=0,r=t.length-1;if(e<t[0][0]||e>t[r][1])return!1;for(;r>=s;)if(i=s+r>>1,e>t[i][1])s=i+1;else{if(!(e<t[i][0]))return!0;r=i-1}return!1}(e,n)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let i=this.wcwidth(e),r=0===i&&0!==t;if(r){const e=s.UnicodeService.extractWidth(t);0===e?r=!1:e>i&&(i=e)}return s.UnicodeService.createPropertyValue(0,i,r)}}},5981:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const s=i(8460),r=i(844);class n extends r.Disposable{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new s.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(void 0!==t&&this._syncCalls>t)return void(this._syncCalls=0);if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let i;for(this._isSyncWriting=!0;i=this._writeBuffer.shift();){this._action(i);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){const i=e||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],s=this._action(e,t);if(s){const e=e=>Date.now()-i>=12?setTimeout((()=>this._innerWrite(0,e))):this._innerWrite(i,e);return void s.catch((e=>(queueMicrotask((()=>{throw e})),Promise.resolve(!1)))).then(e)}const r=this._callbacks[this._bufferOffset];if(r&&r(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-i>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=n},5941:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const i=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,s=/^[\da-f]+$/;function r(e,t){const i=e.toString(16),s=i.length<2?"0"+i:i;switch(t){case 4:return i[0];case 8:return s;case 12:return(s+s).slice(0,3);default:return s+s}}t.parseColor=function(e){if(!e)return;let t=e.toLowerCase();if(0===t.indexOf("rgb:")){t=t.slice(4);const e=i.exec(t);if(e){const t=e[1]?15:e[4]?255:e[7]?4095:65535;return[Math.round(parseInt(e[1]||e[4]||e[7]||e[10],16)/t*255),Math.round(parseInt(e[2]||e[5]||e[8]||e[11],16)/t*255),Math.round(parseInt(e[3]||e[6]||e[9]||e[12],16)/t*255)]}}else if(0===t.indexOf("#")&&(t=t.slice(1),s.exec(t)&&[3,6,9,12].includes(t.length))){const e=t.length/3,i=[0,0,0];for(let s=0;s<3;++s){const r=parseInt(t.slice(e*s,e*s+e),16);i[s]=1===e?r<<4:2===e?r:3===e?r>>4:r>>8}return i}},t.toRgbString=function(e,t=16){const[i,s,n]=e;return`rgb:${r(i,t)}/${r(s,t)}/${r(n,t)}`}},5770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const s=i(482),r=i(8742),n=i(5770),o=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=o,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const i=this._handlers[e];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=o,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||o,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(t);else this._handlerFb(this._ident,"HOOK",t)}put(e,t,i){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(e,t,i);else this._handlerFb(this._ident,"PUT",(0,s.utf32ToString)(e,t,i))}unhook(e,t=!0){if(this._active.length){let i=!1,s=this._active.length-1,r=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,i=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&!1===i){for(;s>=0&&(i=this._active[s].unhook(e),!0!==i);s--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,i;s--}for(;s>=0;s--)if(i=this._active[s].unhook(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,i}else this._handlerFb(this._ident,"UNHOOK",e);this._active=o,this._ident=0}};const a=new r.Params;a.addParam(0),t.DcsHandler=class{constructor(e){this._handler=e,this._data="",this._params=a,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():a,this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=(0,s.utf32ToString)(e,t,i),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then((e=>(this._params=a,this._data="",this._hitLimit=!1,e)));return this._params=a,this._data="",this._hitLimit=!1,t}}},2015:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const s=i(844),r=i(8742),n=i(6242),o=i(6351);class a{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,i,s){this.table[t<<8|e]=i<<4|s}addMany(e,t,i,s){for(let r=0;r<e.length;r++)this.table[t<<8|e[r]]=i<<4|s}}t.TransitionTable=a;const h=160;t.VT500_TRANSITION_TABLE=function(){const e=new a(4095),t=Array.apply(null,Array(256)).map(((e,t)=>t)),i=(e,i)=>t.slice(e,i),s=i(32,127),r=i(0,24);r.push(25),r.push.apply(r,i(28,32));const n=i(0,14);let o;for(o in e.setDefault(1,0),e.addMany(s,0,2,0),n)e.addMany([24,26,153,154],o,3,0),e.addMany(i(128,144),o,3,0),e.addMany(i(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(r,0,3,0),e.addMany(r,1,3,1),e.add(127,1,0,1),e.addMany(r,8,0,8),e.addMany(r,3,3,3),e.add(127,3,0,3),e.addMany(r,4,3,4),e.add(127,4,0,4),e.addMany(r,6,3,6),e.addMany(r,5,3,5),e.add(127,5,0,5),e.addMany(r,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(s,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(i(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(s,7,0,7),e.addMany(r,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(i(64,127),3,7,0),e.addMany(i(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(i(48,60),4,8,4),e.addMany(i(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(i(32,64),6,0,6),e.add(127,6,0,6),e.addMany(i(64,127),6,0,0),e.addMany(i(32,48),3,9,5),e.addMany(i(32,48),5,9,5),e.addMany(i(48,64),5,0,6),e.addMany(i(64,127),5,7,0),e.addMany(i(32,48),4,9,5),e.addMany(i(32,48),1,9,2),e.addMany(i(32,48),2,9,2),e.addMany(i(48,127),2,10,0),e.addMany(i(48,80),1,10,0),e.addMany(i(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(i(96,127),1,10,0),e.add(80,1,11,9),e.addMany(r,9,0,9),e.add(127,9,0,9),e.addMany(i(28,32),9,0,9),e.addMany(i(32,48),9,9,12),e.addMany(i(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(r,11,0,11),e.addMany(i(32,128),11,0,11),e.addMany(i(28,32),11,0,11),e.addMany(r,10,0,10),e.add(127,10,0,10),e.addMany(i(28,32),10,0,10),e.addMany(i(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(i(32,48),10,9,12),e.addMany(r,12,0,12),e.add(127,12,0,12),e.addMany(i(28,32),12,0,12),e.addMany(i(32,48),12,9,12),e.addMany(i(48,64),12,0,11),e.addMany(i(64,127),12,12,13),e.addMany(i(64,127),10,12,13),e.addMany(i(64,127),9,12,13),e.addMany(r,13,13,13),e.addMany(s,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(h,0,2,0),e.add(h,8,5,8),e.add(h,6,0,6),e.add(h,11,0,11),e.add(h,13,13,13),e}();class c extends s.Disposable{constructor(e=t.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new r.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,t,i)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,s.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new o.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(e,t=[64,126]){let i=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=e.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let t=0;t<e.intermediates.length;++t){const s=e.intermediates.charCodeAt(t);if(32>s||s>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=s}}if(1!==e.final.length)throw new Error("final must be a single byte");const s=e.final.charCodeAt(0);if(t[0]>s||s>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return i<<=8,i|=s,i}identToString(e){const t=[];for(;e;)t.push(String.fromCharCode(255&e)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){const i=this._identifier(e,[48,126]);void 0===this._escHandlers[i]&&(this._escHandlers[i]=[]);const s=this._escHandlers[i];return s.push(t),{dispose:()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){const i=this._identifier(e);void 0===this._csiHandlers[i]&&(this._csiHandlers[i]=[]);const s=this._csiHandlers[i];return s.push(t),{dispose:()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,i,s,r){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=i,this._parseStack.transition=s,this._parseStack.chunkPos=r}parse(e,t,i){let s,r=0,n=0,o=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,o=this._parseStack.chunkPos+1;else{if(void 0===i||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const t=this._parseStack.handlers;let n=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===i&&n>-1)for(;n>=0&&(s=t[n](this._params),!0!==s);n--)if(s instanceof Promise)return this._parseStack.handlerPos=n,s;this._parseStack.handlers=[];break;case 4:if(!1===i&&n>-1)for(;n>=0&&(s=t[n](),!0!==s);n--)if(s instanceof Promise)return this._parseStack.handlerPos=n,s;this._parseStack.handlers=[];break;case 6:if(r=e[this._parseStack.chunkPos],s=this._dcsParser.unhook(24!==r&&26!==r,i),s)return s;27===r&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(r=e[this._parseStack.chunkPos],s=this._oscParser.end(24!==r&&26!==r,i),s)return s;27===r&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,o=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let i=o;i<t;++i){switch(r=e[i],n=this._transitions.table[this.currentState<<8|(r<160?r:h)],n>>4){case 2:for(let s=i+1;;++s){if(s>=t||(r=e[s])<32||r>126&&r<h){this._printHandler(e,i,s),i=s-1;break}if(++s>=t||(r=e[s])<32||r>126&&r<h){this._printHandler(e,i,s),i=s-1;break}if(++s>=t||(r=e[s])<32||r>126&&r<h){this._printHandler(e,i,s),i=s-1;break}if(++s>=t||(r=e[s])<32||r>126&&r<h){this._printHandler(e,i,s),i=s-1;break}}break;case 3:this._executeHandlers[r]?this._executeHandlers[r]():this._executeHandlerFb(r),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:i,code:r,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const o=this._csiHandlers[this._collect<<8|r];let a=o?o.length-1:-1;for(;a>=0&&(s=o[a](this._params),!0!==s);a--)if(s instanceof Promise)return this._preserveStack(3,o,a,n,i),s;a<0&&this._csiHandlerFb(this._collect<<8|r,this._params),this.precedingJoinState=0;break;case 8:do{switch(r){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(r-48)}}while(++i<t&&(r=e[i])>47&&r<60);i--;break;case 9:this._collect<<=8,this._collect|=r;break;case 10:const c=this._escHandlers[this._collect<<8|r];let l=c?c.length-1:-1;for(;l>=0&&(s=c[l](),!0!==s);l--)if(s instanceof Promise)return this._preserveStack(4,c,l,n,i),s;l<0&&this._escHandlerFb(this._collect<<8|r),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|r,this._params);break;case 13:for(let s=i+1;;++s)if(s>=t||24===(r=e[s])||26===r||27===r||r>127&&r<h){this._dcsParser.put(e,i,s),i=s-1;break}break;case 14:if(s=this._dcsParser.unhook(24!==r&&26!==r),s)return this._preserveStack(6,[],0,n,i),s;27===r&&(n|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let s=i+1;;s++)if(s>=t||(r=e[s])<32||r>127&&r<h){this._oscParser.put(e,i,s),i=s-1;break}break;case 6:if(s=this._oscParser.end(24!==r&&26!==r),s)return this._preserveStack(5,[],0,n,i),s;27===r&&(n|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&n}}}t.EscapeSequenceParser=c},6242:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const s=i(5770),r=i(482),n=[];t.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){void 0===this._handlers[e]&&(this._handlers[e]=[]);const i=this._handlers[e];return i.push(t),{dispose:()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(2===this._state)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}_put(e,t,i){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(e,t,i);else this._handlerFb(this._id,"PUT",(0,r.utf32ToString)(e,t,i))}start(){this.reset(),this._state=1}put(e,t,i){if(3!==this._state){if(1===this._state)for(;t<i;){const i=e[t++];if(59===i){this._state=2,this._start();break}if(i<48||57<i)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+i-48}2===this._state&&i-t>0&&this._put(e,t,i)}}end(e,t=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let i=!1,s=this._active.length-1,r=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,i=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&!1===i){for(;s>=0&&(i=this._active[s].end(e),!0!==i);s--)if(i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,i;s--}for(;s>=0;s--)if(i=this._active[s].end(!1),i instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,i}else this._handlerFb(this._id,"END",e);this._active=n,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,i){this._hitLimit||(this._data+=(0,r.utf32ToString)(e,t,i),this._data.length>s.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then((e=>(this._data="",this._hitLimit=!1,e)));return this._data="",this._hitLimit=!1,t}}},8742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const i=2147483647;class s{static fromArray(e){const t=new s;if(!e.length)return t;for(let i=Array.isArray(e[0])?1:0;i<e.length;++i){const s=e[i];if(Array.isArray(s))for(let e=0;e<s.length;++e)t.addSubParam(s[e]);else t.addParam(s)}return t}constructor(e=32,t=32){if(this.maxLength=e,this.maxSubParamsLength=t,t>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(t),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const e=new s(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e}toArray(){const e=[];for(let t=0;t<this.length;++t){e.push(this.params[t]);const i=this._subParamsIdx[t]>>8,s=255&this._subParamsIdx[t];s-i>0&&e.push(Array.prototype.slice.call(this._subParams,i,s))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>i?i:e}}addSubParam(e){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(e<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>i?i:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}getSubParams(e){const t=this._subParamsIdx[e]>>8,i=255&this._subParamsIdx[e];return i-t>0?this._subParams.subarray(t,i):null}getSubParamsAll(){const e={};for(let t=0;t<this.length;++t){const i=this._subParamsIdx[t]>>8,s=255&this._subParamsIdx[t];s-i>0&&(e[t]=this._subParams.slice(i,s))}return e}addDigit(e){let t;if(this._rejectDigits||!(t=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const s=this._digitIsSub?this._subParams:this.params,r=s[t-1];s[t-1]=~r?Math.min(10*r+e,i):e}}t.Params=s},5741:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){const i={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(i),t.dispose=()=>this._wrappedAddonDispose(i),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let i=0;i<this._addons.length;i++)if(this._addons[i]===e){t=i;break}if(-1===t)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}}},8771:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const s=i(3785),r=i(511);t.BufferApiView=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){const t=this._buffer.lines.get(e);if(t)return new s.BufferLineApiView(t)}getNullCell(){return new r.CellData}}},3785:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const s=i(511);t.BufferLineApiView=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new s.CellData)}translateToString(e,t,i){return this._line.translateToString(e,t,i)}}},8285:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const s=i(8771),r=i(8460),n=i(844);class o extends n.Disposable{constructor(e){super(),this._core=e,this._onBufferChange=this.register(new r.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new s.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new s.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=o},7975:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,(e=>t(e.toArray())))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,((e,i)=>t(e,i.toArray())))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}}},7090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}}},744:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const n=i(8460),o=i(844),a=i(5295),h=i(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let c=t.BufferService=class extends o.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new a.BufferSet(e,this))}resize(e,t){this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){const i=this.buffer;let s;s=this._cachedBlankLine,s&&s.length===this.cols&&s.getFg(0)===e.fg&&s.getBg(0)===e.bg||(s=i.getBlankLine(e,t),this._cachedBlankLine=s),s.isWrapped=t;const r=i.ybase+i.scrollTop,n=i.ybase+i.scrollBottom;if(0===i.scrollTop){const e=i.lines.isFull;n===i.lines.length-1?e?i.lines.recycle().copyFrom(s):i.lines.push(s.clone()):i.lines.splice(n+1,0,s.clone()),e?this.isUserScrolling&&(i.ydisp=Math.max(i.ydisp-1,0)):(i.ybase++,this.isUserScrolling||i.ydisp++)}else{const e=n-r+1;i.lines.shiftElements(r+1,e-1,-1),i.lines.set(n,s.clone())}this.isUserScrolling||(i.ydisp=i.ybase),this._onScroll.fire(i.ydisp)}scrollLines(e,t,i){const s=this.buffer;if(e<0){if(0===s.ydisp)return;this.isUserScrolling=!0}else e+s.ydisp>=s.ybase&&(this.isUserScrolling=!1);const r=s.ydisp;s.ydisp=Math.max(Math.min(s.ydisp+e,s.ybase),0),r!==s.ydisp&&(t||this._onScroll.fire(s.ydisp))}};t.BufferService=c=s([r(0,h.IOptionsService)],c)},7994:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}}},1753:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const n=i(2585),o=i(8460),a=i(844),h={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>32!==e.action},DRAG:{events:23,restrict:e=>32!==e.action||3!==e.button},ANY:{events:31,restrict:e=>!0}};function c(e,t){let i=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return 4===e.button?(i|=64,i|=e.action):(i|=3&e.button,4&e.button&&(i|=64),8&e.button&&(i|=128),32===e.action?i|=32:0!==e.action||t||(i|=3)),i}const l=String.fromCharCode,d={DEFAULT:e=>{const t=[c(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`[M${l(t[0])}${l(t[1])}${l(t[2])}`},SGR:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{const t=0===e.action&&4!==e.button?"m":"M";return`[<${c(e,!0)};${e.x};${e.y}${t}`}};let _=t.CoreMouseService=class extends a.Disposable{constructor(e,t){super(),this._bufferService=e,this._coreService=t,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new o.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const e of Object.keys(h))this.addProtocol(e,h[e]);for(const e of Object.keys(d))this.addEncoding(e,d[e]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows)return!1;if(4===e.button&&32===e.action)return!1;if(3===e.button&&32!==e.action)return!1;if(4!==e.button&&(2===e.action||3===e.action))return!1;if(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(e))return!1;const t=this._encodings[this._activeEncoding](e);return t&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}_equalEvents(e,t,i){if(i){if(e.x!==t.x)return!1;if(e.y!==t.y)return!1}else{if(e.col!==t.col)return!1;if(e.row!==t.row)return!1}return e.button===t.button&&e.action===t.action&&e.ctrl===t.ctrl&&e.alt===t.alt&&e.shift===t.shift}};t.CoreMouseService=_=s([r(0,n.IBufferService),r(1,n.ICoreService)],_)},6975:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const n=i(1439),o=i(8460),a=i(844),h=i(2585),c=Object.freeze({insertMode:!1}),l=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let d=t.CoreService=class extends a.Disposable{constructor(e,t,i){super(),this._bufferService=e,this._logService=t,this._optionsService=i,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new o.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new o.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new o.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new o.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(c),this.decPrivateModes=(0,n.clone)(l)}reset(){this.modes=(0,n.clone)(c),this.decPrivateModes=(0,n.clone)(l)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const i=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&i.ybase!==i.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,(()=>e.split("").map((e=>e.charCodeAt(0))))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,(()=>e.split("").map((e=>e.charCodeAt(0))))),this._onBinary.fire(e))}};t.CoreService=d=s([r(0,h.IBufferService),r(1,h.ILogService),r(2,h.IOptionsService)],d)},9074:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const s=i(8055),r=i(8460),n=i(844),o=i(6106);let a=0,h=0;class c extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new o.SortedList((e=>e?.marker.line)),this._onDecorationRegistered=this.register(new r.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new r.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)((()=>this.reset())))}registerDecoration(e){if(e.marker.isDisposed)return;const t=new l(e);if(t){const e=t.marker.onDispose((()=>t.dispose()));t.onDispose((()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),e.dispose())})),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,i){let s=0,r=0;for(const n of this._decorations.getKeyIterator(t))s=n.options.x??0,r=s+(n.options.width??1),e>=s&&e<r&&(!i||(n.options.layer??"bottom")===i)&&(yield n)}forEachDecorationAtCell(e,t,i,s){this._decorations.forEachByKey(t,(t=>{a=t.options.x??0,h=a+(t.options.width??1),e>=a&&e<h&&(!i||(t.options.layer??"bottom")===i)&&s(t)}))}}t.DecorationService=c;class l extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=s.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=s.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new r.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new r.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const s=i(2585),r=i(8343);class n{constructor(...e){this._entries=new Map;for(const[t,i]of e)this.set(t,i)}set(e,t){const i=this._entries.get(e);return this._entries.set(e,t),i}forEach(e){for(const[t,i]of this._entries.entries())e(t,i)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}t.ServiceCollection=n,t.InstantiationService=class{constructor(){this._services=new n,this._services.set(s.IInstantiationService,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){const i=(0,r.getServiceDependencies)(e).sort(((e,t)=>e.index-t.index)),s=[];for(const t of i){const i=this._services.get(t.id);if(!i)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${t.id}.`);s.push(i)}const n=i.length>0?i[0].index:t.length;if(t.length!==n)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${n+1} conflicts with ${t.length} static arguments`);return new e(...[...t,...s])}}},7866:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;const n=i(844),o=i(2585),a={trace:o.LogLevelEnum.TRACE,debug:o.LogLevelEnum.DEBUG,info:o.LogLevelEnum.INFO,warn:o.LogLevelEnum.WARN,error:o.LogLevelEnum.ERROR,off:o.LogLevelEnum.OFF};let h,c=t.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=o.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),h=this}_updateLogLevel(){this._logLevel=a[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)"function"==typeof e[t]&&(e[t]=e[t]())}_log(e,t,i){this._evalLazyOptionalParams(i),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+t,...i)}trace(e,...t){this._logLevel<=o.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=o.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=o.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=o.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=o.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};t.LogService=c=s([r(0,o.IOptionsService)],c),t.setTraceLogger=function(e){h=e},t.traceCall=function(e,t,i){if("function"!=typeof i.value)throw new Error("not supported");const s=i.value;i.value=function(...e){if(h.logLevel!==o.LogLevelEnum.TRACE)return s.apply(this,e);h.trace(`GlyphRenderer#${s.name}(${e.map((e=>JSON.stringify(e))).join(", ")})`);const t=s.apply(this,e);return h.trace(`GlyphRenderer#${s.name} return`,t),t}}},7302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const s=i(8460),r=i(844),n=i(6114);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const o=["normal","bold","100","200","300","400","500","600","700","800","900"];class a extends r.Disposable{constructor(e){super(),this._onOptionChange=this.register(new s.EventEmitter),this.onOptionChange=this._onOptionChange.event;const i={...t.DEFAULT_OPTIONS};for(const t in e)if(t in i)try{const s=e[t];i[t]=this._sanitizeAndValidateOption(t,s)}catch(e){console.error(e)}this.rawOptions=i,this.options={...i},this._setupOptions(),this.register((0,r.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(e,t){return this.onOptionChange((i=>{i===e&&t(this.rawOptions[e])}))}onMultipleOptionChange(e,t){return this.onOptionChange((i=>{-1!==e.indexOf(i)&&t()}))}_setupOptions(){const e=e=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);return this.rawOptions[e]},i=(e,i)=>{if(!(e in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${e}"`);i=this._sanitizeAndValidateOption(e,i),this.rawOptions[e]!==i&&(this.rawOptions[e]=i,this._onOptionChange.fire(e))};for(const t in this.rawOptions){const s={get:e.bind(this,t),set:i.bind(this,t)};Object.defineProperty(this.options,t,s)}}_sanitizeAndValidateOption(e,i){switch(e){case"cursorStyle":if(i||(i=t.DEFAULT_OPTIONS[e]),!function(e){return"block"===e||"underline"===e||"bar"===e}(i))throw new Error(`"${i}" is not a valid value for ${e}`);break;case"wordSeparator":i||(i=t.DEFAULT_OPTIONS[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof i&&1<=i&&i<=1e3)break;i=o.includes(i)?i:t.DEFAULT_OPTIONS[e];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw new Error(`${e} cannot be less than 1, value: ${i}`);break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,4294967295))<0)throw new Error(`${e} cannot be less than 0, value: ${i}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${i}`);break;case"rows":case"cols":if(!i&&0!==i)throw new Error(`${e} must be numeric, value: ${i}`);break;case"windowsPty":i=i??{}}return i}}t.OptionsService=a},2660:function(e,t,i){var s=this&&this.__decorate||function(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},r=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const n=i(2585);let o=t.OscLinkService=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){const t=this._bufferService.buffer;if(void 0===e.id){const i=t.addMarker(t.ybase+t.y),s={data:e,id:this._nextId++,lines:[i]};return i.onDispose((()=>this._removeMarkerFromLink(s,i))),this._dataByLinkId.set(s.id,s),s.id}const i=e,s=this._getEntryIdKey(i),r=this._entriesWithId.get(s);if(r)return this.addLineToLink(r.id,t.ybase+t.y),r.id;const n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(i),data:i,lines:[n]};return n.onDispose((()=>this._removeMarkerFromLink(o,n))),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){const i=this._dataByLinkId.get(e);if(i&&i.lines.every((e=>e.line!==t))){const e=this._bufferService.buffer.addMarker(t);i.lines.push(e),e.onDispose((()=>this._removeMarkerFromLink(i,e)))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){const i=e.lines.indexOf(t);-1!==i&&(e.lines.splice(i,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};t.OscLinkService=o=s([r(0,n.IBufferService)],o)},8343:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;const i="di$target",s="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(e){return e[s]||[]},t.createDecorator=function(e){if(t.serviceRegistry.has(e))return t.serviceRegistry.get(e);const r=function(e,t,n){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(e,t,r){t[i]===t?t[s].push({id:e,index:r}):(t[s]=[{id:e,index:r}],t[i]=t)}(r,e,n)};return r.toString=()=>e,t.serviceRegistry.set(e,r),r}},2585:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const s=i(8343);var r;t.IBufferService=(0,s.createDecorator)("BufferService"),t.ICoreMouseService=(0,s.createDecorator)("CoreMouseService"),t.ICoreService=(0,s.createDecorator)("CoreService"),t.ICharsetService=(0,s.createDecorator)("CharsetService"),t.IInstantiationService=(0,s.createDecorator)("InstantiationService"),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.OFF=5]="OFF"}(r||(t.LogLevelEnum=r={})),t.ILogService=(0,s.createDecorator)("LogService"),t.IOptionsService=(0,s.createDecorator)("OptionsService"),t.IOscLinkService=(0,s.createDecorator)("OscLinkService"),t.IUnicodeService=(0,s.createDecorator)("UnicodeService"),t.IDecorationService=(0,s.createDecorator)("DecorationService")},1480:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const s=i(8460),r=i(225);class n{static extractShouldJoin(e){return 0!=(1&e)}static extractWidth(e){return e>>1&3}static extractCharKind(e){return e>>3}static createPropertyValue(e,t,i=!1){return(16777215&e)<<3|(3&t)<<1|(i?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new s.EventEmitter,this.onChange=this._onChange.event;const e=new r.UnicodeV6;this.register(e),this._active=e.version,this._activeProvider=e}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw new Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(e){let t=0,i=0;const s=e.length;for(let r=0;r<s;++r){let o=e.charCodeAt(r);if(55296<=o&&o<=56319){if(++r>=s)return t+this.wcwidth(o);const i=e.charCodeAt(r);56320<=i&&i<=57343?o=1024*(o-55296)+i-56320+65536:t+=this.wcwidth(i)}const a=this.charProperties(o,i);let h=n.extractWidth(a);n.extractShouldJoin(a)&&(h-=n.extractWidth(i)),t+=h,i=a}return t}charProperties(e,t){return this._activeProvider.charProperties(e,t)}}t.UnicodeService=n}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}var s={};return(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;const t=i(9042),r=i(3236),n=i(844),o=i(5741),a=i(8285),h=i(7975),c=i(7090),l=["cols","rows"];class d extends n.Disposable{constructor(e){super(),this._core=this.register(new r.Terminal(e)),this._addonManager=this.register(new o.AddonManager),this._publicOptions={...this._core.options};const t=e=>this._core.options[e],i=(e,t)=>{this._checkReadonlyOptions(e),this._core.options[e]=t};for(const e in this._core.options){const s={get:t.bind(this,e),set:i.bind(this,e)};Object.defineProperty(this._publicOptions,e,s)}}_checkReadonlyOptions(e){if(l.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new h.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new c.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new a.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const e=this._core.coreService.decPrivateModes;let t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(const t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,i){this._verifyIntegers(e,t,i),this._core.select(e,t,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write("\r\n",t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return t}_verifyIntegers(...e){for(const t of e)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(const t of e)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}e.Terminal=d})(),s})()));

   // xterm fit addon, version 0.10.0
   !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FitAddon=t():e.FitAddon=t()}(self,(()=>(()=>{"use strict";var e={};return(()=>{var t=e;Object.defineProperty(t,"__esModule",{value:!0}),t.FitAddon=void 0,t.FitAddon=class{activate(e){this._terminal=e}dispose(){}fit(){const e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;const t=this._terminal._core;this._terminal.rows===e.rows&&this._terminal.cols===e.cols||(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const e=this._terminal._core,t=e._renderService.dimensions;if(0===t.css.cell.width||0===t.css.cell.height)return;const r=0===this._terminal.options.scrollback?0:e.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(i.getPropertyValue("height")),s=Math.max(0,parseInt(i.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),l=o-(parseInt(n.getPropertyValue("padding-top"))+parseInt(n.getPropertyValue("padding-bottom"))),a=s-(parseInt(n.getPropertyValue("padding-right"))+parseInt(n.getPropertyValue("padding-left")))-r;return{cols:Math.max(2,Math.floor(a/t.css.cell.width)),rows:Math.max(1,Math.floor(l/t.css.cell.height))}}}})(),e})()));

   globalThis.xterm_loaded = true;
}

xterm_export();
// 04-ipc.js
function loadIpc() {
	// @pcos-app-mode native
	modules.ipc = {
		create: function() {
			let id = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			this._ipc[id] = { owner: "root", group: "root", world: false, _listeners: [] };
			return id;
		},
		declareAccess: function(id, access) {
			this._ipc[id] = { ...this._ipc[id], ...access };
		},
		listenFor: function(id) {
			let thatIPC = this._ipc;
			return new Promise(function(resolve) {
				let hasResolved = false;
				return thatIPC[id]._listeners.push(function e(d) {
					if (hasResolved) return;
					hasResolved = true;
					return resolve(d);
				});
			});
		},
		send: function(id, data) {
			try {
				this._ipc[id]._listeners.forEach(listener => listener(data));
			} catch {}
		},
		getIPC: function(id) {
			let ipc = { ...this._ipc[id] };
			ipc._listeners = ipc._listeners.length;
			return ipc;
		},
		_ipc: {}
	}
}
loadIpc();
// 04-websockets.js
function loadWebsocketSupport() {
	let websocketAPI = {
		getHandle: function(url) {
			let handle = Array.from(crypto.getRandomValues(new Uint8Array(64))).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			let websocket = new WebSocket(url);
			websocket.binaryType = "arraybuffer";
			websocketAPI._handles[handle] = {
				ws: websocket,
				acl: {
					owner: handle.slice(0, 16),
					group: handle.slice(0, 16),
					world: true
				}
			};
			return handle;
		},
		send: (arg) => websocketAPI._handles[arg.handle].ws.send(arg.data),
		close: function(handle) {
			if (websocketAPI._handles.hasOwnProperty(handle)) websocketAPI._handles[handle].ws.close();
			delete websocketAPI._handles[handle];
		},
		getInfo: function(handle) {
			return {
				bufferedAmount: websocketAPI._handles[handle].ws.bufferedAmount,
				extensions: websocketAPI._handles[handle].ws.extensions,
				protocol: websocketAPI._handles[handle].ws.protocol,
				readyState: websocketAPI._handles[handle].ws.readyState,
				url: websocketAPI._handles[handle].ws.url
			}
		},
		waitForEvent: function(arg) {
			return new Promise(function(resolve) {
				websocketAPI._handles[arg.handle].ws.addEventListener(arg.eventName, function meName(arg2) {
					if (arg.eventName == "message") resolve(arg2.data);
					else if (arg.eventName == "error") resolve({
						code: arg2.code,
						reason: arg2.reason,
						wasClean: arg2.wasClean
					});
					else resolve(arg.eventName);
					try {
						websocketAPI._handles[arg.handle].ws.removeEventListener(arg.eventName, meName);
					} catch {}
				});
			});
		},
		assertAccess: function(arg) {
			if (arg.newACL) websocketAPI._handles[arg.handle].acl = arg.newACL;
			return websocketAPI._handles[arg.handle].acl;
		},
		websocketState: (handle) => websocketAPI._handles[handle].ws.readyState,
		_handles: {}
	}
	modules.websocket = websocketAPI;
}

loadWebsocketSupport();
// 05-lull.js
function loadLull() {
	let lullSession;
	modules.lull = function() {
		if (lullSession) return;
		let style = document.createElement("style");
		style.innerHTML = `* { cursor: none !important; };`;
		document.head.appendChild(style);
		lullSession = modules.session.mksession();
		modules.session.muteAllSessions();
		modules.session.activateSession(lullSession);
		function wake() {
			removeEventListener("mousemove", wake);
			removeEventListener("click", wake);
			removeEventListener("keydown", wake);
			style.remove();
			modules.session.muteAllSessions();
			modules.session.activateSession(modules.session.systemSession);
			modules.session.rmsession(lullSession);
			lullSession = null;
		}
		addEventListener("mousemove", wake);
		addEventListener("click", wake);
		addEventListener("keydown", wake);
	}
}
loadLull();
// 05-network.js
async function networkd() {
	let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
	let u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, "0")).join("");
	modules.network = { connected: false, address: null, ws: null, runOnClose: Promise.resolve(), _runOnClose: _ => 1 };
	try {
		let config = await modules.fs.read(modules.defaultSystem + "/etc/network.json");
		config = JSON.parse(config);
		function isPacketFiltered(packet) {
			if (!config.filters) return false;
			for (let filter of config.filters) {
				if (filter.type == 0) return filter.result;
				if (filter.type == 1 && isPacketFrom(packet, filter)) return filter.result;
				if (filter.type == 2 && filter.protocol == packet.data.type) return filter.result;
				if (filter.type == 3 && isPacketFrom(packet, filter) && filter.protocol == packet.data.type) return filter.result;
				if (filter.type == 4 && isPacketFrom(packet, filter) &&
					(packet.data.type == "connectionful" || packet.data.type == "connectionless")) {
						if (packet.data.gate == filter.gate) return filter.result;
					}
			}
			return true;
		}
		function isPacketFrom(packet, filter) {
			if (filter.from == packet.from) return true;
			if (filter.ipHash == packet.from.slice(0, 8)) return true;
			if (filter.systemID == packet.from.slice(8, 24)) return true;
			return false;
		}
		modules.network.reloadConfig = async function() {
			config = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/network.json"));
			modules.network.updates = config.updates;
			try {
				ws.send(JSON.stringify({
					finalProxyPacket: true
				}));
				ws.close();
			} catch {
				onclose();
			}
		}
		modules.network.updates = config.updates;
		let stage = 0;
		let pukey = (modules.core.prefs.read("system_id") || {}).public;
		let importedKey = await crypto.subtle.importKey("jwk", (modules.core.prefs.read("system_id") || {}).private, {
			name: "ECDSA",
			namedCurve: "P-256"
		}, true, ["sign"]);
		let ws = new WebSocket(config.url);
		let handle = Array.from(crypto.getRandomValues(new Uint8Array(64))).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
		modules.network.runOnClose = new Promise(a => modules.network._runOnClose = a);
		ws.binaryType = "arraybuffer";
		async function onclose() {
			modules.network.connected = false;
			modules.network.address = null;
			modules.network.hostname = null;
			modules.network._runOnClose();
			ws = new WebSocket(config.url);
			stage = 0;
			ws.onmessage = onmessage;
			ws.onclose = onclose;
			modules.network.runOnClose = new Promise(a => modules.network._runOnClose = a);
		}
		async function onmessage(e) {
			let messageData;
			try {
				messageData = JSON.parse(e.data);
			} catch {
				return;
			}
			if (stage == 0) {
				ws.send(JSON.stringify({ ...pukey, forceConnect: true, userCustomizable: config.ucBits, hostname: config.hostname }));
				stage++;
			} else if (stage == 1) {
				if (messageData.event != "SignatureRequest") {
					ws.onclose = null;
					delete modules.websocket._handles[handle];
					return ws.close();
				}
				ws.send(u8aToHex(new Uint8Array(await crypto.subtle.sign({
					name: "ECDSA",
					hash: {
						name: "SHA-256"
					}
				}, importedKey, hexToU8A(messageData.signBytes)))));
				stage++;
			} else if (stage == 2) {
				if (messageData.event != "ConnectionEstablished") {
					ws.onclose = null;
					delete modules.websocket._handles[handle];
					return ws.close();
				}
				modules.websocket._handles[handle] = {
					ws: ws,
					acl: {
						owner: handle.slice(0, 16),
						group: handle.slice(0, 16),
						world: true
					}
				}
				modules.network.connected = true;
				modules.network.address = messageData.address;
				modules.network.hostname = messageData.hostname;
				modules.network.ws = handle;
				stage++;
			} else if (stage == 3) {
				if (messageData.event == "DisconnectionComplete") {
					modules.network.connected = false;
					modules.network.address = null;
					modules.network.hostname = null;
					modules.network.ws = null;
					modules.network._runOnClose();
					ws.onclose = null;
					delete modules.websocket._handles[handle];
					return ws.close();
				}
				if (messageData.from) {
					if (isPacketFiltered(messageData)) {
						e.stopImmediatePropagation();
						e.preventDefault();
						return false;
					}
					if (messageData.data.type == "ping") {
						if (typeof messageData.data.resend !== "string") return;
						if (messageData.data.resend.length > 64) return;
						ws.send(JSON.stringify({ receiver: messageData.from, data: { type: "pong", resend: messageData.data.resend } }));
					}
				}
			}
		}
		ws.onmessage = onmessage;
		ws.onclose = onclose;
	} catch {
		modules.network.serviceStopped = true;
		modules.core.tty_bios_api.println("network: not starting network");
	}
}
networkd();
// 05-reeapis.js
function reeAPIs() {
	// @pcos-app-mode native

	async function denyUnmanifested(list, token) {
		let privileges = (await modules.tokens.info(token)).privileges;
		let isAllowlist = list.some(a => a.lineType == "allow");
		if (isAllowlist) list = list.filter(a => a.lineType == "allow");
		let disallowedRegistry = [];
		for (let privilege of privileges) {
			if ((!list.some(x => x.data == privilege && x.lineType == "allow") && isAllowlist) || list.some(x => x.data == privilege && x.lineType == "deny")) {
				privileges = privileges.filter(x => x != privilege);
				disallowedRegistry.push(privilege);
			}
		}
		modules.tokens.removePrivileges(token, disallowedRegistry);
		return privileges;
	}

	modules.reeAPIInstance = async function(opts) {
		let {ree, ses, token, taskId, limitations, privateData} = opts;
		let processToken = token;
		let tokenInfo = await modules.tokens.info(token);
		let user = tokenInfo.user;
		let groups = tokenInfo.groups || [];
		let privileges = tokenInfo.privileges;
		let processPipes = [];
		let websockets = [];
		let automatedLogonSessions = {};
		let networkListens = {};
		let connections = {};
		let language = modules.session.attrib(ses, "language") || undefined;
		privileges = await denyUnmanifested(limitations, token);

		async function fs_action(action, privilegeCheck, path, ...xtra) {
			let fsPermissions;
			try {
				fsPermissions = await modules.fs.permissions(path);
			} catch (e) {
				throw new Error("PERMISSION_CHECKING_FAILED");
			}
			if (!privilegeCheck(fsPermissions)) throw new Error("PERMISSION_DENIED");
			try {
				let response = await modules.fs[action](path, ...xtra);
				return response;
			} catch (e) {
				if (e.name == "Error") throw e;
				throw new Error("FS_ACTION_FAILED");
			}
		}
		async function recursiveKeyVerify(key, khrl) {
			if (!key) throw new Error("NO_KEY");
			let u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, "0")).join("");
			let hash = u8aToHex(new Uint8Array(await crypto.subtle.digest("SHA-256", new TextEncoder().encode((key.keyInfo?.key || key.key).x + "|" + (key.keyInfo?.key || key.key).y))));
			let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
			if (khrl.includes(hash)) throw new Error("KEY_REVOKED");
			let signedByKey = modules.ksk_imported;
			if (key.keyInfo && key.keyInfo?.signedBy) {
				signedByKey = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/keys/" + key.keyInfo.signedBy, token));
				if (!signedByKey.keyInfo) throw new Error("NOT_KEYS_V2");
				if (!signedByKey.keyInfo.usages.includes("keyTrust")) throw new Error("NOT_KEY_AUTHORITY");
				await recursiveKeyVerify(signedByKey, khrl);
				signedByKey = await crypto.subtle.importKey("jwk", signedByKey.keyInfo.key, {
					name: "ECDSA",
					namedCurve: "P-256"
				}, false, ["verify"]);
			}
			if (!await crypto.subtle.verify({
				name: "ECDSA",
				hash: {
					name: "SHA-256"
				}
			}, signedByKey, hexToU8A(key.signature), new TextEncoder().encode(JSON.stringify(key.key || key.keyInfo)))) throw new Error("KEY_SIGNATURE_VERIFICATION_FAILED");
			return true;
		}

		ree.beforeCloseDown(async function() {
			for (let processPipe of processPipes) delete modules.ipc._ipc[processPipe];
			for (let connection in connections) try { networkListens[connections[connection].networkListenID].ws.send(JSON.stringify({
				receiver: connections[connection].from,
				data: {
					type: "connectionful",
					action: "drop",
					connectionID: connection.slice(0, -7),
					gate: connections[connection].gateIfNeeded
				}
			})); } catch {}
			for (let networkListen in networkListens) networkListens[networkListen].ws.removeEventListener("message", networkListens[networkListen].fn);
			for (let websocket of websockets) modules.websocket.close(websocket);
			await modules.tokens.revoke(token);
			for (let i in modules.csps) if (modules.csps[i].hasOwnProperty("removeSameGroupKeys")) modules.csps[i].removeSameGroupKeys(null, taskId);
		});
		let apis = {
			private: {
				setUser: async function(newUser) {
					user = newUser;
					groups = (await modules.users.getUserInfo(newUser, false, token || processToken)).groups || [];
				},
				addPrivilege: (newPrivilege) => !privileges.includes(newPrivilege) && privileges.push(newPrivilege),
				rmPrivilege: (newPrivilege) => privileges.includes(newPrivilege) && privileges.splice(privileges.indexOf(newPrivilege), 1),
				setPrivileges: (newPrivileges) => privileges = newPrivileges,
				reauthorize: async function() {
					let tokenInfo = await modules.tokens.info(token);
					user = tokenInfo.user;
					groups = tokenInfo.groups || [];
					privileges = tokenInfo.privileges;
					privileges = await denyUnmanifested(limitations, token);
				}
			},
			public: {
				getUser: () => user,
				getPrivileges: () => privileges,
				terminate: async function() {
					await ree.closeDown();
				},
				rmPrivilege: async function(privilege) {
					if (!privileges.includes(privilege)) throw new Error("NO_SUCH_PRIVILEGE");
					privileges.splice(privileges.indexOf(privilege), 1);
					await modules.tokens.removePrivilege(token, privilege);
					return true;
				},
				rmPrivileges: async function(privilegesRemoved) {
					privileges = privileges.filter(x => !privilegesRemoved.includes(x));
					await modules.tokens.removePrivileges(token, privilegesRemoved);
					return true;
				},
				switchUser: async function(desiredUser) {
					if (!privileges.includes("SWITCH_USERS_AUTOMATICALLY")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.tokens.halfInitialize(token, desiredUser);
					let tokenInfo = await modules.tokens.info(token);
					user = tokenInfo.user;
					groups = tokenInfo.groups || [];
					return true;
				},
				shutdown: async function(arg) {
					let {isKexec, isReboot, force, token} = arg;
					if (!privileges.includes("SYSTEM_SHUTDOWN")) throw new Error("UNAUTHORIZED_ACTION");
					if (force) {
						try { modules.websocket._handles[modules.network.ws].ws.close(); } catch {}
						modules.session.destroy();
						if (isReboot) return location.reload();
						return modules.killSystem();
					}
					await modules.restart(!isReboot, token || processToken, isKexec);
					return true;
				},
				fs_read: async function(arg) {
					let {path, token} = arg;
					if (!privileges.includes("FS_READ")) throw new Error("UNAUTHORIZED_ACTION");
					return await fs_action("read", (fsPermissions) => fsPermissions.owner == user || fsPermissions.world.includes("r") || groups.includes(fsPermissions.group) || privileges.includes("FS_BYPASS_PERMISSIONS"), path, token || processToken);
				},
				fs_ls: async function(arg) {
					let {path, token} = arg;
					if (!privileges.includes("FS_READ")) throw new Error("UNAUTHORIZED_ACTION");
					return await fs_action("ls",
					(fsPermissions) =>
						fsPermissions.owner == user ||
						groups.includes(fsPermissions.group) ||
						(fsPermissions.world.includes("r") &&
						fsPermissions.world.includes("x")) || privileges.includes("FS_BYPASS_PERMISSIONS"), path, token || processToken);
				},
				fs_write: async function(arg) {
					if (!privileges.includes("FS_WRITE")) throw new Error("UNAUTHORIZED_ACTION");
					let {path, data, token} = arg;
					let pathParent = path.split("/").slice(0, -1).join("/");
					let basename = path.split("/").slice(-1)[0];
					let isCreating = false;
					let fsParentPermissions;
					try {
						if (!(await modules.fs.ls(pathParent, token || processToken)).includes(basename)) isCreating = true;
					} catch (e) {
						throw new Error("CREATION_CHECK_FAILED");
					}

					try {
						fsParentPermissions = await modules.fs.permissions(pathParent, token || processToken);
					} catch (e) {
						throw new Error("PERMISSION_CHECKING_FAILED");
					}
					if (!fsParentPermissions.world.includes("w") && fsParentPermissions.owner != user && !groups.includes(fsParentPermissions.group) && !privileges.includes("FS_BYPASS_PERMISSIONS")) throw new Error("PERMISSION_DENIED");
					
					if (isCreating) {
						try {
							await modules.fs.chown(path, user, token || processToken);
							await modules.fs.chgrp(path, groups[0], token || processToken);
							await modules.fs.chmod(path, "r", token || processToken);
						} catch (e) {
							if (e.name == "Error") throw e;
							throw new Error("PERMISSION_CHANGE_FAILED");
						}
					}
					return await fs_action("write", (fsPermissions) => fsPermissions.owner == user || groups.includes(fsPermissions.group) || fsPermissions.world.includes("w") || privileges.includes("FS_BYPASS_PERMISSIONS"), path, data, token || processToken);
				},
				fs_rm: async function(arg) {
					let {path, token} = arg;
					if (!privileges.includes("FS_REMOVE")) throw new Error("UNAUTHORIZED_ACTION");
					return await fs_action("rm", (fsPermissions) => fsPermissions.owner == user || privileges.includes("FS_BYPASS_PERMISSIONS"), path, token);
				},
				fs_mkdir: async function(arg) {
					let {path, token} = arg;
					if (!privileges.includes("FS_WRITE")) throw new Error("UNAUTHORIZED_ACTION");
					let pathParent = path.split("/").slice(0, -1).join("/");
					let fsPermissions;
					try {
						fsPermissions = await modules.fs.permissions(pathParent, token || processToken);
					} catch (e) {
						throw new Error("PERMISSION_CHECKING_FAILED");
					}
					if (!fsPermissions.world.includes("w") && fsPermissions.owner != user && !groups.includes(fsPermissions.group) && !privileges.includes("FS_BYPASS_PERMISSIONS")) throw new Error("PERMISSION_DENIED");
					try {
						await modules.fs.chown(path, user, token || processToken);
						await modules.fs.chgrp(path, groups[0] || user, token || processToken);
						await modules.fs.chmod(path, "rx", token || processToken);
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("PERMISSION_CHANGE_FAILED");
					}
					try {
						return await modules.fs.mkdir(path, token || processToken);
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("FS_ACTION_FAILED");
					}
				},
				fs_chown: async function(arg) {
					if (!privileges.includes("FS_CHANGE_PERMISSION")) throw new Error("UNAUTHORIZED_ACTION");
					let {path, newUser, token} = arg;
					return await fs_action("chown", (fsPermissions) => fsPermissions.owner == user || privileges.includes("FS_BYPASS_PERMISSIONS"), path, newUser, token || processToken);
				},
				fs_chgrp: async function(arg) {
					if (!privileges.includes("FS_CHANGE_PERMISSION")) throw new Error("UNAUTHORIZED_ACTION");
					let {path, newGrp, token} = arg;
					return await fs_action("chgrp", (fsPermissions) => fsPermissions.owner == user || privileges.includes("FS_BYPASS_PERMISSIONS"), path, newGrp, token || processToken);
				},
				fs_chmod: async function(arg) {
					if (!privileges.includes("FS_CHANGE_PERMISSION")) throw new Error("UNAUTHORIZED_ACTION");
					let {path, newPermissions, token} = arg;
					return await fs_action("chmod", (fsPermissions) => fsPermissions.owner == user || privileges.includes("FS_BYPASS_PERMISSIONS"), path, newPermissions, token || processToken);
				},
				fs_permissions: async function(arg) {
					let {path, token} = arg;
					if (!privileges.includes("FS_READ")) throw new Error("UNAUTHORIZED_ACTION");
					let pathParent = path.split("/").slice(0, -1).join("/");
					if (pathParent != "") {
						let fsPermissions;
						try {
							fsPermissions = await modules.fs.permissions(pathParent, token || processToken);
						} catch (e) {
							throw new Error("PERMISSION_CHECKING_FAILED");
						}
						if (!fsPermissions.world.includes("r") && fsPermissions.owner != user && !privileges.includes("FS_BYPASS_PERMISSIONS")) throw new Error("PERMISSION_DENIED");
					}
					return await fs_action("permissions", () => true, path, token || processToken);
				},
				fs_mounts: async function() {
					if (!privileges.includes("FS_LIST_PARTITIONS")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						return await modules.fs.lsmounts();
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("FS_ACTION_FAILED");
					}
				},
				fs_sync: async function(arg) {
					let {mount, token} = arg;
					if (!privileges.includes("FS_UNMOUNT")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						return await modules.fs.sync(mount, token || processToken);
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("FS_ACTION_FAILED");
					}
				},
				fs_unmount: async function(arg) {
					let {mount, token, force} = arg;
					if (!privileges.includes("FS_UNMOUNT")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						return await modules.fs.unmount(mount, token || processToken, force);
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("FS_ACTION_FAILED");
					}
				},
				fs_mountInfo: async function(mount) {
					if (!privileges.includes("FS_LIST_PARTITIONS")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						return await modules.fs.mountInfo(mount);
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("FS_ACTION_FAILED");
					}
				},
				getSystemMount: async function() {
					if (!privileges.includes("FS_LIST_PARTITIONS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.defaultSystem;
				},
				createPipe: async function() {
					if (!privileges.includes("IPC_CREATE_PIPE")) throw new Error("UNAUTHORIZED_ACTION");
					let pipe = await modules.ipc.create();
					modules.ipc.declareAccess(pipe, {
						owner: user,
						group: groups[0],
						world: false
					});
					processPipes.push(pipe);
					return pipe;
				},
				listenToPipe: async function(pipe) {
					if (!privileges.includes("IPC_LISTEN_PIPE")) throw new Error("UNAUTHORIZED_ACTION");
					let permissions = await modules.ipc.getIPC(pipe);
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("IPC_BYPASS_PERMISSIONS") && !processPipes.includes(pipe)) throw new Error("PERMISSION_DENIED");
					return await modules.ipc.listenFor(pipe);
				},
				sendToPipe: async function(dataSend) {
					if (!privileges.includes("IPC_SEND_PIPE")) throw new Error("UNAUTHORIZED_ACTION");
					let {pipe, data} = dataSend;
					let permissions = await modules.ipc.getIPC(pipe);
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("IPC_BYPASS_PERMISSIONS") && !processPipes.includes(pipe)) throw new Error("PERMISSION_DENIED");
					return await modules.ipc.send(pipe, data);
				},
				closePipe: async function(pipe) {
					if (!processPipes.includes(pipe)) throw new Error("NOT_OWN_PIPE");
					processPipes.splice(processPipes.indexOf(pipe), 1);
					return delete modules.ipc._ipc[pipe];
				},
				setPipePermissions: async function(opts) {
					if (!privileges.includes("IPC_CHANGE_PERMISSION")) throw new Error("UNAUTHORIZED_ACTION");
					let {pipe, newPermissions} = opts;
					let permissions = await modules.ipc.getIPC(pipe);
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("IPC_BYPASS_PERMISSIONS") && !processPipes.includes(pipe)) throw new Error("PERMISSION_DENIED");
					return await modules.ipc.declareAccess(pipe, newPermissions);
				},
				elevate: async function(newPrivileges) {
					newPrivileges = newPrivileges.filter(privilege => !privileges.includes(privilege));
					newPrivileges = Array.from(new Set(newPrivileges));
					if (!privileges.includes("SWITCH_USERS_AUTOMATICALLY")) throw new Error("UNAUTHORIZED_ACTION");
					privileges.push(...newPrivileges);
					await modules.tokens.addPrivileges(token, newPrivileges);
					privileges = await denyUnmanifested(limitations, token);
					return true;
				},
				getVersion: function() {
					if (!privileges.includes("GET_BUILD")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.pcos_version;
				},
				locale: function() {
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return language || navigator.languages[0].split("-")[0].toLowerCase();
				},
				osLocale: function() {
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.locales.get("OS_LOCALE", language);
				},
				getUserInfo: async function(arg) {
					let {desiredUser, token, sensitive} = arg;
					if (!privileges.includes("GET_USER_INFO")) throw new Error("UNAUTHORIZED_ACTION");
					if (desiredUser != user && !privileges.includes("USER_INFO_OTHERS")) throw new Error("UNAUTHORIZED_ACTION");
					if (sensitive && desiredUser != user && !privileges.includes("SENSITIVE_USER_INFO_OTHERS")) throw new Error("PERMISSION_DENIED");
					return await modules.users.getUserInfo(desiredUser, sensitive, token || processToken);
				},
				setUserInfo: async function(arg) {
					let {desiredUser, token, info} = arg;
					if (!privileges.includes("SET_USER_INFO")) throw new Error("UNAUTHORIZED_ACTION");
					return await modules.users.moduser(desiredUser, info, token || processToken);
				},
				setOwnSecurityChecks: async function(arg) {
					let {token, checks} = arg;
					if (!privileges.includes("SET_SECURITY_CHECKS")) throw new Error("UNAUTHORIZED_ACTION");
					let allowedTypes = [ "pbkdf2", "informative", "informative_deny", "timeout", "timeout_deny", "serverReport", "pc-totp", "totp", "workingHours", "zkpp" ];
					let sanitizedChecks = [];
					checks.filter(a => allowedTypes.includes(a.type));
					for (let checkIndex in checks) {
						let check = checks[checkIndex];
						if (check.type == "pbkdf2") {
							if (!check.salt || !check.hash) continue;
							check = { type: "pbkdf2", salt: check.salt, hash: check.hash };
						} else if (check.type == "informative" || check.type == "informative_deny") {
							if (!check.message) continue;
							check = { type: check.type, message: check.message };
						} else if (check.type == "timeout" || check.type == "timeout_deny") {
							if (!check.timeout) continue;
							check = { type: check.type, timeout: check.timeout };
						} else if (check.type == "serverReport") {
							if (!check.url) continue;
							check = { type: "serverReport", url: check.url };
						} else if (check.type == "pc-totp" || check.type == "totp") {
							if (!check.secret) continue;
							check = { type: check.type, secret: check.secret };
						} else if (check.type == "workingHours") {
							if (!check.start || !check.end) continue;
							if (typeof check.start.hours !== "number" || typeof check.start.minutes !== "number" || typeof check.start.seconds !== "number") continue;
							if (typeof check.end.hours !== "number" || typeof check.end.minutes !== "number" || typeof check.end.seconds !== "number") continue;
							check = {
								type: "workingHours",
								start: {
									hours: check.start.hours,
									minutes: check.start.minutes,
									seconds: check.start.seconds
								},
								end: {
									hours: check.end.hours,
									minutes: check.end.minutes,
									seconds: check.end.seconds
								}
							};
						} else if (check.type == "zkpp") {
							if (!check.publicKey) continue;
							check = { type: "zkpp", publicKey: check.publicKey };
						}
						sanitizedChecks.push(check);
					}
					let previousUserInfo = await modules.users.getUserInfo(user, false, token || processToken);
					await modules.users.moduser(user, { ...previousUserInfo, securityChecks: sanitizedChecks }, token || processToken);
					return true;
				},
				getNewToken: async function(desiredUser) {
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.session.attrib(ses, "secureLock")) await modules.session.attrib(ses, "secureLock");
					if (modules.session.active != ses) throw new Error("TRY_AGAIN_LATER");
					let releaseLock;
					let lock = new Promise((resolve) => releaseLock = resolve);
					modules.session.attrib(ses, "secureLock", lock);
					let secureSession = await modules.session.mksession();
					modules.session.attrib(ses, "secureID", secureSession);
					modules.session.attrib(secureSession, "language", language);

					let dom = modules.session.tracker[secureSession].html;
					let ogDom = modules.session.tracker[ses].html;
					let bgfx = document.createElement("div");
					bgfx.classList.add("session", "secure");
					dom.appendChild(bgfx);
					modules.session.attrib(secureSession, "dark", modules.session.attrib(ses, "dark"));
					dom.style.background = ogDom.style.background;
					dom.style.backgroundSize = "100% 100%";

					modules.session.muteAllSessions();
					modules.session.activateSession(secureSession);

					try {
						let logonUI = await modules.authui(secureSession, desiredUser);
						return new Promise(function(resolve) {
							logonUI.hook(async function(result) {
								releaseLock();
								modules.session.attrib(ses, "secureLock", null);
								modules.session.attrib(ses, "secureID", null);
								modules.session.muteAllSessions();
								modules.session.rmsession(secureSession);
								modules.session.activateSession(ses);
								if (result.success == false) return resolve(false);
								return resolve(result.token);
							});
						});
					} catch (e) {
						console.error("authui:", e);
						releaseLock();
						modules.session.attrib(ses, "secureLock", null);
						modules.session.attrib(ses, "secureID", null);
						modules.session.muteAllSessions();
						modules.session.rmsession(secureSession);
						modules.session.activateSession(ses);
						return false;
					}
				},
				getProcessToken: () => processToken,
				setProcessToken: async function(desiredToken) {
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					let validation = await modules.tokens.validate(desiredToken, {});
					if (!validation) throw new Error("INVALID_TOKEN");
					token = processToken = desiredToken;
					let tokenInfo = await modules.tokens.info(token);
					user = tokenInfo.user;
					groups = tokenInfo.groups || [];
					privileges = tokenInfo.privileges;
					privileges = await denyUnmanifested(limitations, token);
					return true;
				},
				revokeToken: function(dt) {
					if (!privileges.includes("MANAGE_TOKENS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.tokens.revoke(dt || processToken);
				},
				forkToken: function(dt) {
					if (!privileges.includes("MANAGE_TOKENS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.tokens.fork(dt || processToken);
				},
				removeTokenPrivilege: async function(arg) {
					let {token, privilege} = arg;
					if (!privileges.includes("MANAGE_TOKENS")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.tokens.removePrivilege(token, privilege);
					return true;
				},
				removeTokenPrivileges: async function(arg) {
					let {token} = arg;
					if (!privileges.includes("MANAGE_TOKENS")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.tokens.removePrivileges(token, arg.privileges);
					return true;
				},
				estimateStorage: async function() {
					if (!privileges.includes("FS_LIST_PARTITIONS")) throw new Error("UNAUTHORIZED_ACTION");
					let estimate = await navigator.storage.estimate();
					return {
						internal: {
							used: estimate.usage,
							free: estimate.quota - estimate.usage,
							total: estimate.quota
						}
					};
				},
				startTask: async function(arg) {
					let {file, argPassed, token, runInBackground, silent, privateData} = arg;
					if (!privileges.includes("START_TASK")) throw new Error("UNAUTHORIZED_ACTION");
					if (runInBackground && !privileges.includes("START_BACKGROUND_TASK")) throw new Error("UNAUTHORIZED_ACTION");
					if (!token) token = await modules.tokens.fork(processToken);
					try {
						return await modules.tasks.exec(file, argPassed, modules.window(runInBackground ? modules.serviceSession : ses), token, silent, privateData);
					} catch (e) {
						if (e.name == "Error") throw e;
						throw new Error("UNABLE_TO_START_TASK");
					}
				},
				listTasks: async function() {
					if (!privileges.includes("LIST_TASKS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.tasks.listPublicTasks();
				},
				taskInfo: async function(taskId) {
					if (!privileges.includes("LIST_TASKS")) throw new Error("UNAUTHORIZED_ACTION");
					return await modules.tasks.taskInfo(taskId);
				},
				signalTask: async function(arg) {
					let {taskId, signal} = arg;
					if (!privileges.includes("SIGNAL_TASK")) throw new Error("UNAUTHORIZED_ACTION");
					if (!privileges.includes("TASK_BYPASS_PERMISSIONS")) {
						let taskInfo = await modules.tasks.taskInfo(taskId);
						if (taskInfo.runBy != user) throw new Error("PERMISSION_DENIED");
					}
					return await modules.tasks.sendSignal(taskId, signal);
				},
				lookupLocale: function(key) {   
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.locales.get(key, language);
				},
				lookupOtherLocale: function(arg) {
					let {key, locale} = arg;   
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.locales.get(key, locale);
				},
				ufTimeInc: function(args) {
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.userfriendliness.inconsiderateTime(language, ...args);
				},
				ufInfoUnits: function(args) {
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.userfriendliness.informationUnits(language, ...args)
				},
				isDarkThemed: function() {
					if (!privileges.includes("GET_THEME")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.session.attrib(ses, "dark")
				},
				fetchSend: async function(arg) {
					if (!privileges.includes("FETCH_SEND")) throw new Error("UNAUTHORIZED_ACTION");
					let {url, init} = arg;
					let fetc = await fetch(url, init);
					let responseAB;
					if (init.mode != "no-cors" && !init.noArrayBuffer) responseAB = await fetc.arrayBuffer();
					return {
						status: fetc.status,
						statusText: fetc.statusText,
						ok: fetc.ok,
						redirected: fetc.redirected,
						type: fetc.type,
						url: fetc.url,
						headers: Object.fromEntries(Array.from(fetc.headers)),
						arrayBuffer: responseAB,
					};
				},
				switchUserWithSetup: async function(desiredUser) {
					if (!privileges.includes("SWITCH_USERS_AUTOMATICALLY")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.tokens.userInitialize(token, desiredUser);
					let tokenInfo = await modules.tokens.info(token);
					user = tokenInfo.user;
					groups = tokenInfo.groups || [];
					privileges = tokenInfo.privileges;
					privileges = await denyUnmanifested(limitations, token);
					return true;
				},
				runKlvlCode: async function(code) {
					if (!privileges.includes("RUN_KLVL_CODE")) throw new Error("UNAUTHORIZED_ACTION");
					return eval(code);
				},
				cspOperation: async function(arg) {
					if (!privileges.includes("CSP_OPERATIONS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.csps[arg.cspProvider][arg.operation](arg.cspArgument, taskId);
				},
				availableCsps: async function() {
					if (!privileges.includes("CSP_OPERATIONS")) throw new Error("UNAUTHORIZED_ACTION");
					return Object.keys(modules.csps);
				},
				ufTimeCon: function(args) {
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.userfriendliness.considerateTime(language, ...args);
				},
				websocketOpen: async function(arg) {
					if (!privileges.includes("WEBSOCKETS_OPEN")) throw new Error("UNAUTHORIZED_ACTION");
					let handle = await modules.websocket.getHandle(arg);
					websockets.push(handle);
					modules.websocket.assertAccess({ handle, newACL: {
						owner: user,
						group: groups[0],
						world: false
					}});
					return handle;
				},
				listenToWebsocket: async function(arg) {
					if (!privileges.includes("WEBSOCKETS_LISTEN")) throw new Error("UNAUTHORIZED_ACTION");
					let permissions = modules.websocket.assertAccess({ handle: arg.handle });
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("WEBSOCKET_BYPASS_PERMISSIONS") && !websockets.includes(arg.handle)) throw new Error("PERMISSION_DENIED");
					return await modules.websocket.waitForEvent(arg);
				},
				sendToWebsocket: async function(arg) {
					if (!privileges.includes("WEBSOCKETS_SEND")) throw new Error("UNAUTHORIZED_ACTION");
					let permissions = modules.websocket.assertAccess({ handle: arg.handle });
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("WEBSOCKET_BYPASS_PERMISSIONS") && !websockets.includes(arg.handle)) throw new Error("PERMISSION_DENIED");
					return await modules.websocket.send(arg);
				},
				closeWebsocket: async function(websocket) {
					if (!websockets.includes(websocket)) throw new Error("NOT_OWN_WEBSOCKET");
					websockets.splice(websockets.indexOf(websocket), 1);
					return modules.websocket.close(websocket);
				},
				websocketInfo: async function(arg) {
					if (!privileges.includes("WEBSOCKET_INFO")) throw new Error("UNAUTHORIZED_ACTION");
					let permissions = modules.websocket.assertAccess({ handle: arg.handle });
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("WEBSOCKET_BYPASS_PERMISSIONS") && !websockets.includes(arg.handle)) throw new Error("PERMISSION_DENIED");
					return await modules.websocket.getInfo(arg);
				},
				setWebsocketPermissions: async function(arg) {
					if (!privileges.includes("WEBSOCKET_SET_PERMISSIONS")) throw new Error("UNAUTHORIZED_ACTION");
					let permissions = modules.websocket.assertAccess({ handle: arg.handle });
					if (permissions.owner != user && !groups.includes(permissions.group) && !permissions.world && !privileges.includes("WEBSOCKET_BYPASS_PERMISSIONS") && !websockets.includes(arg.handle)) throw new Error("PERMISSION_DENIED");
					return await modules.websocket.assertAccess(arg);
				},
				getPublicSystemID: async function() {
					if (!privileges.includes("IDENTIFY_SYSTEM")) throw new Error("UNAUTHORIZED_ACTION");
					return (modules.core.prefs.read("system_id") || {}).public;
				},
				getPrivateSystemID: async function() {
					if (!privileges.includes("IDENTIFY_SYSTEM_SENSITIVE")) throw new Error("UNAUTHORIZED_ACTION");
					return (modules.core.prefs.read("system_id") || {}).private;
				},
				typeIntoOtherCLI: async function(arg) {
					if (!privileges.includes("CLI_MODIFICATIONS")) throw new Error("UNAUTHORIZED_ACTION");
					if (!modules.tasks.tracker.hasOwnProperty(arg.taskId)) throw new Error("TASK_NOT_FOUND");
					let bypassWorks = modules.tasks.tracker[arg.taskId].apis.public.getProcessToken() == arg.bypass;
					if (!bypassWorks) {
						let taskInfo = await modules.tasks.taskInfo(arg.taskId);
						if (taskInfo.runBy != user && !privileges.includes("TASK_BYPASS_PERMISSIONS")) throw new Error("PERMISSION_DENIED");
					}
					if (!modules.tasks.tracker[arg.taskId].cliio) throw new Error("NO_CLI_ATTACHED");
					return await modules.tasks.tracker[arg.taskId].cliio.xtermInstance.input(arg.text, arg.human);
				},
				getOtherCLIData: async function(arg) {
					if (!privileges.includes("CLI_MODIFICATIONS")) throw new Error("UNAUTHORIZED_ACTION");
					if (!modules.tasks.tracker.hasOwnProperty(arg.taskId)) throw new Error("TASK_NOT_FOUND");
					let bypassWorks = modules.tasks.tracker[arg.taskId].apis.public.getProcessToken() == arg.bypass;
					if (!bypassWorks) {
						let taskInfo = await modules.tasks.taskInfo(arg.taskId);
						if (taskInfo.runBy != user && !privileges.includes("TASK_BYPASS_PERMISSIONS")) throw new Error("PERMISSION_DENIED");
					}
					if (!modules.tasks.tracker[arg.taskId].cliio) throw new Error("NO_CLI_ATTACHED");
					return await modules.tasks.tracker[arg.taskId].cliio.signup();
				},
				waitForOtherCLI: async function(arg) {
					if (!privileges.includes("CLI_MODIFICATIONS")) throw new Error("UNAUTHORIZED_ACTION");
					if (!modules.tasks.tracker.hasOwnProperty(arg.taskId)) throw new Error("TASK_NOT_FOUND");
					let bypassWorks = modules.tasks.tracker[arg.taskId].apis.public.getProcessToken() == arg.bypass;
					if (!bypassWorks) {
						let taskInfo = await modules.tasks.taskInfo(arg.taskId);
						if (taskInfo.runBy != user && !privileges.includes("TASK_BYPASS_PERMISSIONS")) throw new Error("PERMISSION_DENIED");
					}
					if (modules.tasks.tracker[arg.taskId].cliio) return true;
					return await modules.tasks.tracker[arg.taskId].cliio.attachedCLISignUp();
				},
				lldaRead: async function(arg) {
					if (!privileges.includes("LLDISK_READ")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.disk.partition(arg.partition).getData();
				},
				lldaWrite: async function(arg) {
					if (!privileges.includes("LLDISK_WRITE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.disk.partition(arg.partition).setData(arg.data);
				},
				lldaList: async function() {
					if (!privileges.includes("LLDISK_LIST_PARTITIONS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.disk.partitions();
				},
				lldaInitPartitions: async function() {
					if (!privileges.includes("LLDISK_INIT_PARTITIONS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.disk.insertPartitionTable();
				},
				lldaRemove: async function(arg) {
					if (!privileges.includes("LLDISK_REMOVE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.disk.partition(arg.partition).remove();
				},
				lldaIDBRead: async function(arg) {
					if (!privileges.includes("LLDISK_IDB_READ")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.idb.readPart(arg.key);
				},
				lldaIDBWrite: async function(arg) {
					if (!privileges.includes("LLDISK_IDB_WRITE")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.core.idb.writePart(arg.key, arg.value);
				},
				lldaIDBRemove: async function(arg) {
					if (!privileges.includes("LLDISK_IDB_REMOVE")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.core.idb.removePart(arg.key);
				},
				lldaIDBList: async function() {
					if (!privileges.includes("LLDISK_IDB_LIST")) throw new Error("UNAUTHORIZED_ACTION"); 
					return modules.core.idb.listParts(); 
				},
				lldaIDBSync: async function() {
					if (!privileges.includes("LLDISK_IDB_SYNC")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.core.idb.sync();
				},
				fs_mount: async function(arg) {
					if (!privileges.includes("FS_MOUNT")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.fs.mounts[arg.mountpoint]) throw new Error("MOUNT_EXISTS");
					modules.fs.mounts[arg.mountpoint] = await modules.mounts[arg.filesystem](arg.filesystemOptions);
				},
				supportedFilesystems: async function() {
					if (!privileges.includes("GET_FILESYSTEMS")) throw new Error("UNAUTHORIZED_ACTION");
					return Object.keys(modules.mounts);
				},
				installedLocales: async function() {
					if (!privileges.includes("GET_LOCALE")) throw new Error("UNAUTHORIZED_ACTION");
					return Object.keys(modules.locales).filter(a => a != "get" && a != "defaultLocale");
				},
				runningServer: async function() {
					if (!privileges.includes("GET_SERVER_URL")) throw new Error("UNAUTHORIZED_ACTION");
					return location.origin;
				},
				fs_isDirectory: async function(arg) {
					if (!privileges.includes("FS_READ")) throw new Error("UNAUTHORIZED_ACTION");
					let {path, token} = arg;
					return await fs_action("isDirectory", (fsPermissions) => fsPermissions.owner == user || fsPermissions.world.includes("r") || groups.includes(fsPermissions.group) || privileges.includes("FS_BYPASS_PERMISSIONS"), path, token || processToken);
				},
				automatedLogonCreate: async function(arg) {
					let { desiredUser, token } = arg;
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					let automatedLogon = Array.from(crypto.getRandomValues(new Uint8Array(64))).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
					try {
						let access = await modules.users.access(desiredUser, token || processToken);
						access = await access.getNextPrompt();
						automatedLogonSessions[automatedLogon] = access;
					} catch {
						throw new Error("AUTOMATED_LOGON_CREATE_FAILED")
					}
					return automatedLogon;
				},
				automatedLogonGet: async function(arg) {
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						let sharedObj = { ...automatedLogonSessions[arg] };
						delete sharedObj.input;
						return sharedObj;
					} catch (e) {
						throw new Error("AUTOMATED_LOGON_GET_FAILED");
					}
				},
				automatedLogonInput: async function(arg) {
					let { session, input } = arg;
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						automatedLogonSessions[session] = await automatedLogonSessions[session].input(input);
					} catch {
						throw new Error("AUTOMATED_LOGON_INPUT_FAILED");
					}
				},
				automatedLogonDelete: async function(arg) {
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					delete automatedLogonSessions[arg];
				},
				setSystemMount: async function(arg) {
					if (!privileges.includes("SET_DEFAULT_SYSTEM")) throw new Error("UNAUTHORIZED_ACTION");
					modules.defaultSystem = arg;
				},
				usedRAM: async function() {
					if (!privileges.includes("GET_SYSTEM_RESOURCES")) throw new Error("UNAUTHORIZED_ACTION");
					try {
						let mem = performance.memory;
						return {
							total: mem.jsHeapSizeLimit,
							used: mem.usedJSHeapSize,
							free: mem.jsHeapSizeLimit - mem.usedJSHeapSize
						}
					} catch {}
					let mem = await performance.measureUserAgentSpecificMemory();
					return {
						total: Infinity,
						used: mem.bytes,
						free: Infinity
					}
				},
				checkBootMode: async function() {
					if (!privileges.includes("GET_BOOT_MODE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.core.bootMode || "normal";
				},
				getScreenInfo: async function() {
					if (!privileges.includes("GET_SCREEN_INFO")) throw new Error("UNAUTHORIZED_ACTION");
					return {
						width: document.documentElement.clientWidth,
						height: document.documentElement.clientHeight,
						colorDepth: screen.colorDepth,
						orientation: {
							type: screen.orientation.type,
							angle: screen.orientation.angle
						},
						fullWidth: screen.width,
						fullHeight: screen.height,
						availWidth: screen.availWidth,
						availHeight: screen.availHeight,
					}
				},
				waitTermination: async function(arg) {
					if (!privileges.includes("LIST_TASKS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.tasks.waitTermination(arg);
				},
				consentGetToken: async function(params) {
					if (!privileges.includes("ELEVATE_PRIVILEGES")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.session.attrib(ses, "secureLock")) await modules.session.attrib(ses, "secureLock");
					if (modules.session.active != ses) throw new Error("TRY_AGAIN_LATER");
					let { desiredUser, intent } = params;
					if (!intent) throw new Error("INTENT_REQUIRED");
					let releaseLock;
					let lock = new Promise((resolve) => releaseLock = resolve);
					modules.session.attrib(ses, "secureLock", lock);
					let secureSession = await modules.session.mksession();
					modules.session.attrib(ses, "secureID", secureSession);
					modules.session.attrib(secureSession, "language", language);

					let dom = modules.session.tracker[secureSession].html;
					let ogDom = modules.session.tracker[ses].html;
					let bgfx = document.createElement("div");
					bgfx.classList.add("session", "secure");
					dom.appendChild(bgfx);
					modules.session.attrib(secureSession, "dark", modules.session.attrib(ses, "dark"));
					dom.style.background = ogDom.style.background;
					dom.style.backgroundSize = "100% 100%";

					modules.session.muteAllSessions();
					modules.session.activateSession(secureSession);
					let task = await modules.tasks.taskInfo(taskId);

					try {
						let logonUI = await modules.consentui(secureSession, {
							user: desiredUser,
							path: task.file,
							args: task.arg,
							intent,
							name: params.name
						});
						return new Promise(function(resolve) {
							logonUI.hook(async function(result) {
								releaseLock();
								modules.session.attrib(ses, "secureLock", null);
								modules.session.attrib(ses, "secureID", null);
								modules.session.muteAllSessions();
								modules.session.rmsession(secureSession);
								modules.session.activateSession(ses);
								if (result.success == false) return resolve(false);
								return resolve(result.token);
							});
						});
					} catch (e) {
						console.error("consentui:", e);
						releaseLock();
						modules.session.attrib(ses, "secureLock", null);
						modules.session.attrib(ses, "secureID", null);
						modules.session.muteAllSessions();
						modules.session.rmsession(secureSession);
						modules.session.activateSession(ses);
						return false;
					}
				},
				networkPing: async function(address) {
					if (!privileges.includes("PCOS_NETWORK_PING")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					return Promise.race([ new Promise(async function(resolve, reject) {
						let networkListenID = Array.from(crypto.getRandomValues(new Uint8Array(64))).map(a => a.toString(16).padStart(2, "0")).join("");
						let packetId = Array.from(crypto.getRandomValues(new Uint8Array(32))).map(a => a.toString(16).padStart(2, "0")).join("");
						let resend = Array.from(crypto.getRandomValues(new Uint8Array(32))).map(a => a.toString(16).padStart(2, "0")).join("");
						function eventListener(e) {
							try {
								let packet = JSON.parse(e.data);
								if (packet.packetID == packetId && packet.event == "AddressUnreachable") {
									reject(new Error("ADDRESS_UNREACHABLE"));
									delete networkListens[networkListenID];
									websocket.removeEventListener("message", eventListener);
								}
								if (packet.from == address && packet.data.type == "pong" && packet.data.resend == resend) {
									resolve("success");
									delete networkListens[networkListenID];
									websocket.removeEventListener("message", eventListener);
								}
							} catch {}
						}
						networkListens[networkListenID] = { ws: websocket, fn: eventListener };
						websocket.addEventListener("message", eventListener);
						websocket.send(JSON.stringify({
							receiver: address,
							data: {
								type: "ping",
								resend: resend
							},
							id: packetId
						}))
					}), new Promise((_, reject) => modules.network.runOnClose.then(_ => reject(new Error("NETWORK_CLOSED")))) ]);
				},
				logOut: async function(desiredUser) {
					if (desiredUser != user && !privileges.includes("LOGOUT_OTHERS")) throw new Error("UNAUTHORIZED_ACTION");
					if (desiredUser == user && !privileges.includes("LOGOUT")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.session.active != ses && !privileges.includes("LOGOUT_OTHERS")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.logOut(desiredUser);
				},
				lock: async function() {
					if (modules.session.active == ses && !privileges.includes("LOGOUT")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.session.active != ses && !privileges.includes("LOGOUT_OTHERS")) throw new Error("UNAUTHORIZED_ACTION");
					modules.session.muteAllSessions();
					modules.session.activateSession(modules.session.systemSession);
				},
				getPrivateData: () => privateData,
				lull: async function() {
					if (!privileges.includes("LULL_SYSTEM")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.session.active != ses && !privileges.includes("LULL_SYSTEM_FORCE")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.lull();
				},
				connlessListen: async function(gate) {
					if (!privileges.includes("CONNLESS_LISTEN")) throw new Error("UNAUTHORIZED_ACTION");
					if (!gate.startsWith("user_") && !privileges.includes("CONNLESS_LISTEN_GLOBAL")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					return Promise.race([ new Promise(async function(resolve) {
						let networkListenID = Array.from(crypto.getRandomValues(new Uint8Array(64))).map(a => a.toString(16).padStart(2, "0")).join("");
						function eventListener(e) {
							try {
								let packet = JSON.parse(e.data);
								if (packet.data.type == "connectionless" && packet.data.gate == gate) {
									websocket.removeEventListener("message", eventListener);
									delete networkListens[networkListenID];
									resolve(packet);
								}
							} catch {}
						}
						networkListens[networkListenID] = { ws: websocket, fn: eventListener };
						websocket.addEventListener("message", eventListener);
					}), new Promise((_, reject) => modules.network.runOnClose.then(_ => reject(new Error("NETWORK_CLOSED")))) ]);
				},
				connlessSend: async function(sendOpts) {
					if (!privileges.includes("CONNLESS_SEND")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					let { gate, address, content } = sendOpts;
					let packetId = Array.from(crypto.getRandomValues(new Uint8Array(32))).map(a => a.toString(16).padStart(2, "0")).join("");
					websocket.send(JSON.stringify({
						receiver: address,
						data: {
							type: "connectionless",
							gate: gate,
							content: content
						},
						id: packetId
					}));
					return Promise.race([ new Promise(async function(resolve, reject) {
						let networkListenID = Array.from(crypto.getRandomValues(new Uint8Array(64))).map(a => a.toString(16).padStart(2, "0")).join("");
						function eventListener(e) {
							try {
								let packet = JSON.parse(e.data);
								if (packet.from) return;
								if (packet.packetID == packetId) {
									websocket.removeEventListener("message", eventListener);
									delete networkListens[networkListenID];
									if (packet.event == "PacketPong") return resolve("success");
									reject(new Error("ADDRESS_UNREACHABLE"));
								}
							} catch {}
						}
						networkListens[networkListenID] = { ws: websocket, fn: eventListener };
						websocket.addEventListener("message", eventListener);
					}), new Promise((_, reject) => modules.network.runOnClose.then(_ => reject(new Error("NETWORK_CLOSED")))) ]);
				},
				getUsers: async function(token) {
					if (!privileges.includes("GET_USER_LIST")) throw new Error("UNAUTHORIZED_ACTION");
					return await modules.users.getUsers(token || processToken);
				},
				getNetworkAddress: async function() {
					if (!privileges.includes("GET_NETWORK_ADDRESS")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.network.address;
				},
				connfulListen: async function(listenOpts) {
					if (!privileges.includes("CONNFUL_LISTEN")) throw new Error("UNAUTHORIZED_ACTION");
					let {gate, key, private, verifyClientKeyChain} = listenOpts;
					if (!gate.startsWith("user_") && !privileges.includes("CONNFUL_LISTEN_GLOBAL")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					let networkListenID = Array.from(crypto.getRandomValues(new Uint8Array(64))).map(a => a.toString(16).padStart(2, "0")).join("");
					let usableKey = await crypto.subtle.importKey("jwk", private, {name: "ECDSA", namedCurve: "P-256"}, true, ["sign"]);
					let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
					let u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, "0")).join("");
					let _connectionBufferPromise = null;
					let _connectionBufferReject = null;
					let connectionBufferPromise = new Promise((r, j) => [_connectionBufferPromise, _connectionBufferReject] = [r, j]);
					async function eventListener(e) {
						try {
							let packet = JSON.parse(e.data);
							if (!packet.from) return;
							if (packet.data.type == "connectionful" && packet.data.gate == gate && packet.data.action == "start") {
								if (!packet.data.connectionID) return;
								if (connections[packet.data.connectionID + ":server"]) return;
								let ephemeralKey = await crypto.subtle.generateKey({name: "ECDH", namedCurve: "P-256"}, true, ["deriveBits"]);
								let exported = await crypto.subtle.exportKey("jwk", ephemeralKey.publicKey);
								exported = {signedBy: "serverKey", usages: ["connfulSecureEphemeral"], key:exported};
								let signature = u8aToHex(new Uint8Array(await crypto.subtle.sign({
									name: "ECDSA",
									hash: "SHA-256"
								}, usableKey, new TextEncoder().encode(JSON.stringify(exported)))));
								let theirUsableKey = await crypto.subtle.importKey("jwk", packet.data.content.keyInfo.key, {
									name: "ECDH",
									namedCurve: "P-256"
								}, true, []);
								let joinedKeys = await crypto.subtle.deriveBits({ name: "ECDH", public: theirUsableKey }, ephemeralKey.privateKey, 256);
								let aesUsableKey = await crypto.subtle.importKey("raw", joinedKeys, {name: "AES-GCM"}, true, ["encrypt", "decrypt"]);
								let _dataBufferPromise = null, _rejectDataPromise = null;
								let dataBufferPromise = new Promise((r, j) => [_dataBufferPromise, _rejectDataPromise] = [r, j]);
								connections[packet.data.connectionID + ":server"] = {
									ourKey: ephemeralKey,
									from: packet.from,
									theirMainKeyReceived: false,
									theirKeyRaw: packet.data.content,
									aesUsableKey,
									dataBuffer: [],
									dataBufferPromise,
									_dataBufferPromise,
									_rejectDataPromise,
									networkListenID
								}

								websocket.send(JSON.stringify({
									receiver: packet.from,
									data: {
										type: "connectionful",
										action: "start",
										content: {
											keyInfo: exported,
											signature
										},
										connectionID: packet.data.connectionID
									}
								}));
							} else if (packet.data.type == "connectionful" && packet.data.gate == gate && packet.data.action == "xchange") {
								if (!packet.data.connectionID) return;
								if (!connections.hasOwnProperty(packet.data.connectionID + ":server")) return;
								if (connections[packet.data.connectionID + ":server"].theirMainKeyReceived) return;
								if (connections[packet.data.connectionID + ":server"].dying) return;
								let theirMainKeyDecrypt = JSON.parse(new TextDecoder().decode(await crypto.subtle.decrypt({
									name: "AES-GCM",
									iv: hexToU8A(packet.data.content.iv),
								}, connections[packet.data.connectionID + ":server"].aesUsableKey, hexToU8A(packet.data.content.ct))));
								let usableMainKey = await crypto.subtle.importKey("jwk", theirMainKeyDecrypt.keyInfo.key, {
									name: "ECDSA",
									namedCurve: "P-256"
								}, true, ["verify"]);
								let verifyKeySignature = await crypto.subtle.verify({
									name: "ECDSA",
									hash: "SHA-256"
								}, usableMainKey, hexToU8A(connections[packet.data.connectionID + ":server"].theirKeyRaw.signature), new TextEncoder().encode(JSON.stringify(connections[packet.data.connectionID + ":server"].theirKeyRaw.keyInfo)));
								if (verifyClientKeyChain && verifyKeySignature) {
									verifyKeySignature = false;
									try {
										let khrlFiles = await modules.fs.ls(modules.defaultSystem + "/etc/keys/khrl", processToken);
										let khrlSignatures = [];
										for (let khrlFile of khrlFiles) {
											let khrl = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/keys/khrl/" + khrlFile, processToken));
											let khrlSignature = khrl.signature;
											delete khrl.signature;
											if (await crypto.subtle.verify({
												name: "ECDSA",
												hash: {
													name: "SHA-256"
												}
											}, modules.ksk_imported, hexToU8A(khrlSignature), new TextEncoder().encode(JSON.stringify(khrl.list)))) {
												khrlSignatures.push(...khrl.list);
											}
										}
										verifyKeySignature = await recursiveKeyVerify(theirMainKeyDecrypt, khrlSignatures);
									} catch {}
								}
								if (!verifyKeySignature || !theirMainKeyDecrypt.keyInfo.usages.includes("connfulSecureClient:" + packet.from)) {
									delete connections[packet.data.connectionID + ":server"];
									websocket.send(JSON.stringify({
										receiver: packet.from,
										data: {
											type: "connectionful",
											action: "drop",
											connectionID: packet.data.connectionID
										}
									}));
									return;
								}
								connections[packet.data.connectionID + ":server"].theirMainKeyReceived = theirMainKeyDecrypt;
								let iv = crypto.getRandomValues(new Uint8Array(16));
								websocket.send(JSON.stringify({
									receiver: packet.from,
									data: {
										type: "connectionful",
										action: "xchange",
										content: {
											iv: u8aToHex(iv),
											ct: u8aToHex(new Uint8Array(await crypto.subtle.encrypt({
												name: "AES-GCM",
												iv
											}, connections[packet.data.connectionID + ":server"].aesUsableKey, new TextEncoder().encode(JSON.stringify(key)))))
										},
										connectionID: packet.data.connectionID
									}
								}));
							} else if (packet.data.type == "connectionful" && packet.data.gate == gate && packet.data.action == "drop") {
								if (!packet.data.connectionID) return;
								if (!connections.hasOwnProperty(packet.data.connectionID + ":server")) return;
								if (connections[packet.data.connectionID + ":server"].dying) return;
								websocket.send(JSON.stringify({
									receiver: packet.from,
									data: {
										type: "connectionful",
										action: "drop",
										connectionID: packet.data.connectionID
									}
								}));
								if (connections[packet.data.connectionID + ":server"]._rejectDataPromise)
									connections[packet.data.connectionID + ":server"]._rejectDataPromise(new Error("CONNECTION_DROPPED"));
								connections[packet.data.connectionID + ":server"].dying = true;
								if (!connections[packet.data.connectionID + ":server"].dataBuffer.length)
									delete connections[packet.data.connectionID + ":server"];
							} else if (packet.data.type == "connectionful" && packet.data.gate == gate && packet.data.action == "nice2meetu") {
								if (!packet.data.connectionID) return;
								if (!connections.hasOwnProperty(packet.data.connectionID + ":server")) return;
								if (!connections[packet.data.connectionID + ":server"].theirMainKeyReceived) return;
								if (!connections[packet.data.connectionID + ":server"].aesUsableKey) return;
								if (connections[packet.data.connectionID + ":server"].dying) return;
								networkListens[networkListenID].connectionBuffer.push(packet.data.connectionID + ":server");
								let _curcbp = _connectionBufferPromise;
								connectionBufferPromise = new Promise((r, j) => [_connectionBufferPromise, _connectionBufferReject] = [r, j]);
								networkListens[networkListenID].connectionBufferPromise = connectionBufferPromise;
								_curcbp();
							} else if (packet.data.type == "connectionful" && packet.data.gate == gate && packet.data.action == "data") {
								if (!packet.data.connectionID) return;
								if (!connections.hasOwnProperty(packet.data.connectionID + ":server")) return;
								if (!connections[packet.data.connectionID + ":server"].aesUsableKey) return;
								if (!connections[packet.data.connectionID + ":server"].theirMainKeyReceived) return;
								if (connections[packet.data.connectionID + ":server"].dying) return;
								if (connections[packet.data.connectionID + ":server"].writingLock) await connections[packet.data.connectionID + ":server"].writingLock;
								let writingLockRelease;
								let writingLock = new Promise(r => writingLockRelease = r);
								connections[packet.data.connectionID + ":server"].writingLock = writingLock;
								connections[packet.data.connectionID + ":server"].dataBuffer.push(new TextDecoder().decode(await crypto.subtle.decrypt({
									name: "AES-GCM",
									iv: hexToU8A(packet.data.content.iv)
								}, connections[packet.data.connectionID + ":server"].aesUsableKey, hexToU8A(packet.data.content.ct))));
								if (!(connections[connID + ":server"].dataBuffer.length - 1)) {
									let _curdbp = connections[packet.data.connectionID + ":server"].dataBufferPromise;
									let _dataBufferPromise = null, _rejectDataPromise = null;
									let dataBufferPromise = new Promise((r, e) => [_dataBufferPromise, _rejectDataPromise] = [r, e]);
									connections[packet.data.connectionID + ":server"].dataBufferPromise = dataBufferPromise;
									connections[packet.data.connectionID + ":server"]._dataBufferPromise = _dataBufferPromise;
									connections[packet.data.connectionID + ":server"]._rejectDataPromise = _rejectDataPromise;
									_curdbp();
								}
								writingLockRelease();
							}
						} catch {}
					}
					networkListens[networkListenID] = { ws: websocket, gate: gate, fn: eventListener, connectionBuffer: [], connectionBufferPromise }
					modules.network.runOnClose.then(function() {
						for (let connectionID in connections) if (connections[connectionID].networkListenID == networkListenID) {
							connections[connectionID].dying = true;
							connections[connectionID]._rejectDataPromise(new Error("NETWORK_CLOSED"));
							if (!connections[connectionID].dataBuffer.length) delete connections[connectionID];
						}
						delete networkListens[networkListenID];
						_connectionBufferReject(new Error("NETWORK_CLOSED"));
					});
					websocket.addEventListener("message", eventListener);
					return networkListenID;
				},
				connfulListenConnections: async function(networkListenID) {
					if (!privileges.includes("CONNFUL_LISTEN")) throw new Error("UNAUTHORIZED_ACTION");
					if (!networkListens.hasOwnProperty(networkListenID)) throw new Error("INVALID_LISTEN_ID");
					if (!networkListens[networkListenID].connectionBuffer.length) await networkListens[networkListenID].connectionBufferPromise;
					let connectionID = networkListens[networkListenID].connectionBuffer[0];
					networkListens[networkListenID].connectionBuffer = networkListens[networkListenID].connectionBuffer.slice(1);
					return connectionID;
				},
				getBuildTime: function() {
					if (!privileges.includes("GET_BUILD")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.build_time;
				},
				connfulConnect: async function(connOpts) {
					if (!privileges.includes("CONNFUL_CONNECT")) throw new Error("UNAUTHORIZED_ACTION");
					let {address, gate, key, private, doNotVerifyServer, verifyByDomain} = connOpts;
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					let networkListenID = Array.from(crypto.getRandomValues(new Uint8Array(64))).map(a => a.toString(16).padStart(2, "0")).join("");
					let connID = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
					let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
					let u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, "0")).join("");
					let newKeyKA, exportedKA;
					if (!key && !private) {
						newKeyKA = await crypto.subtle.generateKey({name: "ECDSA", namedCurve: "P-256"}, true, ["sign", "verify"]);
						exportedKA = await crypto.subtle.exportKey("jwk", newKeyKA.publicKey);
						exportedKA = { keyInfo: { usages: ["connfulSecureClient:" + modules.network.address], key: exportedKA }, signature: null };
						newKeyKA = newKeyKA.privateKey;
					} else {
						newKeyKA = await crypto.subtle.importKey("jwk", private, {name: "ECDSA", namedCurve: "P-256"}, true, ["sign"]);
						exportedKA = key;
					}
					let ephemeralKey = await crypto.subtle.generateKey({name: "ECDH", namedCurve: "P-256"}, true, ["deriveBits"]);
					let exported = await crypto.subtle.exportKey("jwk", ephemeralKey.publicKey);
					exported = { signedBy: "clientKey", usages: ["connfulSecureEphemeral"], key: exported };
					let signature = u8aToHex(new Uint8Array(await crypto.subtle.sign({
						name: "ECDSA",
						hash: "SHA-256"
					}, newKeyKA, new TextEncoder().encode(JSON.stringify(exported)))));
					let _dataBufferPromise = null;
					let _rejectDataPromise = null;
					let dataBufferPromise = new Promise((r, e) => [_dataBufferPromise, _rejectDataPromise] = [r, e]);
					let _settlePromise = null;
					let _rejectPromise = null;
					let settlePromise = new Promise((r, e) => [_settlePromise, _rejectPromise] = [r, e]);
					let packetID = crypto.getRandomValues(new Uint8Array(32)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
					connections[connID + ":client"] = {
						ourKey: ephemeralKey,
						from: address,
						theirMainKeyReceived: false,
						theirKeyRaw: null,
						aesUsableKey: null,
						networkListenID,
						dataBuffer: [],
						dataBufferPromise,
						settlePromise,
						gateIfNeeded: gate
					}
					async function eventListener(e) {
						try {
							let packet = JSON.parse(e.data);
							if (!packet.from) {
								if (packet.event == "AddressUnreachable" && packet.packetID == packetID)
									_rejectPromise(new Error("ADDRESS_UNREACHABLE"));
								return;
							}
							if (packet.data.gate) return;
							if (packet.data.type == "connectionful" && packet.data.connectionID == connID && packet.data.action == "start") {
								if (connections[connID + ":client"].aesUsableKey) return;
								let theirUsableKey = await crypto.subtle.importKey("jwk", packet.data.content.keyInfo.key, {
									name: "ECDH",
									namedCurve: "P-256"
								}, true, []);
								let joinedKeys = await crypto.subtle.deriveBits({
									name: "ECDH",
									public: theirUsableKey
								}, ephemeralKey.privateKey, 256);
								let aesUsableKey = await crypto.subtle.importKey("raw", joinedKeys, {
									name: "AES-GCM"
								}, true, ["encrypt", "decrypt"]);
								connections[connID + ":client"].aesUsableKey = aesUsableKey;
								connections[connID + ":client"].theirKeyRaw = packet.data.content;
								let iv = crypto.getRandomValues(new Uint8Array(16));
								websocket.send(JSON.stringify({
									receiver: address,
									data: {
										type: "connectionful",
										action: "xchange",
										connectionID: connID,
										content: {
											iv: u8aToHex(iv),
											ct: u8aToHex(new Uint8Array(await crypto.subtle.encrypt({
												name: "AES-GCM",
												iv
											}, aesUsableKey, new TextEncoder().encode(JSON.stringify(exportedKA)))))
										},
										gate
									}
								}));
							} else if (packet.data.type == "connectionful" && packet.data.connectionID == connID && packet.data.action == "xchange") {
								if (connections[connID + ":client"].theirMainKeyReceived) return;
								let theirMainKeyDecrypt = JSON.parse(new TextDecoder().decode(await crypto.subtle.decrypt({
									name: "AES-GCM",
									iv: hexToU8A(packet.data.content.iv)
								}, connections[connID + ":client"].aesUsableKey, hexToU8A(packet.data.content.ct))));
								let usableMainKey = await crypto.subtle.importKey("jwk", theirMainKeyDecrypt.keyInfo.key, {name: "ECDSA", namedCurve: "P-256"}, true, ["verify"]);
								let verifyKeySignature = await crypto.subtle.verify({
									name: "ECDSA",
									hash: "SHA-256"
								}, usableMainKey, hexToU8A(connections[connID + ":client"].theirKeyRaw.signature), new TextEncoder().encode(JSON.stringify(connections[connID + ":client"].theirKeyRaw.keyInfo)));
								if (!doNotVerifyServer && verifyKeySignature) {
									try {
										let khrlFiles = await modules.fs.ls(modules.defaultSystem + "/etc/keys/khrl", processToken);
										let khrlSignatures = [];
										for (let khrlFile of khrlFiles) {
											let khrl = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/keys/khrl/" + khrlFile, processToken));
											let khrlSignature = khrl.signature;
											delete khrl.signature;
											if (await crypto.subtle.verify({
												name: "ECDSA",
												hash: {
													name: "SHA-256"
												}
											}, modules.ksk_imported, hexToU8A(khrlSignature), new TextEncoder().encode(JSON.stringify(khrl.list)))) {
												khrlSignatures.push(...khrl.list);
											}
										}
										verifyKeySignature = await recursiveKeyVerify(theirMainKeyDecrypt, khrlSignatures);
									} catch {
										verifyKeySignature = false;
									}
								}
								if (!verifyKeySignature || (!theirMainKeyDecrypt.keyInfo.usages.includes("connfulSecureServer:" + address) &&
										!theirMainKeyDecrypt.keyInfo.usages.includes("connfulSecureServer:" + verifyByDomain))) {
									_rejectPromise(new Error("SERVER_SIGNATURE_VERIFICATION_FAILED"));
									websocket.removeEventListener("message", eventListener);
									delete connections[connID + ":client"];
									delete networkListens[networkListenID];
									return websocket.send(JSON.stringify({
										receiver: address,
										data: {
											type: "connectionful",
											action: "drop",
											connectionID: connID,
											gate
										}
									}));
								}
								connections[connID + ":client"].theirMainKeyReceived = theirMainKeyDecrypt;
								websocket.send(JSON.stringify({
									receiver: address,
									data: {
										type: "connectionful",
										action: "nice2meetu",
										connectionID: connID,
										gate
									}
								}));
								_settlePromise();
							} else if (packet.data.type == "connectionful" && packet.data.connectionID == connID && packet.data.action == "drop") {
								if (connections[connID + ":client"].dying) return;
								_rejectPromise(new Error("CONNECTION_DROPPED"));
								if (_rejectDataPromise) _rejectDataPromise(new Error("CONNECTION_DROPPED"));
								websocket.send(JSON.stringify({
									receiver: address,
									data: {
										type: "connectionful",
										action: "drop",
										connectionID: connID,
										gate
									}
								}));
								connections[connID + ":client"].dying = true;
								websocket.removeEventListener("message", eventListener);
								delete networkListens[networkListenID];
								if (!connections[connID + ":client"].dataBuffer.length) delete connections[connID + ":client"];
							} else if (packet.data.type == "connectionful" && packet.data.connectionID == connID && packet.data.action == "data") {
								if (!connections[connID + ":client"].aesUsableKey) return;
								if (!connections[connID + ":client"].theirMainKeyReceived) return;
								if (connections[connID + ":client"].writingLock) await connections[connID + ":client"].writingLock;
								let writingLockRelease;
								let writingLock = new Promise(r => writingLockRelease = r);
								connections[connID + ":client"].writingLock = writingLock;
								connections[connID + ":client"].dataBuffer.push(new TextDecoder().decode(await crypto.subtle.decrypt({
									name: "AES-GCM",
									iv: hexToU8A(packet.data.content.iv)
								}, connections[connID + ":client"].aesUsableKey, hexToU8A(packet.data.content.ct))));
								if (!(connections[connID + ":client"].dataBuffer.length - 1)) {
									_dataBufferPromise();
									dataBufferPromise = new Promise((r, e) => [_dataBufferPromise, _rejectDataPromise] = [r, e]);
									connections[packet.data.connectionID + ":client"].dataBufferPromise = dataBufferPromise;
								}
								writingLockRelease();
							}
						} catch {}
					};
					networkListens[networkListenID] = { ws: websocket, gate: gate, fn: eventListener };
					websocket.addEventListener("message", eventListener);
					websocket.send(JSON.stringify({
						receiver: address,
						data: {
							type: "connectionful",
							action: "start",
							gate,
							connectionID: connID,
							content: { keyInfo: exported, signature }
						},
						id: packetID
					}));
					modules.network.runOnClose.then(function() {
						if (connections.hasOwnProperty(connID + ":client")) {
							connections[connID + ":client"].dying = true;
							if (!connections[connID + ":client"].dataBuffer.length) delete connections[connID + ":client"];
						}
						delete networkListens[networkListenID];
						_rejectPromise(new Error("NETWORK_CLOSED"));
						_rejectDataPromise(new Error("NETWORK_CLOSED"));
					});
					return connID + ":client";
				},
				connfulConnectionSettled: async function(connectionID) {
					if (!privileges.includes("CONNFUL_CONNECT")) throw new Error("UNAUTHORIZED_ACTION");
					if (!connections.hasOwnProperty(connectionID)) throw new Error("NO_SUCH_CONNECTION");
					await connections[connectionID].settlePromise;
				},
				connfulDisconnect: async function(connectionID) {
					if (!privileges.includes("CONNFUL_DISCONNECT")) throw new Error("UNAUTHORIZED_ACTION");
					if (!connections.hasOwnProperty(connectionID)) throw new Error("NO_SUCH_CONNECTION");
					if (connections[connectionID].dying) return;
					networkListens[connections[connectionID].networkListenID].ws.send(JSON.stringify({
						receiver: connections[connectionID].from,
						data: {
							type: "connectionful",
							action: "drop",
							connectionID: connectionID.slice(0, -7),
							gate: connections[connectionID].gateIfNeeded
						}
					}));
				},
				connfulForceDisconnect: async function(connectionID) {
					if (!privileges.includes("CONNFUL_DISCONNECT")) throw new Error("UNAUTHORIZED_ACTION");
					delete connections[connectionID];
				},
				connfulWrite: async function(sendOpts) {
					if (!privileges.includes("CONNFUL_WRITE")) throw new Error("UNAUTHORIZED_ACTION");
					if (!connections.hasOwnProperty(sendOpts.connectionID)) throw new Error("NO_SUCH_CONNECTION");
					if (connections[sendOpts.connectionID].dying) throw new Error("CONNECTION_DROPPED");
					let iv = crypto.getRandomValues(new Uint8Array(16));
					let u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, "0")).join("");
					networkListens[connections[sendOpts.connectionID].networkListenID].ws.send(JSON.stringify({
						receiver: connections[sendOpts.connectionID].from,
						data: {
							type: "connectionful",
							action: "data",
							content: {
								iv: u8aToHex(iv),
								ct: u8aToHex(new Uint8Array(await crypto.subtle.encrypt({
									name: "AES-GCM",
									iv
								}, connections[sendOpts.connectionID].aesUsableKey, new TextEncoder().encode(sendOpts.data))))
							},
							connectionID: sendOpts.connectionID.slice(0, -7),
							gate: connections[sendOpts.connectionID].gateIfNeeded
						}
					}));
				},
				connfulRead: async function(connectionID) {
					if (!privileges.includes("CONNFUL_READ")) throw new Error("UNAUTHORIZED_ACTION");
					if (!connections.hasOwnProperty(connectionID)) throw new Error("NO_SUCH_CONNECTION");
					if (!connections[connectionID].dataBuffer.length) await connections[connectionID].dataBufferPromise;
					let data = connections[connectionID].dataBuffer.shift();
					if (connections[connectionID].dying && connections[connectionID].dataBuffer.length == 0) delete connections[connectionID]; 
					return data;
				},
				connfulAddressGet: async function(connectionID) {
					if (!privileges.includes("CONNFUL_ADDRESS_GET")) throw new Error("UNAUTHORIZED_ACTION");
					if (!connections.hasOwnProperty(connectionID)) throw new Error("NO_SUCH_CONNECTION");
					return connections[connectionID].from;
				},
				connfulIdentityGet: async function(connectionID) {
					if (!privileges.includes("CONNFUL_IDENTITY_GET")) throw new Error("UNAUTHORIZED_ACTION");
					if (!connections.hasOwnProperty(connectionID)) throw new Error("NO_SUCH_CONNECTION");
					return connections[connectionID].theirMainKeyReceived;
				},
				systemUptime: async function() {
					if (!privileges.includes("SYSTEM_UPTIME")) throw new Error("UNAUTHORIZED_ACTION");
					return Math.floor(performance.now());
				},
				networkRawWrite: function(data) {
					if (!privileges.includes("NETWORK_RAW_WRITE")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					websocket.send(data);
				},
				networkRawRead: function() {
					if (!privileges.includes("NETWORK_RAW_READ")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					return Promise.race([ new Promise(async function(resolve) {
						networkListens[networkListenID] = { ws: websocket, fn: _ => resolve(_.data) };
						websocket.addEventListener("message", eventListener);
					}), new Promise((_, reject) => modules.network.runOnClose.then(_ => reject(new Error("NETWORK_CLOSED")))) ]);
				},
				getHostname: async function() {
					if (!privileges.includes("GET_HOSTNAME")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.network.hostname;
				},
				resolve: async function(name) {
					if (!privileges.includes("RESOLVE_NAME")) throw new Error("UNAUTHORIZED_ACTION");
					let websocketHandle = modules.network.ws;
					if (!websocketHandle) throw new Error("NETWORK_UNREACHABLE");
					let websocket = modules.websocket._handles[websocketHandle].ws;
					if (websocket.readyState != 1) throw new Error("NETWORK_UNREACHABLE");
					let tlds = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/tlds.json"));
					function resolveRecursive(name, address) {
						if (tlds.hasOwnProperty(name)) return tlds[name];
						if (address == null) return null;
						return new Promise(function(resolve) {
							let gate = "user_" + Array.from(crypto.getRandomValues(new Uint8Array(16))).map(a => a.toString(16).padStart(2, "0")).join("");
							let networkListenID = Array.from(crypto.getRandomValues(new Uint8Array(64))).map(a => a.toString(16).padStart(2, "0")).join("");
							function eventListener(e) {
								try {
									let packet = JSON.parse(e.data);
									if (packet.data.type == "connectionless" && packet.data.gate == gate && packet.from == address) {
										websocket.removeEventListener("message", eventListener);
										delete networkListens[networkListenID];
										resolve(packet.data.content);
									}
								} catch {}
							}
							networkListens[networkListenID] = { ws: websocket, fn: eventListener };
							websocket.addEventListener("message", eventListener);
							websocket.send(JSON.stringify({
								receiver: address,
								data: {
									type: "connectionless",
									gate: "resolve",
									content: {
										reply: gate,
										query: name
									}
								}
							}));
						});
					}
					let nameParts = name.split(".").reverse();
					let currentResolve;
					for (let part = 0; part < nameParts.length; part++) currentResolve = await resolveRecursive(nameParts.slice(0, part + 1).reverse().join("."), currentResolve);
					return currentResolve;
				},
				patchDiff: function(libraryOptions) {
					if (!privileges.includes("PATCH_DIFF")) throw new Error("UNAUTHORIZED_ACTION");
					let operations = { diff_core, diff, lcs, calcPatch, applyPatch, calcSlices };
					return [ ...operations[libraryOptions.operation](...libraryOptions.args) ];
				},
				setFirmware: async function(new_flash) {
					if (!privileges.includes("SET_FIRMWARE")) throw new Error("UNAUTHORIZED_ACTION");
					if (modules.core.setFW) {
						await modules.core.setFW(new_flash);
						return;
					}
					localStorage.setItem("runtime_flash", new_flash);
				},
				reloadNetworkConfig: async function() {
					if (!privileges.includes("RELOAD_NETWORK_CONFIG")) throw new Error("UNAUTHORIZED_ACTION");
					await modules.network.reloadConfig();
				},
				batteryStatus: async function() {
					if (!privileges.includes("GET_BATTERY_STATUS")) throw new Error("UNAUTHORIZED_ACTION");
					let battery = await navigator.getBattery();
					return {
						charging: battery.charging,
						level: battery.level,
						chargingTime: battery.chargingTime,
						dischargingTime: battery.dischargingTime
					};
				},
				getUpdateService: async function() {
					if (!privileges.includes("GET_UPDATE_SERVICE")) throw new Error("UNAUTHORIZED_ACTION");
					return modules.network.updates;
				}
			}
		}
		let customAPIs = modules.customAPIs;
		if (customAPIs) {
			for (let api in (customAPIs.public || {})) apis.public[api] = async (...args) => customAPIs.public[api](processToken, ...args);
			for (let api in (customAPIs.private || {})) apis.private[api] = async (...args) => customAPIs.private[api](processToken, ...args);
		}
		return apis;
	}
}
reeAPIs();
// 05-tweetnacl.js
function tweetnacl() {
    (function(nacl) {
        'use strict';
        
        // Ported in 2014 by Dmitry Chestnykh and Devi Mandiri.
        // Public domain.
        //
        // Implementation derived from TweetNaCl version 20140427.
        // See for details: http://tweetnacl.cr.yp.to/
        
        var gf = function(init) {
          var i, r = new Float64Array(16);
          if (init) for (i = 0; i < init.length; i++) r[i] = init[i];
          return r;
        };
        
        //  Pluggable, initialized in high-level API below.
        var randombytes = function(/* x, n */) { throw new Error('no PRNG'); };
        
        var _0 = new Uint8Array(16);
        var _9 = new Uint8Array(32); _9[0] = 9;
        
        var gf0 = gf(),
            gf1 = gf([1]),
            _121665 = gf([0xdb41, 1]),
            D = gf([0x78a3, 0x1359, 0x4dca, 0x75eb, 0xd8ab, 0x4141, 0x0a4d, 0x0070, 0xe898, 0x7779, 0x4079, 0x8cc7, 0xfe73, 0x2b6f, 0x6cee, 0x5203]),
            D2 = gf([0xf159, 0x26b2, 0x9b94, 0xebd6, 0xb156, 0x8283, 0x149a, 0x00e0, 0xd130, 0xeef3, 0x80f2, 0x198e, 0xfce7, 0x56df, 0xd9dc, 0x2406]),
            X = gf([0xd51a, 0x8f25, 0x2d60, 0xc956, 0xa7b2, 0x9525, 0xc760, 0x692c, 0xdc5c, 0xfdd6, 0xe231, 0xc0a4, 0x53fe, 0xcd6e, 0x36d3, 0x2169]),
            Y = gf([0x6658, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666]),
            I = gf([0xa0b0, 0x4a0e, 0x1b27, 0xc4ee, 0xe478, 0xad2f, 0x1806, 0x2f43, 0xd7a7, 0x3dfb, 0x0099, 0x2b4d, 0xdf0b, 0x4fc1, 0x2480, 0x2b83]);
        
        function ts64(x, i, h, l) {
          x[i]   = (h >> 24) & 0xff;
          x[i+1] = (h >> 16) & 0xff;
          x[i+2] = (h >>  8) & 0xff;
          x[i+3] = h & 0xff;
          x[i+4] = (l >> 24)  & 0xff;
          x[i+5] = (l >> 16)  & 0xff;
          x[i+6] = (l >>  8)  & 0xff;
          x[i+7] = l & 0xff;
        }
        
        function vn(x, xi, y, yi, n) {
          var i,d = 0;
          for (i = 0; i < n; i++) d |= x[xi+i]^y[yi+i];
          return (1 & ((d - 1) >>> 8)) - 1;
        }
        
        function crypto_verify_16(x, xi, y, yi) {
          return vn(x,xi,y,yi,16);
        }
        
        function crypto_verify_32(x, xi, y, yi) {
          return vn(x,xi,y,yi,32);
        }
        
        function core_salsa20(o, p, k, c) {
          var j0  = c[ 0] & 0xff | (c[ 1] & 0xff)<<8 | (c[ 2] & 0xff)<<16 | (c[ 3] & 0xff)<<24,
              j1  = k[ 0] & 0xff | (k[ 1] & 0xff)<<8 | (k[ 2] & 0xff)<<16 | (k[ 3] & 0xff)<<24,
              j2  = k[ 4] & 0xff | (k[ 5] & 0xff)<<8 | (k[ 6] & 0xff)<<16 | (k[ 7] & 0xff)<<24,
              j3  = k[ 8] & 0xff | (k[ 9] & 0xff)<<8 | (k[10] & 0xff)<<16 | (k[11] & 0xff)<<24,
              j4  = k[12] & 0xff | (k[13] & 0xff)<<8 | (k[14] & 0xff)<<16 | (k[15] & 0xff)<<24,
              j5  = c[ 4] & 0xff | (c[ 5] & 0xff)<<8 | (c[ 6] & 0xff)<<16 | (c[ 7] & 0xff)<<24,
              j6  = p[ 0] & 0xff | (p[ 1] & 0xff)<<8 | (p[ 2] & 0xff)<<16 | (p[ 3] & 0xff)<<24,
              j7  = p[ 4] & 0xff | (p[ 5] & 0xff)<<8 | (p[ 6] & 0xff)<<16 | (p[ 7] & 0xff)<<24,
              j8  = p[ 8] & 0xff | (p[ 9] & 0xff)<<8 | (p[10] & 0xff)<<16 | (p[11] & 0xff)<<24,
              j9  = p[12] & 0xff | (p[13] & 0xff)<<8 | (p[14] & 0xff)<<16 | (p[15] & 0xff)<<24,
              j10 = c[ 8] & 0xff | (c[ 9] & 0xff)<<8 | (c[10] & 0xff)<<16 | (c[11] & 0xff)<<24,
              j11 = k[16] & 0xff | (k[17] & 0xff)<<8 | (k[18] & 0xff)<<16 | (k[19] & 0xff)<<24,
              j12 = k[20] & 0xff | (k[21] & 0xff)<<8 | (k[22] & 0xff)<<16 | (k[23] & 0xff)<<24,
              j13 = k[24] & 0xff | (k[25] & 0xff)<<8 | (k[26] & 0xff)<<16 | (k[27] & 0xff)<<24,
              j14 = k[28] & 0xff | (k[29] & 0xff)<<8 | (k[30] & 0xff)<<16 | (k[31] & 0xff)<<24,
              j15 = c[12] & 0xff | (c[13] & 0xff)<<8 | (c[14] & 0xff)<<16 | (c[15] & 0xff)<<24;
        
          var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,
              x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,
              x15 = j15, u;
        
          for (var i = 0; i < 20; i += 2) {
            u = x0 + x12 | 0;
            x4 ^= u<<7 | u>>>(32-7);
            u = x4 + x0 | 0;
            x8 ^= u<<9 | u>>>(32-9);
            u = x8 + x4 | 0;
            x12 ^= u<<13 | u>>>(32-13);
            u = x12 + x8 | 0;
            x0 ^= u<<18 | u>>>(32-18);
        
            u = x5 + x1 | 0;
            x9 ^= u<<7 | u>>>(32-7);
            u = x9 + x5 | 0;
            x13 ^= u<<9 | u>>>(32-9);
            u = x13 + x9 | 0;
            x1 ^= u<<13 | u>>>(32-13);
            u = x1 + x13 | 0;
            x5 ^= u<<18 | u>>>(32-18);
        
            u = x10 + x6 | 0;
            x14 ^= u<<7 | u>>>(32-7);
            u = x14 + x10 | 0;
            x2 ^= u<<9 | u>>>(32-9);
            u = x2 + x14 | 0;
            x6 ^= u<<13 | u>>>(32-13);
            u = x6 + x2 | 0;
            x10 ^= u<<18 | u>>>(32-18);
        
            u = x15 + x11 | 0;
            x3 ^= u<<7 | u>>>(32-7);
            u = x3 + x15 | 0;
            x7 ^= u<<9 | u>>>(32-9);
            u = x7 + x3 | 0;
            x11 ^= u<<13 | u>>>(32-13);
            u = x11 + x7 | 0;
            x15 ^= u<<18 | u>>>(32-18);
        
            u = x0 + x3 | 0;
            x1 ^= u<<7 | u>>>(32-7);
            u = x1 + x0 | 0;
            x2 ^= u<<9 | u>>>(32-9);
            u = x2 + x1 | 0;
            x3 ^= u<<13 | u>>>(32-13);
            u = x3 + x2 | 0;
            x0 ^= u<<18 | u>>>(32-18);
        
            u = x5 + x4 | 0;
            x6 ^= u<<7 | u>>>(32-7);
            u = x6 + x5 | 0;
            x7 ^= u<<9 | u>>>(32-9);
            u = x7 + x6 | 0;
            x4 ^= u<<13 | u>>>(32-13);
            u = x4 + x7 | 0;
            x5 ^= u<<18 | u>>>(32-18);
        
            u = x10 + x9 | 0;
            x11 ^= u<<7 | u>>>(32-7);
            u = x11 + x10 | 0;
            x8 ^= u<<9 | u>>>(32-9);
            u = x8 + x11 | 0;
            x9 ^= u<<13 | u>>>(32-13);
            u = x9 + x8 | 0;
            x10 ^= u<<18 | u>>>(32-18);
        
            u = x15 + x14 | 0;
            x12 ^= u<<7 | u>>>(32-7);
            u = x12 + x15 | 0;
            x13 ^= u<<9 | u>>>(32-9);
            u = x13 + x12 | 0;
            x14 ^= u<<13 | u>>>(32-13);
            u = x14 + x13 | 0;
            x15 ^= u<<18 | u>>>(32-18);
          }
           x0 =  x0 +  j0 | 0;
           x1 =  x1 +  j1 | 0;
           x2 =  x2 +  j2 | 0;
           x3 =  x3 +  j3 | 0;
           x4 =  x4 +  j4 | 0;
           x5 =  x5 +  j5 | 0;
           x6 =  x6 +  j6 | 0;
           x7 =  x7 +  j7 | 0;
           x8 =  x8 +  j8 | 0;
           x9 =  x9 +  j9 | 0;
          x10 = x10 + j10 | 0;
          x11 = x11 + j11 | 0;
          x12 = x12 + j12 | 0;
          x13 = x13 + j13 | 0;
          x14 = x14 + j14 | 0;
          x15 = x15 + j15 | 0;
        
          o[ 0] = x0 >>>  0 & 0xff;
          o[ 1] = x0 >>>  8 & 0xff;
          o[ 2] = x0 >>> 16 & 0xff;
          o[ 3] = x0 >>> 24 & 0xff;
        
          o[ 4] = x1 >>>  0 & 0xff;
          o[ 5] = x1 >>>  8 & 0xff;
          o[ 6] = x1 >>> 16 & 0xff;
          o[ 7] = x1 >>> 24 & 0xff;
        
          o[ 8] = x2 >>>  0 & 0xff;
          o[ 9] = x2 >>>  8 & 0xff;
          o[10] = x2 >>> 16 & 0xff;
          o[11] = x2 >>> 24 & 0xff;
        
          o[12] = x3 >>>  0 & 0xff;
          o[13] = x3 >>>  8 & 0xff;
          o[14] = x3 >>> 16 & 0xff;
          o[15] = x3 >>> 24 & 0xff;
        
          o[16] = x4 >>>  0 & 0xff;
          o[17] = x4 >>>  8 & 0xff;
          o[18] = x4 >>> 16 & 0xff;
          o[19] = x4 >>> 24 & 0xff;
        
          o[20] = x5 >>>  0 & 0xff;
          o[21] = x5 >>>  8 & 0xff;
          o[22] = x5 >>> 16 & 0xff;
          o[23] = x5 >>> 24 & 0xff;
        
          o[24] = x6 >>>  0 & 0xff;
          o[25] = x6 >>>  8 & 0xff;
          o[26] = x6 >>> 16 & 0xff;
          o[27] = x6 >>> 24 & 0xff;
        
          o[28] = x7 >>>  0 & 0xff;
          o[29] = x7 >>>  8 & 0xff;
          o[30] = x7 >>> 16 & 0xff;
          o[31] = x7 >>> 24 & 0xff;
        
          o[32] = x8 >>>  0 & 0xff;
          o[33] = x8 >>>  8 & 0xff;
          o[34] = x8 >>> 16 & 0xff;
          o[35] = x8 >>> 24 & 0xff;
        
          o[36] = x9 >>>  0 & 0xff;
          o[37] = x9 >>>  8 & 0xff;
          o[38] = x9 >>> 16 & 0xff;
          o[39] = x9 >>> 24 & 0xff;
        
          o[40] = x10 >>>  0 & 0xff;
          o[41] = x10 >>>  8 & 0xff;
          o[42] = x10 >>> 16 & 0xff;
          o[43] = x10 >>> 24 & 0xff;
        
          o[44] = x11 >>>  0 & 0xff;
          o[45] = x11 >>>  8 & 0xff;
          o[46] = x11 >>> 16 & 0xff;
          o[47] = x11 >>> 24 & 0xff;
        
          o[48] = x12 >>>  0 & 0xff;
          o[49] = x12 >>>  8 & 0xff;
          o[50] = x12 >>> 16 & 0xff;
          o[51] = x12 >>> 24 & 0xff;
        
          o[52] = x13 >>>  0 & 0xff;
          o[53] = x13 >>>  8 & 0xff;
          o[54] = x13 >>> 16 & 0xff;
          o[55] = x13 >>> 24 & 0xff;
        
          o[56] = x14 >>>  0 & 0xff;
          o[57] = x14 >>>  8 & 0xff;
          o[58] = x14 >>> 16 & 0xff;
          o[59] = x14 >>> 24 & 0xff;
        
          o[60] = x15 >>>  0 & 0xff;
          o[61] = x15 >>>  8 & 0xff;
          o[62] = x15 >>> 16 & 0xff;
          o[63] = x15 >>> 24 & 0xff;
        }
        
        function core_hsalsa20(o,p,k,c) {
          var j0  = c[ 0] & 0xff | (c[ 1] & 0xff)<<8 | (c[ 2] & 0xff)<<16 | (c[ 3] & 0xff)<<24,
              j1  = k[ 0] & 0xff | (k[ 1] & 0xff)<<8 | (k[ 2] & 0xff)<<16 | (k[ 3] & 0xff)<<24,
              j2  = k[ 4] & 0xff | (k[ 5] & 0xff)<<8 | (k[ 6] & 0xff)<<16 | (k[ 7] & 0xff)<<24,
              j3  = k[ 8] & 0xff | (k[ 9] & 0xff)<<8 | (k[10] & 0xff)<<16 | (k[11] & 0xff)<<24,
              j4  = k[12] & 0xff | (k[13] & 0xff)<<8 | (k[14] & 0xff)<<16 | (k[15] & 0xff)<<24,
              j5  = c[ 4] & 0xff | (c[ 5] & 0xff)<<8 | (c[ 6] & 0xff)<<16 | (c[ 7] & 0xff)<<24,
              j6  = p[ 0] & 0xff | (p[ 1] & 0xff)<<8 | (p[ 2] & 0xff)<<16 | (p[ 3] & 0xff)<<24,
              j7  = p[ 4] & 0xff | (p[ 5] & 0xff)<<8 | (p[ 6] & 0xff)<<16 | (p[ 7] & 0xff)<<24,
              j8  = p[ 8] & 0xff | (p[ 9] & 0xff)<<8 | (p[10] & 0xff)<<16 | (p[11] & 0xff)<<24,
              j9  = p[12] & 0xff | (p[13] & 0xff)<<8 | (p[14] & 0xff)<<16 | (p[15] & 0xff)<<24,
              j10 = c[ 8] & 0xff | (c[ 9] & 0xff)<<8 | (c[10] & 0xff)<<16 | (c[11] & 0xff)<<24,
              j11 = k[16] & 0xff | (k[17] & 0xff)<<8 | (k[18] & 0xff)<<16 | (k[19] & 0xff)<<24,
              j12 = k[20] & 0xff | (k[21] & 0xff)<<8 | (k[22] & 0xff)<<16 | (k[23] & 0xff)<<24,
              j13 = k[24] & 0xff | (k[25] & 0xff)<<8 | (k[26] & 0xff)<<16 | (k[27] & 0xff)<<24,
              j14 = k[28] & 0xff | (k[29] & 0xff)<<8 | (k[30] & 0xff)<<16 | (k[31] & 0xff)<<24,
              j15 = c[12] & 0xff | (c[13] & 0xff)<<8 | (c[14] & 0xff)<<16 | (c[15] & 0xff)<<24;
        
          var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,
              x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,
              x15 = j15, u;
        
          for (var i = 0; i < 20; i += 2) {
            u = x0 + x12 | 0;
            x4 ^= u<<7 | u>>>(32-7);
            u = x4 + x0 | 0;
            x8 ^= u<<9 | u>>>(32-9);
            u = x8 + x4 | 0;
            x12 ^= u<<13 | u>>>(32-13);
            u = x12 + x8 | 0;
            x0 ^= u<<18 | u>>>(32-18);
        
            u = x5 + x1 | 0;
            x9 ^= u<<7 | u>>>(32-7);
            u = x9 + x5 | 0;
            x13 ^= u<<9 | u>>>(32-9);
            u = x13 + x9 | 0;
            x1 ^= u<<13 | u>>>(32-13);
            u = x1 + x13 | 0;
            x5 ^= u<<18 | u>>>(32-18);
        
            u = x10 + x6 | 0;
            x14 ^= u<<7 | u>>>(32-7);
            u = x14 + x10 | 0;
            x2 ^= u<<9 | u>>>(32-9);
            u = x2 + x14 | 0;
            x6 ^= u<<13 | u>>>(32-13);
            u = x6 + x2 | 0;
            x10 ^= u<<18 | u>>>(32-18);
        
            u = x15 + x11 | 0;
            x3 ^= u<<7 | u>>>(32-7);
            u = x3 + x15 | 0;
            x7 ^= u<<9 | u>>>(32-9);
            u = x7 + x3 | 0;
            x11 ^= u<<13 | u>>>(32-13);
            u = x11 + x7 | 0;
            x15 ^= u<<18 | u>>>(32-18);
        
            u = x0 + x3 | 0;
            x1 ^= u<<7 | u>>>(32-7);
            u = x1 + x0 | 0;
            x2 ^= u<<9 | u>>>(32-9);
            u = x2 + x1 | 0;
            x3 ^= u<<13 | u>>>(32-13);
            u = x3 + x2 | 0;
            x0 ^= u<<18 | u>>>(32-18);
        
            u = x5 + x4 | 0;
            x6 ^= u<<7 | u>>>(32-7);
            u = x6 + x5 | 0;
            x7 ^= u<<9 | u>>>(32-9);
            u = x7 + x6 | 0;
            x4 ^= u<<13 | u>>>(32-13);
            u = x4 + x7 | 0;
            x5 ^= u<<18 | u>>>(32-18);
        
            u = x10 + x9 | 0;
            x11 ^= u<<7 | u>>>(32-7);
            u = x11 + x10 | 0;
            x8 ^= u<<9 | u>>>(32-9);
            u = x8 + x11 | 0;
            x9 ^= u<<13 | u>>>(32-13);
            u = x9 + x8 | 0;
            x10 ^= u<<18 | u>>>(32-18);
        
            u = x15 + x14 | 0;
            x12 ^= u<<7 | u>>>(32-7);
            u = x12 + x15 | 0;
            x13 ^= u<<9 | u>>>(32-9);
            u = x13 + x12 | 0;
            x14 ^= u<<13 | u>>>(32-13);
            u = x14 + x13 | 0;
            x15 ^= u<<18 | u>>>(32-18);
          }
        
          o[ 0] = x0 >>>  0 & 0xff;
          o[ 1] = x0 >>>  8 & 0xff;
          o[ 2] = x0 >>> 16 & 0xff;
          o[ 3] = x0 >>> 24 & 0xff;
        
          o[ 4] = x5 >>>  0 & 0xff;
          o[ 5] = x5 >>>  8 & 0xff;
          o[ 6] = x5 >>> 16 & 0xff;
          o[ 7] = x5 >>> 24 & 0xff;
        
          o[ 8] = x10 >>>  0 & 0xff;
          o[ 9] = x10 >>>  8 & 0xff;
          o[10] = x10 >>> 16 & 0xff;
          o[11] = x10 >>> 24 & 0xff;
        
          o[12] = x15 >>>  0 & 0xff;
          o[13] = x15 >>>  8 & 0xff;
          o[14] = x15 >>> 16 & 0xff;
          o[15] = x15 >>> 24 & 0xff;
        
          o[16] = x6 >>>  0 & 0xff;
          o[17] = x6 >>>  8 & 0xff;
          o[18] = x6 >>> 16 & 0xff;
          o[19] = x6 >>> 24 & 0xff;
        
          o[20] = x7 >>>  0 & 0xff;
          o[21] = x7 >>>  8 & 0xff;
          o[22] = x7 >>> 16 & 0xff;
          o[23] = x7 >>> 24 & 0xff;
        
          o[24] = x8 >>>  0 & 0xff;
          o[25] = x8 >>>  8 & 0xff;
          o[26] = x8 >>> 16 & 0xff;
          o[27] = x8 >>> 24 & 0xff;
        
          o[28] = x9 >>>  0 & 0xff;
          o[29] = x9 >>>  8 & 0xff;
          o[30] = x9 >>> 16 & 0xff;
          o[31] = x9 >>> 24 & 0xff;
        }
        
        function crypto_core_salsa20(out,inp,k,c) {
          core_salsa20(out,inp,k,c);
        }
        
        function crypto_core_hsalsa20(out,inp,k,c) {
          core_hsalsa20(out,inp,k,c);
        }
        
        var sigma = new Uint8Array([101, 120, 112, 97, 110, 100, 32, 51, 50, 45, 98, 121, 116, 101, 32, 107]);
                    // "expand 32-byte k"
        
        function crypto_stream_salsa20_xor(c,cpos,m,mpos,b,n,k) {
          var z = new Uint8Array(16), x = new Uint8Array(64);
          var u, i;
          for (i = 0; i < 16; i++) z[i] = 0;
          for (i = 0; i < 8; i++) z[i] = n[i];
          while (b >= 64) {
            crypto_core_salsa20(x,z,k,sigma);
            for (i = 0; i < 64; i++) c[cpos+i] = m[mpos+i] ^ x[i];
            u = 1;
            for (i = 8; i < 16; i++) {
              u = u + (z[i] & 0xff) | 0;
              z[i] = u & 0xff;
              u >>>= 8;
            }
            b -= 64;
            cpos += 64;
            mpos += 64;
          }
          if (b > 0) {
            crypto_core_salsa20(x,z,k,sigma);
            for (i = 0; i < b; i++) c[cpos+i] = m[mpos+i] ^ x[i];
          }
          return 0;
        }
        
        function crypto_stream_salsa20(c,cpos,b,n,k) {
          var z = new Uint8Array(16), x = new Uint8Array(64);
          var u, i;
          for (i = 0; i < 16; i++) z[i] = 0;
          for (i = 0; i < 8; i++) z[i] = n[i];
          while (b >= 64) {
            crypto_core_salsa20(x,z,k,sigma);
            for (i = 0; i < 64; i++) c[cpos+i] = x[i];
            u = 1;
            for (i = 8; i < 16; i++) {
              u = u + (z[i] & 0xff) | 0;
              z[i] = u & 0xff;
              u >>>= 8;
            }
            b -= 64;
            cpos += 64;
          }
          if (b > 0) {
            crypto_core_salsa20(x,z,k,sigma);
            for (i = 0; i < b; i++) c[cpos+i] = x[i];
          }
          return 0;
        }
        
        function crypto_stream(c,cpos,d,n,k) {
          var s = new Uint8Array(32);
          crypto_core_hsalsa20(s,n,k,sigma);
          var sn = new Uint8Array(8);
          for (var i = 0; i < 8; i++) sn[i] = n[i+16];
          return crypto_stream_salsa20(c,cpos,d,sn,s);
        }
        
        function crypto_stream_xor(c,cpos,m,mpos,d,n,k) {
          var s = new Uint8Array(32);
          crypto_core_hsalsa20(s,n,k,sigma);
          var sn = new Uint8Array(8);
          for (var i = 0; i < 8; i++) sn[i] = n[i+16];
          return crypto_stream_salsa20_xor(c,cpos,m,mpos,d,sn,s);
        }
        
        /*
        * Port of Andrew Moon's Poly1305-donna-16. Public domain.
        * https://github.com/floodyberry/poly1305-donna
        */
        
        var poly1305 = function(key) {
          this.buffer = new Uint8Array(16);
          this.r = new Uint16Array(10);
          this.h = new Uint16Array(10);
          this.pad = new Uint16Array(8);
          this.leftover = 0;
          this.fin = 0;
        
          var t0, t1, t2, t3, t4, t5, t6, t7;
        
          t0 = key[ 0] & 0xff | (key[ 1] & 0xff) << 8; this.r[0] = ( t0                     ) & 0x1fff;
          t1 = key[ 2] & 0xff | (key[ 3] & 0xff) << 8; this.r[1] = ((t0 >>> 13) | (t1 <<  3)) & 0x1fff;
          t2 = key[ 4] & 0xff | (key[ 5] & 0xff) << 8; this.r[2] = ((t1 >>> 10) | (t2 <<  6)) & 0x1f03;
          t3 = key[ 6] & 0xff | (key[ 7] & 0xff) << 8; this.r[3] = ((t2 >>>  7) | (t3 <<  9)) & 0x1fff;
          t4 = key[ 8] & 0xff | (key[ 9] & 0xff) << 8; this.r[4] = ((t3 >>>  4) | (t4 << 12)) & 0x00ff;
          this.r[5] = ((t4 >>>  1)) & 0x1ffe;
          t5 = key[10] & 0xff | (key[11] & 0xff) << 8; this.r[6] = ((t4 >>> 14) | (t5 <<  2)) & 0x1fff;
          t6 = key[12] & 0xff | (key[13] & 0xff) << 8; this.r[7] = ((t5 >>> 11) | (t6 <<  5)) & 0x1f81;
          t7 = key[14] & 0xff | (key[15] & 0xff) << 8; this.r[8] = ((t6 >>>  8) | (t7 <<  8)) & 0x1fff;
          this.r[9] = ((t7 >>>  5)) & 0x007f;
        
          this.pad[0] = key[16] & 0xff | (key[17] & 0xff) << 8;
          this.pad[1] = key[18] & 0xff | (key[19] & 0xff) << 8;
          this.pad[2] = key[20] & 0xff | (key[21] & 0xff) << 8;
          this.pad[3] = key[22] & 0xff | (key[23] & 0xff) << 8;
          this.pad[4] = key[24] & 0xff | (key[25] & 0xff) << 8;
          this.pad[5] = key[26] & 0xff | (key[27] & 0xff) << 8;
          this.pad[6] = key[28] & 0xff | (key[29] & 0xff) << 8;
          this.pad[7] = key[30] & 0xff | (key[31] & 0xff) << 8;
        };
        
        poly1305.prototype.blocks = function(m, mpos, bytes) {
          var hibit = this.fin ? 0 : (1 << 11);
          var t0, t1, t2, t3, t4, t5, t6, t7, c;
          var d0, d1, d2, d3, d4, d5, d6, d7, d8, d9;
        
          var h0 = this.h[0],
              h1 = this.h[1],
              h2 = this.h[2],
              h3 = this.h[3],
              h4 = this.h[4],
              h5 = this.h[5],
              h6 = this.h[6],
              h7 = this.h[7],
              h8 = this.h[8],
              h9 = this.h[9];
        
          var r0 = this.r[0],
              r1 = this.r[1],
              r2 = this.r[2],
              r3 = this.r[3],
              r4 = this.r[4],
              r5 = this.r[5],
              r6 = this.r[6],
              r7 = this.r[7],
              r8 = this.r[8],
              r9 = this.r[9];
        
          while (bytes >= 16) {
            t0 = m[mpos+ 0] & 0xff | (m[mpos+ 1] & 0xff) << 8; h0 += ( t0                     ) & 0x1fff;
            t1 = m[mpos+ 2] & 0xff | (m[mpos+ 3] & 0xff) << 8; h1 += ((t0 >>> 13) | (t1 <<  3)) & 0x1fff;
            t2 = m[mpos+ 4] & 0xff | (m[mpos+ 5] & 0xff) << 8; h2 += ((t1 >>> 10) | (t2 <<  6)) & 0x1fff;
            t3 = m[mpos+ 6] & 0xff | (m[mpos+ 7] & 0xff) << 8; h3 += ((t2 >>>  7) | (t3 <<  9)) & 0x1fff;
            t4 = m[mpos+ 8] & 0xff | (m[mpos+ 9] & 0xff) << 8; h4 += ((t3 >>>  4) | (t4 << 12)) & 0x1fff;
            h5 += ((t4 >>>  1)) & 0x1fff;
            t5 = m[mpos+10] & 0xff | (m[mpos+11] & 0xff) << 8; h6 += ((t4 >>> 14) | (t5 <<  2)) & 0x1fff;
            t6 = m[mpos+12] & 0xff | (m[mpos+13] & 0xff) << 8; h7 += ((t5 >>> 11) | (t6 <<  5)) & 0x1fff;
            t7 = m[mpos+14] & 0xff | (m[mpos+15] & 0xff) << 8; h8 += ((t6 >>>  8) | (t7 <<  8)) & 0x1fff;
            h9 += ((t7 >>> 5)) | hibit;
        
            c = 0;
        
            d0 = c;
            d0 += h0 * r0;
            d0 += h1 * (5 * r9);
            d0 += h2 * (5 * r8);
            d0 += h3 * (5 * r7);
            d0 += h4 * (5 * r6);
            c = (d0 >>> 13); d0 &= 0x1fff;
            d0 += h5 * (5 * r5);
            d0 += h6 * (5 * r4);
            d0 += h7 * (5 * r3);
            d0 += h8 * (5 * r2);
            d0 += h9 * (5 * r1);
            c += (d0 >>> 13); d0 &= 0x1fff;
        
            d1 = c;
            d1 += h0 * r1;
            d1 += h1 * r0;
            d1 += h2 * (5 * r9);
            d1 += h3 * (5 * r8);
            d1 += h4 * (5 * r7);
            c = (d1 >>> 13); d1 &= 0x1fff;
            d1 += h5 * (5 * r6);
            d1 += h6 * (5 * r5);
            d1 += h7 * (5 * r4);
            d1 += h8 * (5 * r3);
            d1 += h9 * (5 * r2);
            c += (d1 >>> 13); d1 &= 0x1fff;
        
            d2 = c;
            d2 += h0 * r2;
            d2 += h1 * r1;
            d2 += h2 * r0;
            d2 += h3 * (5 * r9);
            d2 += h4 * (5 * r8);
            c = (d2 >>> 13); d2 &= 0x1fff;
            d2 += h5 * (5 * r7);
            d2 += h6 * (5 * r6);
            d2 += h7 * (5 * r5);
            d2 += h8 * (5 * r4);
            d2 += h9 * (5 * r3);
            c += (d2 >>> 13); d2 &= 0x1fff;
        
            d3 = c;
            d3 += h0 * r3;
            d3 += h1 * r2;
            d3 += h2 * r1;
            d3 += h3 * r0;
            d3 += h4 * (5 * r9);
            c = (d3 >>> 13); d3 &= 0x1fff;
            d3 += h5 * (5 * r8);
            d3 += h6 * (5 * r7);
            d3 += h7 * (5 * r6);
            d3 += h8 * (5 * r5);
            d3 += h9 * (5 * r4);
            c += (d3 >>> 13); d3 &= 0x1fff;
        
            d4 = c;
            d4 += h0 * r4;
            d4 += h1 * r3;
            d4 += h2 * r2;
            d4 += h3 * r1;
            d4 += h4 * r0;
            c = (d4 >>> 13); d4 &= 0x1fff;
            d4 += h5 * (5 * r9);
            d4 += h6 * (5 * r8);
            d4 += h7 * (5 * r7);
            d4 += h8 * (5 * r6);
            d4 += h9 * (5 * r5);
            c += (d4 >>> 13); d4 &= 0x1fff;
        
            d5 = c;
            d5 += h0 * r5;
            d5 += h1 * r4;
            d5 += h2 * r3;
            d5 += h3 * r2;
            d5 += h4 * r1;
            c = (d5 >>> 13); d5 &= 0x1fff;
            d5 += h5 * r0;
            d5 += h6 * (5 * r9);
            d5 += h7 * (5 * r8);
            d5 += h8 * (5 * r7);
            d5 += h9 * (5 * r6);
            c += (d5 >>> 13); d5 &= 0x1fff;
        
            d6 = c;
            d6 += h0 * r6;
            d6 += h1 * r5;
            d6 += h2 * r4;
            d6 += h3 * r3;
            d6 += h4 * r2;
            c = (d6 >>> 13); d6 &= 0x1fff;
            d6 += h5 * r1;
            d6 += h6 * r0;
            d6 += h7 * (5 * r9);
            d6 += h8 * (5 * r8);
            d6 += h9 * (5 * r7);
            c += (d6 >>> 13); d6 &= 0x1fff;
        
            d7 = c;
            d7 += h0 * r7;
            d7 += h1 * r6;
            d7 += h2 * r5;
            d7 += h3 * r4;
            d7 += h4 * r3;
            c = (d7 >>> 13); d7 &= 0x1fff;
            d7 += h5 * r2;
            d7 += h6 * r1;
            d7 += h7 * r0;
            d7 += h8 * (5 * r9);
            d7 += h9 * (5 * r8);
            c += (d7 >>> 13); d7 &= 0x1fff;
        
            d8 = c;
            d8 += h0 * r8;
            d8 += h1 * r7;
            d8 += h2 * r6;
            d8 += h3 * r5;
            d8 += h4 * r4;
            c = (d8 >>> 13); d8 &= 0x1fff;
            d8 += h5 * r3;
            d8 += h6 * r2;
            d8 += h7 * r1;
            d8 += h8 * r0;
            d8 += h9 * (5 * r9);
            c += (d8 >>> 13); d8 &= 0x1fff;
        
            d9 = c;
            d9 += h0 * r9;
            d9 += h1 * r8;
            d9 += h2 * r7;
            d9 += h3 * r6;
            d9 += h4 * r5;
            c = (d9 >>> 13); d9 &= 0x1fff;
            d9 += h5 * r4;
            d9 += h6 * r3;
            d9 += h7 * r2;
            d9 += h8 * r1;
            d9 += h9 * r0;
            c += (d9 >>> 13); d9 &= 0x1fff;
        
            c = (((c << 2) + c)) | 0;
            c = (c + d0) | 0;
            d0 = c & 0x1fff;
            c = (c >>> 13);
            d1 += c;
        
            h0 = d0;
            h1 = d1;
            h2 = d2;
            h3 = d3;
            h4 = d4;
            h5 = d5;
            h6 = d6;
            h7 = d7;
            h8 = d8;
            h9 = d9;
        
            mpos += 16;
            bytes -= 16;
          }
          this.h[0] = h0;
          this.h[1] = h1;
          this.h[2] = h2;
          this.h[3] = h3;
          this.h[4] = h4;
          this.h[5] = h5;
          this.h[6] = h6;
          this.h[7] = h7;
          this.h[8] = h8;
          this.h[9] = h9;
        };
        
        poly1305.prototype.finish = function(mac, macpos) {
          var g = new Uint16Array(10);
          var c, mask, f, i;
        
          if (this.leftover) {
            i = this.leftover;
            this.buffer[i++] = 1;
            for (; i < 16; i++) this.buffer[i] = 0;
            this.fin = 1;
            this.blocks(this.buffer, 0, 16);
          }
        
          c = this.h[1] >>> 13;
          this.h[1] &= 0x1fff;
          for (i = 2; i < 10; i++) {
            this.h[i] += c;
            c = this.h[i] >>> 13;
            this.h[i] &= 0x1fff;
          }
          this.h[0] += (c * 5);
          c = this.h[0] >>> 13;
          this.h[0] &= 0x1fff;
          this.h[1] += c;
          c = this.h[1] >>> 13;
          this.h[1] &= 0x1fff;
          this.h[2] += c;
        
          g[0] = this.h[0] + 5;
          c = g[0] >>> 13;
          g[0] &= 0x1fff;
          for (i = 1; i < 10; i++) {
            g[i] = this.h[i] + c;
            c = g[i] >>> 13;
            g[i] &= 0x1fff;
          }
          g[9] -= (1 << 13);
        
          mask = (c ^ 1) - 1;
          for (i = 0; i < 10; i++) g[i] &= mask;
          mask = ~mask;
          for (i = 0; i < 10; i++) this.h[i] = (this.h[i] & mask) | g[i];
        
          this.h[0] = ((this.h[0]       ) | (this.h[1] << 13)                    ) & 0xffff;
          this.h[1] = ((this.h[1] >>>  3) | (this.h[2] << 10)                    ) & 0xffff;
          this.h[2] = ((this.h[2] >>>  6) | (this.h[3] <<  7)                    ) & 0xffff;
          this.h[3] = ((this.h[3] >>>  9) | (this.h[4] <<  4)                    ) & 0xffff;
          this.h[4] = ((this.h[4] >>> 12) | (this.h[5] <<  1) | (this.h[6] << 14)) & 0xffff;
          this.h[5] = ((this.h[6] >>>  2) | (this.h[7] << 11)                    ) & 0xffff;
          this.h[6] = ((this.h[7] >>>  5) | (this.h[8] <<  8)                    ) & 0xffff;
          this.h[7] = ((this.h[8] >>>  8) | (this.h[9] <<  5)                    ) & 0xffff;
        
          f = this.h[0] + this.pad[0];
          this.h[0] = f & 0xffff;
          for (i = 1; i < 8; i++) {
            f = (((this.h[i] + this.pad[i]) | 0) + (f >>> 16)) | 0;
            this.h[i] = f & 0xffff;
          }
        
          mac[macpos+ 0] = (this.h[0] >>> 0) & 0xff;
          mac[macpos+ 1] = (this.h[0] >>> 8) & 0xff;
          mac[macpos+ 2] = (this.h[1] >>> 0) & 0xff;
          mac[macpos+ 3] = (this.h[1] >>> 8) & 0xff;
          mac[macpos+ 4] = (this.h[2] >>> 0) & 0xff;
          mac[macpos+ 5] = (this.h[2] >>> 8) & 0xff;
          mac[macpos+ 6] = (this.h[3] >>> 0) & 0xff;
          mac[macpos+ 7] = (this.h[3] >>> 8) & 0xff;
          mac[macpos+ 8] = (this.h[4] >>> 0) & 0xff;
          mac[macpos+ 9] = (this.h[4] >>> 8) & 0xff;
          mac[macpos+10] = (this.h[5] >>> 0) & 0xff;
          mac[macpos+11] = (this.h[5] >>> 8) & 0xff;
          mac[macpos+12] = (this.h[6] >>> 0) & 0xff;
          mac[macpos+13] = (this.h[6] >>> 8) & 0xff;
          mac[macpos+14] = (this.h[7] >>> 0) & 0xff;
          mac[macpos+15] = (this.h[7] >>> 8) & 0xff;
        };
        
        poly1305.prototype.update = function(m, mpos, bytes) {
          var i, want;
        
          if (this.leftover) {
            want = (16 - this.leftover);
            if (want > bytes)
              want = bytes;
            for (i = 0; i < want; i++)
              this.buffer[this.leftover + i] = m[mpos+i];
            bytes -= want;
            mpos += want;
            this.leftover += want;
            if (this.leftover < 16)
              return;
            this.blocks(this.buffer, 0, 16);
            this.leftover = 0;
          }
        
          if (bytes >= 16) {
            want = bytes - (bytes % 16);
            this.blocks(m, mpos, want);
            mpos += want;
            bytes -= want;
          }
        
          if (bytes) {
            for (i = 0; i < bytes; i++)
              this.buffer[this.leftover + i] = m[mpos+i];
            this.leftover += bytes;
          }
        };
        
        function crypto_onetimeauth(out, outpos, m, mpos, n, k) {
          var s = new poly1305(k);
          s.update(m, mpos, n);
          s.finish(out, outpos);
          return 0;
        }
        
        function crypto_onetimeauth_verify(h, hpos, m, mpos, n, k) {
          var x = new Uint8Array(16);
          crypto_onetimeauth(x,0,m,mpos,n,k);
          return crypto_verify_16(h,hpos,x,0);
        }
        
        function crypto_secretbox(c,m,d,n,k) {
          var i;
          if (d < 32) return -1;
          crypto_stream_xor(c,0,m,0,d,n,k);
          crypto_onetimeauth(c, 16, c, 32, d - 32, c);
          for (i = 0; i < 16; i++) c[i] = 0;
          return 0;
        }
        
        function crypto_secretbox_open(m,c,d,n,k) {
          var i;
          var x = new Uint8Array(32);
          if (d < 32) return -1;
          crypto_stream(x,0,32,n,k);
          if (crypto_onetimeauth_verify(c, 16,c, 32,d - 32,x) !== 0) return -1;
          crypto_stream_xor(m,0,c,0,d,n,k);
          for (i = 0; i < 32; i++) m[i] = 0;
          return 0;
        }
        
        function set25519(r, a) {
          var i;
          for (i = 0; i < 16; i++) r[i] = a[i]|0;
        }
        
        function car25519(o) {
          var i, v, c = 1;
          for (i = 0; i < 16; i++) {
            v = o[i] + c + 65535;
            c = Math.floor(v / 65536);
            o[i] = v - c * 65536;
          }
          o[0] += c-1 + 37 * (c-1);
        }
        
        function sel25519(p, q, b) {
          var t, c = ~(b-1);
          for (var i = 0; i < 16; i++) {
            t = c & (p[i] ^ q[i]);
            p[i] ^= t;
            q[i] ^= t;
          }
        }
        
        function pack25519(o, n) {
          var i, j, b;
          var m = gf(), t = gf();
          for (i = 0; i < 16; i++) t[i] = n[i];
          car25519(t);
          car25519(t);
          car25519(t);
          for (j = 0; j < 2; j++) {
            m[0] = t[0] - 0xffed;
            for (i = 1; i < 15; i++) {
              m[i] = t[i] - 0xffff - ((m[i-1]>>16) & 1);
              m[i-1] &= 0xffff;
            }
            m[15] = t[15] - 0x7fff - ((m[14]>>16) & 1);
            b = (m[15]>>16) & 1;
            m[14] &= 0xffff;
            sel25519(t, m, 1-b);
          }
          for (i = 0; i < 16; i++) {
            o[2*i] = t[i] & 0xff;
            o[2*i+1] = t[i]>>8;
          }
        }
        
        function neq25519(a, b) {
          var c = new Uint8Array(32), d = new Uint8Array(32);
          pack25519(c, a);
          pack25519(d, b);
          return crypto_verify_32(c, 0, d, 0);
        }
        
        function par25519(a) {
          var d = new Uint8Array(32);
          pack25519(d, a);
          return d[0] & 1;
        }
        
        function unpack25519(o, n) {
          var i;
          for (i = 0; i < 16; i++) o[i] = n[2*i] + (n[2*i+1] << 8);
          o[15] &= 0x7fff;
        }
        
        function A(o, a, b) {
          for (var i = 0; i < 16; i++) o[i] = a[i] + b[i];
        }
        
        function Z(o, a, b) {
          for (var i = 0; i < 16; i++) o[i] = a[i] - b[i];
        }
        
        function M(o, a, b) {
          var v, c,
             t0 = 0,  t1 = 0,  t2 = 0,  t3 = 0,  t4 = 0,  t5 = 0,  t6 = 0,  t7 = 0,
             t8 = 0,  t9 = 0, t10 = 0, t11 = 0, t12 = 0, t13 = 0, t14 = 0, t15 = 0,
            t16 = 0, t17 = 0, t18 = 0, t19 = 0, t20 = 0, t21 = 0, t22 = 0, t23 = 0,
            t24 = 0, t25 = 0, t26 = 0, t27 = 0, t28 = 0, t29 = 0, t30 = 0,
            b0 = b[0],
            b1 = b[1],
            b2 = b[2],
            b3 = b[3],
            b4 = b[4],
            b5 = b[5],
            b6 = b[6],
            b7 = b[7],
            b8 = b[8],
            b9 = b[9],
            b10 = b[10],
            b11 = b[11],
            b12 = b[12],
            b13 = b[13],
            b14 = b[14],
            b15 = b[15];
        
          v = a[0];
          t0 += v * b0;
          t1 += v * b1;
          t2 += v * b2;
          t3 += v * b3;
          t4 += v * b4;
          t5 += v * b5;
          t6 += v * b6;
          t7 += v * b7;
          t8 += v * b8;
          t9 += v * b9;
          t10 += v * b10;
          t11 += v * b11;
          t12 += v * b12;
          t13 += v * b13;
          t14 += v * b14;
          t15 += v * b15;
          v = a[1];
          t1 += v * b0;
          t2 += v * b1;
          t3 += v * b2;
          t4 += v * b3;
          t5 += v * b4;
          t6 += v * b5;
          t7 += v * b6;
          t8 += v * b7;
          t9 += v * b8;
          t10 += v * b9;
          t11 += v * b10;
          t12 += v * b11;
          t13 += v * b12;
          t14 += v * b13;
          t15 += v * b14;
          t16 += v * b15;
          v = a[2];
          t2 += v * b0;
          t3 += v * b1;
          t4 += v * b2;
          t5 += v * b3;
          t6 += v * b4;
          t7 += v * b5;
          t8 += v * b6;
          t9 += v * b7;
          t10 += v * b8;
          t11 += v * b9;
          t12 += v * b10;
          t13 += v * b11;
          t14 += v * b12;
          t15 += v * b13;
          t16 += v * b14;
          t17 += v * b15;
          v = a[3];
          t3 += v * b0;
          t4 += v * b1;
          t5 += v * b2;
          t6 += v * b3;
          t7 += v * b4;
          t8 += v * b5;
          t9 += v * b6;
          t10 += v * b7;
          t11 += v * b8;
          t12 += v * b9;
          t13 += v * b10;
          t14 += v * b11;
          t15 += v * b12;
          t16 += v * b13;
          t17 += v * b14;
          t18 += v * b15;
          v = a[4];
          t4 += v * b0;
          t5 += v * b1;
          t6 += v * b2;
          t7 += v * b3;
          t8 += v * b4;
          t9 += v * b5;
          t10 += v * b6;
          t11 += v * b7;
          t12 += v * b8;
          t13 += v * b9;
          t14 += v * b10;
          t15 += v * b11;
          t16 += v * b12;
          t17 += v * b13;
          t18 += v * b14;
          t19 += v * b15;
          v = a[5];
          t5 += v * b0;
          t6 += v * b1;
          t7 += v * b2;
          t8 += v * b3;
          t9 += v * b4;
          t10 += v * b5;
          t11 += v * b6;
          t12 += v * b7;
          t13 += v * b8;
          t14 += v * b9;
          t15 += v * b10;
          t16 += v * b11;
          t17 += v * b12;
          t18 += v * b13;
          t19 += v * b14;
          t20 += v * b15;
          v = a[6];
          t6 += v * b0;
          t7 += v * b1;
          t8 += v * b2;
          t9 += v * b3;
          t10 += v * b4;
          t11 += v * b5;
          t12 += v * b6;
          t13 += v * b7;
          t14 += v * b8;
          t15 += v * b9;
          t16 += v * b10;
          t17 += v * b11;
          t18 += v * b12;
          t19 += v * b13;
          t20 += v * b14;
          t21 += v * b15;
          v = a[7];
          t7 += v * b0;
          t8 += v * b1;
          t9 += v * b2;
          t10 += v * b3;
          t11 += v * b4;
          t12 += v * b5;
          t13 += v * b6;
          t14 += v * b7;
          t15 += v * b8;
          t16 += v * b9;
          t17 += v * b10;
          t18 += v * b11;
          t19 += v * b12;
          t20 += v * b13;
          t21 += v * b14;
          t22 += v * b15;
          v = a[8];
          t8 += v * b0;
          t9 += v * b1;
          t10 += v * b2;
          t11 += v * b3;
          t12 += v * b4;
          t13 += v * b5;
          t14 += v * b6;
          t15 += v * b7;
          t16 += v * b8;
          t17 += v * b9;
          t18 += v * b10;
          t19 += v * b11;
          t20 += v * b12;
          t21 += v * b13;
          t22 += v * b14;
          t23 += v * b15;
          v = a[9];
          t9 += v * b0;
          t10 += v * b1;
          t11 += v * b2;
          t12 += v * b3;
          t13 += v * b4;
          t14 += v * b5;
          t15 += v * b6;
          t16 += v * b7;
          t17 += v * b8;
          t18 += v * b9;
          t19 += v * b10;
          t20 += v * b11;
          t21 += v * b12;
          t22 += v * b13;
          t23 += v * b14;
          t24 += v * b15;
          v = a[10];
          t10 += v * b0;
          t11 += v * b1;
          t12 += v * b2;
          t13 += v * b3;
          t14 += v * b4;
          t15 += v * b5;
          t16 += v * b6;
          t17 += v * b7;
          t18 += v * b8;
          t19 += v * b9;
          t20 += v * b10;
          t21 += v * b11;
          t22 += v * b12;
          t23 += v * b13;
          t24 += v * b14;
          t25 += v * b15;
          v = a[11];
          t11 += v * b0;
          t12 += v * b1;
          t13 += v * b2;
          t14 += v * b3;
          t15 += v * b4;
          t16 += v * b5;
          t17 += v * b6;
          t18 += v * b7;
          t19 += v * b8;
          t20 += v * b9;
          t21 += v * b10;
          t22 += v * b11;
          t23 += v * b12;
          t24 += v * b13;
          t25 += v * b14;
          t26 += v * b15;
          v = a[12];
          t12 += v * b0;
          t13 += v * b1;
          t14 += v * b2;
          t15 += v * b3;
          t16 += v * b4;
          t17 += v * b5;
          t18 += v * b6;
          t19 += v * b7;
          t20 += v * b8;
          t21 += v * b9;
          t22 += v * b10;
          t23 += v * b11;
          t24 += v * b12;
          t25 += v * b13;
          t26 += v * b14;
          t27 += v * b15;
          v = a[13];
          t13 += v * b0;
          t14 += v * b1;
          t15 += v * b2;
          t16 += v * b3;
          t17 += v * b4;
          t18 += v * b5;
          t19 += v * b6;
          t20 += v * b7;
          t21 += v * b8;
          t22 += v * b9;
          t23 += v * b10;
          t24 += v * b11;
          t25 += v * b12;
          t26 += v * b13;
          t27 += v * b14;
          t28 += v * b15;
          v = a[14];
          t14 += v * b0;
          t15 += v * b1;
          t16 += v * b2;
          t17 += v * b3;
          t18 += v * b4;
          t19 += v * b5;
          t20 += v * b6;
          t21 += v * b7;
          t22 += v * b8;
          t23 += v * b9;
          t24 += v * b10;
          t25 += v * b11;
          t26 += v * b12;
          t27 += v * b13;
          t28 += v * b14;
          t29 += v * b15;
          v = a[15];
          t15 += v * b0;
          t16 += v * b1;
          t17 += v * b2;
          t18 += v * b3;
          t19 += v * b4;
          t20 += v * b5;
          t21 += v * b6;
          t22 += v * b7;
          t23 += v * b8;
          t24 += v * b9;
          t25 += v * b10;
          t26 += v * b11;
          t27 += v * b12;
          t28 += v * b13;
          t29 += v * b14;
          t30 += v * b15;
        
          t0  += 38 * t16;
          t1  += 38 * t17;
          t2  += 38 * t18;
          t3  += 38 * t19;
          t4  += 38 * t20;
          t5  += 38 * t21;
          t6  += 38 * t22;
          t7  += 38 * t23;
          t8  += 38 * t24;
          t9  += 38 * t25;
          t10 += 38 * t26;
          t11 += 38 * t27;
          t12 += 38 * t28;
          t13 += 38 * t29;
          t14 += 38 * t30;
          // t15 left as is
        
          // first car
          c = 1;
          v =  t0 + c + 65535; c = Math.floor(v / 65536);  t0 = v - c * 65536;
          v =  t1 + c + 65535; c = Math.floor(v / 65536);  t1 = v - c * 65536;
          v =  t2 + c + 65535; c = Math.floor(v / 65536);  t2 = v - c * 65536;
          v =  t3 + c + 65535; c = Math.floor(v / 65536);  t3 = v - c * 65536;
          v =  t4 + c + 65535; c = Math.floor(v / 65536);  t4 = v - c * 65536;
          v =  t5 + c + 65535; c = Math.floor(v / 65536);  t5 = v - c * 65536;
          v =  t6 + c + 65535; c = Math.floor(v / 65536);  t6 = v - c * 65536;
          v =  t7 + c + 65535; c = Math.floor(v / 65536);  t7 = v - c * 65536;
          v =  t8 + c + 65535; c = Math.floor(v / 65536);  t8 = v - c * 65536;
          v =  t9 + c + 65535; c = Math.floor(v / 65536);  t9 = v - c * 65536;
          v = t10 + c + 65535; c = Math.floor(v / 65536); t10 = v - c * 65536;
          v = t11 + c + 65535; c = Math.floor(v / 65536); t11 = v - c * 65536;
          v = t12 + c + 65535; c = Math.floor(v / 65536); t12 = v - c * 65536;
          v = t13 + c + 65535; c = Math.floor(v / 65536); t13 = v - c * 65536;
          v = t14 + c + 65535; c = Math.floor(v / 65536); t14 = v - c * 65536;
          v = t15 + c + 65535; c = Math.floor(v / 65536); t15 = v - c * 65536;
          t0 += c-1 + 37 * (c-1);
        
          // second car
          c = 1;
          v =  t0 + c + 65535; c = Math.floor(v / 65536);  t0 = v - c * 65536;
          v =  t1 + c + 65535; c = Math.floor(v / 65536);  t1 = v - c * 65536;
          v =  t2 + c + 65535; c = Math.floor(v / 65536);  t2 = v - c * 65536;
          v =  t3 + c + 65535; c = Math.floor(v / 65536);  t3 = v - c * 65536;
          v =  t4 + c + 65535; c = Math.floor(v / 65536);  t4 = v - c * 65536;
          v =  t5 + c + 65535; c = Math.floor(v / 65536);  t5 = v - c * 65536;
          v =  t6 + c + 65535; c = Math.floor(v / 65536);  t6 = v - c * 65536;
          v =  t7 + c + 65535; c = Math.floor(v / 65536);  t7 = v - c * 65536;
          v =  t8 + c + 65535; c = Math.floor(v / 65536);  t8 = v - c * 65536;
          v =  t9 + c + 65535; c = Math.floor(v / 65536);  t9 = v - c * 65536;
          v = t10 + c + 65535; c = Math.floor(v / 65536); t10 = v - c * 65536;
          v = t11 + c + 65535; c = Math.floor(v / 65536); t11 = v - c * 65536;
          v = t12 + c + 65535; c = Math.floor(v / 65536); t12 = v - c * 65536;
          v = t13 + c + 65535; c = Math.floor(v / 65536); t13 = v - c * 65536;
          v = t14 + c + 65535; c = Math.floor(v / 65536); t14 = v - c * 65536;
          v = t15 + c + 65535; c = Math.floor(v / 65536); t15 = v - c * 65536;
          t0 += c-1 + 37 * (c-1);
        
          o[ 0] = t0;
          o[ 1] = t1;
          o[ 2] = t2;
          o[ 3] = t3;
          o[ 4] = t4;
          o[ 5] = t5;
          o[ 6] = t6;
          o[ 7] = t7;
          o[ 8] = t8;
          o[ 9] = t9;
          o[10] = t10;
          o[11] = t11;
          o[12] = t12;
          o[13] = t13;
          o[14] = t14;
          o[15] = t15;
        }
        
        function S(o, a) {
          M(o, a, a);
        }
        
        function inv25519(o, i) {
          var c = gf();
          var a;
          for (a = 0; a < 16; a++) c[a] = i[a];
          for (a = 253; a >= 0; a--) {
            S(c, c);
            if(a !== 2 && a !== 4) M(c, c, i);
          }
          for (a = 0; a < 16; a++) o[a] = c[a];
        }
        
        function pow2523(o, i) {
          var c = gf();
          var a;
          for (a = 0; a < 16; a++) c[a] = i[a];
          for (a = 250; a >= 0; a--) {
              S(c, c);
              if(a !== 1) M(c, c, i);
          }
          for (a = 0; a < 16; a++) o[a] = c[a];
        }
        
        function crypto_scalarmult(q, n, p) {
          var z = new Uint8Array(32);
          var x = new Float64Array(80), r, i;
          var a = gf(), b = gf(), c = gf(),
              d = gf(), e = gf(), f = gf();
          for (i = 0; i < 31; i++) z[i] = n[i];
          z[31]=(n[31]&127)|64;
          z[0]&=248;
          unpack25519(x,p);
          for (i = 0; i < 16; i++) {
            b[i]=x[i];
            d[i]=a[i]=c[i]=0;
          }
          a[0]=d[0]=1;
          for (i=254; i>=0; --i) {
            r=(z[i>>>3]>>>(i&7))&1;
            sel25519(a,b,r);
            sel25519(c,d,r);
            A(e,a,c);
            Z(a,a,c);
            A(c,b,d);
            Z(b,b,d);
            S(d,e);
            S(f,a);
            M(a,c,a);
            M(c,b,e);
            A(e,a,c);
            Z(a,a,c);
            S(b,a);
            Z(c,d,f);
            M(a,c,_121665);
            A(a,a,d);
            M(c,c,a);
            M(a,d,f);
            M(d,b,x);
            S(b,e);
            sel25519(a,b,r);
            sel25519(c,d,r);
          }
          for (i = 0; i < 16; i++) {
            x[i+16]=a[i];
            x[i+32]=c[i];
            x[i+48]=b[i];
            x[i+64]=d[i];
          }
          var x32 = x.subarray(32);
          var x16 = x.subarray(16);
          inv25519(x32,x32);
          M(x16,x16,x32);
          pack25519(q,x16);
          return 0;
        }
        
        function crypto_scalarmult_base(q, n) {
          return crypto_scalarmult(q, n, _9);
        }
        
        function crypto_box_keypair(y, x) {
          randombytes(x, 32);
          return crypto_scalarmult_base(y, x);
        }
        
        function crypto_box_beforenm(k, y, x) {
          var s = new Uint8Array(32);
          crypto_scalarmult(s, x, y);
          return crypto_core_hsalsa20(k, _0, s, sigma);
        }
        
        var crypto_box_afternm = crypto_secretbox;
        var crypto_box_open_afternm = crypto_secretbox_open;
        
        function crypto_box(c, m, d, n, y, x) {
          var k = new Uint8Array(32);
          crypto_box_beforenm(k, y, x);
          return crypto_box_afternm(c, m, d, n, k);
        }
        
        function crypto_box_open(m, c, d, n, y, x) {
          var k = new Uint8Array(32);
          crypto_box_beforenm(k, y, x);
          return crypto_box_open_afternm(m, c, d, n, k);
        }
        
        var K = [
          0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,
          0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,
          0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,
          0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,
          0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,
          0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,
          0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,
          0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,
          0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,
          0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,
          0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,
          0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,
          0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,
          0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,
          0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,
          0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,
          0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,
          0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,
          0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,
          0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,
          0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,
          0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,
          0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,
          0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,
          0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,
          0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,
          0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,
          0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,
          0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,
          0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,
          0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,
          0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,
          0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,
          0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,
          0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,
          0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,
          0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,
          0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,
          0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,
          0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817
        ];
        
        function crypto_hashblocks_hl(hh, hl, m, n) {
          var wh = new Int32Array(16), wl = new Int32Array(16),
              bh0, bh1, bh2, bh3, bh4, bh5, bh6, bh7,
              bl0, bl1, bl2, bl3, bl4, bl5, bl6, bl7,
              th, tl, i, j, h, l, a, b, c, d;
        
          var ah0 = hh[0],
              ah1 = hh[1],
              ah2 = hh[2],
              ah3 = hh[3],
              ah4 = hh[4],
              ah5 = hh[5],
              ah6 = hh[6],
              ah7 = hh[7],
        
              al0 = hl[0],
              al1 = hl[1],
              al2 = hl[2],
              al3 = hl[3],
              al4 = hl[4],
              al5 = hl[5],
              al6 = hl[6],
              al7 = hl[7];
        
          var pos = 0;
          while (n >= 128) {
            for (i = 0; i < 16; i++) {
              j = 8 * i + pos;
              wh[i] = (m[j+0] << 24) | (m[j+1] << 16) | (m[j+2] << 8) | m[j+3];
              wl[i] = (m[j+4] << 24) | (m[j+5] << 16) | (m[j+6] << 8) | m[j+7];
            }
            for (i = 0; i < 80; i++) {
              bh0 = ah0;
              bh1 = ah1;
              bh2 = ah2;
              bh3 = ah3;
              bh4 = ah4;
              bh5 = ah5;
              bh6 = ah6;
              bh7 = ah7;
        
              bl0 = al0;
              bl1 = al1;
              bl2 = al2;
              bl3 = al3;
              bl4 = al4;
              bl5 = al5;
              bl6 = al6;
              bl7 = al7;
        
              // add
              h = ah7;
              l = al7;
        
              a = l & 0xffff; b = l >>> 16;
              c = h & 0xffff; d = h >>> 16;
        
              // Sigma1
              h = ((ah4 >>> 14) | (al4 << (32-14))) ^ ((ah4 >>> 18) | (al4 << (32-18))) ^ ((al4 >>> (41-32)) | (ah4 << (32-(41-32))));
              l = ((al4 >>> 14) | (ah4 << (32-14))) ^ ((al4 >>> 18) | (ah4 << (32-18))) ^ ((ah4 >>> (41-32)) | (al4 << (32-(41-32))));
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              // Ch
              h = (ah4 & ah5) ^ (~ah4 & ah6);
              l = (al4 & al5) ^ (~al4 & al6);
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              // K
              h = K[i*2];
              l = K[i*2+1];
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              // w
              h = wh[i%16];
              l = wl[i%16];
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              b += a >>> 16;
              c += b >>> 16;
              d += c >>> 16;
        
              th = c & 0xffff | d << 16;
              tl = a & 0xffff | b << 16;
        
              // add
              h = th;
              l = tl;
        
              a = l & 0xffff; b = l >>> 16;
              c = h & 0xffff; d = h >>> 16;
        
              // Sigma0
              h = ((ah0 >>> 28) | (al0 << (32-28))) ^ ((al0 >>> (34-32)) | (ah0 << (32-(34-32)))) ^ ((al0 >>> (39-32)) | (ah0 << (32-(39-32))));
              l = ((al0 >>> 28) | (ah0 << (32-28))) ^ ((ah0 >>> (34-32)) | (al0 << (32-(34-32)))) ^ ((ah0 >>> (39-32)) | (al0 << (32-(39-32))));
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              // Maj
              h = (ah0 & ah1) ^ (ah0 & ah2) ^ (ah1 & ah2);
              l = (al0 & al1) ^ (al0 & al2) ^ (al1 & al2);
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              b += a >>> 16;
              c += b >>> 16;
              d += c >>> 16;
        
              bh7 = (c & 0xffff) | (d << 16);
              bl7 = (a & 0xffff) | (b << 16);
        
              // add
              h = bh3;
              l = bl3;
        
              a = l & 0xffff; b = l >>> 16;
              c = h & 0xffff; d = h >>> 16;
        
              h = th;
              l = tl;
        
              a += l & 0xffff; b += l >>> 16;
              c += h & 0xffff; d += h >>> 16;
        
              b += a >>> 16;
              c += b >>> 16;
              d += c >>> 16;
        
              bh3 = (c & 0xffff) | (d << 16);
              bl3 = (a & 0xffff) | (b << 16);
        
              ah1 = bh0;
              ah2 = bh1;
              ah3 = bh2;
              ah4 = bh3;
              ah5 = bh4;
              ah6 = bh5;
              ah7 = bh6;
              ah0 = bh7;
        
              al1 = bl0;
              al2 = bl1;
              al3 = bl2;
              al4 = bl3;
              al5 = bl4;
              al6 = bl5;
              al7 = bl6;
              al0 = bl7;
        
              if (i%16 === 15) {
                for (j = 0; j < 16; j++) {
                  // add
                  h = wh[j];
                  l = wl[j];
        
                  a = l & 0xffff; b = l >>> 16;
                  c = h & 0xffff; d = h >>> 16;
        
                  h = wh[(j+9)%16];
                  l = wl[(j+9)%16];
        
                  a += l & 0xffff; b += l >>> 16;
                  c += h & 0xffff; d += h >>> 16;
        
                  // sigma0
                  th = wh[(j+1)%16];
                  tl = wl[(j+1)%16];
                  h = ((th >>> 1) | (tl << (32-1))) ^ ((th >>> 8) | (tl << (32-8))) ^ (th >>> 7);
                  l = ((tl >>> 1) | (th << (32-1))) ^ ((tl >>> 8) | (th << (32-8))) ^ ((tl >>> 7) | (th << (32-7)));
        
                  a += l & 0xffff; b += l >>> 16;
                  c += h & 0xffff; d += h >>> 16;
        
                  // sigma1
                  th = wh[(j+14)%16];
                  tl = wl[(j+14)%16];
                  h = ((th >>> 19) | (tl << (32-19))) ^ ((tl >>> (61-32)) | (th << (32-(61-32)))) ^ (th >>> 6);
                  l = ((tl >>> 19) | (th << (32-19))) ^ ((th >>> (61-32)) | (tl << (32-(61-32)))) ^ ((tl >>> 6) | (th << (32-6)));
        
                  a += l & 0xffff; b += l >>> 16;
                  c += h & 0xffff; d += h >>> 16;
        
                  b += a >>> 16;
                  c += b >>> 16;
                  d += c >>> 16;
        
                  wh[j] = (c & 0xffff) | (d << 16);
                  wl[j] = (a & 0xffff) | (b << 16);
                }
              }
            }
        
            // add
            h = ah0;
            l = al0;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[0];
            l = hl[0];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[0] = ah0 = (c & 0xffff) | (d << 16);
            hl[0] = al0 = (a & 0xffff) | (b << 16);
        
            h = ah1;
            l = al1;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[1];
            l = hl[1];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[1] = ah1 = (c & 0xffff) | (d << 16);
            hl[1] = al1 = (a & 0xffff) | (b << 16);
        
            h = ah2;
            l = al2;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[2];
            l = hl[2];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[2] = ah2 = (c & 0xffff) | (d << 16);
            hl[2] = al2 = (a & 0xffff) | (b << 16);
        
            h = ah3;
            l = al3;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[3];
            l = hl[3];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[3] = ah3 = (c & 0xffff) | (d << 16);
            hl[3] = al3 = (a & 0xffff) | (b << 16);
        
            h = ah4;
            l = al4;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[4];
            l = hl[4];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[4] = ah4 = (c & 0xffff) | (d << 16);
            hl[4] = al4 = (a & 0xffff) | (b << 16);
        
            h = ah5;
            l = al5;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[5];
            l = hl[5];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[5] = ah5 = (c & 0xffff) | (d << 16);
            hl[5] = al5 = (a & 0xffff) | (b << 16);
        
            h = ah6;
            l = al6;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[6];
            l = hl[6];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[6] = ah6 = (c & 0xffff) | (d << 16);
            hl[6] = al6 = (a & 0xffff) | (b << 16);
        
            h = ah7;
            l = al7;
        
            a = l & 0xffff; b = l >>> 16;
            c = h & 0xffff; d = h >>> 16;
        
            h = hh[7];
            l = hl[7];
        
            a += l & 0xffff; b += l >>> 16;
            c += h & 0xffff; d += h >>> 16;
        
            b += a >>> 16;
            c += b >>> 16;
            d += c >>> 16;
        
            hh[7] = ah7 = (c & 0xffff) | (d << 16);
            hl[7] = al7 = (a & 0xffff) | (b << 16);
        
            pos += 128;
            n -= 128;
          }
        
          return n;
        }
        
        function crypto_hash(out, m, n) {
          var hh = new Int32Array(8),
              hl = new Int32Array(8),
              x = new Uint8Array(256),
              i, b = n;
        
          hh[0] = 0x6a09e667;
          hh[1] = 0xbb67ae85;
          hh[2] = 0x3c6ef372;
          hh[3] = 0xa54ff53a;
          hh[4] = 0x510e527f;
          hh[5] = 0x9b05688c;
          hh[6] = 0x1f83d9ab;
          hh[7] = 0x5be0cd19;
        
          hl[0] = 0xf3bcc908;
          hl[1] = 0x84caa73b;
          hl[2] = 0xfe94f82b;
          hl[3] = 0x5f1d36f1;
          hl[4] = 0xade682d1;
          hl[5] = 0x2b3e6c1f;
          hl[6] = 0xfb41bd6b;
          hl[7] = 0x137e2179;
        
          crypto_hashblocks_hl(hh, hl, m, n);
          n %= 128;
        
          for (i = 0; i < n; i++) x[i] = m[b-n+i];
          x[n] = 128;
        
          n = 256-128*(n<112?1:0);
          x[n-9] = 0;
          ts64(x, n-8,  (b / 0x20000000) | 0, b << 3);
          crypto_hashblocks_hl(hh, hl, x, n);
        
          for (i = 0; i < 8; i++) ts64(out, 8*i, hh[i], hl[i]);
        
          return 0;
        }
        
        function add(p, q) {
          var a = gf(), b = gf(), c = gf(),
              d = gf(), e = gf(), f = gf(),
              g = gf(), h = gf(), t = gf();
        
          Z(a, p[1], p[0]);
          Z(t, q[1], q[0]);
          M(a, a, t);
          A(b, p[0], p[1]);
          A(t, q[0], q[1]);
          M(b, b, t);
          M(c, p[3], q[3]);
          M(c, c, D2);
          M(d, p[2], q[2]);
          A(d, d, d);
          Z(e, b, a);
          Z(f, d, c);
          A(g, d, c);
          A(h, b, a);
        
          M(p[0], e, f);
          M(p[1], h, g);
          M(p[2], g, f);
          M(p[3], e, h);
        }
        
        function cswap(p, q, b) {
          var i;
          for (i = 0; i < 4; i++) {
            sel25519(p[i], q[i], b);
          }
        }
        
        function pack(r, p) {
          var tx = gf(), ty = gf(), zi = gf();
          inv25519(zi, p[2]);
          M(tx, p[0], zi);
          M(ty, p[1], zi);
          pack25519(r, ty);
          r[31] ^= par25519(tx) << 7;
        }
        
        function scalarmult(p, q, s) {
          var b, i;
          set25519(p[0], gf0);
          set25519(p[1], gf1);
          set25519(p[2], gf1);
          set25519(p[3], gf0);
          for (i = 255; i >= 0; --i) {
            b = (s[(i/8)|0] >> (i&7)) & 1;
            cswap(p, q, b);
            add(q, p);
            add(p, p);
            cswap(p, q, b);
          }
        }
        
        function scalarbase(p, s) {
          var q = [gf(), gf(), gf(), gf()];
          set25519(q[0], X);
          set25519(q[1], Y);
          set25519(q[2], gf1);
          M(q[3], X, Y);
          scalarmult(p, q, s);
        }
        
        function crypto_sign_keypair(pk, sk, seeded) {
          var d = new Uint8Array(64);
          var p = [gf(), gf(), gf(), gf()];
          var i;
        
          if (!seeded) randombytes(sk, 32);
          crypto_hash(d, sk, 32);
          d[0] &= 248;
          d[31] &= 127;
          d[31] |= 64;
        
          scalarbase(p, d);
          pack(pk, p);
        
          for (i = 0; i < 32; i++) sk[i+32] = pk[i];
          return 0;
        }
        
        var L = new Float64Array([0xed, 0xd3, 0xf5, 0x5c, 0x1a, 0x63, 0x12, 0x58, 0xd6, 0x9c, 0xf7, 0xa2, 0xde, 0xf9, 0xde, 0x14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x10]);
        
        function modL(r, x) {
          var carry, i, j, k;
          for (i = 63; i >= 32; --i) {
            carry = 0;
            for (j = i - 32, k = i - 12; j < k; ++j) {
              x[j] += carry - 16 * x[i] * L[j - (i - 32)];
              carry = Math.floor((x[j] + 128) / 256);
              x[j] -= carry * 256;
            }
            x[j] += carry;
            x[i] = 0;
          }
          carry = 0;
          for (j = 0; j < 32; j++) {
            x[j] += carry - (x[31] >> 4) * L[j];
            carry = x[j] >> 8;
            x[j] &= 255;
          }
          for (j = 0; j < 32; j++) x[j] -= carry * L[j];
          for (i = 0; i < 32; i++) {
            x[i+1] += x[i] >> 8;
            r[i] = x[i] & 255;
          }
        }
        
        function reduce(r) {
          var x = new Float64Array(64), i;
          for (i = 0; i < 64; i++) x[i] = r[i];
          for (i = 0; i < 64; i++) r[i] = 0;
          modL(r, x);
        }
        
        // Note: difference from C - smlen returned, not passed as argument.
        function crypto_sign(sm, m, n, sk) {
          var d = new Uint8Array(64), h = new Uint8Array(64), r = new Uint8Array(64);
          var i, j, x = new Float64Array(64);
          var p = [gf(), gf(), gf(), gf()];
        
          crypto_hash(d, sk, 32);
          d[0] &= 248;
          d[31] &= 127;
          d[31] |= 64;
        
          var smlen = n + 64;
          for (i = 0; i < n; i++) sm[64 + i] = m[i];
          for (i = 0; i < 32; i++) sm[32 + i] = d[32 + i];
        
          crypto_hash(r, sm.subarray(32), n+32);
          reduce(r);
          scalarbase(p, r);
          pack(sm, p);
        
          for (i = 32; i < 64; i++) sm[i] = sk[i];
          crypto_hash(h, sm, n + 64);
          reduce(h);
        
          for (i = 0; i < 64; i++) x[i] = 0;
          for (i = 0; i < 32; i++) x[i] = r[i];
          for (i = 0; i < 32; i++) {
            for (j = 0; j < 32; j++) {
              x[i+j] += h[i] * d[j];
            }
          }
        
          modL(sm.subarray(32), x);
          return smlen;
        }
        
        function unpackneg(r, p) {
          var t = gf(), chk = gf(), num = gf(),
              den = gf(), den2 = gf(), den4 = gf(),
              den6 = gf();
        
          set25519(r[2], gf1);
          unpack25519(r[1], p);
          S(num, r[1]);
          M(den, num, D);
          Z(num, num, r[2]);
          A(den, r[2], den);
        
          S(den2, den);
          S(den4, den2);
          M(den6, den4, den2);
          M(t, den6, num);
          M(t, t, den);
        
          pow2523(t, t);
          M(t, t, num);
          M(t, t, den);
          M(t, t, den);
          M(r[0], t, den);
        
          S(chk, r[0]);
          M(chk, chk, den);
          if (neq25519(chk, num)) M(r[0], r[0], I);
        
          S(chk, r[0]);
          M(chk, chk, den);
          if (neq25519(chk, num)) return -1;
        
          if (par25519(r[0]) === (p[31]>>7)) Z(r[0], gf0, r[0]);
        
          M(r[3], r[0], r[1]);
          return 0;
        }
        
        function crypto_sign_open(m, sm, n, pk) {
          var i;
          var t = new Uint8Array(32), h = new Uint8Array(64);
          var p = [gf(), gf(), gf(), gf()],
              q = [gf(), gf(), gf(), gf()];
        
          if (n < 64) return -1;
        
          if (unpackneg(q, pk)) return -1;
        
          for (i = 0; i < n; i++) m[i] = sm[i];
          for (i = 0; i < 32; i++) m[i+32] = pk[i];
          crypto_hash(h, m, n);
          reduce(h);
          scalarmult(p, q, h);
        
          scalarbase(q, sm.subarray(32));
          add(p, q);
          pack(t, p);
        
          n -= 64;
          if (crypto_verify_32(sm, 0, t, 0)) {
            for (i = 0; i < n; i++) m[i] = 0;
            return -1;
          }
        
          for (i = 0; i < n; i++) m[i] = sm[i + 64];
          return n;
        }
        
        var crypto_secretbox_KEYBYTES = 32,
            crypto_secretbox_NONCEBYTES = 24,
            crypto_secretbox_ZEROBYTES = 32,
            crypto_secretbox_BOXZEROBYTES = 16,
            crypto_scalarmult_BYTES = 32,
            crypto_scalarmult_SCALARBYTES = 32,
            crypto_box_PUBLICKEYBYTES = 32,
            crypto_box_SECRETKEYBYTES = 32,
            crypto_box_BEFORENMBYTES = 32,
            crypto_box_NONCEBYTES = crypto_secretbox_NONCEBYTES,
            crypto_box_ZEROBYTES = crypto_secretbox_ZEROBYTES,
            crypto_box_BOXZEROBYTES = crypto_secretbox_BOXZEROBYTES,
            crypto_sign_BYTES = 64,
            crypto_sign_PUBLICKEYBYTES = 32,
            crypto_sign_SECRETKEYBYTES = 64,
            crypto_sign_SEEDBYTES = 32,
            crypto_hash_BYTES = 64;
        
        nacl.lowlevel = {
          crypto_core_hsalsa20: crypto_core_hsalsa20,
          crypto_stream_xor: crypto_stream_xor,
          crypto_stream: crypto_stream,
          crypto_stream_salsa20_xor: crypto_stream_salsa20_xor,
          crypto_stream_salsa20: crypto_stream_salsa20,
          crypto_onetimeauth: crypto_onetimeauth,
          crypto_onetimeauth_verify: crypto_onetimeauth_verify,
          crypto_verify_16: crypto_verify_16,
          crypto_verify_32: crypto_verify_32,
          crypto_secretbox: crypto_secretbox,
          crypto_secretbox_open: crypto_secretbox_open,
          crypto_scalarmult: crypto_scalarmult,
          crypto_scalarmult_base: crypto_scalarmult_base,
          crypto_box_beforenm: crypto_box_beforenm,
          crypto_box_afternm: crypto_box_afternm,
          crypto_box: crypto_box,
          crypto_box_open: crypto_box_open,
          crypto_box_keypair: crypto_box_keypair,
          crypto_hash: crypto_hash,
          crypto_sign: crypto_sign,
          crypto_sign_keypair: crypto_sign_keypair,
          crypto_sign_open: crypto_sign_open,
        
          crypto_secretbox_KEYBYTES: crypto_secretbox_KEYBYTES,
          crypto_secretbox_NONCEBYTES: crypto_secretbox_NONCEBYTES,
          crypto_secretbox_ZEROBYTES: crypto_secretbox_ZEROBYTES,
          crypto_secretbox_BOXZEROBYTES: crypto_secretbox_BOXZEROBYTES,
          crypto_scalarmult_BYTES: crypto_scalarmult_BYTES,
          crypto_scalarmult_SCALARBYTES: crypto_scalarmult_SCALARBYTES,
          crypto_box_PUBLICKEYBYTES: crypto_box_PUBLICKEYBYTES,
          crypto_box_SECRETKEYBYTES: crypto_box_SECRETKEYBYTES,
          crypto_box_BEFORENMBYTES: crypto_box_BEFORENMBYTES,
          crypto_box_NONCEBYTES: crypto_box_NONCEBYTES,
          crypto_box_ZEROBYTES: crypto_box_ZEROBYTES,
          crypto_box_BOXZEROBYTES: crypto_box_BOXZEROBYTES,
          crypto_sign_BYTES: crypto_sign_BYTES,
          crypto_sign_PUBLICKEYBYTES: crypto_sign_PUBLICKEYBYTES,
          crypto_sign_SECRETKEYBYTES: crypto_sign_SECRETKEYBYTES,
          crypto_sign_SEEDBYTES: crypto_sign_SEEDBYTES,
          crypto_hash_BYTES: crypto_hash_BYTES,
        
          gf: gf,
          D: D,
          L: L,
          pack25519: pack25519,
          unpack25519: unpack25519,
          M: M,
          A: A,
          S: S,
          Z: Z,
          pow2523: pow2523,
          add: add,
          set25519: set25519,
          modL: modL,
          scalarmult: scalarmult,
          scalarbase: scalarbase,
        };
        
        /* High-level API */
        
        function checkLengths(k, n) {
          if (k.length !== crypto_secretbox_KEYBYTES) throw new Error('bad key size');
          if (n.length !== crypto_secretbox_NONCEBYTES) throw new Error('bad nonce size');
        }
        
        function checkBoxLengths(pk, sk) {
          if (pk.length !== crypto_box_PUBLICKEYBYTES) throw new Error('bad public key size');
          if (sk.length !== crypto_box_SECRETKEYBYTES) throw new Error('bad secret key size');
        }
        
        function checkArrayTypes() {
          for (var i = 0; i < arguments.length; i++) {
            if (!(arguments[i] instanceof Uint8Array))
              throw new TypeError('unexpected type, use Uint8Array');
          }
        }
        
        function cleanup(arr) {
          for (var i = 0; i < arr.length; i++) arr[i] = 0;
        }
        
        nacl.randomBytes = function(n) {
          var b = new Uint8Array(n);
          randombytes(b, n);
          return b;
        };
        
        nacl.secretbox = function(msg, nonce, key) {
          checkArrayTypes(msg, nonce, key);
          checkLengths(key, nonce);
          var m = new Uint8Array(crypto_secretbox_ZEROBYTES + msg.length);
          var c = new Uint8Array(m.length);
          for (var i = 0; i < msg.length; i++) m[i+crypto_secretbox_ZEROBYTES] = msg[i];
          crypto_secretbox(c, m, m.length, nonce, key);
          return c.subarray(crypto_secretbox_BOXZEROBYTES);
        };
        
        nacl.secretbox.open = function(box, nonce, key) {
          checkArrayTypes(box, nonce, key);
          checkLengths(key, nonce);
          var c = new Uint8Array(crypto_secretbox_BOXZEROBYTES + box.length);
          var m = new Uint8Array(c.length);
          for (var i = 0; i < box.length; i++) c[i+crypto_secretbox_BOXZEROBYTES] = box[i];
          if (c.length < 32) return null;
          if (crypto_secretbox_open(m, c, c.length, nonce, key) !== 0) return null;
          return m.subarray(crypto_secretbox_ZEROBYTES);
        };
        
        nacl.secretbox.keyLength = crypto_secretbox_KEYBYTES;
        nacl.secretbox.nonceLength = crypto_secretbox_NONCEBYTES;
        nacl.secretbox.overheadLength = crypto_secretbox_BOXZEROBYTES;
        
        nacl.scalarMult = function(n, p) {
          checkArrayTypes(n, p);
          if (n.length !== crypto_scalarmult_SCALARBYTES) throw new Error('bad n size');
          if (p.length !== crypto_scalarmult_BYTES) throw new Error('bad p size');
          var q = new Uint8Array(crypto_scalarmult_BYTES);
          crypto_scalarmult(q, n, p);
          return q;
        };
        
        nacl.scalarMult.base = function(n) {
          checkArrayTypes(n);
          if (n.length !== crypto_scalarmult_SCALARBYTES) throw new Error('bad n size');
          var q = new Uint8Array(crypto_scalarmult_BYTES);
          crypto_scalarmult_base(q, n);
          return q;
        };
        
        nacl.scalarMult.scalarLength = crypto_scalarmult_SCALARBYTES;
        nacl.scalarMult.groupElementLength = crypto_scalarmult_BYTES;
        
        nacl.box = function(msg, nonce, publicKey, secretKey) {
          var k = nacl.box.before(publicKey, secretKey);
          return nacl.secretbox(msg, nonce, k);
        };
        
        nacl.box.before = function(publicKey, secretKey) {
          checkArrayTypes(publicKey, secretKey);
          checkBoxLengths(publicKey, secretKey);
          var k = new Uint8Array(crypto_box_BEFORENMBYTES);
          crypto_box_beforenm(k, publicKey, secretKey);
          return k;
        };
        
        nacl.box.after = nacl.secretbox;
        
        nacl.box.open = function(msg, nonce, publicKey, secretKey) {
          var k = nacl.box.before(publicKey, secretKey);
          return nacl.secretbox.open(msg, nonce, k);
        };
        
        nacl.box.open.after = nacl.secretbox.open;
        
        nacl.box.keyPair = function() {
          var pk = new Uint8Array(crypto_box_PUBLICKEYBYTES);
          var sk = new Uint8Array(crypto_box_SECRETKEYBYTES);
          crypto_box_keypair(pk, sk);
          return {publicKey: pk, secretKey: sk};
        };
        
        nacl.box.keyPair.fromSecretKey = function(secretKey) {
          checkArrayTypes(secretKey);
          if (secretKey.length !== crypto_box_SECRETKEYBYTES)
            throw new Error('bad secret key size');
          var pk = new Uint8Array(crypto_box_PUBLICKEYBYTES);
          crypto_scalarmult_base(pk, secretKey);
          return {publicKey: pk, secretKey: new Uint8Array(secretKey)};
        };
        
        nacl.box.publicKeyLength = crypto_box_PUBLICKEYBYTES;
        nacl.box.secretKeyLength = crypto_box_SECRETKEYBYTES;
        nacl.box.sharedKeyLength = crypto_box_BEFORENMBYTES;
        nacl.box.nonceLength = crypto_box_NONCEBYTES;
        nacl.box.overheadLength = nacl.secretbox.overheadLength;
        
        nacl.sign = function(msg, secretKey) {
          checkArrayTypes(msg, secretKey);
          if (secretKey.length !== crypto_sign_SECRETKEYBYTES)
            throw new Error('bad secret key size');
          var signedMsg = new Uint8Array(crypto_sign_BYTES+msg.length);
          crypto_sign(signedMsg, msg, msg.length, secretKey);
          return signedMsg;
        };
        
        nacl.sign.open = function(signedMsg, publicKey) {
          checkArrayTypes(signedMsg, publicKey);
          if (publicKey.length !== crypto_sign_PUBLICKEYBYTES)
            throw new Error('bad public key size');
          var tmp = new Uint8Array(signedMsg.length);
          var mlen = crypto_sign_open(tmp, signedMsg, signedMsg.length, publicKey);
          if (mlen < 0) return null;
          var m = new Uint8Array(mlen);
          for (var i = 0; i < m.length; i++) m[i] = tmp[i];
          return m;
        };
        
        nacl.sign.detached = function(msg, secretKey) {
          var signedMsg = nacl.sign(msg, secretKey);
          var sig = new Uint8Array(crypto_sign_BYTES);
          for (var i = 0; i < sig.length; i++) sig[i] = signedMsg[i];
          return sig;
        };
        
        nacl.sign.detached.verify = function(msg, sig, publicKey) {
          checkArrayTypes(msg, sig, publicKey);
          if (sig.length !== crypto_sign_BYTES)
            throw new Error('bad signature size');
          if (publicKey.length !== crypto_sign_PUBLICKEYBYTES)
            throw new Error('bad public key size');
          var sm = new Uint8Array(crypto_sign_BYTES + msg.length);
          var m = new Uint8Array(crypto_sign_BYTES + msg.length);
          var i;
          for (i = 0; i < crypto_sign_BYTES; i++) sm[i] = sig[i];
          for (i = 0; i < msg.length; i++) sm[i+crypto_sign_BYTES] = msg[i];
          return (crypto_sign_open(m, sm, sm.length, publicKey) >= 0);
        };
        
        nacl.sign.keyPair = function() {
          var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);
          var sk = new Uint8Array(crypto_sign_SECRETKEYBYTES);
          crypto_sign_keypair(pk, sk);
          return {publicKey: pk, secretKey: sk};
        };
        
        nacl.sign.keyPair.fromSecretKey = function(secretKey) {
          checkArrayTypes(secretKey);
          if (secretKey.length !== crypto_sign_SECRETKEYBYTES)
            throw new Error('bad secret key size');
          var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);
          for (var i = 0; i < pk.length; i++) pk[i] = secretKey[32+i];
          return {publicKey: pk, secretKey: new Uint8Array(secretKey)};
        };
        
        nacl.sign.keyPair.fromSeed = function(seed) {
          checkArrayTypes(seed);
          if (seed.length !== crypto_sign_SEEDBYTES)
            throw new Error('bad seed size');
          var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);
          var sk = new Uint8Array(crypto_sign_SECRETKEYBYTES);
          for (var i = 0; i < 32; i++) sk[i] = seed[i];
          crypto_sign_keypair(pk, sk, true);
          return {publicKey: pk, secretKey: sk};
        };
        
        nacl.sign.publicKeyLength = crypto_sign_PUBLICKEYBYTES;
        nacl.sign.secretKeyLength = crypto_sign_SECRETKEYBYTES;
        nacl.sign.seedLength = crypto_sign_SEEDBYTES;
        nacl.sign.signatureLength = crypto_sign_BYTES;
        
        nacl.hash = function(msg) {
          checkArrayTypes(msg);
          var h = new Uint8Array(crypto_hash_BYTES);
          crypto_hash(h, msg, msg.length);
          return h;
        };
        
        nacl.hash.hashLength = crypto_hash_BYTES;
        
        nacl.verify = function(x, y) {
          checkArrayTypes(x, y);
          // Zero length arguments are considered not equal.
          if (x.length === 0 || y.length === 0) return false;
          if (x.length !== y.length) return false;
          return (vn(x, 0, y, 0, x.length) === 0) ? true : false;
        };
        
        nacl.setPRNG = function(fn) {
          randombytes = fn;
        };
        
        (function() {
          // Initialize PRNG if environment provides CSPRNG.
          // If not, methods calling randombytes will throw.
          var crypto = typeof self !== 'undefined' ? (self.crypto || self.msCrypto) : null;
          if (crypto && crypto.getRandomValues) {
            // Browsers.
            var QUOTA = 65536;
            nacl.setPRNG(function(x, n) {
              var i, v = new Uint8Array(n);
              for (i = 0; i < n; i += QUOTA) {
                crypto.getRandomValues(v.subarray(i, i + Math.min(n - i, QUOTA)));
              }
              for (i = 0; i < n; i++) x[i] = v[i];
              cleanup(v);
            });
          } else if (typeof require !== 'undefined') {
            // Node.js.
            crypto = require('crypto');
            if (crypto && crypto.randomBytes) {
              nacl.setPRNG(function(x, n) {
                var i, v = crypto.randomBytes(n);
                for (i = 0; i < n; i++) x[i] = v[i];
                cleanup(v);
              });
            }
          }
        })();
        
        })(typeof module !== 'undefined' && module.exports ? module.exports : (self.nacl = self.nacl || {}));
}

tweetnacl();
// 06-csp.js
function loadBasicCSP() {
	modules.csps = {};
	let cryptoKeys = {};
	function cryptoKeyIntoKeyObject(ck, groupBy) {
		if (ck.privateKey && ck.publicKey) return {
			privateKey: cryptoKeyIntoKeyObject(ck.privateKey, groupBy),
			publicKey: cryptoKeyIntoKeyObject(ck.publicKey, groupBy),
		};
		let keyID = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
		if (!cryptoKeys.hasOwnProperty(groupBy)) cryptoKeys[groupBy] = {};
		cryptoKeys[groupBy][keyID] = ck;
		return {
			type: ck.type,
			extractable: ck.extractable,
			algorithm: ck.algorithm,
			usages: ck.usages,
			keyID: keyID
		}
	}
	modules.csps.basic = {
		cspMetadata: function() {
			return {
				name: "Basic Cryptographic Provider",
				version: modules.pcos_version,
				developer: "PCsoft",
				features: Object.keys(modules.csps.basic)
			}
		},
		random: async function(typedArray) {
			return crypto.getRandomValues(typedArray);
		},
		importKey: async function(arg, groupBy) {
			return cryptoKeyIntoKeyObject(await crypto.subtle.importKey(arg.format, arg.keyData, arg.algorithm, arg.extractable, arg.keyUsages), groupBy);
		},
		generateKey: async function(arg, groupBy) {
			return cryptoKeyIntoKeyObject(await crypto.subtle.generateKey(arg.algorithm, arg.extractable, arg.keyUsages), groupBy);
		},
		deriveBits: async function(arg, groupBy) {
			arg.baseKey = cryptoKeys[groupBy][arg.baseKey.keyID];
			if (arg.algorithm.public) arg.algorithm.public = cryptoKeys[groupBy][arg.algorithm.public.keyID];
			return crypto.subtle.deriveBits(arg.algorithm, arg.baseKey, arg.length);
		},
		deriveKey: async function(arg, groupBy) {
			arg.baseKey = cryptoKeys[groupBy][arg.baseKey.keyID];
			if (arg.algorithm.public) arg.algorithm.public = cryptoKeys[groupBy][arg.algorithm.public.keyID];
			return cryptoKeyIntoKeyObject(await crypto.subtle.deriveKey(arg.algorithm, arg.baseKey, arg.derivedKeyType, arg.extractable, arg.keyUsages), groupBy);
		},
		wrapKey: async function(arg, groupBy) {
			arg.key = cryptoKeys[groupBy][arg.key.keyID];
			arg.wrappingKey = cryptoKeys[groupBy][arg.wrappingKey.keyID];
			return crypto.subtle.wrapKey(arg.format, arg.key, arg.wrappingKey, arg.wrapAlgo);
		},
		digest: async function(arg) {
			return crypto.subtle.digest(arg.algorithm, arg.data);
		},
		encrypt: async function(arg, groupBy) {
			arg.key = cryptoKeys[groupBy][arg.key.keyID];
			return crypto.subtle.encrypt(arg.algorithm, arg.key, arg.data);
		},
		sign: async function(arg, groupBy) {
			arg.key = cryptoKeys[groupBy][arg.key.keyID];
			return crypto.subtle.sign(arg.algorithm, arg.key, arg.data);
		},
		exportKey: async function(arg, groupBy) {
			arg.key = cryptoKeys[groupBy][arg.key.keyID];
			return crypto.subtle.exportKey(arg.format, arg.key);
		},
		unwrapKey: async function(arg, groupBy) {
			arg.unwrappingKey = cryptoKeys[groupBy][arg.unwrappingKey.keyID];
			return cryptoKeyIntoKeyObject(await crypto.subtle.unwrapKey(arg.format, arg.keyData, arg.unwrappingKey, arg.unwrapAlgo, arg.unwrappedKeyAlgo, arg.extractable, arg.keyUsages), groupBy);
		},
		decrypt: async function(arg, groupBy) {
			arg.key = cryptoKeys[groupBy][arg.key.keyID];
			return crypto.subtle.decrypt(arg.algorithm, arg.key, arg.data);
		},
		verify: async function(arg, groupBy) {
			arg.key = cryptoKeys[groupBy][arg.key.keyID];
			return crypto.subtle.verify(arg.algorithm, arg.key, arg.signature, arg.data);
		},
		unloadKey: (key, groupBy) => delete cryptoKeys[groupBy][key.keyID],
		removeSameGroupKeys: (_, groupBy) => delete cryptoKeys[groupBy]
	}
	modules.csps.tweetnacl = {
		cspMetadata: function() {
			return {
				name: "TweetNaCl Cryptographic Provider",
				version: "1.0.3",
				developer: "TweetNaCl.js developers (https://github.com/dchest/tweetnacl-js)",
				features: Object.keys(modules.csps.tweetnacl)
			}
		},
		random: typedArray => nacl.randomBytes(typedArray.length),
		generateKey: type => nacl[type].keyPair(),
		deriveKey: arg => nacl[arg.type].keyPair.fromSeed(arg.seed),
		digest: message => nacl.hash(message),
		encrypt: arg => nacl[arg.type](arg.message, arg.nonce, arg.key1, arg.key2),
		sign: arg => nacl.sign.detached(arg.message, arg.secretKey),
		decrypt: arg => nacl[arg.type].open(arg.box, arg.nonce, arg.key1, arg.key2),
		verify: arg => nacl.sign.detached.verify(arg.message, arg.signature, arg.publicKey)
	}
}
loadBasicCSP();
// 06-ksk.js
async function ksk() {
	// @pcos-app-mode native
	// Key signing key
	let ksk = {"kty":"EC","x":"2iqPpmoqWFYGIjoCYAZvyDeGN2MeB2kkEdKeSswMPEc","y":"6ZSKXt7HqvB8cWya7j9dC6x36DDgHLndX6qeMMnh7s4","crv":"P-256"};
	if (ksk.stub == "present") {
		let e = new Error("The key signing key was not built into this build.");
		panic("KEY_SIGNING_KEY_NOT_BUILT", {
			name: "ksk",
			params: [ "stub" ],
			underlyingJS: e
		});
		throw e;
	}
	if (ksk.stub != "present") modules.ksk = ksk;
	if (modules.ksk) {
		try {
			modules.ksk_imported = await crypto.subtle.importKey("jwk", modules.ksk, {
				name: "ECDSA",
				namedCurve: "P-256"
			}, false, ["verify"]);
		} catch (e) {
			panic("KEY_SIGNING_KEY_IMPORT_FAILED", {
				name: "ksk",
				underlyingJS: e
			});
			throw e;
		}
	}
}
await ksk();
// 06-locales.js
function localization() {
	// @pcos-app-mode native
	let locales = {
		en: {
			"UNTITLED_APP": "Untitled program",
			"PERMISSION_DENIED": "Permission denied",
			"MORE_PERMISSION_DENIED": "There are not enough permissions to run this program.",
			"COMPATIBILITY_ISSUE_TITLE": "Compatibility issue",
			"COMPATIBILITY_ISSUE": "This program cannot run on this computer as a task. Check the application modes to include \"isolatable\".",
			"APP_STARTUP_CRASH_TITLE": "Something went wrong",
			"APP_STARTUP_CRASH": "The system failed to execute this program.",
			"JS_TERMINAL": "JavaScript Terminal",
			"TERMINAL_INVITATION": "PCOS 3, build %s",
			"PCOS_RESTARTING": "PCOS is restarting. %s",
			"PLEASE_WAIT": "Please wait.",
			"POLITE_CLOSE_SIGNAL": "Sending polite close.",
			"ABRUPT_CLOSE_SIGNAL": "Sending abrupt close.",
			"UNMOUNTING_MOUNTS": "Unmounting mounts.",
			"SAFE_TO_CLOSE": "It is now safe to close this tab.",
			"RESTART_BUTTON": "Reboot",
			"RESTARTING": "Restarting.",
			"INSTALL_PCOS": "Install PCOS",
			"INSTALLER_TITLE": "PCOS 3 Installer",
			"CLOSE_INSTALLER_CONFIRMATION": "Are you sure you want to stop the installation process? This computer will restart.",
			"YES": "Yes",
			"NO": "No",
			"INSTALLER_INVITATION": "You are installing PCOS 3 build %s on this computer.",
			"INSTALL_BUTTON": "Install",
			"LIVE_BUTTON": "Try out",
			"INSTALLER_PARTITIONING": "Select the boot and data partitions you would like to use.",
			"PARTITIONING_USE": "Use partitions",
			"PARTITION_DATA": "Data partition",
			"PARTITION_BOOT": "Boot partition",
			"FORMAT_DATA": "Format to PCFS",
			"DATA_INPUT_ALERT": "Please enter a data partition name.",
			"PROMPT_PARTITION_TABLE": "This disk does not seem to contain a valid partition table. Do you want to insert a partition table?",
			"CONFIRM_PARTITION_ERASE": "All data on that partition will be erased. Continue?",
			"BOOT_INPUT_ALERT": "Please enter a boot partition name.",
			"CANNOT_FIND_PARTITION": "Can't find a disk partition. Please try formatting the data partition to PCFS.",
			"PCFS_DETECTION_ERROR": "The data partition doesn't seem to contain PCFS. Do you still want to use it?",
			"INSTALLING_PCOS": "Installing PCOS: %s",
			"CREATING_BOOT_PARTITION": "Creating boot partition",
			"MOUNTING_DATA_PARTITION": "Mounting data partition as 'target'",
			"CHANGING_ROOT_PERMISSIONS": "Changing / permissions",
			"COPYING_FOLDERS": "Copying directories",
			"PREPARING_FOR_COPY": "Preparing for copying",
			"CHANGING_BOOT_PERMISSIONS": "Changing /boot permissions",
			"PATCHING_FS": "Patching for data mount",
			"INSTALLATION_SUCCESSFUL": "Successful installation. Close window to reboot.",
			"INSTALLATION_FAILED": "Installation of PCOS failed. Please try again. Close window to reboot.",
			"CREATING_DIR": "Creating %s",
			"COPYING_FILE": "Copying %s",
			"COMPLETE_COPY": "Complete copying %s",
			"REMOVING_OBJECT": "Removing %s",
			"COMPLETE_REMOVE": "Complete removing %s",
			"SHORT_DAYS": "%sd",
			"SHORT_HOURS": "%sh",
			"SHORT_MINUTES": "%smin",
			"SHORT_SECONDS": "%ss",
			"SHORT_MILLISECONDS": "%sms",
			"SHORT_TERABYTES": "%sTB",
			"SHORT_GIGABYTES": "%sGB",
			"SHORT_MEGABYTES": "%sMB",
			"SHORT_KILOBYTES": "%sKB",
			"SHORT_BYTES": "%sB",
			"AUTH_FAILED_NEW": "Authentication failed, please use a new instance!",
			"AUTH_SUCCESS": "Authentication successful.",
			"AUTH_FAILED": "Authentication failed.",
			"PLEASE_WAIT_TIME": "Please wait %s",
			"REPORTING_LOGON": "Reporting logon to server...",
			"TOTP_PC_PROMPT": "Enter TOTP-PC code",
			"TOTP_PROMPT": "Enter TOTP code",
			"ACCESS_NOT_SETUP": "Access to this user is not set up",
			"PASSWORD_PROMPT": "Enter password",
			"ENTER_BUTTON": "Enter",
			"USERNAME_PROMPT": "Enter an username.",
			"USERNAME": "Username",
			"ACCESS_FN_FAIL": "No such user.",
			"PROMPT_GET_FAIL": "Something went wrong while getting the authentication prompt.",
			"LET_TRY_AGAIN": "Let's try again.",
			"RESPONSE_PLACEHOLDER": "Response...",
			"START_MENU_BTN": "Start",
			"START_MENU": "Start menu",
			"LOG_IN_INVITATION": "Log in",
			"LOG_OUT_BUTTON": "Log out (%s)",
			"LOCK_BUTTON": "Lock",
			"TERMINAL_BUTTON": "Terminal",
			"TURN_OFF_BUTTON": "Turn off",
			"PASSWORD": "Password",
			"SET_UP_PCOS": "Set up PCOS",
			"LET_SETUP_SYSTEM": "Let's set up the system now.",
			"SET_UP": "Set up",
			"LET_CREATE_ACCOUNT": "Let's create your own user account.",
			"CREATE": "Create",
			"PASSWORD_INPUT_ALERT": "Please enter a password!",
			"SETUP_SUCCESSFUL": "Successful setup. Close window to log in.",
			"CREATING_USER_STRUCTURE": "Creating user structure",
			"CREATING_USER": "Creating user",
			"INSTALLING_WPS": "Installing wallpapers",
			"INSTALLING_APPS": "Installing programs",
			"INSTALLING_WP2U": "Installing wallpaper to user",
			"REMOVING_2STAGE": "Removing second-stage installer",
			"PATCHING_LOGON": "Patching for logon requirement",
			"CONFIRM": "Confirm",
			"RIGHT_REVIEW": "Let's review your rights.",
			"RIGHT_REVIEW_BTN": "Accept license",
			"DARK_MODE": "Dark mode",
			"INSTALLING_DARKMODE": "Installing dark mode preference",
			"CREATING_USER_HOME": "Creating user home directory",
			"PROVISIONED_PREFERENCE": "This setting is managed by the system administrator.",
			"USERNAME_EXISTS": "This user already exists in the system.",
			"VIDEO_PLAYER": "Video player",
			"INACCESSIBLE_FILE": "%s is inaccessible. Ensure you have permissions to access it, and that the object exists.",
			"FILE_NOT_SPECIFIED": "No file specified.",
			"PICTURE_VIEWER": "Picture viewer",
			"API_TEST_TERM": "API Developer's Terminal",
			"HELP_TERMINAL_APITEST": "help - Display help menu\r\nclear - Clear terminal\r\njs_ree - Execute JavaScript code\r\n--- REE API EXPORTS ---\r\n",
			"TERM_COMMAND_NOT_FOUND": "%s: command not found",
			"FILE_EXPLORER": "File explorer",
			"GRANT_FEXP_PERM": "Please grant permissions to read file structures and list partitions.",
			"GRANT_PERM": "Grant permissions",
			"GRANT_FEXP_PERM_ADM": "Please consult the administrator to grant privileges to this program to read file structures and list partitions. (FS_READ, FS_LIST_PARTITIONS)",
			"GRANT_FEXP_PERM_USR": "Please grant permissions to read file structures and list partitions using a different user.",
			"BROWSE_FEXP": "Browse",
			"SPACE_SHOWER": "Space in \"%s\": %s used of %s (%s%)",
			"FILE_STRUCT_BROWSE_FAIL": "Could not browse to this structure:\n%s",
			"UNKNOWN_FS_STRUCT": "Unknown filesystem structure \"%s\"",
			"UNKNOWN_FILE_TYPE": "This is an unknown file type.",
			"TMGR_PERMISSION": "Task manager was not permitted to run under this condition. Please contact the system administrator.\nRequired privileges: %s",
			"TASK_MANAGER": "Task manager",
			"BASENAME_TASK": "Basename",
			"USER_TASK": "User",
			"TERMINATE_TASK": "Terminate",
			"FULL_PATH_TASK": "Full path",
			"ARGUMENTS_TASK": "Arguments",
			"REMOVING_SETUP_STATE": "Removing setup status",
			"LOGGING_OUT": "Logging out...",
			"PANIC_LINE1": "A critical problem has been detected while using the operating system. Its stability is at risk now.",
			"PANIC_LINE2": "Problem code: %s",
			"PANIC_UNSPECIFIED_ERROR": "UNSPECIFIED_ERROR",
			"PROBLEMATIC_COMPONENT": "Problematic component: %s",
			"PROBLEMATIC_PARAMS": "Problematic parameters: %s",
			"PROBLEMATIC_JS": "Problematic JavaScript: %s: %s",
			"PANIC_LINE3": "If you have seen this error message the first time, attempt rebooting.",
			"PANIC_LINE4": "If you see this error message once more, there is something wrong with the system.",
			"PANIC_LINE5": "You can try repairing the filesystem by placing a .fsck file on the system root mountpoint, with the value \"recover\" in it.",
			"PANIC_LINE6": "Proper shutdown procedure follows now:",
			"PANIC_TASK_KILLED": "task:%s: killed",
			"PANIC_MOUNT_UNMOUNTED": "mount:%s: unmounted",
			"PANIC_MOUNT_FAILED": "mount:%s: %s: %s",
			"SHORT_YEARS": "%sy",
			"SHORT_MONTHS": "%smo",
			"SYSADMIN_TOOLS_TITLE": "Sysadmin Tools",
			"SYSADMIN_TOOLS_PRIVFAIL": "You are not a system administrator.",
			"REINSTALL_BUTTON": "Reinstall OS",
			"FSCK_BUTTON": "Recover lost files",
			"SWIPE_BUTTON": "Wipe system securely",
			"REINSTALL_DOWNLOADING": "Downloading local os.js...",
			"REINSTALL_DOWNLOAD_FAILED": "Failed to download local os.js.",
			"REINSTALL_DECODING": "Parsing os.js as text",
			"REINSTALL_SETTING": "Setting os.js as bootloader",
			"REMOVING_INSTALLERS": "Removing installers...",
			"SETTING_FSCK_FLAG": "Creating .fsck file",
			"SETTING_FSCK_FLAG_FAILED": "Failed to create .fsck file.",
			"WIPING_SYSTEM": "Securely wiping system...",
			"WIPING_SYSTEM_FAILED": "Failed to securely wipe system.",
			"WORKING_HOURS_UNMET": "You attempted to log in outside of your working hours. Try again later.",
			"NETCONFIG_TITLE": "PCOS Network configurator",
			"NETCONFIG_DENY": "There are not enough permissions to configure PCOS Network.",
			"NETCONFIG_URLF": "Proxy URL: ",
			"NETCONFIG_AUTO": "Start on OS startup",
			"NETCONFIG_UC": "Customizable: ",
			"NETCONFIG_SAVE": "Save config",
			"NETCONFIG_PREDICT": "Predict address",
			"EMPTY_STATUSBAR": "Status",
			"NETCONFIG_SAVE_OK": "Configuration saved successfully",
			"NETCONFIG_SAVE_FAIL": "Failed to save config",
			"PCOS_STARTING": "PCOS is starting...",
			"FILE_PICKER": "File picker",
			"TEXT_EDITOR": "Text editor",
			"LOAD_BTN": "Load",
			"SAVE_BTN": "Save",
			"NETCONFIG_SYSIDM": "No System ID available",
			"NO_SAVE_IN_MTN": "You can't save in the mountpoint directory.",
			"INSTALLING_WP2L": "Installing wallpaper to lock screen",
			"EXIT": "Exit",
			"DESCRIPTION_FIELD": "Description: %s",
			"REMOVE_BTN": "Remove",
			"UNMOUNT_BTN": "Unmount",
			"INSTALLING_DARKMODE2L": "Installing dark mode preference to lock screen",
			"MESSAGE_ENTER": "Enter a message to display",
			"TIMEOUT_FIELD": "Timeout (ms)",
			"SECRET_FIELD_TXT": "Secret (text)",
			"SECRET_FIELD_HEX": "Secret (hex)",
			"REGENERATE": "Regenerate",
			"START_TIME_FIELD": "Start time",
			"END_TIME_FIELD": "End time",
			"PBKDF2_OPTION": "PBKDF2 (Password)",
			"INFORMATIVE_MESSAGE_OPTION": "Informative message",
			"INFORMATIVE_MESSAGE_DENY_OPTION": "Informative message (deny)",
			"TIMEOUT_OPTION": "Timeout",
			"TIMEOUT_DENY_OPTION": "Timeout (deny)",
			"SERVER_REPORT_OPTION": "Server reporting",
			"PCTOTP_OPTION": "PC's TOTP interpretation",
			"RFCTOTP_OPTION": "RFC TOTP",
			"WORKING_HOURS_OPTION": "Working hours",
			"PERSONAL_SECURITY_TITLE": "Personal Security",
			"PERSONAL_SECURITY_DENY": "Not enough privileges were granted for Personal Security.",
			"ADD_BTN": "Add",
			"OS_LOCALE": "en",
			"SYSTEM_SECURITY_TITLE": "System Security",
			"SYSTEM_SECURITY_DENY": "Not enough privileges were granted for System Security.",
			"EDIT": "Edit",
			"USER_GROUPS": "Groups",
			"USER_HOMEDIR": "Home directory",
			"REMOVE_USER_WITH_HD": "Remove user with home directory",
			"CREATE_HD": "Create home directory",
			"CREATING_HD_OK": "The home directory was created successfully.",
			"CREATING_HD_FAIL": "Failed to create the home directory.",
			"SIGNATURE_VERIFICATION_FAILED": "This program claims it is trusted by %s, but the system failed to verify that claim.",
			"UNKNOWN_PLACEHOLDER": "<Unknown>",
			"NO_APP_ALLOWLIST": "The system administrator requires programs to have an allowlist of permissions, but this program didn't have that list.",
			"DISCARD_BUTTON": "Discard lost files",
			"MOUNTPOINT": "Mountpoint",
			"GENERATE_PROMPT": "Generate?",
			"MOUNT_BUTTON": "Mount",
			"NEW_DIR_NAME": "New directory name",
			"MKDIR_BUTTON": "Create directory",
			"CHOWN_BUTTON": "Change owner",
			"CHGRP_BUTTON": "Change group",
			"CHMOD_BUTTON": "Change permissions",
			"CLIPBOARD_COPY": "Copy",
			"CLIPBOARD_CUT": "Cut",
			"CLIPBOARD_PASTE": "Paste",
			"CLIPBOARD_SOURCE_GONE": "The source no longer exists or is no longer a file.",
			"CLIPBOARD_CONFLICT": "The destination directory already has a file or directory with the same name.",
			"SAFE_MODE_MSG": "Safe mode",
			"INSTALLING_SFX": "Installing sound effects",
			"APP_OR_KEY_SIGNATURE_VERIFICATION_FAILED": "Signature verification for the program or the key signing the program failed.",
			"NO_SUCH_DEVICE": "No such device",
			"READ_ONLY_BMGR": "Writes restricted by boot manager.",
			"READ_ONLY_DEV": "Device is read-only",
			"NO_DIRECTORY_SUPPORT": "Device does not support directories",
			"NO_PERMIS_SUPPORT": "Device does not support permissions",
			"IS_A_DIR": "Is a directory",
			"NO_SUCH_FILE": "No such file",
			"NO_SUCH_DIR": "No such directory",
			"NO_SUCH_FILE_DIR": "No such file or directory",
			"NON_EMPTY_DIR": "Non-empty directory",
			"IS_A_FILE": "Is a file",
			"DIR_EXISTS": "Directory already exists",
			"FS_ACTION_FAILED": "Failed to perform this file system action.",
			"UNAUTHORIZED_ACTION": "The program does not have permissions to perform this action.",
			"CREATION_CHECK_FAILED": "Failed to check if this object is being created.",
			"PERMISSION_CHANGE_FAILED": "Failed to change permissions for this object.",
			"UPDATE_EXTRA_FAIL": "Failed to update apps, wallpapers, sounds.",
			"UPDATE_BOOT_FAIL": "Failed to update boot files.",
			"UPDATE_BUTTON": "Update OS",
			"TOGGLE_HIDDEN_FILES": "Hide/unhide files",
			"AUTORUN_NECESSITIES_FAILED": "Failed to run one of your autorun files. The system will not log you in.",
			"CRYPTO_TOOLS_TITLE": "Cryptographic Tools",
			"CRYPTO_TOOLS_NOPERM": "Not enough privileges were given to use Cryptographic Tools.",
			"CRYPTO_RNG": "Random generation",
			"CRYPTO_HASH": "Hashing",
			"CRYPTO_KEYGEN": "Key generation",
			"CRYPTO_ENCRYPT": "Encryption",
			"CRYPTO_DECRYPT": "Decryption",
			"CRYPTO_SIGN": "Signing",
			"CRYPTO_VERIFY": "Verification",
			"CRYPTO_DERIVEBITS": "Bit derivation",
			"GENERATE": "Generate",
			"RAW_HEX_DATA": "Raw data (hex)",
			"CRYPTO_HASH_FIELD": "Hash algorithm: ",
			"CRYPTO_PLAINTEXT_FIELD": "Plaintext: ",
			"ALGORITHM_FIELD": "Algorithm: ",
			"LENGTH_FIELD": "Length: ",
			"CRYPTO_NC_FIELD": "Named curve: ",
			"IMPORT_AS_FIELD": "Import as: ",
			"CRYPTO_KEY_FIELD": "Key: ",
			"CRYPTO_CIPHERTEXT_FIELD": "Ciphertext (hex): ",
			"CRYPTO_SIGNATURE_FIELD": "Signature (hex): ",
			"CRYPTO_KEYGEN_MSG": "Generating key(s)...",
			"CRYPTO_KEYGEN_SYMM": "Is a symmetric key type",
			"CRYPTO_KEYGEN_EXPFAIL": "Export failed, check export settings",
			"CRYPTO_RNGOUT_FIELD": "Random numbers (hex): ",
			"CRYPTO_KEYGEN_ACTION": "Generate key(s)",
			"CRYPTO_HASH_ACTION": "Hash",
			"CRYPTO_ENCRYPT_ACTION": "Encrypt",
			"CRYPTO_DECRYPT_ACTION": "Decrypt",
			"CRYPTO_SIGN_ACTION": "Sign",
			"CRYPTO_VERIFY_ACTION": "Verify",
			"CRYPTO_DERIVEBITS_ACTION": "Derive bits",
			"CRYPTO_PUBKEY_FIELD": "Public key: ",
			"CRYPTO_PRIVKEY_FIELD": "Private key: ",
			"CRYPTO_BASEKEY_FIELD": "Base key: ",
			"CRYPTO_HASHOUT_FIELD": "Hash value (hex): ",
			"CRYPTO_MODLEN_FIELD": "Modulus length: ",
			"CRYPTO_PUBEXP_FIELD": "Public exponent (hex): ",
			"EXPORT_AS_FIELD": "Export as: ",
			"CRYPTO_KEYUSE_FIELD": "Key usages:",
			"CRYPTO_PLAINTEXTAS_FIELD": "Process plaintext as: ",
			"CRYPTO_IV_FIELD": "IV (hex): ",
			"CRYPTO_CTR_FIELD": "Counter (hex): ",
			"CRYPTO_VERIFIED_CHECKBOX": "Verified successfully",
			"CRYPTO_SALT_FIELD": "Salt (hex): ",
			"CRYPTO_DERIVEOUT_FIELD": "Derived bits (hex): ",
			"CRYPTO_ITERATIONS_FIELD": "Iterations: ",
			"PATH_INCLUDES_EMPTY": "The specified path includes an object with an empty name.",
			"BASIC_CURL_USAGE": "Usage: basiccurl [source] [output]",
			"BASIC_CURL_DESCRIPTION": "Downloads the specified source and saves it to the specified output.",
			"NO_ARGUMENTS": "No arguments specified",
			"CAT_USAGE": "Usage: cat [file1] <file2> <file3> ... <fileN>",
			"CAT_DESCRIPTION": "Concatenates the specified files and outputs to CLI output",
			"CHGRP_USAGE": "Usage: chgrp [group] [file]",
			"CHGRP_DESCRIPTION": "Changes the owning group of the specified file",
			"CHMOD_USAGE": "Usage: chmod [mode] [file]",
			"CHMOD_DESCRIPTION": "Changes what everyone may do with the specified file",
			"CHMOD_MODE_DESCRIPTION": "[mode] may consist of characters r (Read), w (Write) and x (eXecute).",
			"CHMOD_MODE_CONVERT": "[mode] number to string table: 0 - \"\", 1 - \"x\", 2 - \"w\", 3 - \"wx\", 4 - \"r\", 5 - \"rx\", 6 - \"rw\", 7 - \"rwx\"",
			"CHOWN_USAGE": "Usage: chown [user] [file]",
			"CHOWN_DESCRIPTION": "Changes the owning user of the specified file",
			"CP_USAGE": "Usage: cp <options> [source] [destination]",
			"CP_DESCRIPTION": "Copies files or directories from the source to the destination.",
			"OPT_RECURSIVE_DESCRIPTION": "--recursive: run on directories",
			"OPT_FORCE_DESCRIPTION": "--force: do not fail immediately in case of an error",
			"ARGUMENT_COUNT_MISMATCH": "Too much or not enough arguments",
			"DF_HEADER": "Medium\tSize\tUsed\tAvail\tUse%",
			"LS_USAGE": "Usage: ls [directory]",
			"LS_DESCRIPTION": "Lists the contents of the specified directory.",
			"LS_MOUNTPOINT_LIST": "You have the following mountpoints: ",
			"MOUNTPOINT_SYSTEM": "system",
			"PASSWD_NEW_PROMPT": "Setting a new password for your user account.",
			"PASSWD_2FACTOR_LOSS_WARN": "Any previously set up additional factors will be removed.",
			"PASSWD_PROMPT": "New password: ",
			"PASSWD_CONFIRM_PROMPT": "Re-enter password: ",
			"PASSWD_FEEDBACK": "New password set",
			"PASSWD_MISMATCH": "Sorry, passwords do not match.",
			"PING_USAGE": "Usage: ping <--internet> [networkAddress]",
			"PING_DESCRIPTION": "Sends a request to the specified address to verify its availability.",
			"PING_INTERNET_OPTION": "--internet: send a ping to the Internet instead of PCOS Network",
			"PIVOT_ROOT_USAGE": "Usage: pivot_root [mountpoint]",
			"PIVOT_ROOT_DESCRIPTION": "Makes the specified mountpoint the new default system mountpoint for every program.",
			"REAL_TERMINAL_NAME": "Terminal",
			"REAL_TERMINAL_BUILTIN_LIST": "Built-in commands:",
			"REAL_TERMINAL_HELP_USEDESC": "help - Display the list, description and usage of all available built-in commands.",
			"REAL_TERMINAL_CLEAR_USEDESC": "clear - Clear everything displayed on the terminal right now.",
			"REAL_TERMINAL_SUGRAPH_USEDESC": "sugraph <desiredUsername> - Switch the terminal user using a graphical utility.",
			"REAL_TERMINAL_SU_USEDESC": "su <desiredUsername> - Switch the terminal user.",
			"REAL_TERMINAL_GRAPHIC_USEDESC": "graphic <boolean> - Enable or disable running new applications outside of background.",
			"REAL_TERMINAL_EXIT_USEDESC": "exit - Exit the terminal.",
			"REAL_TERMINAL_LOGON_REQUIRED": "(internal): You must run sugraph %s before running this program.",
			"RM_USAGE": "Usage: rm <options> [file]",
			"RM_DESCRIPTION": "Removes the specified file or directory.",
			"RKL_USAGE": "Usage: runKlvlCode [codeFile]",
			"RKL_DESCRIPTION": "Runs the specified code file in the kernel level.",
			"WRITE_USAGE": "Usage: write [file] [data]",
			"WRITE_DESCRIPTION": "Writes data to the specified file.",
			"CP_PERMISSIONS_OPTION": "--permissions: opy the permissions of the original files",
			"REAL_TERMINAL_DEFAULT_PATH_FIELD": "Default path: %s",
			"REAL_TERMINAL_PUSHPATH_USEDESC": "pushpath [path] - Add a new path to explore to find commands.",
			"REAL_TERMINAL_RESETPATH_USEDESC": "resetpath - Reset the list of paths to explore to the default path.",
			"REAL_TERMINAL_LSPATH_USEDESC": "lspath - See the current list of paths to explore and the default path.",
			"MKDIR_USAGE": "Usage: mkdir [directory]",
			"MKDIR_DESCRIPTION": "Creates a new directory in the specified path.",
			"NEXT": "Next",
			"DESCRIBE_TEMPLATE": "Program: %s (%s)\nIntent: %s",
			"EXTRA_DESCRIBE_TEMPLATE": "Program: %s (%s)\nArguments: %s\nIntent: %s",
			"DECLINE": "Decline",
			"ACCESS_REQUEST_TITLE": "Access request",
			"REAL_TERMINAL_INTENT": "Launch commands with your permissions",
			"PERSONAL_SECURITY_INTENT": "Manage your security settings",
			"FILE_EXPLORER_INTENT": "Launch programs and open files",
			"FILE_EXPLORER_FULL_INTENT": "Browse files, launch programs, and open files",
			"CRYPTO_TOOLS_INTENT": "Perform cryptographic operations",
			"SYSTEM_SECURITY_INTENT": "Management of the system-wide user account setup",
			"FORMAT_USAGE": "Usage: format [filesystem_type] [partition] <overwrite>",
			"FORMAT_DESCRIPTION": "Prepares the selected partition for use.",
			"FORMAT_FSTYPE": "Filesystem types: pcfs (corresponds to mountpoint PCFSiDBMount), pcfs_crypt (PCFSiDBAESCryptMount), pcfs_crypt_monokey (PCFSiDBAESCryptMount), pcfs_crypt_filetable_monokey (PCFSiDBAESCryptMount), pcbm:<data_partition> (like code in boot partition), null (DELETE the partition)",
			"FORMAT_OVERWRITE_WARN": "The partition already contains data. Set the overwrite parameter to 'overwrite' to remove data anyway. In that case, ALL DATA ON THE PARTITION MAY BE REMOVED.",
			"FORMAT_UNKNOWN_FSTYPE": "Unknown target formatting",
			"LLDA_USAGE": "Usage: llda_tool [action] [parameters]",
			"LLDA_ACTION_EXPORT": "action export: [input partition] [output file]",
			"LLDA_ACTION_IMPORT": "action import: [input file] [output partition]",
			"LLDA_ACTION_IMPORTSTRING": "action importstring: [input file] [output partition]",
			"LLDA_ACTION_COPY": "action copy: [input partition] [output partition]",
			"LLDA_ACTION_REMOVE": "action remove: [partition]",
			"LLDA_ACTION_LIST": "action list",
			"LLDA_DISCLAIMER": "When using this tool you may encounter LOSS OF DATA!",
			"LLDA_UNKNOWN_ACTION": "Unknown action",
			"INITDISK_OVERWRITE_WARN": "The system disk already contains partitioning data. Set the overwrite parameter to 'overwrite' to remove data anyway. In that case, ALL DATA ON THE DISK MAY BE REMOVED.",
			"INITDISK_USAGE": "Usage: initdisk [whatever] <overwrite>",
			"INITDISK_DESCRIPTION": "Prepares the system disk for use.",
			"MOUNT_USAGE": "Usage: mount [options] [fs_type] [mountpoint]",
			"MOUNT_DESCRIPTION": "Mounts a filesystem.",
			"MOUNT_KNOWN_FS": "Known filesystems: %s",
			"MOUNT_KNOWN_PPART": "--partition=[dataPartition] - Specify the data partition",
			"MOUNT_KNOWN_PINPA": "--interactivePassword - Ask for the password interactively",
			"MOUNT_KNOWN_PPASS": "--password=[password] - Specify the password",
			"MOUNT_KNOWN_PKEY": "--key=[hexKey] - Specify the encryption key",
			"MOUNT_KNOWN_PTYPE": "--type=[type] - For ramMount, specify type=run to create /run",
			"MOUNT_KNOWN_PURL": "--url=[URL] - Specify the URL",
			"MOUNT_KNOWN_PINPI": "--inputPipeId=[pipeId] - Specify the input pipe",
			"MOUNT_KNOWN_POUPI": "--outputPipeId=[pipeId] - Specify the output pipe",
			"MOUNTINFO_USAGE": "Usage: mountinfo [mountpoint]",
			"MOUNTINFO_DESCRIPTION": "Get information about a mountpoint.",
			"UMOUNT_USAGE": "Usage: umount <options> [mountpoint]",
			"UMOUNT_DESCRIPTION": "Unmounts a filesystem.",
			"UMOUNT_OPT_SYNCONLY": "--sync-only - Only sync the filesystem, not unmount (overrides --force)",
			"UMOUNT_OPT_FORCE": "--force - Force unmount the filesystem, do not sync",
			"CALC_TITLE": "Calculator",
			"CALC_BASIC_MODE": "Calculator: Basic mode",
			"CALC_ADVANCED_MODE": "Calculator: Advanced mode",
			"CALC_ADD": "Add",
			"CALC_SUBTRACT": "Subtract",
			"CALC_MULTIPLY": "Multiply",
			"CALC_DIVIDE": "Divide",
			"CALC_ADVMODE_BTN": "Advanced mode",
			"CALC_BASICMODE_BTN": "Basic mode",
			"CALC_OPERAND": "Operand %s",
			"CALC_TOMIXED_BTN": "Convert to mixed fraction",
			"CALC_TOIMPR_BTN": "Convert to improper fraction",
			"CALC_GCD": "GCD",
			"CALC_FACTORIAL": "Factorial",
			"CALC_GCD_PAGE": "Greatest common divisor",
			"ZKPP_OPTION": "ZKPP (Password)",
			"SECONDSTAGE_INSTALLER_INTENT": "Complete the OS configuration",
			"SETUP_FAILED": "Setting up PCOS failed. Please try again by rebooting.",
			"WARNING_PRIVILEGES": "Be careful with this feature! You may compromise system security.",
			"USER_EXT_PRIVILEGES": "Extended privilege set",
			"LULL_SYSTEM": "Sleep mode",
			"SYSTEM_IMAGING": "System imaging",
			"CREATE_IMAGE": "Create system image",
			"RESTORE_IMAGE": "Restore system image",
			"SELECT_FILE_PROMPT": "Select file: ",
			"REBOOT_ON_RESTORE": "Reboot after restoring",
			"MERGE_STATES": "Merge image states",
			"LISTING_PARTITIONS_FAILED": "Failed to list partitions.",
			"READING_PARTITION_FAILED": "Failed to read partition %s",
			"LISTING_DATA_FAILED": "Failed to list data.",
			"READING_DATA_FAILED": "Failed to read data.",
			"WRITING_IMAGE_FAILED": "Failed to write image.",
			"SUCCESSFUL_OP": "The process was successfully completed.",
			"FAILED_OP": "The process has failed.",
			"READING_IMAGE_FAILED": "Failed to read image.",
			"WRITING_PARTITION_FAILED": "Failed to write partition %s",
			"WRITING_DATA_FAILED": "Failed to write data.",
			"DELETING_PARTITION_FAILED": "Failed to delete partition %s",
			"DELETING_DATA_FAILED": "Failed to delete data.",
			"SHUTTING_DOWN_FAILED": "Failed to shut the system down.",
			"NETWORK_STATUS_ONLINE": "You are connected to a local area network.",
			"NETWORK_STATUS_OFFLINE": "You aren't connected to any sort of network.",
			"PCOS_NETWORK_STATUS_ONLINE": "You are connected to PCOS Network. (hostname: %s, address: %s)",
			"PCOS_NETWORK_STATUS_OFFLINE": "You are disconnected from PCOS Network.",
			"PCOS_NETWORK_STATUS_STOPPED": "The PCOS Network service was stopped.",
			"START_MENU_FAILED": "The start menu has failed to launch. You can log out instead.",
			"SYSTEM_BUILT_AT": "System built at %s",
			"REAL_TERMINAL_VER_USEDESC": "ver - Show the build version and time",
			"BLANK_PRIVILEGE_FLAG": "Blank user privileges",
			"INSTALLING_SYSTEM_APPHARDEN": "Installing program security rules",
			"INSTALLING_NET_CONF": "Installing PCOS Network configuration",
			"NETWORK_ADDRESS_FIELD": "Network address: %s",
			"NETWORK_AUTOHOST_FIELD": "Automatic hostname: %s",
			"NETCONFIG_HOSTNAME": "Hostname: ",
			"DIFF_USAGE": "Usage: diff [original] [new] [difference]",
			"DIFF_DESCRIPTION": "Calculates the difference between two files.",
			"PATCH_USAGE": "Usage: patch [original] [difference] [new]",
			"PATCH_DESCRIPTION": "Calculates the 'sum' of the original and the difference.",
			"CURRENT_OSFILE_VERSION": "Current OS file version: build %s",
			"DOWNLOADING_OS_PATCH": "Downloading OS file patch from %s (address %s)",
			"HANDOFF_UPDATE": "Handing off the update process to updateos.js",
			"SYSTEM_UP_TO_DATE": "The system is up to date",
			"POWER_USAGE": "Usage: power <options> <r|reboot|restart|k|kexec>",
			"POWER_DESCRIPTION": "Powers down or restarts the system. Supplying nothing to power makes a shutdown.",
			"POWER_FORCE": "--force: don't wait for processes, reboot or power down immediately",
			"POWER_KEXEC": "--kexec: reboot without reloading the page or firmware (automatically toggles reboot)",
			"UPDATEFW_BUTTON": "Update firmware",
			"UPDATEFW_DOWNLOADING": "Downloading local init.js...",
			"UPDATEFW_DOWNLOAD_FAILED": "Failed to download local init.js.",
			"UPDATEFW_DECODING": "Parsing init.js as text",
			"UPDATEFW_SETTING": "Setting init.js as firmware",
			"ADDUSER_USAGE": "Usage: adduser <options> [username]",
			"ADDUSER_DESCRIPTION": "Creates a new user account.",
			"ADDUSER_SKIP_PASSWD": "--skip-passwd: don't prompt for a password",
			"ADDUSER_SKIP_HOME": "--skip-home: don't create a home directory",
			"ADDUSER_GROUPS": "--groups: group to add (specify multiple times for multiple groups)",
			"ADDUSER_HOME": "--home: custom home directory",
			"NEW_USER_CREATION": "Creating new user \"%s\"",
			"BLOCKUSER_USAGE": "Usage: blockuser <username>",
			"BLOCKUSER_DESCRIPTION": "Blocks a user account.",
			"DELUSER_USAGE": "Usage: deluser <options> [username]",
			"DELUSER_DESCRIPTION": "Deletes a user account.",
			"DELUSER_HOMEDIR": "--homedir: delete the home directory",
			"OLD_USER_DELETION": "Deleting old user \"%s\"",
			"BATTERY_STATUS_UNAVAILABLE": "The battery status is unavailable.",
			"BATTERY_STATUS_CHARGING": "The battery is charging (%s%, %suntil full)",
			"BATTERY_STATUS_DISCHARGING": "The battery is discharging (%s%, %sof play)",
			"PATCH_HUNK_COUNT": "Patch hunks: %s",
			"SERVER_SIGNATURE_VERIFICATION_FAILED": "Signature verification for the server failed.",
			"NETWORK_UNREACHABLE": "Network is unreachable.",
			"ADDRESS_UNREACHABLE": "Address is unreachable.",
			"NETWORK_CLOSED": "The network has closed.",
			"CONNECTION_DROPPED": "The connection has been dropped.",
			"BLOG_BROWSER_NAME": "Blog Browser",
			"BLOG_BROWSER_LOADING": "Hold on, loading this page...",
			"BLOG_BROWSER_PROTO": "There's no such protocol. This version only supports the bdp:// protocol.",
			"BLOG_BROWSER_GATESET": "To set a connful gate, use the username part of the URL: bdp://gate@myblog.pc",
			"HOSTNAME_RESOLUTION_FAILED": "Failed to resolve hostname.",
			"BLOG_BROWSER_POSTCLOSE": "This interactive post has been closed.",
			"BLOG_BROWSER_FILEPOST": "This is a file post. You can save it to this system.",
			"BLOG_BROWSER_DLFILEPOST": "You have downloaded this file post.",
			"BLOG_BROWSER_LOADING_PROGRESS": "Loading this post (%s of %s chunks received)",
			"BLOG_BROWSER_NOVERIFY": "You have enabled an option to disable the verification of the server. This is not recommended as the network proxy can execute a man-in-the-middle attack and see your information. Would you let that happen?",
			"BLOG_BROWSER_NOSANDBOX": "You have enabled an option to pass through all APIs of your operating system. This is not recommended as the blog post can do anything as if it were the blog browser application. Would you let that happen?",
			"NETWORKFS_USAGE": "Usage: networkfs <options> [url] [mountpoint]",
			"NETWORKFS_DESCRIPTION": "Mounts a filesystem available over PCOS Network.",
			"NETWORKFS_NOVERIFY": "--no-verification: Don't verify the server's key",
			"NETWORKFS_KEY": "--key=[path]: Path to key for mutual verification",
			"NETWORKFS_PROTO": "This version only supports the netfs:// protocol.",
			"NETCONFIG_UPDATES": "Updates from: ",
			"NETWORK_UPDATES_FIELD": "Updates from: %s",
			"LOCALE_NAME": "English",
			"SETTING_LOCALE_PREFERENCE": "Setting locale preference",
			"LANGUAGE_SELECT": "Your language: ",
			"CHANGE_LOCALE": "Change language",
			"INSTALLER_INTENT": "Start the OS installation",
			"MOUNT_EXISTS": "Mount already exists",
			"INSECURE_MODE_MSG": "Insecure configuration!"
		},
		ru: {
			"UNTITLED_APP": " ",
			"PERMISSION_DENIED": "  ",
			"MORE_PERMISSION_DENIED": "     .",
			"COMPATIBILITY_ISSUE_TITLE": "  ",
			"COMPATIBILITY_ISSUE": "         . ,      \"isolatable\".",
			"APP_STARTUP_CRASH_TITLE": "-   ",
			"APP_STARTUP_CRASH": "     .",
			"JS_TERMINAL": " JavaScript",
			"TERMINAL_INVITATION": "PCOS 3,  %s",
			"PCOS_RESTARTING": "PCOS . %s",
			"PLEASE_WAIT": ", .",
			"POLITE_CLOSE_SIGNAL": "  .",
			"ABRUPT_CLOSE_SIGNAL": "  .",
			"UNMOUNTING_MOUNTS": "  .",
			"SAFE_TO_CLOSE": "    .",
			"RESTART_BUTTON": "",
			"RESTARTING": " .",
			"INSTALL_PCOS": " PCOS",
			"INSTALLER_TITLE": " PCOS 3",
			"CLOSE_INSTALLER_CONFIRMATION": " ,    ?   .",
			"YES": "",
			"NO": "",
			"INSTALLER_INVITATION": "  PCOS 3  %s   .",
			"INSTALL_BUTTON": "",
			"LIVE_BUTTON": "",
			"INSTALLER_PARTITIONING": "    ,    .",
			"PARTITIONING_USE": " ",
			"PARTITION_DATA": " ",
			"PARTITION_BOOT": " ",
			"FORMAT_DATA": "  PCFS",
			"DATA_INPUT_ALERT": "   .",
			"PROMPT_PARTITION_TABLE": " , ,    .     ?",
			"CONFIRM_PARTITION_ERASE": "      . ?",
			"BOOT_INPUT_ALERT": "   .",
			"CANNOT_FIND_PARTITION": "    .      PCFS.",
			"PCFS_DETECTION_ERROR": " , ,   PCFS.    ?",
			"INSTALLING_PCOS": " PCOS: %s",
			"CREATING_BOOT_PARTITION": "  ",
			"MOUNTING_DATA_PARTITION": "    'target'",
			"CHANGING_ROOT_PERMISSIONS": "  /",
			"COPYING_FOLDERS": " ",
			"PREPARING_FOR_COPY": "  ",
			"CHANGING_BOOT_PERMISSIONS": "  /boot",
			"PATCHING_FS": "    ",
			"INSTALLATION_SUCCESSFUL": " .    .",
			"INSTALLATION_FAILED": "  .   .    .",
			"CREATING_DIR": " %s",
			"COPYING_FILE": " %s",
			"COMPLETE_COPY": " %s ",
			"REMOVING_OBJECT": " %s",
			"COMPLETE_REMOVE": " %s ",
			"SHORT_DAYS": "%s",
			"SHORT_HOURS": "%s",
			"SHORT_MINUTES": "%s",
			"SHORT_SECONDS": "%s",
			"SHORT_MILLISECONDS": "%s",
			"SHORT_TERABYTES": "%s",
			"SHORT_GIGABYTES": "%s",
			"SHORT_MEGABYTES": "%s",
			"SHORT_KILOBYTES": "%s",
			"SHORT_BYTES": "%s",
			"AUTH_FAILED_NEW": "  , ,   !",
			"AUTH_SUCCESS": " !",
			"AUTH_FAILED": "  .",
			"PLEASE_WAIT_TIME": ",  %s",
			"REPORTING_LOGON": "     ...",
			"TOTP_PC_PROMPT": "  TOTP-PC",
			"TOTP_PROMPT": "  TOTP",
			"ACCESS_NOT_SETUP": "     ",
			"PASSWORD_PROMPT": " ",
			"ENTER_BUTTON": "",
			"USERNAME_PROMPT": "  ",
			"USERNAME": " ",
			"ACCESS_FN_FAIL": "  .",
			"PROMPT_GET_FAIL": "-       .",
			"LET_TRY_AGAIN": "   .",
			"RESPONSE_PLACEHOLDER": "...",
			"START_MENU_BTN": "",
			"START_MENU": " \"\"",
			"LOG_IN_INVITATION": "  ",
			"LOG_OUT_BUTTON": " (%s)",
			"LOCK_BUTTON": "",
			"TERMINAL_BUTTON": "",
			"TURN_OFF_BUTTON": "",
			"PASSWORD": "",
			"SET_UP_PCOS": " PCOS",
			"LET_SETUP_SYSTEM": "   .",
			"SET_UP": "",
			"LET_CREATE_ACCOUNT": "    .",
			"CREATE": "",
			"PASSWORD_INPUT_ALERT": " .",
			"SETUP_SUCCESSFUL": " .      .",
			"CREATING_USER_STRUCTURE": "  ",
			"CREATING_USER": " ",
			"INSTALLING_WPS": " ",
			"INSTALLING_APPS": " ",
			"INSTALLING_WP2U": "   ",
			"REMOVING_2STAGE": "  2- ",
			"PATCHING_LOGON": "     ",
			"CONFIRM": "",
			"RIGHT_REVIEW": "   .",
			"RIGHT_REVIEW_BTN": " ",
			"DARK_MODE": " ",
			"INSTALLING_DARKMODE": "   ",
			"CREATING_USER_HOME": "   ",
			"PROVISIONED_PREFERENCE": "    .",
			"USERNAME_EXISTS": "     .",
			"VIDEO_PLAYER": "",
			"INACCESSIBLE_FILE": "%s . ,         ,    .",
			"FILE_NOT_SPECIFIED": "  .",
			"PICTURE_VIEWER": " ",
			"API_TEST_TERM": " API-",
			"HELP_TERMINAL_APITEST": "help -   \r\nclear -  \r\njs_ree -   JavaScript\r\n---    ---\r\n",
			"TERM_COMMAND_NOT_FOUND": "%s:   ",
			"FILE_EXPLORER": "",
			"GRANT_FEXP_PERM": ",          .",
			"GRANT_PERM": " ",
			"GRANT_FEXP_PERM_ADM": "  ,           . (FS_READ, FS_LIST_PARTITIONS)",
			"GRANT_FEXP_PERM_USR": ",              .",
			"BROWSE_FEXP": "",
			"SPACE_SHOWER": "  \"%s\":  %s  %s (%s%)",
			"FILE_STRUCT_BROWSE_FAIL": "  :\n%s",
			"UNKNOWN_FS_STRUCT": "   \"%s\"",
			"UNKNOWN_FILE_TYPE": "   .",
			"TMGR_PERMISSION": "       .    \n : %s",
			"TASK_MANAGER": " ",
			"BASENAME_TASK": "",
			"USER_TASK": "",
			"TERMINATE_TASK": "",
			"FULL_PATH_TASK": " ",
			"ARGUMENTS_TASK": "",
			"REMOVING_SETUP_STATE": "  ",
			"LOGGING_OUT": "  ...",
			"PANIC_LINE1": "       .    .",
			"PANIC_LINE2": " : %s",
			"PANIC_UNSPECIFIED_ERROR": "_",
			"PROBLEMATIC_COMPONENT": " : %s",
			"PROBLEMATIC_PARAMS": " : %s",
			"PROBLEMATIC_JS": " JavaScript: %s: %s",
			"PANIC_LINE3": "       ,   .",
			"PANIC_LINE4": "      ,  ,  -    .",
			"PANIC_LINE5": "     ,   .fsck     ,   \"recover\"  .",
			"PANIC_LINE6": "    :",
			"PANIC_TASK_KILLED": ":%s: ",
			"PANIC_MOUNT_UNMOUNTED": ":%s: ",
			"PANIC_MOUNT_FAILED": ":%s: %s: %s",
			"SHORT_YEARS": "%s",
			"SHORT_MONTHS": "%s",
			"SYSADMIN_TOOLS_TITLE": "  ",
			"SYSADMIN_TOOLS_PRIVFAIL": "    .",
			"REINSTALL_BUTTON": " ",
			"FSCK_BUTTON": "  ",
			"SWIPE_BUTTON": "  ",
			"REINSTALL_DOWNLOADING": "  os.js...",
			"REINSTALL_DOWNLOAD_FAILED": "    os.js.",
			"REINSTALL_DECODING": " os.js  ",
			"REINSTALL_SETTING": " os.js  ",
			"REMOVING_INSTALLERS": " ...",
			"SETTING_FSCK_FLAG": "  .fsck...",
			"SETTING_FSCK_FLAG_FAILED": "    .fsck.",
			"WIPING_SYSTEM": "  ...",
			"WIPING_SYSTEM_FAILED": "    .",
			"WORKING_HOURS_UNMET": "       .   .",
			"NETCONFIG_TITLE": " PCOS Network",
			"NETCONFIG_DENY": "    PCOS Network.",
			"NETCONFIG_URLF": "URL : ",
			"NETCONFIG_AUTO": "   ",
			"NETCONFIG_UC": ": ",
			"NETCONFIG_SAVE": " .",
			"NETCONFIG_PREDICT": " ",
			"EMPTY_STATUSBAR": "",
			"NETCONFIG_SAVE_OK": "  ",
			"NETCONFIG_SAVE_FAIL": "  !",
			"PCOS_STARTING": "PCOS   ...",
			"FILE_PICKER": " ",
			"TEXT_EDITOR": " ",
			"LOAD_BTN": "",
			"SAVE_BTN": "",
			"NETCONFIG_SYSIDM": "System ID ",
			"NO_SAVE_IN_MTN": "     .",
			"INSTALLING_WP2L": "    ",
			"EXIT": "",
			"DESCRIPTION_FIELD": ": %s",
			"REMOVE_BTN": "",
			"UNMOUNT_BTN": "",
			"INSTALLING_DARKMODE2L": "      ",
			"MESSAGE_ENTER": "   ",
			"TIMEOUT_FIELD": " ()",
			"SECRET_FIELD_TXT": "  ()",
			"SECRET_FIELD_HEX": "  ()",
			"REGENERATE": "",
			"START_TIME_FIELD": " ",
			"END_TIME_FIELD": " ",
			"PBKDF2_OPTION": "PBKDF2 ()",
			"INFORMATIVE_MESSAGE_OPTION": " ",
			"INFORMATIVE_MESSAGE_DENY_OPTION": "  ()",
			"TIMEOUT_OPTION": "",
			"TIMEOUT_DENY_OPTION": " ()",
			"SERVER_REPORT_OPTION": " ",
			"PCTOTP_OPTION": " TOTP  PC",
			"RFCTOTP_OPTION": "TOTP  RFC",
			"WORKING_HOURS_OPTION": " ",
			"PERSONAL_SECURITY_TITLE": " ",
			"PERSONAL_SECURITY_DENY": "       .",
			"ADD_BTN": "",
			"OS_LOCALE": "ru",
			"SYSTEM_SECURITY_TITLE": " ",
			"SYSTEM_SECURITY_DENY": "       .",
			"EDIT": "",
			"USER_GROUPS": "",
			"USER_HOMEDIR": " ",
			"REMOVE_USER_WITH_HD": "   ",
			"CREATE_HD": "  ",
			"CREATING_HD_OK": "   .",
			"CREATING_HD_FAIL": "    .",
			"SIGNATURE_VERIFICATION_FAILED": "  ,    %s,       .",
			"UNKNOWN_PLACEHOLDER": "<>",
			"NO_APP_ALLOWLIST": "  ,       ,       .",
			"DISCARD_BUTTON": "  ",
			"MOUNTPOINT": " ",
			"GENERATE_PROMPT": "?",
			"MOUNT_BUTTON": "",
			"NEW_DIR_NAME": "  ",
			"MKDIR_BUTTON": " ",
			"CHOWN_BUTTON": " ",
			"CHGRP_BUTTON": " ",
			"CHMOD_BUTTON": " ",
			"CLIPBOARD_COPY": "",
			"CLIPBOARD_CUT": "",
			"CLIPBOARD_PASTE": "",
			"CLIPBOARD_SOURCE_GONE": "      .",
			"CLIPBOARD_CONFLICT": "          .",
			"SAFE_MODE_MSG": " ",
			"INSTALLING_SFX": "  ",
			"APP_OR_KEY_SIGNATURE_VERIFICATION_FAILED": "    ,     .",
			"NO_SUCH_DEVICE": "  ",
			"READ_ONLY_BMGR": "   .",
			"READ_ONLY_DEV": "   ",
			"NO_DIRECTORY_SUPPORT": "   ",
			"NO_PERMIS_SUPPORT": "   ",
			"IS_A_DIR": " ",
			"NO_SUCH_FILE": "  ",
			"NO_SUCH_DIR": "  ",
			"NO_SUCH_FILE_DIR": "    ",
			"NON_EMPTY_DIR": " ",
			"IS_A_FILE": " ",
			"DIR_EXISTS": "  ",
			"FS_ACTION_FAILED": "       .",
			"UNAUTHORIZED_ACTION": "      .",
			"CREATION_CHECK_FAILED": "  ,    .",
			"PERMISSION_CHANGE_FAILED": "      .",
			"UPDATE_EXTRA_FAIL": "   , , .",
			"UPDATE_BOOT_FAIL": "    .",
			"UPDATE_BUTTON": " ",
			"TOGGLE_HIDDEN_FILES": "/ ",
			"AUTORUN_NECESSITIES_FAILED": "       .     .",
			"CRYPTO_TOOLS_TITLE": "  ",
			"CRYPTO_TOOLS_NOPERM": "      .",
			"CRYPTO_RNG": " ",
			"CRYPTO_HASH": "",
			"CRYPTO_KEYGEN": " ",
			"CRYPTO_ENCRYPT": "",
			"CRYPTO_DECRYPT": "",
			"CRYPTO_SIGN": "",
			"CRYPTO_VERIFY": " ",
			"CRYPTO_DERIVEBITS": "",
			"GENERATE": "",
			"RAW_HEX_DATA": "  ()",
			"CRYPTO_HASH_FIELD": " : ",
			"CRYPTO_PLAINTEXT_FIELD": " : ",
			"ALGORITHM_FIELD": ": ",
			"LENGTH_FIELD": ": ",
			"CRYPTO_NC_FIELD": " : ",
			"IMPORT_AS_FIELD": " : ",
			"CRYPTO_KEY_FIELD": ": ",
			"CRYPTO_CIPHERTEXT_FIELD": " (): ",
			"CRYPTO_SIGNATURE_FIELD": " (): ",
			"CRYPTO_KEYGEN_MSG": "  ()...",
			"CRYPTO_KEYGEN_SYMM": "   ",
			"CRYPTO_KEYGEN_EXPFAIL": "  ,   ",
			"CRYPTO_RNGOUT_FIELD": "  (): ",
			"CRYPTO_KEYGEN_ACTION": " ()",
			"CRYPTO_HASH_ACTION": "",
			"CRYPTO_ENCRYPT_ACTION": "",
			"CRYPTO_DECRYPT_ACTION": "",
			"CRYPTO_SIGN_ACTION": "",
			"CRYPTO_VERIFY_ACTION": " ",
			"CRYPTO_DERIVEBITS_ACTION": "",
			"CRYPTO_PUBKEY_FIELD": " : ",
			"CRYPTO_PRIVKEY_FIELD": " : ",
			"CRYPTO_BASEKEY_FIELD": " : ",
			"CRYPTO_HASHOUT_FIELD": "  (): ",
			"CRYPTO_MODLEN_FIELD": " : ",
			"CRYPTO_PUBEXP_FIELD": "  (): ",
			"EXPORT_AS_FIELD": " : ",
			"CRYPTO_KEYUSE_FIELD": " :",
			"CRYPTO_PLAINTEXTAS_FIELD": "   : ",
			"CRYPTO_IV_FIELD": "  (): ",
			"CRYPTO_CTR_FIELD": " (): ",
			"CRYPTO_VERIFIED_CHECKBOX": " ",
			"CRYPTO_SALT_FIELD": " (): ",
			"CRYPTO_DERIVEOUT_FIELD": " (): ",
			"CRYPTO_ITERATIONS_FIELD": ": ",
			"PATH_INCLUDES_EMPTY": "       .",
			"BASIC_CURL_USAGE": ": basiccurl [] []",
			"BASIC_CURL_DESCRIPTION": "        .",
			"NO_ARGUMENTS": "  ",
			"CAT_USAGE": ": cat [1] <2> <3> ... <N>",
			"CAT_DESCRIPTION": "        ",
			"CHGRP_USAGE": ": chgrp [] []",
			"CHGRP_DESCRIPTION": "   ",
			"CHMOD_USAGE": ": chmod [] []",
			"CHMOD_DESCRIPTION": ",      .",
			"CHMOD_MODE_DESCRIPTION": "[]     r (Read, ), w (Write, )  x (eXecute, ).",
			"CHMOD_MODE_CONVERT": "  []  : 0 - \"\", 1 - \"x\", 2 - \"w\", 3 - \"wx\", 4 - \"r\", 5 - \"rx\", 6 - \"rw\", 7 - \"rwx\"",
			"CHOWN_USAGE": ": chown [] []",
			"CHOWN_DESCRIPTION": "   ",
			"CP_USAGE": ": cp <> [] []",
			"CP_DESCRIPTION": "      .",
			"OPT_RECURSIVE_DESCRIPTION": "--recursive:   ",
			"OPT_FORCE_DESCRIPTION": "--force:     ",
			"ARGUMENT_COUNT_MISMATCH": "     ",
			"DF_HEADER": "\t\t\t\t%",
			"LS_USAGE": ": ls []",
			"LS_DESCRIPTION": "   .",
			"LS_MOUNTPOINT_LIST": "    : ",
			"MOUNTPOINT_SYSTEM": "",
			"PASSWD_NEW_PROMPT": "      .",
			"PASSWD_2FACTOR_LOSS_WARN": "     .",
			"PASSWD_PROMPT": " : ",
			"PASSWD_CONFIRM_PROMPT": " : ",
			"PASSWD_FEEDBACK": "  ",
			"PASSWD_MISMATCH": "  .",
			"PING_USAGE": ": ping <--internet> []",
			"PING_DESCRIPTION": "        .",
			"PING_INTERNET_OPTION": "--internet:  ping  ,    PCOS Network",
			"PIVOT_ROOT_USAGE": ": pivot_root []",
			"PIVOT_ROOT_DESCRIPTION": "        .",
			"REAL_TERMINAL_NAME": "",
			"REAL_TERMINAL_BUILTIN_LIST": " :",
			"REAL_TERMINAL_HELP_USEDESC": "help -  ,     .",
			"REAL_TERMINAL_CLEAR_USEDESC": "clear -  ,    .",
			"REAL_TERMINAL_SUGRAPH_USEDESC": "sugraph <> -       .",
			"REAL_TERMINAL_SU_USEDESC": "su <> -   .",
			"REAL_TERMINAL_GRAPHIC_USEDESC": "graphic <> -         .",
			"REAL_TERMINAL_EXIT_USEDESC": "exit -   .",
			"REAL_TERMINAL_LOGON_REQUIRED": "():      sugraph %s.",
			"RM_USAGE": ": rm <> []",
			"RM_DESCRIPTION": "    .",
			"RKL_USAGE": ": runKlvlCode []",
			"RKL_DESCRIPTION": "       .",
			"WRITE_USAGE": ": write [] []",
			"WRITE_DESCRIPTION": "    .",
			"CP_PERMISSIONS_OPTION": "--permissions:   ",
			"REAL_TERMINAL_DEFAULT_PATH_FIELD": "  : %s",
			"REAL_TERMINAL_PUSHPATH_USEDESC": "pushpath [] -      .",
			"REAL_TERMINAL_RESETPATH_USEDESC": "resetpath -           .",
			"REAL_TERMINAL_LSPATH_USEDESC": "lspath -          .",
			"MKDIR_USAGE": ": mkdir []",
			"MKDIR_DESCRIPTION": "     .",
			"NEXT": "",
			"DESCRIBE_TEMPLATE": ": %s (%s)\n: %s",
			"EXTRA_DESCRIBE_TEMPLATE": ": %s (%s)\n: %s\n: %s",
			"DECLINE": "",
			"ACCESS_REQUEST_TITLE": " ",
			"REAL_TERMINAL_INTENT": "    ",
			"PERSONAL_SECURITY_INTENT": "   ",
			"FILE_EXPLORER_INTENT": "    ",
			"FILE_EXPLORER_FULL_INTENT": " ,     ",
			"CRYPTO_TOOLS_INTENT": "  ",
			"SYSTEM_SECURITY_INTENT": "      ",
			"FORMAT_USAGE": ": format [_] [] <>",
			"FORMAT_DESCRIPTION": "    .",
			"FORMAT_FSTYPE": "  : pcfs (   PCFSiDBMount), pcfs_crypt (PCFSiDBAESCryptMount), pcfs_crypt_monokey (PCFSiDBAESCryptMount), pcfs_crypt_filetable_monokey (PCFSiDBAESCryptMount), pcbm:<_> (   ), null ( )",
			"FORMAT_OVERWRITE_WARN": "   .     'overwrite'     .          .",
			"FORMAT_UNKNOWN_FSTYPE": "  ",
			"LLDA_USAGE": ": llda_tool [] []",
			"LLDA_ACTION_EXPORT": " export: [ ] [ ]",
			"LLDA_ACTION_IMPORT": " import: [ ] [ ]",
			"LLDA_ACTION_IMPORTSTRING": " importstring: [ ] [ ]",
			"LLDA_ACTION_COPY": " copy: [ ] [ ]",
			"LLDA_ACTION_REMOVE": " remove: []",
			"LLDA_ACTION_LIST": " list",
			"LLDA_DISCLAIMER": "       !",
			"LLDA_UNKNOWN_ACTION": " ",
			"INITDISK_OVERWRITE_WARN": "     .     'overwrite'     .          .",
			"INITDISK_USAGE": ": initdisk [ ] <>",
			"INITDISK_DESCRIPTION": "    .",
			"MOUNT_USAGE": ": mount [] [_] [_]",
			"MOUNT_DESCRIPTION": "  .",
			"MOUNT_KNOWN_FS": "   : %s",
			"MOUNT_KNOWN_PPART": "--partition=[] -   ",
			"MOUNT_KNOWN_PINPA": "--interactivePassword -   ",
			"MOUNT_KNOWN_PPASS": "--password=[] -  ",
			"MOUNT_KNOWN_PKEY": "--key=[] -   ",
			"MOUNT_KNOWN_PTYPE": "--type=[] -  ramMount,  type=run  - /run",
			"MOUNT_KNOWN_PURL": "--url=[URL] -  URL",
			"MOUNT_KNOWN_PINPI": "--inputPipeId=[] -   ",
			"MOUNT_KNOWN_POUPI": "--outputPipeId=[] -   ",
			"MOUNTINFO_USAGE": ": mountinfo [_]",
			"MOUNTINFO_DESCRIPTION": "    .",
			"UMOUNT_USAGE": ": umount <> [_]",
			"UMOUNT_DESCRIPTION": "  .",
			"UMOUNT_OPT_SYNCONLY": "--sync-only -  ,    ( --force)",
			"UMOUNT_OPT_FORCE": "--force -  ,  ",
			"CALC_TITLE": "",
			"CALC_BASIC_MODE": ":  ",
			"CALC_ADVANCED_MODE": ":  ",
			"CALC_ADD": "",
			"CALC_SUBTRACT": "",
			"CALC_MULTIPLY": "",
			"CALC_DIVIDE": "",
			"CALC_ADVMODE_BTN": " ",
			"CALC_BASICMODE_BTN": " ",
			"CALC_OPERAND": " %s",
			"CALC_TOMIXED_BTN": "   ",
			"CALC_TOIMPR_BTN": "   ",
			"CALC_GCD": "",
			"CALC_FACTORIAL": "",
			"CALC_GCD_PAGE": "  ",
			"ZKPP_OPTION": "ZKPP ()",
			"SECONDSTAGE_INSTALLER_INTENT": "  ",
			"SETUP_FAILED": "  .   ,  .",
			"WARNING_PRIVILEGES": "    !      .",
			"USER_EXT_PRIVILEGES": "  ",
			"LULL_SYSTEM": " ",
			"SYSTEM_IMAGING": " ",
			"CREATE_IMAGE": "  ",
			"RESTORE_IMAGE": "  ",
			"SELECT_FILE_PROMPT": " : ",
			"REBOOT_ON_RESTORE": "  ",
			"MERGE_STATES": "  ",
			"LISTING_PARTITIONS_FAILED": "    .",
			"READING_PARTITION_FAILED": "    %s",
			"LISTING_DATA_FAILED": "    .",
			"READING_DATA_FAILED": "   .",
			"WRITING_IMAGE_FAILED": "   .",
			"SUCCESSFUL_OP": "   .",
			"FAILED_OP": "  .",
			"READING_IMAGE_FAILED": "   .",
			"WRITING_PARTITION_FAILED": "    %s",
			"WRITING_DATA_FAILED": "   .",
			"DELETING_PARTITION_FAILED": "    %s",
			"DELETING_DATA_FAILED": "   .",
			"SHUTTING_DOWN_FAILED": "    .",
			"NETWORK_STATUS_ONLINE": "     .",
			"NETWORK_STATUS_OFFLINE": "      .",
			"PCOS_NETWORK_STATUS_ONLINE": "   PCOS Network. (: %s, : %s)",
			"PCOS_NETWORK_STATUS_OFFLINE": "   PCOS Network.",
			"PCOS_NETWORK_STATUS_STOPPED": " PCOS Network  .",
			"START_MENU_FAILED": "    \"\".       .",
			"SYSTEM_BUILT_AT": "  %s",
			"REAL_TERMINAL_VER_USEDESC": "ver -      ",
			"BLANK_PRIVILEGE_FLAG": " ",
			"INSTALLING_SYSTEM_APPHARDEN": "   ",
			"INSTALLING_NET_CONF": "  PCOS Network",
			"NETWORK_ADDRESS_FIELD": " : %s",
			"NETWORK_AUTOHOST_FIELD": " : %s",
			"NETCONFIG_HOSTNAME": "  : ",
			"DIFF_USAGE": ": diff [] [] []",
			"DIFF_DESCRIPTION": "    .",
			"PATCH_USAGE": ": patch [] [] []",
			"PATCH_DESCRIPTION": " ''    .",
			"CURRENT_OSFILE_VERSION": "  :  %s",
			"DOWNLOADING_OS_PATCH": "     %s ( %s)",
			"HANDOFF_UPDATE": "   updateos.js",
			"SYSTEM_UP_TO_DATE": " ",
			"POWER_USAGE": ": power <> <r|reboot|restart|k|kexec>",
			"POWER_DESCRIPTION": "   .      .",
			"POWER_FORCE": "--force:   ,    ",
			"POWER_KEXEC": "--kexec:  ,      (  reboot)",
			"UPDATEFW_BUTTON": " ",
			"UPDATEFW_DOWNLOADING": "  init.js...",
			"UPDATEFW_DOWNLOAD_FAILED": "    init.js.",
			"UPDATEFW_DECODING": " init.js  ",
			"UPDATEFW_SETTING": " init.js  ",
			"ADDUSER_USAGE": ": adduser <> []",
			"ADDUSER_DESCRIPTION": "    .",
			"ADDUSER_SKIP_PASSWD": "--skip-passwd:   ",
			"ADDUSER_SKIP_HOME": "--skip-home:    ",
			"ADDUSER_GROUPS": "--groups:    (  ,     )",
			"ADDUSER_HOME": "--home:   ",
			"NEW_USER_CREATION": "   \"%s\"",
			"BLOCKUSER_USAGE": ": blockuser <>",
			"BLOCKUSER_DESCRIPTION": "   .",
			"DELUSER_USAGE": ": deluser <> []",
			"DELUSER_DESCRIPTION": "   .",
			"DELUSER_HOMEDIR": "--homedir:   ",
			"OLD_USER_DELETION": "   \"%s\"",
			"BATTERY_STATUS_UNAVAILABLE": "  .",
			"BATTERY_STATUS_CHARGING": "  (%s%, %s )",
			"BATTERY_STATUS_DISCHARGING": "  (%s%, %s)",
			"PATCH_HUNK_COUNT": " : %s",
			"SERVER_SIGNATURE_VERIFICATION_FAILED": "    .",
			"NETWORK_UNREACHABLE": " .",
			"ADDRESS_UNREACHABLE": " .",
			"NETWORK_CLOSED": "  .",
			"CONNECTION_DROPPED": "  .",
			"BLOG_BROWSER_NAME": " ",
			"BLOG_BROWSER_LOADING": ",  ...",
			"BLOG_BROWSER_PROTO": "  .      bdp://.",
			"BLOG_BROWSER_GATESET": " ,   ,    : bdp://gate@myblog.pc",
			"HOSTNAME_RESOLUTION_FAILED": "    .",
			"BLOG_BROWSER_POSTCLOSE": "    .",
			"BLOG_BROWSER_FILEPOST": " -.       .",
			"BLOG_BROWSER_DLFILEPOST": "   -.",
			"BLOG_BROWSER_LOADING_PROGRESS": "  ( %s  %s )",
			"BLOG_BROWSER_NOVERIFY": "  ,   .   ,    -    \" \"   ,     .     ?",
			"BLOG_BROWSER_NOSANDBOX": "        .   ,       ,      .     ?",
			"NETWORKFS_USAGE": ": networkfs <> [url] [_]",
			"NETWORKFS_DESCRIPTION": "  ,   PCOS Network.",
			"NETWORKFS_NOVERIFY": "--no-verification:    ",
			"NETWORKFS_KEY": "--key=[]:      ",
			"NETWORKFS_PROTO": "     netfs://.",
			"NETCONFIG_UPDATES": ": ",
			"NETWORK_UPDATES_FIELD": " : %s",
			"LOCALE_NAME": " (Russian)",
			"SETTING_LOCALE_PREFERENCE": "  ",
			"LANGUAGE_SELECT": " : ",
			"CHANGE_LOCALE": " ",
			"INSTALLER_INTENT": "  ",
			"MOUNT_EXISTS": "  ",
			"INSECURE_MODE_MSG": " !"
		},
		get: function(key, lang) {
			lang = lang || locales.defaultLocale || navigator.languages[0].split("-")[0].toLowerCase();
			let locale = locales[lang];
			if (!locale) locale = locales[locales.defaultLocale];
			if (!locale) locale = {};
			if (!locale.hasOwnProperty(key)) locale = locales.en;
			return locale.hasOwnProperty(key) ? locale[key] : key;
		}
	}
	modules.locales = locales;
	modules.startupWindow.content.innerText = locales.get("PCOS_STARTING");
}
localization();
// 07-tasks.js
function loadTasks() {
	// @pcos-app-mode native
	let tasks = {
		exec: async function(file, arg, windowObject, token, silent, privateData) {
			let errorAudio = new Audio();
			try {
				let errorSoundPerm = await modules.fs.permissions(modules.defaultSystem + "/etc/sounds/error.aud", token);
				if (!errorSoundPerm.world.includes("r")) throw new Error("Not allowed to read error.aud");
				let errorSound = await modules.fs.read(modules.defaultSystem + "/etc/sounds/error.aud", token);
				errorAudio.src = errorSound;
			} catch {}
			if (modules.session.attrib(windowObject.sessionId, "loggingOut")) throw new Error("LOGGING_OUT");
			let language = modules.session.attrib(windowObject.sessionId, "language") || undefined;
			if (modules.shuttingDown) {
				windowObject.windowDiv.remove();
				throw new Error("SYSTEM_SHUTDOWN_REQUESTED");
			}
			let appRedirecting = {};
			try {
				appRedirecting = JSON.parse(await this.fs.read(modules.defaultSystem + "/etc/appRedir", token));
			} catch {}
			if (modules.core.bootMode == "safe") appRedirecting = {};
			if (appRedirecting.hasOwnProperty(file)) file = appRedirecting[file];
			windowObject.title.innerText = modules.locales.get("UNTITLED_APP", language);
			windowObject.content.innerText = "";
			windowObject.content.style = "";
			let taskId = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
			let executablePermissions, executable;
			try {
				executablePermissions = await this.fs.permissions(file, token);
				executable = await this.fs.read(file, token);
			} catch (e) {
				windowObject.title.innerText = modules.locales.get("APP_STARTUP_CRASH_TITLE", language);
				windowObject.content.innerText = modules.locales.get("APP_STARTUP_CRASH", language);
				windowObject.content.style.padding = "8px";
				windowObject.closeButton.disabled = false;
				windowObject.closeButton.onclick = (e) => windowObject.windowDiv.remove() && e.stopPropagation();
				if (silent) windowObject.windowDiv.remove();
				if (!silent) errorAudio.play();
				throw e;
			}
			if (!executablePermissions.world.includes("r") || !executablePermissions.world.includes("x")) {
				windowObject.title.innerText = modules.locales.get("PERMISSION_DENIED", language);
				windowObject.content.innerText = modules.locales.get("MORE_PERMISSION_DENIED", language);
				windowObject.content.style.padding = "8px";
				windowObject.closeButton.disabled = false;
				windowObject.closeButton.onclick = (e) => windowObject.windowDiv.remove() && e.stopPropagation();
				if (silent) windowObject.windowDiv.remove();
				if (!silent) errorAudio.play();
				throw new Error("MORE_PERMISSION_DENIED", language);
			}
			if (!executable.includes("// @pcos-app-mode isolat" + "able")) {
				windowObject.title.innerText = modules.locales.get("COMPATIBILITY_ISSUE_TITLE", language);
				windowObject.content.innerText = modules.locales.get("COMPATIBILITY_ISSUE", language);
				windowObject.content.style.padding = "8px";
				windowObject.closeButton.disabled = false;
				windowObject.closeButton.onclick = (e) => windowObject.windowDiv.remove() && e.stopPropagation();
				if (silent) windowObject.windowDiv.remove();
				if (!silent) errorAudio.play();
				throw new Error("COMPATIBILITY_ISSUE");
			}
			let appHardening = {overridable:true};
			try {
				appHardening = JSON.parse(await this.fs.read(modules.defaultSystem + "/etc/appHarden", token));
			} catch {}
			let disableHarden = appHardening.overridable && modules.core.bootMode == "disable-harden";
			if (disableHarden) appHardening = {overridable:true};
			let limitations = [];
			let execSignature = {};
			if (executable.includes("// =====BEGIN MANIFEST=====")) {
				let parsingLines = executable.split("\n");
				let parsingBoundStart = parsingLines.indexOf("// =====BEGIN MANIFEST=====");
				let parsingBoundEnd = parsingLines.indexOf("// =====END MANIFEST=====");
				let upToParse = parsingLines.slice(parsingBoundStart, parsingBoundEnd + 1);
				let knownLineTypes = ["allow", "deny"];
				for (let line of upToParse) {
					let lineType = line.split(": ")[0].replace("// ", "");
					let lineData = line.replace("// " + lineType + ": ", "");
					if (lineType == "signature") {
						execSignature.signature = lineData;
						executable = executable.replace(line + "\n", "");
					}
					if (lineType == "signer") execSignature.signer = lineData;
					if (lineType == "asck") execSignature.selfContainedSigner = lineData;
					if (knownLineTypes.includes(lineType)) {
						let dataParts = lineData.split(", ");
						for (let data of dataParts) limitations.push({ lineType, data });
					}
				}
			}
			if (disableHarden) limitations = [];
			let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
			let u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, "0")).join("");
			if (!limitations.some(lim => lim.lineType == "allow") && appHardening.requireAllowlist && !disableHarden) {
				windowObject.title.innerText = modules.locales.get("PERMISSION_DENIED", language);
				windowObject.content.innerText = modules.locales.get("NO_APP_ALLOWLIST", language);
				windowObject.content.style.padding = "8px";
				windowObject.closeButton.disabled = false;
				windowObject.closeButton.onclick = (e) => windowObject.windowDiv.remove() && e.stopPropagation();
				if (silent) windowObject.windowDiv.remove();
				if (!silent) errorAudio.play();
				throw new Error("NO_APP_ALLOWLIST");
			}

			async function recursiveKeyVerify(key, khrl) {
				if (!key) throw new Error("NO_KEY");
				let hash = u8aToHex(new Uint8Array(await crypto.subtle.digest("SHA-256", new TextEncoder().encode((key.keyInfo?.key || key.key).x + "|" + (key.keyInfo?.key || key.key).y))));
				if (khrl.includes(hash)) throw new Error("KEY_REVOKED");
				let signedByKey = modules.ksk_imported;
				if (key.keyInfo && key.keyInfo?.signedBy) {
					signedByKey = JSON.parse(await this.fs.read(modules.defaultSystem + "/etc/keys/" + key.keyInfo.signedBy, token));
					if (!signedByKey.keyInfo) throw new Error("NOT_KEYS_V2");
					if (!signedByKey.keyInfo.usages.includes("keyTrust")) throw new Error("NOT_KEY_AUTHORITY");
					await recursiveKeyVerify(signedByKey, khrl);
					signedByKey = await crypto.subtle.importKey("jwk", signedByKey.keyInfo.key, {
						name: "ECDSA",
						namedCurve: "P-256"
					}, false, ["verify"]);
				}
				if (!await crypto.subtle.verify({
					name: "ECDSA",
					hash: {
						name: "SHA-256"
					}
				}, signedByKey, hexToU8A(key.signature), new TextEncoder().encode(JSON.stringify(key.key || key.keyInfo)))) throw new Error("KEY_SIGNATURE_VERIFICATION_FAILED");
				return true;
			}

			if ((execSignature.signer || appHardening.requireSignature || execSignature.selfContainedSigner) && !disableHarden) {
				try {
					let khrlFiles = await this.fs.ls(modules.defaultSystem + "/etc/keys/khrl", token);
					let khrlSignatures = [];
					for (let khrlFile of khrlFiles) {
						let khrl = JSON.parse(await this.fs.read(modules.defaultSystem + "/etc/keys/khrl/" + khrlFile, token));
						let khrlSignature = khrl.signature;
						delete khrl.signature;
						if (await crypto.subtle.verify({
							name: "ECDSA",
							hash: {
								name: "SHA-256"
							}
						}, modules.ksk_imported, hexToU8A(khrlSignature), new TextEncoder().encode(JSON.stringify(khrl.list)))) {
							khrlSignatures.push(...khrl.list);
						}
					}
					let signingKey = JSON.parse(execSignature.selfContainedSigner || "null");
					if (!signingKey || appHardening.disableASCK) signingKey = JSON.parse(await this.fs.read(modules.defaultSystem + "/etc/keys/" + execSignature.signer, token));
					await recursiveKeyVerify(signingKey, khrlSignatures);
					if (signingKey.keyInfo) if (!signingKey.keyInfo.usages.includes("appTrust")) throw new Error("NOT_APP_SIGNING_KEY");
					let importSigningKey = await crypto.subtle.importKey("jwk", signingKey.keyInfo?.key || signingKey.key, {
						name: "ECDSA",
						namedCurve: "P-256"
					}, false, ["verify"]);
					if (!await crypto.subtle.verify({
						name: "ECDSA",
						hash: {
							name: "SHA-256"
						}
					}, importSigningKey, hexToU8A(execSignature.signature), new TextEncoder().encode(executable))) throw new Error("APP_SIGNATURE_VERIFICATION_FAILED");
				} catch (e) {
					console.error("Failed to verify app signature:", e);
					windowObject.title.innerText = modules.locales.get("PERMISSION_DENIED", language);
					windowObject.content.innerText = modules.locales.get("SIGNATURE_VERIFICATION_FAILED", language).replace("%s", execSignature.signer || modules.locales.get("UNKNOWN_PLACEHOLDER", language));
					windowObject.content.style.padding = "8px";
					windowObject.closeButton.disabled = false;
					windowObject.closeButton.onclick = (e) => windowObject.windowDiv.remove() && e.stopPropagation();
					if (silent) windowObject.windowDiv.remove();
					if (!silent) errorAudio.play();
					throw new Error("APP_OR_KEY_SIGNATURE_VERIFICATION_FAILED");
				}
			}
			let ree = await this.ree(windowObject.content, token);
			try {
				modules.session.attrib(windowObject.sessionId, "openReeWindows", [ ...(modules.session.attrib(windowObject.sessionId, "openReeWindows") || []), taskId ]);
				arg = arg || [];
				if (!(arg instanceof Array)) arg = [];
				arg = arg.map(a => String(a));
				let that = this;
				ree.iframe.style = "width: 100%; height: 100%; border: none; top: 0; left: 0; position: absolute;";
				let reeAPIInstance = await modules.reeAPIInstance({ ree, ses: windowObject.sessionId, token, taskId, limitations, privateData });
				for (let action in reeAPIInstance.public) ree.exportAPI(action, (e) => reeAPIInstance.public[action](e.arg));
				this.tracker[taskId] = {
					ree,
					file: file,
					arg: arg,
					apis: reeAPIInstance,
					critical: false,
					cliio: {
						attached: false,
						attachedCLISignUp: function() {
							return new Promise(a => attachedCLIRegistrations.push(a));
						}
					}
				};
				let registrations = [];
				let attachedCLIRegistrations = [];
				let cliCache = [];
				windowObject.closeButton.addEventListener("click", () => that.sendSignal(taskId, 15));
				ree.exportAPI("attachCLI", async function() {
					if (that.tracker[taskId].cliio.attached) return true;
					for (let registration of attachedCLIRegistrations) registration();
					attachedCLIRegistrations = [];
					let signup = () => new Promise((resolve) => registrations.push(resolve));
					ree.iframe.hidden = true;
					let termDiv = document.createElement("div");
					termDiv.style = "position: absolute; top: 0; left: 0; width: 100%; height: 100%;";
					let fitAddon = new FitAddon.FitAddon();
					let termInstance = new Terminal();
					termInstance.loadAddon(fitAddon);
					termInstance.open(termDiv);
					windowObject.content.appendChild(termDiv);
					that.tracker[taskId].cliio.attached = true;
					that.tracker[taskId].cliio.xtermInstance = termInstance;
					let onresizeFn = () => fitAddon.fit();
					onresizeFn();
					let robs = new ResizeObserver(onresizeFn);
					that.tracker[taskId].cliio.robsInstance = robs;
					robs.observe(windowObject.windowDiv);
					that.tracker[taskId].cliio.signup = signup;
					that.tracker[taskId].cliio.xtermInstance.onData(e => cliCache.push(e));
					termInstance.clear();
					await new Promise((resolve) => setTimeout(resolve, 8));
					return true;  
				});
				ree.exportAPI("toMyCLI", async function(apiArg) {
					if (that.tracker[taskId].cliio.attached) {
						that.tracker[taskId].cliio.xtermInstance.write(apiArg.arg);
						for (let registered in registrations) {
							await registrations[registered]({ type: "write", data: apiArg.arg });
							registrations.splice(0, 1);
						}
					}
				});
				ree.exportAPI("fromMyCLI", async function() {
					if (!that.tracker[taskId].cliio.attached) return false;
					let ti = that.tracker[taskId].cliio.xtermInstance;
					return new Promise(async function(resolve) {
						if (cliCache.length) {
							let element = cliCache[0];
							cliCache = cliCache.slice(1);
							resolve(element);
							return;
						}
						let d = ti.onData(async function(e) {
							cliCache = cliCache.slice(1);
							resolve(e);
							d.dispose();
						});
					});
				});
				ree.exportAPI("clearMyCLI", async function() {
					if (that.tracker[taskId].cliio.attached) that.tracker[taskId].cliio.xtermInstance.clear();
					for (let registered in registrations) {
						await registrations[registered]({ type: "consoleClear" });
						registrations.splice(registered, 1);
					}
				});
				ree.exportAPI("cliSize", function() {
					if (!that.tracker[taskId].cliio.attached) return [ 0, 0 ];
					return [ that.tracker[taskId].cliio.xtermInstance.cols, that.tracker[taskId].cliio.xtermInstance.rows ];
				});
				ree.exportAPI("detachCLI", function() {
					if (!that.tracker[taskId].cliio.attached) return true;
					that.tracker[taskId].cliio.attached = false;
					that.tracker[taskId].cliio.xtermInstance.clear();
					that.tracker[taskId].cliio.robsInstance.disconnect();
					delete that.tracker[taskId].cliio.robsInstance;
					that.tracker[taskId].cliio.xtermInstance.dispose();
					delete that.tracker[taskId].cliio.xtermInstance;
					delete that.tracker[taskId].cliio.signup;
					registrations = [];
					ree.iframe.hidden = false;
					return true;
				});
				ree.exportAPI("windowVisibility", (apiArg) => windowObject.windowDiv.classList.toggle("hidden", !apiArg.arg));
				ree.exportAPI("windowTitleSet", (apiArg) => windowObject.title.innerText = apiArg.arg);
				ree.exportAPI("windowResize", function(apiArg) {
					if (reeAPIInstance.public.getPrivileges().includes("GRAB_ATTENTION")) {
						windowObject.windowDiv.style.width = apiArg.arg[0] + "px";
						windowObject.windowDiv.style.height = apiArg.arg[1] + "px";
					}
				});
				ree.exportAPI("windowSize", function() {
					return {
						width: windowObject.windowDiv.clientWidth,
						height: windowObject.windowDiv.clientHeight
					}
				});
				ree.exportAPI("windowRelocate", function(apiArg) {
					if (reeAPIInstance.public.getPrivileges().includes("GRAB_ATTENTION")) {
						windowObject.windowDiv.style.top = apiArg.arg[0] + "px";
						windowObject.windowDiv.style.left = apiArg.arg[1] + "px";
					}
				});
				ree.exportAPI("windowFullscreen", function(apiArg) {
					if (reeAPIInstance.public.getPrivileges().includes("GRAB_ATTENTION")) {
						windowObject.windowDiv.classList.toggle("fullscreen", apiArg.arg);
					}
				});
				ree.exportAPI("closeability", (apiArg) => windowObject.closeButton.classList.toggle("hidden", !apiArg.arg));
				ree.exportAPI("critical", function(apiArg) {
					if (reeAPIInstance.public.getPrivileges().includes("SYSTEM_STABILITY")) {
						that.tracker[taskId].critical = !!apiArg.arg;
					}
				});
				await ree.eval("taskId = " + JSON.stringify(taskId) + ";");
				await ree.eval("exec_args = " + JSON.stringify(arg) + ";");
				ree.beforeCloseDown(function() {
					let orw = modules.session.attrib(windowObject.sessionId, "openReeWindows");
					orw.splice(orw.indexOf(taskId), 1);
					modules.session.attrib(windowObject.sessionId, "openReeWindows", orw);
					if (that.tracker[taskId].cliio.attached) {    
						that.tracker[taskId].cliio.attached = false;
						that.tracker[taskId].cliio.xtermInstance.clear();
						that.tracker[taskId].cliio.robsInstance.disconnect();
						that.tracker[taskId].cliio.robsInstance = null;
						that.tracker[taskId].cliio.xtermInstance.dispose();
					}
				});
				ree.beforeCloseDown(() => windowObject.windowDiv.remove());
				ree.beforeCloseDown(() => delete that.tracker[taskId]);
				await ree.eval(executable);
			} catch (e) {
				ree.closeDown();
				windowObject.title.innerText = modules.locales.get("APP_STARTUP_CRASH_TITLE", language);
				windowObject.content.innerText = modules.locales.get("APP_STARTUP_CRASH", language);
				windowObject.content.style.padding = "8px";
				windowObject.closeButton.disabled = false;
				windowObject.windowDiv.classList.toggle("hidden", false);
				windowObject.closeButton.onclick = (e) => windowObject.windowDiv.remove() && e.stopPropagation();
				if (silent) windowObject.windowDiv.remove();
				throw e;
			}
			return taskId;
		},
		sendSignal: async function(taskId, signal, bypassCritical) {
			if (signal == 9) {
				if (this.tracker[taskId].critical && !bypassCritical) {
					let memory = this.tracker[taskId];
					await memory.ree.closeDown();
					await panic("CRITICAL_TASK_FAILED", {
						name: memory.file,
						params: memory.arg
					});
					throw new Error("CRITICAL_TASK_FAILED");
				}
				return await this.tracker[taskId].ree.closeDown();
			}
			return await this.tracker[taskId].ree.eval("dispatchEvent(new CustomEvent(\"signal\", { detail: " + JSON.stringify(signal) + ", bubbles: true }));");
		},
		runsProperly: async function(taskId) {
			try {
				return await this.tracker[taskId].ree.eval("true");
			} catch (e) {
				return false;
			}
		},
		listPublicTasks: () => Object.keys(tasks.tracker),
		waitTermination: async function(taskId) {
			if (!this.tracker.hasOwnProperty(taskId)) return;
			return new Promise((resolve) => this.tracker[taskId].ree.beforeCloseDown(() => resolve()));
		},
		taskInfo: async function(taskId) {
			if (!this.tracker.hasOwnProperty(taskId)) return null;
			let info = await modules.tokens.info(this.tracker[taskId].apis.public.getProcessToken());
			if (!info) info = { user: taskId.slice(0, 16) };
			return {
				file: this.tracker[taskId].file,
				arg: this.tracker[taskId].arg,
				runBy: info.user,
				cliio: this.tracker[taskId].cliio.attached
			}
		},
		tracker: {},
		fs: modules.fs,
		ree: modules.core.createREE
	};
	
	modules.tasks = tasks;
}
loadTasks();
// 08-tty.js
async function js_terminal() {
	// @pcos-app-mode native
	let windowtty = await modules.window(modules.session.active);
	windowtty.title.innerText = modules.locales.get("JS_TERMINAL");
	windowtty.closeButton.onclick = function() {
		windowtty.windowDiv.remove();
	}
	windowtty.content.style.padding = "0px";
	windowtty.content.style.margin = "0px";
	let term = new Terminal();
	let fitAddon = new FitAddon.FitAddon();
	term.loadAddon(fitAddon);
	term.open(windowtty.content);
	let onresizeFn = () => fitAddon.fit();
	onresizeFn();
	let robs = new ResizeObserver(onresizeFn);
	robs.observe(windowtty.windowDiv);
	term.clear();
	term.write(modules.locales.get("TERMINAL_INVITATION").replace("%s", pcos_version) + "\r\n\r\n");
	term.write("> ");
	let command = "";
	term.onData(function(e) {
		if (e == "\r") {
			term.write("\r\n");
			try {
				term.write(JSON.stringify(eval(command)) + "\r\n");
			} catch (e) {
				term.write(e + "\r\n");
			}
			term.write("> ");
			command = "";
		} else if (e == '\u007F') {
			if (command.length > 0) {
				command = command.substr(0, command.length - 1);
				term.write('\b \b');
			}
		} else {
			if (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\u00a0') {
				command += e;
				term.write(e);
			}
		}
	});
	return windowtty;
}
// 09-logout.js
async function logOut(target) {
	let liu = modules.liu;
	if (!liu.hasOwnProperty(target)) throw new Error("USER_NOT_LOGGED_IN");
	let session = liu[target].session;
	let token = liu[target].logon.token;
	let secureSession = modules.session.attrib(session, "secureID");
	await modules.session.attrib(session, "loggingOut", true);
	clearInterval(liu[target].clockInterval);
	if (modules.session.active == session || (secureSession && modules.session.active == secureSession)) await modules.session.muteAllSessions();
	await modules.session.activateSession(modules.session.systemSession);
	let loggingOutWindow = modules.window(modules.session.systemSession, true);
	loggingOutWindow.title.innerText = modules.locales.get("LOGGING_OUT");
	loggingOutWindow.content.style.padding = "8px";
	loggingOutWindow.closeButton.disabled = true;
	loggingOutWindow.content.innerText = modules.locales.get("LOGGING_OUT");
	let taskList = modules.session.attrib(session, "openReeWindows") || [];
	let timeout = (ms) => new Promise(resolve => setTimeout(resolve, ms));
	function allProcessesClosed() {
		return new Promise(function(resolve) {
			let int = setInterval(function() {
				try {
					taskList = modules.session.attrib(session, "openReeWindows") || [];
					if (Object.keys(taskList).length == 0) {
						resolve();
						clearInterval(int);
					}
				} catch {
					resolve();
					clearInterval(int);
				}
			})
		});
	}
	loggingOutWindow.content.innerText = modules.locales.get("POLITE_CLOSE_SIGNAL");
	for (let taskId of taskList) modules.tasks.sendSignal(taskId, 15);
	await Promise.race([
		timeout(5000),
		allProcessesClosed()
	]);
	loggingOutWindow.content.innerText = modules.locales.get("ABRUPT_CLOSE_SIGNAL");
	if (secureSession) {
		taskList = modules.session.attrib(secureSession, "openReeWindows") || [];
		for (let taskId of taskList) modules.tasks.sendSignal(taskId, 9);
	}
	taskList = modules.session.attrib(session, "openReeWindows") || [];
	for (let taskId of taskList) modules.tasks.sendSignal(taskId, 9);
	await allProcessesClosed();
	loggingOutWindow.windowDiv.remove();
	delete modules.liu[target];
	await modules.tokens.revoke(token);
	if (secureSession) await modules.session.rmsession(secureSession);
	await modules.session.rmsession(session);
}

modules.logOut = logOut;
// 09-restart.js
function restartLoad() {
	// @pcos-app-mode native
	function timeout(ms) {
		return new Promise(resolve => setTimeout(resolve, ms));
	}
	function allProcessesClosed() {
		return new Promise(function(resolve) {
			let int = setInterval(function() {
				if (Object.keys(modules.tasks.tracker).length == 0) {
					resolve();
					clearInterval(int);
				}
			})
		});
	}
	
	async function restart(noAutomaticReload = false, token, kexec) {
		try {
			let shutdownSoundPerm = await modules.fs.permissions(modules.defaultSystem + "/etc/sounds/shutdown.aud");
			if (!shutdownSoundPerm.world.includes("r")) throw new Error("Not allowed to read shutdown.aud");
			let shutdownSound = await modules.fs.read(modules.defaultSystem + "/etc/sounds/shutdown.aud");
			let shutdownAudio = new Audio();
			shutdownAudio.src = shutdownSound;
			shutdownAudio.play();
		} catch (e) {
			console.error("Failed to play shutdown.aud:", e);
		}
		modules.shuttingDown = true;
		let window = modules.window;
		let fs = modules.fs;
		let tasks = modules.tasks;
		modules.session.muteAllSessions();
		modules.session.activateSession(modules.session.systemSession);
		let windowDiv = window(modules.session.systemSession, true);
		windowDiv.closeButton.classList.toggle("hidden", true);
		windowDiv.title.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", "");
		windowDiv.content.style.padding = "8px";
		let description = document.createElement("p");
		description.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", modules.locales.get("PLEASE_WAIT"));
		windowDiv.content.appendChild(description);
		description.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", modules.locales.get("POLITE_CLOSE_SIGNAL"));
		for (let taskId in tasks.tracker) tasks.sendSignal(taskId, 15);
		await Promise.race([
			timeout(5000),
			allProcessesClosed()
		]);
		try {
			modules.websocket._handles[modules.network.ws].send(JSON.stringify({
				finalProxyPacket: true
			}));
		} catch {}
		description.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", modules.locales.get("ABRUPT_CLOSE_SIGNAL"));
		for (let taskId in tasks.tracker) tasks.sendSignal(taskId, 9, true);
		await allProcessesClosed();
		try {
			modules.websocket._handles[modules.network.ws].ws.onclose = null;
			modules.websocket._handles[modules.network.ws].ws.close();
			delete modules.websocket._handles[modules.network.ws];
		} catch {}
		description.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", modules.locales.get("UNMOUNTING_MOUNTS"));
		for (let mount in fs.mounts) try { await fs.sync(mount, token); } catch {}
		for (let mount in fs.mounts) try { await fs.umount(mount, token); } catch {}
		for (let mount in fs.mounts) try { await fs.umount(mount, token, true); } catch {}
		description.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", modules.locales.get("RESTARTING"));
		if (!noAutomaticReload) {
			if (kexec) {
				try {
					modules.session.destroy();
					await new ((async _=>0).constructor)(
						modules.core.disk.partition("boot").getData()
					)();
					return modules.killSystem();
				} catch (e) {
					await panic("KEXEC_FAILED", {
						name: "kexec",
						underlyingJS: e
					});
				}
			}
			return location.reload();
		}
		modules.killSystem();
		description.innerText = modules.locales.get("SAFE_TO_CLOSE");
		let button = document.createElement("button");
		button.innerText = modules.locales.get("RESTART_BUTTON");
		button.onclick = function() {
			description.innerText = modules.locales.get("PCOS_RESTARTING").replace("%s", modules.locales.get("RESTARTING"));
			button.remove();
			location.reload();
		}
		windowDiv.content.appendChild(button);
	}
	
	modules.restart = restart;
}

restartLoad();
// 10-installer.js
async function installer() {
	// @pcos-app-mode native
	let window = modules.window;
	let windowDiv = window(modules.session.active);
	let token;
	let usersConfigured = await modules.users.configured();
	if (usersConfigured) {
		await modules.fs.rm(modules.defaultSystem + "/etc/security/automaticLogon");
		token = await new Promise(async function(resolve) {
			let consentui = await modules.consentui(modules.session.systemSession, {
				path: modules.defaultSystem + "/apps/installer.js",
				args: [ "usersConfigured" ],
				intent: modules.locales.get("INSTALLER_INTENT"),
				name: modules.locales.get("INSTALL_PCOS")
			});
			consentui.hook(async function(msg) {
				if (msg.success) return resolve(msg.token);
				modules.restart(true);
			});
		});
	} else {
		await modules.users.init();
		token = await modules.tokens.generate();
		await modules.tokens.userInitialize(token, "root");
		let userInfo = await modules.users.getUserInfo("root", true, token);
		userInfo.securityChecks = [ { type: "timeout", timeout: 0 } ];
		await modules.users.moduser("root", userInfo, token);
	}
	delete modules.settingUp;
	await modules.tasks.exec(modules.defaultSystem + "/apps/installer.js", [], windowDiv, token, false);
}

async function prepare4Running(currentDir = "", targetMount = "installer") {
	let dirList = await modules.fs.ls(modules.defaultSystem + currentDir);
	if (currentDir != "") await modules.fs.mkdir(targetMount + currentDir);
	for (let fileIndex in dirList) {
		let file = dirList[fileIndex];
		let permissions = await modules.fs.permissions(modules.defaultSystem + currentDir + "/" + file);
		if (await isDirectory(modules.defaultSystem + currentDir + "/" + file)) await prepare4Running(currentDir + "/" + file, targetMount);
		else await modules.fs.write(targetMount + currentDir + "/" + file, await modules.fs.read(modules.defaultSystem + currentDir + "/" + file));
		await modules.fs.chown(targetMount + currentDir + "/" + file, permissions.owner);
		await modules.fs.chgrp(targetMount + currentDir + "/" + file, permissions.group);
		await modules.fs.chmod(targetMount + currentDir + "/" + file, permissions.world);
	}
}
let isDirectory = (path) => modules.fs.isDirectory(path);

async function setupbase() {
	modules.settingUp = true;
	let _generated = null;
	let appFns = [ mediaInstaller, adduserInstaller, apiTerminalInstaller, authuiInstaller, autoinstallerInstaller, basiccurlInstaller, batteryinfoInstaller, blockuserInstaller, blogBrowserInstaller, calculatorInstaller, catInstaller, chgrpInstaller, chmodInstaller, chownInstaller, consentuiInstaller, cpInstaller, cryptoInstaller, dateInstaller, deluserInstaller, dfInstaller, diffInstaller, diffupdateInstaller, explorerInstaller, filePickerInstaller, formatInstaller, initdiskInstaller, installerInstaller, llda_toolInstaller, lsInstaller, lsuserInstaller, mkdirInstaller, mountInstaller, mountinfoInstaller, netinfoInstaller, networkfsInstaller, passwdInstaller, patchInstaller, networkInstaller, personalSecurityInstaller, pictureInstaller, pingInstaller, pivot_rootInstaller, powerInstaller, renetworkdInstaller, rmInstaller, runKlvlCodeInstaller, secondstageInstaller, startMenuInstaller, sysadminInstaller, systemSecurityInstaller, taskMgrInstaller, terminalInstaller, textEditorInstaller, umountInstaller, updatefwInstaller, updateosInstaller, uptimeInstaller, videoPlayerInstaller, writeInstaller ];
	let appFnCode = appFns.map(a => a.toString()).join("\n");
	let url = new URL(location.origin);
	url.protocol = "ws" + (url.protocol == "https:" ? "s" : "") + ":";
	let fsmount = {
		read: async function (key) {
			let pathParts = key.split("/");
			if (pathParts[0] == "") pathParts = pathParts.slice(1);
			let files = this.backend.files;
			for (let part of pathParts) {
				files = files[part];
				if (!files) throw new Error("NO_SUCH_FILE");
			}
			if (typeof files === "object") throw new Error("IS_A_DIR");
			return files;
		},
		ls: async function (directory) {
			let pathParts = directory.split("/");
			if (pathParts[0] == "") pathParts = pathParts.slice(1);
			let files = this.backend.files;
			for (let part of pathParts) {
				files = files[part];
				if (!files) throw new Error("NO_SUCH_DIR");
			}
			if (typeof files !== "object") throw new Error("IS_A_FILE");
			return Object.keys(files);
		},
		permissions: async function (file) {
			return this.backend.permissions[file] || {
				owner: "root",
				group: "root",
				world: "",
			};
		},
		isDirectory: function(key) {
			let pathParts = key.split("/").slice(0, -1);
			if (pathParts[0] == "") pathParts = pathParts.slice(1);
			if (pathParts[pathParts.length - 1] == "") pathParts = pathParts.slice(0, -1);
			let basename = key.split("/").slice(-1)[0];
			let files = this.backend.files;
			for (let part of pathParts) {
				files = files[part];
				if (!files) throw new Error("NO_SUCH_DIR");
			}
			if (!files.hasOwnProperty(basename)) throw new Error("NO_SUCH_FILE_DIR");
			if (typeof files[basename] === "object") return true;
			return false;
		},
		sync: () => {},
		directory_supported: true,
		read_only: true,
		permissions_supported: true,
		backend: {
			files: {
				etc: {
					appHarden: JSON.stringify({
						requireSignature: true,
						requireAllowlist: true
					}),
					"network.json": JSON.stringify({
						url: url.toString(),
						ucBits: 1,
						updates: "pcosserver.pc"
					}),
					security: {
						automaticLogon: "root"
					} 
				},
				boot: {
					"00-pcos.js": "// @pcos-app-mode native\nconst pcos_version = " + JSON.stringify(modules.pcos_version) + ";\nconst build_time = " + JSON.stringify(modules.build_time) + ";\n\nlet modules = {\n	core: coreExports,\n	pcos_version,\n	build_time\n};\nglobalThis.modules = modules;\n" + panic.toString() + "\n" + startupMemo.toString() + "\nstartupMemo();\n",
					"01-fs.js": loadFs.toString() + "\nloadFs();\n",
					"01-fsboot.js": "/* no-op */",
					"01-fsck.js": fsck.toString() + "\nawait fsck();\n",
					"01-fsmodules.js": loadModules.toString() + "\nawait loadModules();\n",
					"01-setup-state.js": "modules.settingUp = true;\n",
					"02-ui.js": loadUi.toString() + "\nloadUi();\n",
					"03-diff.js": loadDiff.toString() + "\nloadDiff();\n",
					"03-xterm.js": xterm_export.toString() + "\nxterm_export();\n",
					"04-ipc.js": loadIpc.toString() + "\nloadIpc();\n",
					"04-websockets.js": loadWebsocketSupport.toString() + "\nloadWebsocketSupport();\n",
					"05-lull.js": loadLull.toString() + "\nloadLull();\n",
					"05-network.js": networkd.toString() + "\nnetworkd();\n",
					"05-reeapis.js": reeAPIs.toString() + "\nreeAPIs();\n",
					"05-tweetnacl.js": tweetnacl.toString() + "\ntweetnacl();\n",
					"06-csp.js": loadBasicCSP.toString() + "\nloadBasicCSP();\n",
					"06-locales.js": localization.toString() + "\nlocalization();\n",
					"06-localeset.js": "/* no-op */",
					"06-ksk.js": ksk.toString() + "\nawait ksk();\n",
					"07-tasks.js": loadTasks.toString() + "\nloadTasks();\n",
					"08-tty.js": js_terminal.toString() + "\n",
					"09-logout.js": logOut.toString() + "\nmodules.logOut = logOut;\n",
					"09-restart.js": restartLoad.toString() + "\nrestartLoad();\n",
					"11-userfriendliness.js": loadUserFriendly.toString() + "\nloadUserFriendly();\n",
					"12-tokens.js": setupTokens.toString() + "\nsetupTokens();\n",
					"12-users.js": setupUsers.toString() + "\nawait setupUsers();\n",
					"13-authui.js": authui.toString() + "\nmodules.authui = authui;\n",
					"13-consentui.js": consentui.toString() + "\nmodules.consentui = consentui;\n",
					"14-logon-requirement.js": requireLogon.toString() + "\n" + waitForLogon.toString() + "\n" + hookButtonClick.toString() + "\n" + serviceLogon.toString() + "\n",
					"14-logon-requirement-enforce.js": "/* no-op */",
					"15-apps.js": appFnCode + "\n",
					"17-installer-secondstage.js": secondstage.toString() + "\nsecondstage();\n",
					"99-finished.js": systemKillWaiter.toString() + "\nreturn await systemKillWaiter();"
				},
				root: {}
			},
			permissions: {
				"": {
					owner: "root",
					group: "root",
					world: "rx"
				},
				"boot": {
					owner: "root",
					group: "root",
					world: "rx"
				},
				"etc": {
					owner: "root",
					group: "root",
					world: "rx"
				},
				"etc/appHarden": {
					owner: "root",
					group: "root",
					world: "rx"
				},
				"etc/security": {
					owner: "root",
					group: "root",
					world: ""
				},
				"etc/security/automaticLogon": {
					owner: "root",
					group: "root",
					world: "r"
				}
			}
		}
	};
	for (let file in fsmount.backend.files.boot) {
		fsmount.backend.permissions["boot/" + file] = {
			owner: "root",
			group: "root",
			world: "rx"
		};
	}
	modules.fs.mounts["roinstaller"] = fsmount;
	modules.defaultSystem = "roinstaller";
	modules.fs.mounts.installer = modules.mounts.ramMount({});
	await prepare4Running();
	await mediaInstaller("installer");
	await consentuiInstaller("installer");
	await installerInstaller("installer");
	fsmount = null;
	delete modules.fs.mounts["roinstaller"];
	modules.defaultSystem = "installer";
	installer();
	if (modules.network.serviceStopped) {
		delete modules.network.serviceStopped;
		networkd();
	}
}

setupbase();
// 11-userfriendliness.js
function loadUserFriendly() {
	// @pcos-app-mode native
	modules.userfriendliness = {
		inconsiderateTime: function(language, ms, majorUnitsOnly, displayMs) {
			let string = "";
			let days = Math.floor(ms / 86400000);
			let hours = Math.floor(ms / 3600000) % 24;
			let minutes = Math.floor(ms / 60000) % 60;
			let seconds = Math.floor(ms / 1000) % 60;
			if (days) string = string + modules.locales.get("SHORT_DAYS", language).replace("%s", days) + " ";
			if (days && majorUnitsOnly) return string;
			if (hours) string = string + modules.locales.get("SHORT_HOURS", language).replace("%s", hours) + " ";
			if (hours && majorUnitsOnly) return string;
			if (minutes) string = string + modules.locales.get("SHORT_MINUTES", language).replace("%s", minutes) + " ";
			if (minutes && majorUnitsOnly) return string;
			if (seconds) string = string + modules.locales.get("SHORT_SECONDS", language).replace("%s", seconds) + " ";
			if (displayMs && (ms % 1000)) {
				if (seconds && majorUnitsOnly) return string;
				string = string + modules.locales.get("SHORT_MILLISECONDS", language).replace("%s", (ms % 1000)) + " ";
			}
			return string;
		},
		informationUnits: function(language, bytes, majorUnitsOnly) {
			let string = "";
			let tb = Math.floor(bytes / (1024 * 1024 * 1024 * 1024));
			let gb = Math.floor(bytes / (1024 * 1024 * 1024)) % 1024;
			let mb = Math.floor(bytes / (1024 * 1024)) % 1024;
			let kb = Math.floor(bytes / 1024) % 1024;
			let b = bytes % 1024;
			if (tb) string = string + modules.locales.get("SHORT_TERABYTES", language).replace("%s", tb) + " ";
			if (tb && majorUnitsOnly) return string;
			if (gb) string = string + modules.locales.get("SHORT_GIGABYTES", language).replace("%s", gb) + " ";
			if (gb && majorUnitsOnly) return string;
			if (mb) string = string + modules.locales.get("SHORT_MEGABYTES", language).replace("%s", mb) + " ";
			if (mb && majorUnitsOnly) return string;
			if (kb) string = string + modules.locales.get("SHORT_KILOBYTES", language).replace("%s", kb) + " ";
			if (kb && majorUnitsOnly) return string;
			if (b) string = string + modules.locales.get("SHORT_BYTES", language).replace("%s", b);
			if (b && majorUnitsOnly) return string;
			return string;
		},
		considerateTime: function(language, ms, majorUnitsOnly, displayMs) {
			let dateObject = new Date(ms + (new Date(ms).getTimezoneOffset() * 60000));
			let string = "";
			let years = dateObject.getFullYear() - 1970;
			let months = dateObject.getMonth();
			let days = dateObject.getDate() - 1;
			let hours = dateObject.getHours();
			let minutes = dateObject.getMinutes();
			let seconds = dateObject.getSeconds();
			let millisec = dateObject.getMilliseconds();
			if (years) string = string + modules.locales.get("SHORT_YEARS", language).replace("%s", years) + " ";
			if (years && majorUnitsOnly) return string;
			if (months) string = string + modules.locales.get("SHORT_MONTHS", language).replace("%s", months) + " ";
			if (months && majorUnitsOnly) return string;
			if (days) string = string + modules.locales.get("SHORT_DAYS", language).replace("%s", days) + " ";
			if (days && majorUnitsOnly) return string;
			if (hours) string = string + modules.locales.get("SHORT_HOURS", language).replace("%s", hours) + " ";
			if (hours && majorUnitsOnly) return string;
			if (minutes) string = string + modules.locales.get("SHORT_MINUTES", language).replace("%s", minutes) + " ";
			if (minutes && majorUnitsOnly) return string;
			if (seconds) string = string + modules.locales.get("SHORT_SECONDS", language).replace("%s", seconds) + " ";
			if (displayMs && millisec) {
				if (seconds && majorUnitsOnly) return string;
				string = string + modules.locales.get("SHORT_MILLISECONDS", language).replace("%s", (millisec % 1000)) + " ";
			}
			return string;
		}
	}
}
loadUserFriendly();
// 12-tokens.js
function setupTokens() {
	// @pcos-app-mode native
	modules.tokens = {
		generate: async function() {
			let rng = crypto.getRandomValues(new Uint8Array(64));
			let token = Array.from(rng).map(x => x.toString(16).padStart(2, "0")).join("");
			this._tokens[token] = { privileges: [], user: "nobody", groups: [] };
			return token;
		},
		revoke: async function(token) {
			delete this._tokens[token];
		},
		setPrivileges: async function(token, privileges) {
			this._tokens[token].privileges = privileges;
		},
		addPrivilege: async function(token, privilege) {
			this._tokens[token].privileges.push(privilege);
		},
		addPrivileges: async function(token, privileges) {
			this._tokens[token].privileges.push(...privileges);
		},
		removePrivilege: async function(token, privilege) {
			this._tokens[token].privileges = this._tokens[token].privileges.filter(x => x != privilege);
		},
		removePrivileges: async function(token, privileges) {
			this._tokens[token].privileges = this._tokens[token].privileges.filter(x => !privileges.includes(x));
		},
		userInitialize: async function(token, user) {
			this._tokens[token].user = user;
			this._tokens[token].groups = (await modules.users.getUserInfo(user, token)).groups || [];
			this._tokens[token].privileges = ["FS_READ", "FS_WRITE", "FS_REMOVE", "FS_CHANGE_PERMISSION", "FS_LIST_PARTITIONS", "IPC_CREATE_PIPE", "IPC_LISTEN_PIPE", "IPC_SEND_PIPE", "IPC_CHANGE_PERMISSION", "ELEVATE_PRIVILEGES", "GET_USER_INFO", "SET_SECURITY_CHECKS", "START_TASK", "LIST_TASKS", "SIGNAL_TASK", "FETCH_SEND", "CSP_OPERATIONS", "IDENTIFY_SYSTEM", "WEBSOCKETS_OPEN", "WEBSOCKETS_LISTEN", "WEBSOCKETS_SEND", "WEBSOCKET_SET_PERMISSIONS", "MANAGE_TOKENS", "WEBSOCKET_INFO", "GRAB_ATTENTION", "CLI_MODIFICATIONS", "GET_THEME", "GET_LOCALE", "GET_FILESYSTEMS", "GET_BUILD", "GET_SERVER_URL", "START_BACKGROUND_TASK", "GET_BOOT_MODE", "GET_SCREEN_INFO", "PCOS_NETWORK_PING", "LOGOUT", "LULL_SYSTEM", "CONNLESS_LISTEN", "CONNLESS_SEND", "GET_NETWORK_ADDRESS", "CONNFUL_LISTEN", "CONNFUL_CONNECT", "CONNFUL_DISCONNECT", "CONNFUL_WRITE", "CONNFUL_READ", "CONNFUL_ADDRESS_GET", "SYSTEM_UPTIME", "GET_HOSTNAME", "RESOLVE_NAME", "PATCH_DIFF", "GET_BATTERY_STATUS", "CONNFUL_IDENTITY_GET", "GET_UPDATE_SERVICE"];
			if (user == "root") this._tokens[token].privileges.push("FS_UNMOUNT", "SYSTEM_SHUTDOWN", "SWITCH_USERS_AUTOMATICALLY", "USER_INFO_OTHERS", "SET_USER_INFO", "FS_BYPASS_PERMISSIONS", "IPC_BYPASS_PERMISSIONS", "TASK_BYPASS_PERMISSIONS", "SENSITIVE_USER_INFO_OTHERS", "SYSTEM_STABILITY", "RUN_KLVL_CODE", "IDENTIFY_SYSTEM_SENSITIVE", "WEBSOCKET_BYPASS_PERMISSIONS", "LLDISK_READ", "LLDISK_WRITE", "LLDISK_LIST_PARTITIONS", "LLDISK_REMOVE", "LLDISK_IDB_READ", "LLDISK_IDB_WRITE", "LLDISK_IDB_REMOVE", "LLDISK_IDB_LIST", "LLDISK_IDB_SYNC", "FS_MOUNT", "SET_DEFAULT_SYSTEM", "GET_SYSTEM_RESOURCES", "LLDISK_INIT_PARTITIONS", "LOGOUT_OTHERS", "LULL_SYSTEM_FORCE", "CONNLESS_LISTEN_GLOBAL", "GET_USER_LIST", "CONNFUL_LISTEN_GLOBAL", "NETWORK_RAW_WRITE", "NETWORK_RAW_READ", "SET_FIRMWARE", "RELOAD_NETWORK_CONFIG");
			if ((await modules.users.getUserInfo(user, token)).blankPrivileges) this._tokens[token].privileges = [];
			this._tokens[token].privileges.push(...((await modules.users.getUserInfo(user, token)).additionalPrivilegeSet || []));
			this._tokens[token].privileges = Array.from(new Set(this._tokens[token].privileges));
		},
		halfInitialize: async function(token, user) {
			this._tokens[token].user = user;
			this._tokens[token].groups = (await modules.users.getUserInfo(user, token)).groups || [];
		},
		info: async function(token) {
			return this._tokens[token];
		},
		validate: async function(token, criteria) {
			if (!this._tokens.hasOwnProperty(token)) return false;
			if (criteria.user && this._tokens[token].user != criteria.user) return false;
			if (criteria.group && !this._tokens[token].groups.includes(criteria.group)) return false;
			if (criteria.privilege && !this._tokens[token].privileges.includes(criteria.privilege)) return false;
			return true;
		},
		fork: async function(token) {
			let rng = crypto.getRandomValues(new Uint8Array(64));
			let newToken = Array.from(rng).map(x => x.toString(16).padStart(2, "0")).join("");
			this._tokens[newToken] = JSON.parse(JSON.stringify(this._tokens[token]));
			return newToken;  
		},
		_tokens: {}
	}
}
setupTokens();
// 12-users.js
async function setupUsers() {
	// @pcos-app-mode native
	async function handleAuthentication(user, prompts, finishFunction) {
		let currentPromptIndex = 0;
		let destroyed = false;

		return {
			getNextPrompt: async function() {
				if (destroyed) return {
					success: false,
					message: modules.locales.get("AUTH_FAILED_NEW")
				};
				if (currentPromptIndex >= prompts.length) {
					if (finishFunction) await finishFunction(true);
					let token = await modules.tokens.generate();
					await modules.tokens.userInitialize(token, user);
					return {
						success: true,
						message: modules.locales.get("AUTH_SUCCESS"),
						token: token
					};
				}
				let that = this;
				let currentPrompt = prompts[currentPromptIndex];
				let used = false;
				
				return {
					success: "intermediate",
					type: currentPrompt.type,
					message: currentPrompt.message,
					wantsUserInput: currentPrompt.userInput,
					challenge: currentPrompt.challenge,
					input: async function(input) {
						if (used || destroyed) return that.getNextPrompt();
						if (!used) used = true;
						let verified;
						try {
							verified = await currentPrompt.verify(input);
						} catch {
							verified = false;
						}
						if (!verified) {
							destroyed = true;
							if (finishFunction) await finishFunction(false);
							return { success: false, message: modules.locales.get("AUTH_FAILED") };
						}
						currentPromptIndex++;
						return that.getNextPrompt();
					}
				};
			}
		};
	}

	let test = "{}";
	try {
		test = await modules.fs.read(modules.defaultSystem + "/etc/security/users");
	} catch {
		if (!modules.settingUp) test = "systemStatusInvalid";
	}
	try {
		JSON.parse(test);
	} catch (e) {
		if (!modules.settingUp) await panic("USER_SYSTEM_CORRUPTED", {
			name: "/etc/security/users",
			params: [modules.defaultSystem],
			underlyingJS: e
		})
	}

	modules.users = {
		init: async function(token) {
			await this.mkrecursive(modules.defaultSystem + "/etc/security", token);
			await modules.fs.chmod(modules.defaultSystem + "/etc", "rx", token);
			await this.mkrecursive(modules.defaultSystem + "/root", token);
			await modules.fs.write(modules.defaultSystem + "/etc/security/users", JSON.stringify({root: {
				securityChecks: [],
				groups: ["root"],
				homeDirectory: modules.defaultSystem + "/root"
			},
			nobody: {
				securityChecks: [],
				groups: ["nobody"],
				homeDirectory: modules.defaultSystem
			},
			authui: {
				securityChecks: [],
				groups: ["authui"],
				homeDirectory: modules.defaultSystem,
				blankPrivileges: true,
				additionalPrivilegeSet:  [ "IPC_SEND_PIPE", "GET_LOCALE", "GET_THEME", "ELEVATE_PRIVILEGES", "FS_READ", "FS_LIST_PARTITIONS", "CSP_OPERATIONS" ]
			}}), token);
		},
		mkrecursive: async function(dir, token) {
			let slices = dir.split("/");
			for (let slice in slices) {
				let previousParts = slices.slice(0, slice).join("/");
				if (!previousParts) continue;
				let currentPart = slices[slice];
				let check = await modules.fs.ls(previousParts, token);
				previousParts += "/";
				if (!check.includes(currentPart)) await modules.fs.mkdir(previousParts + currentPart, token);
			}
		},
		moduser: async function(user, data, token) {
			let userDB = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/security/users"), token);
			userDB[user] = data;
			await modules.fs.write(modules.defaultSystem + "/etc/security/users", JSON.stringify(userDB), token);
		},
		getUserInfo: async function(user, sensitive = false, token) {
			let userDB = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/security/users"), token);
			if (!userDB.hasOwnProperty(user)) return null;
			userDB = userDB[user];
			if (!sensitive) delete userDB.securityChecks;
			return userDB;
		},
		configured: async function(token) {
			try {
				JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/security/users"), token);
				return true;
			} catch {
				return false;
			}
		},
		access: async function(user, token) {
			let userDB = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/security/users"), token);
			let credentials = userDB[user].securityChecks;
			for (let check in credentials) {
				if (credentials[check].type == "pbkdf2") {
					credentials[check].userInput = true;
					credentials[check].type = "password";
					credentials[check].message = modules.locales.get("PASSWORD_PROMPT");
					credentials[check].verify = async function(input) {
						return (await modules.core.pbkdf2(input, credentials[check].salt)) == credentials[check].hash;
					}
				}
				if (credentials[check].type == "informative" || credentials[check].type == "informative_deny") {
					credentials[check].verify = () => credentials[check].type == "informative";
					credentials[check].type = "informative";
					credentials[check].userInput = false;
				}
				if (credentials[check].type == "timeout" || credentials[check].type == "timeout_deny") {
					let isTimeout = credentials[check].type == "timeout";
					credentials[check].message = modules.locales.get("PLEASE_WAIT_TIME").replace("%s", modules.userfriendliness.inconsiderateTime(credentials[check].timeout));
					credentials[check].verify = () => new Promise(resolve => setTimeout(resolve, credentials[check].timeout, isTimeout));
					credentials[check].type = "promise";
					credentials[check].userInput = false;
				}
				if (credentials[check].type == "serverReport") {
					credentials[check].message = modules.locales.get("REPORTING_LOGON");
					credentials[check].type = "promise";
					credentials[check].verify = async function() {
						try {
							let response = await fetch(credentials[check].url);
							if (!response.ok) return false;
						} catch {
							return false;
						}
						return true;
					}
					credentials[check].userInput = false;
				}
				if (credentials[check].type == "pc-totp") {
					credentials[check].message = modules.locales.get("TOTP_PC_PROMPT");
					credentials[check].type = "text";
					credentials[check].userInput = true;
					credentials[check].verify = async function(input) {
						let sha256 = async b => Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256", new TextEncoder().encode(b)))).map(a => a.toString(16).padStart(2, "0")).join("");
						let c = Math.floor((Math.floor(Date.now() / 1000)) / 30);
						let hash = await sha256(credentials[check].secret + c);
						hash = parseInt(hash, 16);
						hash = hash % 60466176;
						hash = hash.toString();
						hash = hash.split("", 6);
						hash = hash.join("");
						return hash == input;
					}
				}
				if (credentials[check].type == "totp") {
					credentials[check].message = modules.locales.get("TOTP_PROMPT");
					credentials[check].type = "text";
					credentials[check].userInput = true;
					let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
					let keyImport = await crypto.subtle.importKey("raw", hexToU8A(credentials[check].secret?.padStart(20, "0")), {
						name: "HMAC",
						hash: "SHA-1"
					}, true, [ "sign" ]);
					
					credentials[check].verify = async function(input) {
						let counter = hexToU8A(Math.floor(Date.now() / 30000).toString(16).padStart(16, "0"));
						let hmacSign = await crypto.subtle.sign("HMAC", keyImport, counter);
						hmacSign = Array.from(new Uint8Array(hmacSign));
						let offset = hmacSign[19] & 0xf; // https://datatracker.ietf.org/doc/html/rfc4226#section-5.4
						let code = (hmacSign[offset] & 0x7f) << 24
							| (hmacSign[offset + 1] & 0xff) << 16
							| (hmacSign[offset + 2] & 0xff) << 8
							| (hmacSign[offset + 3] & 0xff);
						code = code % 1000000;
						return (code.toString() == input) || (code.toString().padStart(6, "0") == input);
					}
				}
				if (credentials[check].type == "workingHours") {
					let workingHourStarts = new Date();
					workingHourStarts.setHours(credentials[check].start.hours || 0, credentials[check].start.minutes || 0, credentials[check].start.seconds || 0);
					let workingHourEnds = new Date();
					workingHourEnds.setHours(credentials[check].end.hours || 0, credentials[check].end.minutes || 0, credentials[check].end.seconds || 0);
					
					if (new Date() > workingHourEnds || new Date() < workingHourStarts) {
						credentials[check].message = modules.locales.get("WORKING_HOURS_UNMET");
						credentials[check].type = "informative";
						credentials[check].userInput = false;
						credentials[check].verify = () => false;
					} else {
						credentials[check].message = modules.locales.get("AUTH_SUCCESS");
						credentials[check].type = "promise";
						credentials[check].userInput = false;
						credentials[check].verify = () => true;
					}
				}
				if (credentials[check].type == "zkpp") {
					let hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));
					let randomChallenge = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, "0"), "");
					credentials[check].message = modules.locales.get("PASSWORD_PROMPT");
					credentials[check].type = "zkpp_password";
					credentials[check].userInput = true;
					credentials[check].challenge = randomChallenge;
					credentials[check].verify = input => nacl.sign.detached.verify(hexToU8A(credentials[check].challenge), hexToU8A(input), hexToU8A(credentials[check].publicKey));
				}
			}
			if (credentials.length == 0) {
				credentials.push({
					type: "informative",
					message: modules.locales.get("ACCESS_NOT_SETUP"),
					userInput: false,
					verify: () => false
				})
			}
			return handleAuthentication(user, credentials);
		},
		getUsers: async function(token) {
			let userDB = JSON.parse(await modules.fs.read(modules.defaultSystem + "/etc/security/users"), token);
			return Object.keys(userDB);
		}
	}
}
await setupUsers();
// 13-authui.js
async function authui(ses = modules.session.active, user, token, isLogonScreen) {
	// @pcos-app-mode native
	if (modules.shuttingDown) return { hook: _ => _ };
	let appToken;
	if (token) appToken = modules.tokens.fork(token);
	else {
		appToken = await modules.tokens.generate();
		await modules.tokens.userInitialize(appToken, "authui");
	}
	let hook = new Function();
	let ipc = await modules.ipc.create();
	modules.ipc.declareAccess(ipc, { owner: "authui", group: "authui", world: false });
	let windowObject = modules.window(ses);
	if (isLogonScreen) windowObject.closeButton.classList.toggle("hidden", true);
	let authTask = await modules.tasks.exec(modules.defaultSystem + "/apps/authui.js", [], windowObject, appToken, false, [ ipc, user || "" ]);
	async function waitForIt() {
		let msg = await Promise.race([
			modules.ipc.listenFor(ipc),
			modules.tasks.waitTermination(authTask)
		]);
		delete modules.ipc._ipc[ipc];
		try {
			await modules.tasks.sendSignal(authTask, 9);
			hook(msg);
		} catch {
			hook({
				success: false,
				cancelled: true
			});
		}
	}
	waitForIt();
	return { hook: (e) => hook = e };
}
modules.authui = authui;
// 13-consentui.js
async function consentui(ses = modules.session.active, config, token) {
	// @pcos-app-mode native
	if (modules.shuttingDown) return { hook: _ => _ };
	let appToken;
	if (token) appToken = modules.tokens.fork(token);
	else {
		appToken = await modules.tokens.generate();
		await modules.tokens.userInitialize(appToken, "authui");
	}
	let hook = new Function();
	let ipc = await modules.ipc.create();
	modules.ipc.declareAccess(ipc, { owner: "authui", group: "authui", world: false });
	let windowObject = modules.window(ses);
	let authTask = await modules.tasks.exec(modules.defaultSystem + "/apps/consentui.js", [], windowObject, appToken, false, [
		ipc,
		config.user || "",
		JSON.stringify({
			path: config.path,
			args: config.args,
			submittedIntent: config.intent,
			submittedName: config.name
		})
	]);
	async function waitForIt() {
		let msg = await Promise.race([
			modules.ipc.listenFor(ipc),
			modules.tasks.waitTermination(authTask)
		]);
		delete modules.ipc._ipc[ipc];
		try {
			await modules.tasks.sendSignal(authTask, 9);
			hook(msg);
		} catch {
			hook({
				success: false,
				cancelled: true
			});
		}
	}
	waitForIt();
	return { hook: (e) => hook = e };
}
modules.consentui = consentui;
// 14-logon-requirement.js
async function requireLogon() {
	// @pcos-app-mode native
	try {
		let startupSoundPerm = await modules.fs.permissions(modules.defaultSystem + "/etc/sounds/startup.aud");
		if (!startupSoundPerm.world.includes("r")) throw new Error("Not allowed to read startup.aud");
		let startupSound = await modules.fs.read(modules.defaultSystem + "/etc/sounds/startup.aud");
		let startupAudio = new Audio();
		startupAudio.src = startupSound;
		startupAudio.play();
	} catch (e) {
		console.error("Failed to play startup sound:", e);
	}
	let liu = {};
	modules.liu = liu;
	serviceLogon();
	let insertedLockMessage = false;
	async function handleLogin(resolvedLogon, liu) {
		modules.session.muteAllSessions();
		let userInfo = await modules.tokens.info(resolvedLogon.token);
		let session;
		let liuUser = userInfo.user;
		let wasLiuLoaded = false;
		if (liu.hasOwnProperty(userInfo.user)) {
			session = liu[userInfo.user].session;
			await modules.tokens.revoke(resolvedLogon.token);
			resolvedLogon = liu[userInfo.user].logon;
			userInfo = await modules.tokens.info(resolvedLogon.token);
			wasLiuLoaded = true;
		} else {
			session = modules.session.mksession();
			liu[userInfo.user] = {
				session,
				logon: resolvedLogon,
			}
		}
		if (modules.session.attrib(session, "secureID")) return modules.session.activateSession(modules.session.attrib(session, "secureID"));
		modules.session.activateSession(session);
		let dom = modules.session.tracker[session].html;
		let bgPic = "";
		let isDark = false;
		let locale;
		let basicPrivilegeChecklist = [ "FS_READ", "FS_LIST_PARTITIONS", "IPC_SEND_PIPE", "IPC_LISTEN_PIPE", "START_TASK", "GET_LOCALE", "GET_THEME", "LOGOUT" ];
		if (!basicPrivilegeChecklist.every(privilege => userInfo.privileges.includes(privilege))) {
			let failureMessage = modules.window(session);
			failureMessage.title.innerText = "Permission denied";
			failureMessage.content.style.padding = "8px";
			failureMessage.content.innerText = "There were not enough privileges to log you in. Please contact your system administrator.";
			failureMessage.closeButton.onclick = async function() {
				failureMessage.windowDiv.remove();
				await modules.logOut(userInfo.user);
			}
			return;
		}

		try {
			let permissions = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.wallpaper", resolvedLogon.token);
			if (permissions.owner != userInfo.user && !userInfo.groups.includes(permissions.group) && !(permissions.world.includes("r") && permissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
				throw new Error("Permission denied reading wallpaper");
			}
			bgPic = await modules.fs.read((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.wallpaper", resolvedLogon.token);
		} catch (e) {
			console.error("Failed to read wallpaper:", e);
		}
		try {
			let permissionsdm = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.darkmode", resolvedLogon.token);
			if (permissionsdm.owner != userInfo.user && !userInfo.groups.includes(permissionsdm.group) && !(permissionsdm.world.includes("r") && permissionsdm.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
				throw new Error("Permission denied reading dark mode preference");
			}
			isDark = (await modules.fs.read((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.darkmode", resolvedLogon.token)) == "true";
		} catch (e) {
			console.error("Failed to read dark mode preference:", e);
		}
		try {
			let permissionsloc = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.locale", resolvedLogon.token);
			if (permissionsloc.owner != userInfo.user && !userInfo.groups.includes(permissionsloc.group) && !(permissionsloc.world.includes("r") && permissionsloc.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
				throw new Error("Permission denied reading locale preference");
			}
			locale = await modules.fs.read((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.locale", resolvedLogon.token);
			modules.session.attrib(session, "language", locale);
		} catch (e) {
			console.error("Failed to read dark mode preference:", e);
		}
		if (modules.core.bootMode == "safe") {
			isDark = true;
			if (!wasLiuLoaded) {
				let message = document.createElement("span");
				message.innerText = modules.locales.get("SAFE_MODE_MSG", locale);
				message.style = "position: absolute; right: 8px; bottom: 8px; color: white;";
				dom.appendChild(message);
				let message2 = document.createElement("span");
				message2.innerText = modules.locales.get("SAFE_MODE_MSG", locale);
				message2.style = "position: absolute; top: 8px; left: 8px; color: white;";
				dom.appendChild(message2);
			}
			bgPic = "";
		}
		if (modules.core.bootMode == "disable-harden" && !wasLiuLoaded) {
			let message = document.createElement("span");
			message.innerText = modules.locales.get("INSECURE_MODE_MSG", locale);
			message.style = "position: absolute; right: 8px; bottom: 8px; color: white;";
			dom.appendChild(message);
			let message2 = document.createElement("span");
			message2.innerText = modules.locales.get("INSECURE_MODE_MSG", locale);
			message2.style = "position: absolute; top: 8px; left: 8px; color: white;";
			dom.appendChild(message2);
		}
		modules.session.attrib(session, "dark", isDark);
		dom.style.background = "url(" + JSON.stringify(bgPic) + ")";
		if (modules.core.bootMode == "safe") dom.style.background = "black";
		dom.style.backgroundSize = "100% 100%";
		if (!wasLiuLoaded) {
			let autoRunNecessities = [];
			try {
				let autoRunPermissions = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorunNecessity", resolvedLogon.token);
				if (autoRunPermissions.owner != userInfo.user && !userInfo.groups.includes(autoRunPermissions.group) && !(autoRunPermissions.world.includes("r") && autoRunPermissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
					throw new Error("Permission denied reading autorun necessities");
				}
				if (modules.core.bootMode != "safe") autoRunNecessities = await modules.fs.ls((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorunNecessity", resolvedLogon.token);
			} catch (e) {
				console.error("Failed to read autorun necessities:", e);
			}
			function breakNecessityFailure() {
				let failureMessage = modules.window(session);
				failureMessage.title.innerText = modules.locales.get("PERMISSION_DENIED", locale);
				failureMessage.content.style.padding = "8px";
				failureMessage.content.innerText = modules.locales.get("AUTORUN_NECESSITIES_FAILED", locale);
				failureMessage.closeButton.onclick = async function() {
					failureMessage.windowDiv.remove();
					await modules.logOut(userInfo.user);
				}
			}
			for (let autoRunNecessity of autoRunNecessities) {
				let necessityPermissions = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorunNecessity/" + autoRunNecessity, resolvedLogon.token);
				if (necessityPermissions.owner != userInfo.user && !userInfo.groups.includes(necessityPermissions.group) && !(necessityPermissions.world.includes("r") && necessityPermissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
					return breakNecessityFailure();
				}
				let link = await modules.fs.read((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorunNecessity/" + autoRunNecessity, resolvedLogon.token);
				try {
					link = JSON.parse(link);
				} catch (e) {
					console.error("Failed to parse autorun necessity:", e);
					return breakNecessityFailure();
				}
				if (link.disabled) continue;
				try {
					let ipcPipe = modules.ipc.create();
					modules.ipc.declareAccess(ipcPipe, {
						owner: userInfo.user,
						group: userInfo.groups[0],
						world: false
					});
					let forkedToken;
					if (link.automaticLogon) {
						try {
							let logon = await modules.users.access(link.automaticLogon.username, resolvedLogon.token);
							logon = await logon.getNextPrompt();
							for (let response of link.automaticLogon.responses)
								if (logon.success == "intermediate") logon = await logon.input(response);
							if (!logon.success) throw new Error(logon.message);
							forkedToken = logon.token;
						} catch {}
						if (necessityPermissions.world.includes("r") && forkedToken) {
							let ownUser = await modules.tokens.info(forkedToken);
							let ownUserInfo = await modules.users.getUserInfo(ownUser.user, true, forkedToken);
							ownUserInfo.securityChecks = [];
							await modules.users.moduser(ownUser.user, ownUserInfo, forkedToken);
							await modules.tokens.revoke(forkedToken);
							forkedToken = null;
						}
					}
					if (!forkedToken) forkedToken = await modules.tokens.fork(resolvedLogon.token);
					let appWindow = modules.window(session);
					let ipcResult = modules.ipc.listenFor(ipcPipe);
					let taskId = await modules.tasks.exec(link.path, [ ...(link.args || []), ipcPipe ], appWindow, forkedToken, true);
					let finishTaskPromise = new Promise(function(resolve) {
						modules.tasks.tracker[taskId].ree.beforeCloseDown(() => resolve());
					})
					ipcResult = await Promise.race([ipcResult, finishTaskPromise]);
					if (!ipcResult) throw new Error("Software rejected autorun necessity.");
					if (modules.tasks.tracker.hasOwnProperty(taskId)) await modules.tasks.sendSignal(taskId, 9);
				} catch (e) {
					console.error("Failed to execute autorun necessity:", e);
					return breakNecessityFailure();
				}
			}
			
			let autoRun = [];
			try {
				let autoRunPermissions = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorun", resolvedLogon.token);
				if (autoRunPermissions.owner != userInfo.user && !userInfo.groups.includes(autoRunPermissions.group) && !(autoRunPermissions.world.includes("r") && autoRunPermissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
					throw new Error("Permission denied reading autorun");
				}
				if (modules.core.bootMode != "safe") autoRun = await modules.fs.ls((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorun", resolvedLogon.token);
			} catch (e) {
				console.error("Failed to read autorun:", e);
			}
			for (let autoRunFile of autoRun) {
				let autoRunItemPermissions = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorun/" + autoRunFile, resolvedLogon.token);
				if (autoRunItemPermissions.owner != userInfo.user && !userInfo.groups.includes(autoRunItemPermissions.group) && !(autoRunItemPermissions.world.includes("r") && autoRunItemPermissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) continue;
				let link = await modules.fs.read((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/.autorun/" + autoRunFile, resolvedLogon.token);
				try {
					link = JSON.parse(link);
				} catch {}
				if (link.disabled) continue;
				try {
					let forkedToken;
					if (link.automaticLogon) {
						try {
							let logon = await modules.users.access(link.automaticLogon.username, resolvedLogon.token);
							logon = await logon.getNextPrompt();
							for (let response of link.automaticLogon.responses)
								if (logon.success == "intermediate") logon = await logon.input(response);
							if (!logon.success) throw new Error(logon.message);
							forkedToken = logon.token;
						} catch {}
						if (autoRunItemPermissions.world.includes("r") && forkedToken) {
							let ownUser = await modules.tokens.info(forkedToken);
							let ownUserInfo = await modules.users.getUserInfo(ownUser.user, true, forkedToken);
							ownUserInfo.securityChecks = [];
							await modules.users.moduser(ownUser.user, ownUserInfo, forkedToken);
							await modules.tokens.revoke(forkedToken);
							forkedToken = null;
						}
					}
					if (!forkedToken) forkedToken = await modules.tokens.fork(resolvedLogon.token);
					let appWindow = modules.window(session);
					await modules.tasks.exec(link.path, [ ...(link.args || []) ], appWindow, forkedToken);
				} catch {}
			}

			let icons = [];
			let lastIconPlacement = [ 72, 72 ];
			try {
				let permissions = await modules.fs.permissions((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/desktop", resolvedLogon.token);
				if (permissions.owner != userInfo.user && !userInfo.groups.includes(permissions.group) && !(permissions.world.includes("r") && permissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
					throw new Error("Permission denied reading desktop icons");
				}
				icons = await modules.fs.ls((await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/desktop", resolvedLogon.token);
			} catch (e) {
				console.error("Failed to read desktop icons:", e);
			}
			for (let icon of icons) {
				if (icon.split("/").slice(-1)[0].startsWith(".")) continue;
				try {
					let iconPath = (await modules.users.getUserInfo(userInfo.user, false, resolvedLogon.token)).homeDirectory + "/desktop/" + icon;
					let permissions = await modules.fs.permissions(iconPath, resolvedLogon.token);
					if (permissions.owner != userInfo.user && !userInfo.groups.includes(permissions.group) && !permissions.world.includes("r") && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
						throw new Error("Permission denied reading desktop icon");
					}
					let isDir = await modules.fs.isDirectory(iconPath, resolvedLogon.token);
					let linkName = iconPath.split("/").slice(-1)[0];
					let appLink = { path: modules.defaultSystem + "/apps/explorer.js", args: [ iconPath ], name: linkName, placed: lastIconPlacement, icon: modules.defaultSystem + "/etc/icons/fileicon.pic" };
					if (!isDir) {
						if (linkName.endsWith(".lnk")) {
							try {
								appLink = { placed: lastIconPlacement, icon: modules.defaultSystem + "/etc/icons/lnk.pic", ...(JSON.parse(await modules.fs.read(iconPath, resolvedLogon.token))) };
								appLink._isRealLink = true;
							} catch {}
						} else {
							let ext = linkName.split(".").slice(-1)[0];
							appLink.icon = modules.defaultSystem + "/etc/icons/" + ext + ".pic";
							let assocsPermissions = await modules.fs.permissions(modules.defaultSystem + "/apps/associations", resolvedLogon.token);
							if (assocsPermissions.owner != userInfo.user && !userInfo.groups.includes(assocsPermissions.group) && !(assocsPermissions.world.includes("r") && assocsPermissions.world.includes("x")) && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
								throw new Error("Permission denied reading associations");
							}
							let associations = await modules.fs.ls(modules.defaultSystem + "/apps/associations", resolvedLogon.token);
							if (!associations.includes(ext)) appLink.disabled = true;
							else {
								let associationPermissions = await modules.fs.permissions(modules.defaultSystem + "/apps/associations/" + ext, resolvedLogon.token);
								if (!associationPermissions.world.includes("r") && !userInfo.groups.includes(associationPermissions.group) && associationPermissions.owner != userInfo.user && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
									throw new Error("Permission denied reading association");
								}
								appLink = { placed: lastIconPlacement, icon: appLink.icon, ...(JSON.parse(await modules.fs.read(modules.defaultSystem + "/apps/associations/" + ext, resolvedLogon.token))) };
								appLink.args = [ ...(appLink.args || []), iconPath ];
								appLink.name = linkName;
								delete appLink.localeDatabaseName;
								delete appLink.localeReferenceName;
							}
						}
					}
					if (appLink.disabled) continue;
					if (isDir) appLink.icon = modules.defaultSystem + "/etc/icons/foldericon.pic";
					let iconWindow = modules.window(session, false, true, async function(newx, newy) {
						if (appLink._isRealLink) {
							appLink.placed = [ newx, newy ];
							delete appLink._isRealLink;
							if (permissions.owner != userInfo.user && !userInfo.groups.includes(permissions.group) && !permissions.world.includes("w") && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
								throw new Error("Permission denied writing desktop icon");
							}
							await modules.fs.write(iconPath, JSON.stringify(appLink), resolvedLogon.token);
							appLink._isRealLink = true;
						}
					});
					iconWindow.title.innerText = (appLink.localeReferenceName ? modules.locales.get(appLink.localeReferenceName, locale) : null) || (appLink.localeDatabaseName ? (appLink.localeDatabaseName[locale] || appLink.localeDatabaseName[modules.locales.defaultLocale] || appLink.localeDatabaseName[navigator.language.slice(0, 2).toLowerCase()]) : null) || appLink.name;
					let iconEl = document.createElement("img");
					try {
						let permissions = await modules.fs.permissions(appLink.icon, resolvedLogon.token);
						if (permissions.owner != userInfo.user && !userInfo.groups.includes(permissions.group) && !permissions.world.includes("r") && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
							throw new Error("Permission denied reading desktop icon picture");
						}
						iconEl.src = await modules.fs.read(appLink.icon, resolvedLogon.token);
					} catch (e) {
						console.error("Failed to read desktop icon picture:", e);
						continue;
					}
					iconEl.style = "width: 100%; height: 100%; position: absolute;";
					iconWindow.content.appendChild(iconEl);
					iconWindow.windowDiv.style.top = appLink.placed[1] + "px";
					iconWindow.windowDiv.style.left = appLink.placed[0] + "px";
					iconEl.addEventListener("click", async function() {
						let forkedToken;
						if (appLink.automaticLogon) {
							try {
								let logon = await modules.users.access(appLink.automaticLogon.username, resolvedLogon.token);
								logon = await logon.getNextPrompt();
								for (let response of appLink.automaticLogon.responses)
									if (logon.success == "intermediate") logon = await logon.input(response);
								if (!logon.success) throw new Error(logon.message);
								forkedToken = logon.token;
							} catch {}
						}
						if (!forkedToken) forkedToken = await modules.tokens.fork(resolvedLogon.token);
						let appWindow = modules.window(session);
						await modules.tasks.exec(appLink.path, [ ...(appLink.args || []) ], appWindow, forkedToken);
					});
					lastIconPlacement = appLink.placed;
					lastIconPlacement[1] += 136;
					if (lastIconPlacement[1] > (dom.clientHeight - 136)) {
						lastIconPlacement[0] += 136;
						lastIconPlacement[1] = 72;
					}
				} catch (e) {
					console.error("Failed to read desktop icon:", e);
					continue;
				}
			}
			let startMenuChannel = modules.ipc.create();
			modules.ipc.declareAccess(startMenuChannel, {
				owner: userInfo.user,
				group: userInfo.groups[0],
				world: false
			});
			let taskbar = document.createElement("div");
			let clock = document.createElement("span");
			let startButton = document.createElement("button");
			let startMenu = modules.window(session);
			let forkedStartMenuToken = await modules.tokens.fork(resolvedLogon.token);

			function startMenuStub() {
				if (startMenu.windowDiv.parentElement == null) startMenu = modules.window(session);
				startMenu.windowDiv.classList.toggle("hidden", true);
				startMenu.title.innerText = modules.locales.get("START_MENU", locale);
				startMenu.content.style.padding = "8px";
				startMenu.content.innerText = "";
				let description = document.createElement("span");
				let logout = document.createElement("button");
				description.innerText = modules.locales.get("START_MENU_FAILED", locale);
				logout.innerText = modules.locales.get("LOG_OUT_BUTTON", locale).replace("%s", userInfo.user);
				logout.onclick = _ => modules.logOut(userInfo.user);
				startMenu.content.appendChild(description);
				startMenu.content.appendChild(document.createElement("br"));
				startMenu.content.appendChild(logout);
				startMenu.closeButton.onclick = () => startMenu.windowDiv.classList.toggle("hidden", true);
				startButton.onclick = _ => startMenu.windowDiv.classList.toggle("hidden");
			}

			startMenuStub();
			startButton.innerText = modules.locales.get("START_MENU_BTN", locale);
			startButton.style = "padding: 4px;";
			try {
				await modules.tasks.exec(modules.defaultSystem + "/apps/startMenu.js", [], startMenu, forkedStartMenuToken, true, startMenuChannel);
			} catch (e) {
				console.error("Failed to start start menu:", e);
				startMenuStub();
			}

			(async function() {
				while (true) {
					let listen = await modules.ipc.listenFor(startMenuChannel);
					if (listen.run) {
						try {
							let forkedToken;
							if (listen.run.automaticLogon) {
								try {
									let logon = await modules.users.access(listen.run.automaticLogon.username, resolvedLogon.token);
									logon = await logon.getNextPrompt();
									for (let response of listen.run.automaticLogon.responses)
										if (logon.success == "intermediate") logon = await logon.input(response);
									if (!logon.success) throw new Error(logon.message);
									forkedToken = logon.token;
								} catch {}
							}
							if (!forkedToken) forkedToken = await modules.tokens.fork(resolvedLogon.token);
							let appWindow = modules.window(session);
							await modules.tasks.exec(listen.run.path, [ ...(listen.run.args || []) ], appWindow, forkedToken);
						} catch {}
					} else if (listen.success) {
						startButton.onclick = () => modules.ipc.send(startMenuChannel, { open: true });
					} else if (listen.dying) {
						startMenu = modules.window(session);
						startMenuStub();
						forkedStartMenuToken = await modules.tokens.fork(resolvedLogon.token);
						try {
							await modules.tasks.exec(modules.defaultSystem + "/apps/startMenu.js", [], startMenu, forkedStartMenuToken, true, startMenuChannel);
						} catch (e) {
							console.error("Failed to start start menu:", e);
							startMenuStub();
						}
					}
				}
			})();

			taskbar.className = "taskbar";
			clock.className = "clock";
			let filler = document.createElement("div");
			filler.className = "filler";
			let battery = document.createElement("div");
			let networkIcon = document.createElement("div");
			let pcosNetworkIcon = document.createElement("div");
			let iconCache = {};
			for (let iconFile of ["network_", "network_offline_", "pcos_network_", "pcos_network_offline_", "readyToPlay_", "batteryChargeFinished_", "dying_", "charging_"]) {
				try {
					let permissions = await modules.fs.permissions(modules.defaultSystem + "/etc/icons/" + iconFile + "icon.pic", resolvedLogon.token);
					if (permissions.owner != userInfo.user && !userInfo.groups.includes(permissions.group) && !permissions.world.includes("r") && !userInfo.privileges.includes("FS_BYPASS_PERMISSIONS")) {
						throw new Error("Permission denied reading taskbar icon picture");
					}
					iconCache[iconFile] = await modules.fs.read(modules.defaultSystem + "/etc/icons/" + iconFile + "icon.pic", resolvedLogon.token);
				} catch (e) {
					console.error("Failed to read taskbar icon picture:", e);
				}
			}

			let toggle = false;
			clock.addEventListener("click", _ => toggle = !toggle);
			liu[liuUser].clockInterval = setInterval(async function() {
				clock.innerText = Intl.DateTimeFormat(locale, { timeStyle: toggle ? undefined : "medium" }).format()
				networkIcon.style.backgroundImage = "url(" + JSON.stringify(navigator.onLine ? iconCache.network_ : iconCache.network_offline_) + ")";
				networkIcon.title = modules.locales.get("NETWORK_STATUS_" + (navigator.onLine ? "ONLINE" : "OFFLINE"), locale)
				pcosNetworkIcon.style.backgroundImage = "url(" + JSON.stringify(modules.network.connected ? iconCache.pcos_network_ : iconCache.pcos_network_offline_) + ")";
				pcosNetworkIcon.title = modules.locales.get("PCOS_NETWORK_STATUS_" + (modules.network.connected ? "ONLINE" : "OFFLINE"), locale).replace("%s", userInfo.privileges.includes("GET_HOSTNAME") ? (modules.network.hostname || modules.locales.get("UNKNOWN_PLACEHOLDER", locale)) : modules.locales.get("UNKNOWN_PLACEHOLDER", locale)).replace("%s", userInfo.privileges.includes("GET_NETWORK_ADDRESS") ? (modules.network.address || "0").match(/.{1,4}/g).join(":") : modules.locales.get("UNKNOWN_PLACEHOLDER", locale));
				if (modules.network.serviceStopped) pcosNetworkIcon.title = modules.locales.get("PCOS_NETWORK_STATUS_STOPPED", locale);
				let batteryStatus = {charging: true, chargingTime: 0, dischargingTime: 0, level: 1};
				let batteryStatusIcon = iconCache.readyToPlay_;
				let batteryStatusDescription = modules.locales.get("BATTERY_STATUS_UNAVAILABLE", locale);
				if (navigator.getBattery && userInfo.privileges.includes("GET_BATTERY_STATUS")) {
					batteryStatus = await navigator.getBattery();
					batteryStatusDescription = modules.locales.get("BATTERY_STATUS_" + (batteryStatus.charging ? "CHARGING" : "DISCHARGING"), locale)
						.replace("%s", (batteryStatus.level * 100).toFixed(2))
						.replace("%s", modules.userfriendliness.inconsiderateTime(
							(batteryStatus.charging ? batteryStatus.chargingTime : batteryStatus.dischargingTime) * 1000
						));
					if (batteryStatus.level < 0.2) batteryStatusIcon = iconCache.dying_;
					if (batteryStatus.charging) batteryStatusIcon = batteryStatus.level == 1 ? iconCache.batteryChargeFinished_ : iconCache.charging_;
				}
				battery.style.backgroundImage = "url(" + JSON.stringify(batteryStatusIcon) + ")";
				battery.title = batteryStatusDescription;
			}, 500);
			
			battery.className = "icon";
			networkIcon.className = "icon";
			pcosNetworkIcon.className = "icon";
			taskbar.appendChild(startButton);
			taskbar.appendChild(filler);
			taskbar.appendChild(battery);
			taskbar.appendChild(networkIcon);
			taskbar.appendChild(pcosNetworkIcon);
			taskbar.appendChild(clock);
			dom.appendChild(taskbar);
		}
	}
	while (!modules.shuttingDown) {
		let useDefaultUser = await modules.fs.permissions(modules.defaultSystem + "/etc/security/automaticLogon");
		useDefaultUser = !useDefaultUser.world.includes("w");
		let defaultUser;
		try {
			if (useDefaultUser) defaultUser = await modules.fs.read(modules.defaultSystem + "/etc/security/automaticLogon");
		} catch {}
		let sysDom = modules.session.tracker[modules.session.systemSession].html;
		let lockWallpaper = "";
		let lockIsDark = false;
		try {
			lockWallpaper = await modules.fs.read(modules.defaultSystem + "/etc/wallpapers/lockscreen.pic");
		} catch (e) {
			console.error("Failed to read lockscreen.pic:", e);
		}
		try {
			lockIsDark = (await modules.fs.read(modules.defaultSystem + "/etc/darkLockScreen")) == "true";
		} catch (e) {
			console.error("Failed to read darkLockScreen:", e);
		}
		if (modules.core.bootMode == "safe") {
			lockIsDark = true;
			lockWallpaper = "";
			if (!insertedLockMessage) {
				insertedLockMessage = true;
				let message = document.createElement("span");
				message.innerText = modules.locales.get("SAFE_MODE_MSG");
				message.style = "position: absolute; right: 8px; bottom: 8px; color: white;";
				sysDom.appendChild(message);
				let message2 = document.createElement("span");
				message2.innerText = modules.locales.get("SAFE_MODE_MSG");
				message2.style = "position: absolute; top: 8px; left: 8px; color: white;";
				sysDom.appendChild(message2);
			}
		}
		if (modules.core.bootMode == "disable-harden" && !insertedLockMessage) {
			insertedLockMessage = true;
			let message = document.createElement("span");
			message.innerText = modules.locales.get("INSECURE_MODE_MSG");
			message.style = "position: absolute; right: 8px; bottom: 8px; color: white;";
			sysDom.appendChild(message);
			let message2 = document.createElement("span");
			message2.innerText = modules.locales.get("INSECURE_MODE_MSG");
			message2.style = "position: absolute; top: 8px; left: 8px; color: white;";
			sysDom.appendChild(message2);
		}
		sysDom.style.background = "url(" + JSON.stringify(lockWallpaper) + ")";
		if (modules.core.bootMode == "safe") sysDom.style.background = "black";
		sysDom.style.backgroundSize = "100% 100%";
		modules.session.attrib(modules.session.systemSession, "dark", lockIsDark);
		let logon, resolvedLogon;
		while (!modules.shuttingDown) {
			logon = await modules.authui(modules.session.systemSession, defaultUser, undefined, true);
			resolvedLogon = await waitForLogon(logon);
			if (resolvedLogon.success) break;
		}
		if (!resolvedLogon.success) break;
		handleLogin(resolvedLogon, liu);
		if (useDefaultUser && defaultUser) {
			let newWindow = modules.window(modules.session.systemSession);
			newWindow.title.innerText = modules.locales.get("LOG_IN_INVITATION");
			let button = document.createElement("button");
			button.innerText = modules.locales.get("LOG_IN_INVITATION");
			newWindow.content.appendChild(button);
			newWindow.closeButton.classList.toggle("hidden", true);
			await hookButtonClick(button);
			newWindow.windowDiv.remove();
		}
	}
}

async function serviceLogon() {
	let session = modules.session.mksession();
	modules.session.attrib(session, "dark", true);
	let dom = modules.session.tracker[session].html;
	dom.style.backgroundColor = "black";
	let message = document.createElement("span");
	message.innerText = "Service Desktop";
	message.style = "position: absolute; right: 8px; bottom: 8px; color: white;";
	dom.appendChild(message);
	let startButton = document.createElement("button");
	startButton.innerText = modules.locales.get("START_MENU_BTN");
	startButton.style = "padding: 4px;";
	startButton.onclick = async function() {
		let startMenu = modules.window(session);
		startMenu.title.innerText = modules.locales.get("START_MENU");
		startMenu.content.style.padding = "8px";
		startMenu.closeButton.onclick = () => startMenu.windowDiv.remove();
		let lockButton = document.createElement("button");
		lockButton.innerText = modules.locales.get("LOCK_BUTTON");
		startMenu.content.appendChild(lockButton);
		lockButton.onclick = async function() {
			startMenu.windowDiv.remove();
			await modules.session.muteAllSessions();
			await modules.session.activateSession(modules.session.systemSession);
		}
	}
	let taskbar = document.createElement("div");
	taskbar.className = "taskbar";

	taskbar.appendChild(startButton);
	dom.appendChild(taskbar);
	modules.serviceSession = session;
	if (modules.core.bootMode != "safe") {
		let serviceList = [];
		try {
			serviceList = await modules.fs.ls(modules.defaultSystem + "/apps/services");
		} catch (e) {
			console.error("Failed to list services:", e);
		}
		for (let service of serviceList) {
			let serviceConfig;
			let triggerPasswordReset = false;
			try {
				let permissions = await modules.fs.permissions(modules.defaultSystem + "/apps/services/" + service);
				if (permissions.world.includes("r")) triggerPasswordReset = true;
			} catch {}
			try {
				serviceConfig = await modules.fs.read(modules.defaultSystem + "/apps/services/" + service);
				serviceConfig = JSON.parse(serviceConfig);
			} catch (e) {
				console.error("Failed to read service config of", service, ":", e);
				continue;
			}
			if (serviceConfig.disabled) continue;p
			let serviceName = (serviceConfig.localeReferenceName ? modules.locales.get(serviceConfig.localeReferenceName) : null) || (serviceConfig.localeDatabaseName ? (serviceConfig.localeDatabaseName[navigator.language.slice(0, 2).toLowerCase()] || serviceConfig.localeDatabaseName[modules.locales.defaultLocale]) : null) || serviceConfig.name;
			if (!serviceConfig.automaticLogon) {
				console.error("Service", serviceName, "(", service, ") does not have logon credentials set");
				continue;
			}
			let forkedToken;
			try {
				let logon = await modules.users.access(serviceConfig.automaticLogon.username);
				logon = await logon.getNextPrompt();
				for (let response of serviceConfig.automaticLogon.responses)
					if (logon.success == "intermediate") logon = await logon.input(response);
				if (!logon.success) throw new Error(logon.message);
				forkedToken = logon.token;
			} catch (e) {
				console.error("Failed to create a logon session for", serviceName, "(", service, "):", e);
				continue;
			}
			if (triggerPasswordReset) {
				let ownUser = await modules.tokens.info(forkedToken);
				let ownUserInfo = await modules.users.getUserInfo(ownUser.user, true, forkedToken);
				ownUserInfo.securityChecks = [];
				await modules.users.moduser(ownUser.user, ownUserInfo, forkedToken);
				await modules.tokens.revoke(forkedToken);
				console.error("Exposed credentials for", serviceName, "(", service, ") have been made invalid");
				continue;
			}
			try {
				await modules.tasks.exec(serviceConfig.path, [ ...(serviceConfig.args || []) ], modules.window(session), forkedToken, true);
			} catch (e) {
				console.error("Failed to start service", serviceName, "(", service, "):", e);
			}
		}
	}
}

function waitForLogon(toHook) {
	return new Promise(function(resolve) {
		toHook.hook(resolve);
	});
}

async function hookButtonClick(button) {
	return new Promise(function(resolve) {
		button.onclick = (e) => resolve(e);
	});
}
// 15-apps.js
// App and media installers are dynamically created, look at the directory structure!
		// dynamically inserted
		async function mediaInstaller(target, token) {
			let mediaStructure = {"etc":{"icons":{"aud.pic":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAwXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjabVDbEcMgDPv3FB0BLPMahzTpXTfo+DVgcqGp7pCFDcKYjs/7RY8G9kISUo4lRqeQIoWriuwGamfvpHPHLOl+ydNZYE1BI+xCtPMz70+DEaqqcDV6WmFbC0XMP/8Y8QhoHTW9m1ExI/AoeDOo41sulpyuX9gOtyKPRY0kr23f9kmntwd9B8wHPJwyEEcDaCsQqgqv7JG5KXSdlIFppgP5N6cJ+gLqhVkYh0XxjQAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNQFIVPU6VSKortIOKQoTrZRUUcaxWKUCHUCq06mLz0D5o0JCkujoJrwcGfxaqDi7OuDq6CIPgD4i44KbpIifelhRYxXni8j/PuObx3HyA0KkyzeuKApttmOpkQs7lVMfAKH4YQxCDCMrOMOUlKwbO+7qmb6i7Gs7z7/qx+NW8xwCcSx5lh2sQbxDObtsF5nzjCSrJKfE48YdIFiR+5rrT4jXPRZYFnRsxMep44QiwWu1jpYlYyNeJp4qiq6ZQvZFusct7irFVqrH1P/sJQXl9Z5jqtUSSxiCVIEKGghjIqsBGjXSfFQprOEx7+EdcvkUshVxmMHAuoQoPs+sH/4PdsrcLUZCsplAB6XxznYwwI7ALNuuN8HztO8wTwPwNXesdfbQCzn6TXO1r0CBjYBi6uO5qyB1zuAMNPhmzKruSnJRQKwPsZfVMOCN8CwbXW3NrnOH0AMjSr1A1wcAiMFyl73ePdfd1z+7enPb8fQC5ykgotUKYAAA14aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjRlZDI3MGJiLTk1NTctNDkxMy1hMzJlLWRmODlhZDI2YTBmZiIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0MjI3NTNhNC02OTI4LTQ5ZmMtOTY1Mi1jOGI0OWI3NTIxZTciCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxMmVlMjdlNS04YTUyLTRiYzUtOGZhNS01ZWEzNjE3ZTAyMGQiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE3MzcxOTU0NTA1NTkwNDciCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zNiIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjU6MDE6MThUMTM6MTc6MzArMDM6MDAiCiAgIHhtcDpNb2RpZnlEYXRlPSIyMDI1OjAxOjE4VDEzOjE3OjMwKzAzOjAwIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MTljYjcwYTMtMmNkZi00NjE5LWEzMTUtOTUyNjRkZjNhMDliIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKExpbnV4KSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyNS0wMS0xOFQxMzoxNzozMCswMzowMCIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz5S1XxbAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH6QESChEenq7N6wAADn5JREFUeNrtnGtsVNW7xn9r7z33XrgVCpRSWwpyx3ByPDlRvxDN+WBiIPFShINwYsDMiZrwQROrMYKJXzX/JiBEbU00qGhMIOYfJSFKTg7NSQBREEpLodza0mLbaee2917nw56Z3ktpZ0qns55kMu2+zKznXc963nevvWaDgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgkLWora2Vu7cuVM+zDbcvn37wunTp+WRI0ceSjtErnb8/v37aWhoAOC3337jySefnLJYtLS0yOvXr/PVV18N2l5TUyOUADKIuro6uW/fvlTHV1ZWUl1dzY4dOzIeh+bmZnnt2jW++eabYft27dpFaWnpjqKiojolgCkY8cmOf/nll3G73di2nZFYXLlyRV67do3vv/9+2L5XX32VDRs2PPT4i1zs+K1bt/Lmm28C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","batteryChargeFinished_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMzQiIHdpZHRoPSIxMTIiIGhlaWdodD0iNjAiIHN0cm9rZT0iIzgwODA4MCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJ0cmFuc3BhcmVudCIgLz4KCQk8cmVjdCB4PSIxMTIiIHk9IjQ4IiB3aWR0aD0iMTYiIGhlaWdodD0iMzIiIGZpbGw9IiM4MDgwODAiIC8+CgkJPHJlY3QgeD0iMSIgeT0iMzUiIHdpZHRoPSIxMTAiIGhlaWdodD0iNTgiIGZpbGw9IiMwMGZmMDAiIC8+CgkJPHJlY3QgeD0iNzkiIHk9IjM1IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IiNmZmZmZmYiIC8+CgkJPHJlY3QgeD0iOTUiIHk9IjM1IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iNzkiIHk9IjUxIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iOTUiIHk9IjUxIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IiNmZmZmZmYiIC8+CgkJPHJlY3QgeD0iNzkiIHk9IjY3IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IiNmZmZmZmYiIC8+CgkJPHJlY3QgeD0iOTUiIHk9IjY3IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iNzkiIHk9IjgzIiB3aWR0aD0iMTYiIGhlaWdodD0iMTAiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iOTUiIHk9IjgzIiB3aWR0aD0iMTYiIGhlaWdodD0iMTAiIGZpbGw9IiNmZmZmZmYiIC8+Cgk8L2c+Cjwvc3ZnPgo=","charging_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMzQiIHdpZHRoPSIxMTIiIGhlaWdodD0iNjAiIHN0cm9rZT0iIzgwODA4MCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJ0cmFuc3BhcmVudCIgLz4KCQk8cmVjdCB4PSIxMTIiIHk9IjQ4IiB3aWR0aD0iMTYiIGhlaWdodD0iMzIiIGZpbGw9IiM4MDgwODAiIC8+CgkJPHJlY3QgeD0iMSIgeT0iMzUiIHdpZHRoPSIxOCIgaGVpZ2h0PSI1OCIgZmlsbD0iI2ZmMDAwMCIgLz4KCQk8bGluZSB4MT0iMjQiIHkxPSI2NCIgeDI9IjEwOCIgeTI9IjY0IiBzdHJva2U9IiMwMGZmMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8bGluZSB4MT0iMTA4IiB5MT0iNjQiIHgyPSI4NCIgeTI9IjQwIiBzdHJva2U9IiMwMGZmMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8bGluZSB4MT0iMTA4IiB5MT0iNjQiIHgyPSI4NCIgeTI9Ijg4IiBzdHJva2U9IiMwMGZmMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCTwvZz4KPC9zdmc+Cg==","dying_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMzQiIHdpZHRoPSIxMTIiIGhlaWdodD0iNjAiIHN0cm9rZT0iIzgwODA4MCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJ0cmFuc3BhcmVudCIgLz4KCQk8cmVjdCB4PSIxMTIiIHk9IjQ4IiB3aWR0aD0iMTYiIGhlaWdodD0iMzIiIGZpbGw9IiM4MDgwODAiIC8+CgkJPHJlY3QgeD0iMSIgeT0iMzUiIHdpZHRoPSIxOCIgaGVpZ2h0PSI1OCIgZmlsbD0iI2ZmMDAwMCIgLz4KCTwvZz4KPC9zdmc+Cg==","fileicon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiIGZpbGw9IiNmZmZmZmYiIC8+CgkJPHJlY3QgeD0iMCIgeT0iLTQiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgZmlsbD0iIzgwODA4MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI4LCAtMzIpIHJvdGF0ZSg0NSkiIC8+Cgk8L2c+Cjwvc3ZnPgo=","foldericon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiIGZpbGw9IiNmZjdiMDAiIC8+CgkJPHJlY3QgeD0iMCIgeT0iNjAiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgZmlsbD0iI2ZmZDgwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTcwLCAtMTYpIHJvdGF0ZSg0NSkiIC8+CgkJPHJlY3QgeD0iOTQiIHk9IjAiIHdpZHRoPSI0OCIgaGVpZ2h0PSI2MCIgZmlsbD0iI2ZmZDgwMCIgLz4KCTwvZz4KPC9zdmc+Cg==","js.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEyOCIgaGVpZ2h0PSIzMiIgZmlsbD0iI2NjY2NjYyIgLz4KCQk8cmVjdCB4PSIwIiB5PSIzMiIgd2lkdGg9IjEyOCIgaGVpZ2h0PSI5NiIgZmlsbD0iI2ZmZmZmZiIgLz4KCQk8cmVjdCB4PSIxMDIiIHk9IjgiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iI2ZmMDAwMCIgLz4KCQk8cmVjdCB4PSI4MCIgeT0iOCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSIjZTllOWU5IiAvPgoJCTx0ZXh0IHg9IjEwNiIgeT0iMjAiIGZpbGw9IndoaXRlIiBmb250LXNpemU9IjEycHgiPuKclTwvdGV4dD4KCQk8dGV4dCB4PSI4NCIgeT0iMjAiIGZpbGw9ImJsYWNrIiBmb250LXNpemU9IjEycHgiPuKWoTwvdGV4dD4KCQk8dGV4dCB4PSI2IiB5PSIyMCIgZmlsbD0iYmxhY2siIGZvbnQtc2l6ZT0iMTJweCI+SW5zdGFsbCBQQ09TPC90ZXh0PgoJCTx0ZXh0IHg9IjYiIHk9IjQ4IiBmaWxsPSJibGFjayIgZm9udC1zaXplPSIxMnB4IiBmb250LXdlaWdodD0iYm9sZCI+UENPUyAzIEluc3RhbGxlcjwvdGV4dD4KCQk8dGV4dCB4PSI2IiB5PSI2NCIgZmlsbD0iYmxhY2siIGZvbnQtc2l6ZT0iMTJweCI+WW91IGFyZSBpbnN0YWxsaW5nIFBDT1M8L3RleHQ+CgkJPHRleHQgeD0iNiIgeT0iODAiIGZpbGw9ImJsYWNrIiBmb250LXNpemU9IjEycHgiPjMgb24gdGhpcyBjb21wdXRlci48L3RleHQ+CgkJPHJlY3QgeD0iNiIgeT0iODQiIHdpZHRoPSIzMiIgaGVpZ2h0PSIxNiIgZmlsbD0iI2U5ZTllOSIgLz4KCQk8dGV4dCB4PSI3IiB5PSI5NiIgZmlsbD0iYmxhY2siIGZvbnQtc2l6ZT0iMTJweCI+SW5zdGFsbDwvdGV4dD4KCQk8cmVjdCB4PSI2IiB5PSIxMDQiIHdpZHRoPSIzMiIgaGVpZ2h0PSIxNiIgZmlsbD0iI2U5ZTllOSIgLz4KCQk8dGV4dCB4PSI4IiB5PSIxMTYiIGZpbGw9ImJsYWNrIiBmb250LXNpemU9IjEycHgiPlRyeSBpdDwvdGV4dD4KCTwvZz4KPC9zdmc+Cg==","lnk.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjEyOCIgZmlsbD0iI2ZmZmZmZiIgLz4KCQk8cmVjdCB4PSI2NCIgeT0iMCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzAwMDAwMCIgLz4KCQk8ZWxsaXBzZSBjeD0iMzIiIGN5PSI2NCIgcng9IjE2IiByeT0iNDgiIHN0cm9rZT0iIzAwOTRmZiIgc3Ryb2tlLXdpZHRoPSI0IiBmaWxsPSJibGFjayIgLz4KCQk8ZWxsaXBzZSBjeD0iOTYiIGN5PSI2NCIgcng9IjE2IiByeT0iNDgiIHN0cm9rZT0iI2ZmNmIwMCIgc3Ryb2tlLXdpZHRoPSI0IiBmaWxsPSJ3aGl0ZSIgLz4KCTwvZz4KPC9zdmc+Cg==","network_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMTUiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iMTciIHk9IjE3IiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiNhNzAwZmYiIC8+CgkJPGxpbmUgeDE9IjU1IiB5MT0iMzIiIHgyPSI3OCIgeTI9IjMyIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8cmVjdCB4PSI3MyIgeT0iMTUiIHdpZHRoPSI0MCIgaGVpZ2h0PSIzNSIgZmlsbD0iIzAwMDAwMCIgLz4KCQk8bGluZSB4MT0iMzUiIHkxPSI1MCIgeDI9IjU0IiB5Mj0iNzgiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSI4IiAvPgoJCTxsaW5lIHgxPSI5MyIgeTE9IjUwIiB4Mj0iNzQiIHkyPSI3OCIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjgiIC8+CgkJPHJlY3QgeD0iNDQiIHk9Ijc4IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iNDYiIHk9IjgwIiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiMwMGJmZmYiIC8+Cgk8L2c+Cjwvc3ZnPgo=","network_offline_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMTUiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iMTciIHk9IjE3IiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiNhNzAwZmYiIC8+CgkJPGxpbmUgeDE9IjU1IiB5MT0iMzIiIHgyPSI3OCIgeTI9IjMyIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8cmVjdCB4PSI3MyIgeT0iMTUiIHdpZHRoPSI0MCIgaGVpZ2h0PSIzNSIgZmlsbD0iIzAwMDAwMCIgLz4KCQk8bGluZSB4MT0iMzUiIHkxPSI1MCIgeDI9IjU0IiB5Mj0iNzgiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSI4IiAvPgoJCTxsaW5lIHgxPSI5MyIgeTE9IjUwIiB4Mj0iNzQiIHkyPSI3OCIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjgiIC8+CgkJPHJlY3QgeD0iNDQiIHk9Ijc4IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iNDYiIHk9IjgwIiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiMwMGJmZmYiIC8+CgkJPGxpbmUgeDE9IjAiIHkxPSIwIiB4Mj0iMTI4IiB5Mj0iMTI4IiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8bGluZSB4MT0iMTI4IiB5MT0iMCIgeDI9IjAiIHkyPSIxMjgiIHN0cm9rZT0iI2ZmMDAwMCIgc3Ryb2tlLXdpZHRoPSI4IiAvPgoJPC9nPgo8L3N2Zz4K","pcos_network_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMTUiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iMTciIHk9IjE3IiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiNhNzAwZmYiIC8+CgkJPGxpbmUgeDE9IjU1IiB5MT0iMzIiIHgyPSI3OCIgeTI9IjMyIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8cmVjdCB4PSI3MyIgeT0iMTUiIHdpZHRoPSI0MCIgaGVpZ2h0PSIzNSIgZmlsbD0iIzAwMDAwMCIgLz4KCQk8cmVjdCB4PSI3NSIgeT0iMTciIHdpZHRoPSIzNiIgaGVpZ2h0PSIzMSIgZmlsbD0iI2E3MDBmZiIgLz4KCQk8bGluZSB4MT0iMzUiIHkxPSI1MCIgeDI9IjU0IiB5Mj0iNzgiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSI4IiAvPgoJCTxsaW5lIHgxPSI5MyIgeTE9IjUwIiB4Mj0iNzQiIHkyPSI3OCIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjgiIC8+CgkJPHJlY3QgeD0iNDQiIHk9Ijc4IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iNDYiIHk9IjgwIiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiNhNzAwZmYiIC8+Cgk8L2c+Cjwvc3ZnPgo=","pcos_network_offline_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMTUiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iMTciIHk9IjE3IiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiNhNzAwZmYiIC8+CgkJPGxpbmUgeDE9IjU1IiB5MT0iMzIiIHgyPSI3OCIgeTI9IjMyIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8cmVjdCB4PSI3MyIgeT0iMTUiIHdpZHRoPSI0MCIgaGVpZ2h0PSIzNSIgZmlsbD0iIzAwMDAwMCIgLz4KCQk8cmVjdCB4PSI3NSIgeT0iMTciIHdpZHRoPSIzNiIgaGVpZ2h0PSIzMSIgZmlsbD0iI2E3MDBmZiIgLz4KCQk8bGluZSB4MT0iMzUiIHkxPSI1MCIgeDI9IjU0IiB5Mj0iNzgiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSI4IiAvPgoJCTxsaW5lIHgxPSI5MyIgeTE9IjUwIiB4Mj0iNzQiIHkyPSI3OCIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjgiIC8+CgkJPHJlY3QgeD0iNDQiIHk9Ijc4IiB3aWR0aD0iNDAiIGhlaWdodD0iMzUiIGZpbGw9IiMwMDAwMDAiIC8+CgkJPHJlY3QgeD0iNDYiIHk9IjgwIiB3aWR0aD0iMzYiIGhlaWdodD0iMzEiIGZpbGw9IiNhNzAwZmYiIC8+CgkJPGxpbmUgeDE9IjAiIHkxPSIwIiB4Mj0iMTI4IiB5Mj0iMTI4IiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iOCIgLz4KCQk8bGluZSB4MT0iMTI4IiB5MT0iMCIgeDI9IjAiIHkyPSIxMjgiIHN0cm9rZT0iI2ZmMDAwMCIgc3Ryb2tlLXdpZHRoPSI4IiAvPgoJPC9nPgo8L3N2Zz4K","pic.pic":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAABHNCSVQICAgIfAhkiAAACr5JREFUeJztnW1MW9cZgB9jG7CxA5iPhDThm9AQSAP5YK0moTZrpygLU9VoyVQSqe3SKV1V9U/Gtv9Ty/InmrY2S6ZuTZgEVbpIZFGktGmENq0laSCtgYbwmaQtCWAgtWMbjO39OLgkmQKYXGOTcx7JQr7Y73vMfe655z3nmqvjT8EgCmmJi3YDFNFFCSA5SgDJUQJIjhJAcgzRboDiXuJ0AapSmtmRcYrK5BYKTL1kxg8BMDSZSa+ngJbblZwa3kHzeBWB4MMdwzpVBsYGep2fl1e+R21OHQXm3nm9p9ddQN21Wt779mX8Qf2C8ioBYoASSyfH1+2hwtoKQL8nj4Zbu/lk7BnanaUM+TIByDQOUWpt55nUT9i9vIE8Uz8Arc4K9nQcp9NVEnZuJUCU2Z5+moay3Vj0Lga8udR213FiaCf+rbMf0fpzfnZmnqCuqJbcxAFcfgu77Q2cHtkeVv6ICbDG7GZb+igbrC5WJU6QapzSLPb4lIEbngTanBbOjKTR7TZpFnsx2Z5+mpNPPI9R56N+sIb9V97F+bQ1rBjW807efXw/NVn1+IJGnv/iZFgSaC6A1eDnt3nXeTZtFJ2WgR9AEDjrsPF2fzbOqYWdB6NBiaWTls2VWPQuDl47QG13HYEfLWxAF/dxgLqiWg7kHMTlt1B5sWXepwNNBbAa/Bwt6aLQ7MHjj6NpOJ3msRR63ImM+Yxc/MGlh86x+bON2Iw+CsweqlJvU50xgkkfoMdtYl9n8ZKQQK/zc2HLFiqsrdQP1rC349iCd36IuI8DHFu3l5qselqdFWy5cGFeA0NNBfh9UT8/Thulz53Im12FNJW3axX6gVS3lXGouJt8s5ezDhu/686LeM6HZd9jRzmy9lUGvLmUfWoPu9t/ENbzTuxPlpGbOMCrXx3h6Df75nyPZhNBRWYPz6WN4vHH8WZX0aLsfICmcjtvdhXi8cfxbNooa5I8i5J3ocTpAtTm1AFQ212n2c4HcD5t5dfdfxCxc+qI0wXmbo9WybelO9ABTcPpNJXbtQo7L5rK22kaTkcHbEtzLGrucKlKaabA3EufJ58TQzs1j//h0Av0efIpMPdSldI85+s1E6Dc6gKgeSxFq5BhEcq7YbodscqOjFMANN7aNWeptxD8W/U03tp1T67Z0EyAbNMEAD3uRK1ChkUo7+rpdsQqlcktAJwb3RqxHKHYoVyzoZkAVr2o88d90VleCOVdZvBHJf98KTT1ACxo1m6+hGKHcs2GdquBusWo+udBjE9sphnFGGXYlxGxHKHYoVyzoZkA303X3ykazviFQyiv068WOMNBMwFueBIAKDR7tQoZFqG816fbEas4fGkAZBiHI5YjFDuUazY0E+Cy0wJAVeq4ViHDIpS3bbodsUqPpxAQU8GRIhQ7lGs2NBPgjCONIFCdMUJ1W6lWYedFdVsZ1RkjBIEzI3NbH01ablcCsNV2LmI5QrFDuWZDMwGu3jHxkcOGSR/gUHEP1W1lWoWeleq2Ug4Vd2PSBzjrsMX8yuCp4R0A7FreiP6c9hWL/pyfXcsb78k1G5qOmN7qzybf5KHQ7KFxfQeNNzNpHkum121iVMPFoFSjj0Kzl6rUcRrXd36/GPR2f7YGnyKyNI9X0esuoMDcy87ME5rHfyHzQ/JNffS6C2ger5rz9RFZDv5N3nWeW8Tl4I8cNt5aQsvBsbQYFLELQorMHralOyi3ulhtmiDFoF15OOYz8LU3gctOC2dGbFx1mzWLvRjE0nJwxIrmbreJ7uurIhV+SeMP6tnTcZyWzZXUZNUzOJlF3MeBh74gpCarHpffwp6O4/O+SFR9LyBKdLpK2G1vwBc0ciDnIMfW7cV63hl2HOt5J8fW7eVAzkF8QSO77Q1hTTMrAaLI6ZHtPP/FSVx+CzVZ9difLGOXfX7Vgf6cn132RuxPln1/5Id7PSCoq4JjAnVZuEJ9MUQhUF8NUywqahAoOUoAyVECSI4SQHKUAJKjBJAcJYDkKAEkRwkgOUoAyVECSI4SQHKUAJKjBJAcJYDkKAEkRwkgOUoAyVECSI4SQHKUAJKjBJAcJYDkKAEkRwkgOUoAyVECSI4SQHKUAJKjBJAcJYDkKAEkRwkgOUoAyVECSI4SQHKUAJKjBJAcJYDkKAEkRwkgObF1k71lt8HmgNRxWDYOVhckOcHkBaMP4u+6LawvHnwG8JrAbQaXBb5LhvFUGLXBmA0Cyu+5iJ4ARh+sGISV34ifGUOQEMZ9f42T4mF2C2nux68HRzrczILBlfDtY0IUxT0s7v8Ktjkgtx+yr4mdrr/v/+K7k8CRBqNpcDsZnMvgThJ4zOAzwi8Oz7z26H4hQMIEJN0Bq1P0IKljYBuB5Nugu++jjaTD9Vy4liukCMbI7W6jSOQFyBiCwqtQ0CN2SoigDoaWiyPzZhbcXAEv/VW7vEf2Q+YQZH078zD6Zn7vMUFfAfSsgW9WSStDZASwOqH4Kyi+AiljM9s9ZujPE0fh16vvPaIjzeHXhQTZA5DXByl33eHUnQRdxXClRPQ+EqGdAHEB8YctaYfV12e6X7cZeougp0h0u6/9UZN0D03Di1DYLXqnu2W4uQI6y6B7DUzF1hg5Ejy8ACYPrLNDqR2SXGKbXw99hXBlLdzIjp2d/iA+/JnosYquzgxEJxKgsxTs68VY5BFl4QKkjEF5q/jDhQZzYzZoL4OutYvbvWvFX34leoRSOyy/KbYFdULmy+VirPKIEb4AGUOw8SLk94puPqiDgTz4cgP89J8RamYU+ODn8MRlIURI8MGV0LpJfN5HhPkLkHkLtrRAjrhTFX49fFUCX1TAi+9HsIlR5m/7YP1lcZpL9IptjnS4tElUEEu8ephbAJsDKj8VRzyIerx9PVyugJeOLkITY4Qjr0FJB2xoBcv0DR7HU+DSZrj6+JKddXywABYnVH4mzvG6oNjx9vXQthFeObLIzYwhDr8uytuKzyF5unpwLhMiXFkresYlxP8LYPSJD7ehFQxT4gN1lMKlLXId8XPxzhtQ1AWbLkLqqNjmskLrRlE9LBER7hVgzRV46j9iahVELfzZU7Dn79Fp3VLgnTfELOemC5A2IrbdSRI9ZWep6DljGCGAzQFV58XCDMCtFfDvKtjZGN3WLTXO/AQ2tUDGsHjuNcGXT4hTp9cU3bY9AB0X/xuk4nMxk+c2w6c/hK1no92upc2/qsWpYcWgeD5lgK7HxeB5JCO6bbsPHcFDQYI66CgT3f1SnMCJVU7uhPJLkDMwMzU+nAlXi8VcwnhqVJsHoR7gWi688EG02/Lo8o+9UPalqKjuvubBmziz9O2yihVKbyJMJohB5ETCzGsn48Wcgz4AhrtWNY0+MVEV5wfjlBi4G3wQPzlzEU3C5MzSeYIXEidAPwXvvTrdAygWh8Ovi+sh8ntg1Q1xMUs0OfKaEiCqvP+KKCGt34HFJWYaEz3i6DVMiZ8h4ifFacQfB1N3VRZTBvEIxImKwz/9fCJBPPfFw0S86FUmEmAiEbwJYlD6yz8rAWRnac5fKjRDCSA5SgDJUQJIjhJAcpQAkqMEkBwlgOQoASRHCSA5SgDJUQJIjhJAcpQAkqMEkBwlgOQoASRHCSA5SgDJUQJIjhJAcpQAkqMEkBwlgOQoASRHCSA5SgDJUQJIjhJAcpQAkqMEkJz/Aa8ABgsgvLbdAAAAAElFTkSuQmCC","readyToPlay_icon.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMzQiIHdpZHRoPSIxMTIiIGhlaWdodD0iNjAiIHN0cm9rZT0iIzgwODA4MCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJ0cmFuc3BhcmVudCIgLz4KCQk8cmVjdCB4PSIxMTIiIHk9IjQ4IiB3aWR0aD0iMTYiIGhlaWdodD0iMzIiIGZpbGw9IiM4MDgwODAiIC8+CgkJPHJlY3QgeD0iMSIgeT0iMzUiIHdpZHRoPSIxMTAiIGhlaWdodD0iNTgiIGZpbGw9IiMwMGZmMDAiIC8+Cgk8L2c+Cjwvc3ZnPgo=","txt.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiIGZpbGw9IiNmZmZmZmYiIC8+CgkJPHJlY3QgeD0iMCIgeT0iLTQiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgZmlsbD0iIzgwODA4MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI4LCAtMzIpIHJvdGF0ZSg0NSkiIC8+CgkJPHRleHQgeD0iNiIgeT0iMTYiIGZvbnQtc2l6ZT0iMTJweCI+TG9yZW0gaXBzdW0gZG9sb3I8L3RleHQ+CgkJPHRleHQgeD0iNiIgeT0iMzIiIGZvbnQtc2l6ZT0iMTJweCI+c2l0IGFtZXQsIGNvbnNlY3RldHVyPC90ZXh0PgoJCTx0ZXh0IHg9IjYiIHk9IjQ4IiBmb250LXNpemU9IjEycHgiPmFkaXBpc2NpbmcgZWxpdC4gTnVsbGFtPC90ZXh0PgoJCTx0ZXh0IHg9IjYiIHk9IjY0IiBmb250LXNpemU9IjEycHgiPnVsbGFtY29ycGVyIG1vbGxpczwvdGV4dD4KCQk8dGV4dCB4PSI2IiB5PSI4MCIgZm9udC1zaXplPSIxMnB4Ij5sYWNpbmlhLiBVdCBkaWduaXNzaW0sPC90ZXh0PgoJCTx0ZXh0IHg9IjYiIHk9Ijk2IiBmb250LXNpemU9IjEycHgiPmxvcmVtIHNlZCB1bHRyaWNlczwvdGV4dD4KCQk8dGV4dCB4PSI2IiB5PSIxMTIiIGZvbnQtc2l6ZT0iMTJweCI+cG9ydHRpdG9yLCB0ZWxsdXMuLi48L3RleHQ+Cgk8L2c+Cjwvc3ZnPgo=","vid.pic":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAwXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjabVDbEcMgDPv3FB0BLPMahzTpXTfo+DVgcqGp7pCFDcKYjs/7RY8G9kISUo4lRqeQIoWriuwGamfvpHPHLOl+ydNZYE1BI+xCtPMz70+DEaqqcDV6WmFbC0XMP/8Y8QhoHTW9m1ExI/AoeDOo41sulpyuX9gOtyKPRY0kr23f9kmntwd9B8wHPJwyEEcDaCsQqgqv7JG5KXSdlIFppgP5N6cJ+gLqhVkYh0XxjQAAAYRpQ0NQSUNDIHByb2ZpbGUAAHicfZE9SMNQFIVPU6VSKortIOKQoTrZRUUcaxWKUCHUCq06mLz0D5o0JCkujoJrwcGfxaqDi7OuDq6CIPgD4i44KbpIifelhRYxXni8j/PuObx3HyA0KkyzeuKApttmOpkQs7lVMfAKH4YQxCDCMrOMOUlKwbO+7qmb6i7Gs7z7/qx+NW8xwCcSx5lh2sQbxDObtsF5nzjCSrJKfE48YdIFiR+5rrT4jXPRZYFnRsxMep44QiwWu1jpYlYyNeJp4qiq6ZQvZFusct7irFVqrH1P/sJQXl9Z5jqtUSSxiCVIEKGghjIqsBGjXSfFQprOEx7+EdcvkUshVxmMHAuoQoPs+sH/4PdsrcLUZCsplAB6XxznYwwI7ALNuuN8HztO8wTwPwNXesdfbQCzn6TXO1r0CBjYBi6uO5qyB1zuAMNPhmzKruSnJRQKwPsZfVMOCN8CwbXW3NrnOH0AMjSr1A1wcAiMFyl73ePdfd1z+7enPb8fQC5ykgotUKYAAA14aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjRlZDI3MGJiLTk1NTctNDkxMy1hMzJlLWRmODlhZDI2YTBmZiIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0MjI3NTNhNC02OTI4LTQ5ZmMtOTY1Mi1jOGI0OWI3NTIxZTciCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxMmVlMjdlNS04YTUyLTRiYzUtOGZhNS01ZWEzNjE3ZTAyMGQiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE3MzcxOTU0NTA1NTkwNDciCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zNiIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjU6MDE6MThUMTM6MTc6MzArMDM6MDAiCiAgIHhtcDpNb2RpZnlEYXRlPSIyMDI1OjAxOjE4VDEzOjE3OjMwKzAzOjAwIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MTljYjcwYTMtMmNkZi00NjE5LWEzMTUtOTUyNjRkZjNhMDliIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKExpbnV4KSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyNS0wMS0xOFQxMzoxNzozMCswMzowMCIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz5S1XxbAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH6QESChEenq7N6wAADn5JREFUeNrtnGtsVNW7xn9r7z33XrgVCpRSWwpyx3ByPDlRvxDN+WBiIPFShINwYsDMiZrwQROrMYKJXzX/JiBEbU00qGhMIOYfJSFKTg7NSQBREEpLodza0mLbaee2917nw56Z3ktpZ0qns55kMu2+zKznXc963nevvWaDgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgkLWora2Vu7cuVM+zDbcvn37wunTp+WRI0ceSjtErnb8/v37aWhoAOC3337jySefnLJYtLS0yOvXr/PVV18N2l5TUyOUADKIuro6uW/fvlTHV1ZWUl1dzY4dOzIeh+bmZnnt2jW++eabYft27dpFaWnpjqKiojolgCkY8cmOf/nll3G73di2nZFYXLlyRV67do3vv/9+2L5XX32VDRs2PPT4i1zs+K1bt/Lmm28C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"},"keys":{"automaticSigner":"{\"signature\":\"c30fadf278f4633bad65e18d692bd49630863a274d14379199a2a2218572cb57a9f2906e8d9b9d7d6c19f2cefd76f15deecdedc0f8817a50c44734759636f7cd\",\"keyInfo\":{\"key\":{\"kty\":\"EC\",\"x\":\"UuzRB_2hdrUsqieuaizjh-bG8Os6mfD4ZPbfZKeve4M\",\"y\":\"dMG6126Me_tYyXugVxLBZjhUr6YL2YwPa0h5qS68boc\",\"crv\":\"P-256\"},\"usages\":[\"appTrust\"]}}","khrl":{"list.khrl":"{\"list\":[],\"signature\":\"1ca37cd05b924ec986eb6f212927dec1a0f2d5b1e97036c881ba4b121d99fde0dabd0e22d858716a8e5f68cfdbcb13d69a11972058a1a507a830d92540e37d35\"}"}},"sounds":{"ask.aud":"data:audio/mpeg;base64,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HBACSjLCdkCoB7AQef0SNjeA1gLPKVQUv5qT7L5IQX7QSBtZvt6ZkxOf4xqEdtadXsMiMCsnqx3Dy8ylqhkvY1TAXICjGGXJD5USCVrBZJF5P/p/0Xf///tSxOkDC4CvGi29sQmBEWMFt6YYcN+kIcpCBjFwfMewEqXSJuZYSZd+aj8HK4EaTIWnyoDGERzAojcRgcJapHz0FmZtjILpdijPImIkMJUZ0C2MbiUkeVfd9DpmqJd+Ja+cz6te/94XiRy3nThUNcJtZxN3/+4CAApeHYA6KonhTlMsLgACLxMcUwvDGHBDY0kIo8j7F+pQQCZvwW0GAOCcDPlgqCGtnlf2xgSwJx13X8o4vUVo2/PyFmWtln5/Nkeqcq+uJEJWGVEEkQUDZH//+1LE6IOLnK8YDb1wwX8RowW9PHL/R+nT9v/+z2gQAA9sDBCaACGRRpy6WyFLkxZmBMEPtjQC7a4VGq6ctgLiZrpmkFZumMkLvz/Ebd6zNS8WAOMWENvp6NqksmeLCINSW3RUGPPBUJCYFAEkRjjJNhCFP20ggkSQjKlUiNgDRUDdsousU0ZcRHin7Gkhr1yvfgdBw4pyD5mOlBBr5gFk5iOu3OEwBKbjujZNcypnhaxlgnWFzJARFFMRmhMxWn/sa9lW7+r//vu27B24cDIjcP/7UsToAAtYeSFM6Q6BfBJiwc08cQjBlRKcD0HIj5RCEKs3jcxlY/U8woAzgcaHBwQsuIiQFIiG0dBPOMltspdWlpmjK5rwBDZhCZHpaPwpq0c2ifUOF1Jq7n3G2yUcmTr6xOkTHK5SvODM4Q2V0T7i9iG0bi9YnYZXOuPqG2Eq5336XgZtX6UvlbO/S+wbbvcDIIxIGRRiQMjDEhapRIWjKpC0ZUALRlQOqMqjojKoyItUDpClUdKyTEFNRTMuMTAwqqqqqgABZOsDOyNKEk6G//tSxOkDDFSfGs2wcUFcEGNJt6IQCMosgnHArmBmEEwIULQXP2Tirjc2aLEho0Kihp7N7P/F9ISFdQv1M//9fWKcVbxRD6//4vVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+1LE6gMK+HcebTEQgp+fIsW9MLlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7UsTBg8fsSQ5HsMhAAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV","ding.aud":"data:audio/mpeg;base64,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tluDvAwCOUOAMPM0SaMIgyJqkiacCP7p3GfhxadKjIbMoX6UB40bzuAl52FU0vnZUgexzLVcRKx6YhhWqx5CqAiOm9mthi+sUN5qu3lZaxnzKShTCMYt//tSxOACCkSlI00kdMlLkKNFvC4Yq3XUAxEKKDcF/a0bJQD7BBQqfDZgL+AwG9euLxfuU0QwHoUTA34dKljxkoBYsQdb1jMQJtXH0x1a1tdqTFKln7SWFIcxNZjJh89GjzpCFiBEa9H/s///+rSn/94jBHbVQBp+a7bhcQC4IXREO+bAaiQG9L/QVZuK2GJk51A+mbK4HAQBF8fHAxJuV1YokLXhhsAggZcfG7zXmgDmVF5ZaRJYQMOmvBSEnF8xK1apYRGYFpB0H1qXQkHoN3//+1LE64IMCLsc7bB0wYcT4wm8IhhYOgkgxIRKbKPxiMEmAQMjUKoM4uLR4JtFuPTBc/Exg1mYa7qRs4kaMT9VHpBJeu0svs3qqBSOCakWxt7v46wCRLN8mUeFEcG1Tey7/v53+2moICcyIS6l4ua3XwAYAAQSMsFru4nAgkmHhCmDNwgKcE8c6GMa4XbAxgKIPDCSjiGvtyLgFbFrMqqgyACg1GWRFU82Xz0YuM5h/+RigGCAcSNTMPYce+Zu+73f/3bMQfq+kIDPJwCADCoKTv/7UsTogAuEvRgtvRDBYw7j3ZeaGHc3hGUu7UAMI4yVmwQNVqV4rtTRG8EAjIA0bnrZ8zpXUOy4sHiNgERUSmjxOCQGhCRITRhGgOHUmTR42YLh8Y6SJZlim6Sg5hMQWRJKWgeUaklCcW01ij0Lh/lrgtnqFwB0jEhekYkLUjEhatZJVGWDC0ZRIWjKpKoyoBVOqB1RlQOidVHSLVA6ZVQOlUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//tSxOwDzBiNFA29NIlsk6LBzBngVQVGsLFVJrKkQhB4DgcgTi0sBCSoWEZkYLC5lzVEQELNF0//FfFOtvZ//8X4szi/sd//1tVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+1LE7AAK0IkhTT1JQlgbIsWkmllVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7UsS7g8ZwJxBEmGhAAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV","error.aud":"data:audio/mpeg;base64,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","shutdown.aud":"data:audio/mpeg;base64,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","startup.aud":"data:audio/mpeg;base64,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"},"tlds.json":"{\n    \"basic\": \"7f00000150434f53334e6574776f726b\",\n    \"pc\": \"7f00000150434f53334e6574776f726b\"\n}","wallpapers":{"pcos-beta.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+Cgk8ZGVmcz4KCQk8bGluZWFyR3JhZGllbnQgaWQ9IkJnR3JhZGllbnQiIHgxPSIwIiB4Mj0iMCIgeTE9IjAiIHkyPSIxIj4KCQkJPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwYmZmZiIgLz4KCQkJPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjYTcwMGZmIiAvPgoJCTwvbGluZWFyR3JhZGllbnQ+Cgk8L2RlZnM+Cgk8Zz4KCQk8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiBmaWxsPSJ1cmwoI0JnR3JhZGllbnQpIiAvPgoJCTx0ZXh0IHg9IjM1IiB5PSIxNTAiIGNsYXNzPSJzZWdvZWZvbnQiIGZpbGw9IiNmZmZmZmYiPlBDT1MgMzwvdGV4dD4KCQk8dGV4dCB4PSIxNTU1IiB5PSIxMDMwIiBjbGFzcz0ic2Vnb2Vmb250IiBmaWxsPSIjMzAzMDMwIj50ZXN0IGJ1aWxkPC90ZXh0PgoJPC9nPgoJPHN0eWxlPgoJCS5zZWdvZWZvbnQgewoJCQlmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7CgkJCWZvbnQtc2l6ZTogNjRweDsKCQkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJfQoJPC9zdHlsZT4KPC9zdmc+Cg==","pcos-dark-beta.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+Cgk8ZGVmcz4KCQk8bGluZWFyR3JhZGllbnQgaWQ9IkJnR3JhZGllbnQiIHgxPSIwIiB4Mj0iMCIgeTE9IjAiIHkyPSIxIj4KCQkJPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIgLz4KCQkJPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjYTcwMGZmIiAvPgoJCTwvbGluZWFyR3JhZGllbnQ+Cgk8L2RlZnM+Cgk8Zz4KCQk8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiBmaWxsPSJ1cmwoI0JnR3JhZGllbnQpIiAvPgoJCTx0ZXh0IHg9IjM1IiB5PSIxNTAiIGNsYXNzPSJzZWdvZWZvbnQiIGZpbGw9IiNhNzAwZmYiPlBDT1MgMzwvdGV4dD4KCQk8dGV4dCB4PSIxNTU1IiB5PSIxMDMwIiBjbGFzcz0ic2Vnb2Vmb250IiBmaWxsPSIjMzAzMDMwIj50ZXN0IGJ1aWxkPC90ZXh0PgoJPC9nPgoJPHN0eWxlPgoJCS5zZWdvZWZvbnQgewoJCQlmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7CgkJCWZvbnQtc2l6ZTogNjRweDsKCQkJZm9udC13ZWlnaHQ6IGJvbGQ7CgkJfQoJPC9zdHlsZT4KPC9zdmc+Cg==","pcos-lock-beta.pic":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+Cgk8ZGVmcz4KCQk8bGluZWFyR3JhZGllbnQgaWQ9IkJnR3JhZGllbnQiIHgxPSIwIiB4Mj0iMCIgeTE9IjAiIHkyPSIxIj4KCQkJPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwYmZmZiIgLz4KCQkJPHN0b3Agb2Zmc2V0PSI1MCUiIHN0b3AtY29sb3I9IiNhNzAwZmYiIC8+CgkJCTxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIgLz4KCQk8L2xpbmVhckdyYWRpZW50PgoJPC9kZWZzPgoJPGc+CgkJPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjE5MjAiIGhlaWdodD0iMTA4MCIgZmlsbD0idXJsKCNCZ0dyYWRpZW50KSIgLz4KCQk8dGV4dCB4PSI4MDAiIHk9IjIwMCIgY2xhc3M9InNlZ29lZm9udCIgZmlsbD0iIzAwMDAwMCIgZm9udC1zaXplPSI3MnB4IiBmb250LXdlaWdodD0iYm9sZCI+UENPUyAzPC90ZXh0PgoJCTx0ZXh0IHg9Ijg2MCIgeT0iMjQwIiBjbGFzcz0ic2Vnb2Vmb250IiBmaWxsPSIjNDA0MDQwIiBmb250LXNpemU9IjM2cHgiPmxvY2tlZDwvdGV4dD4KCQk8dGV4dCB4PSIxNTU1IiB5PSIxMDUwIiBjbGFzcz0ic2Vnb2Vmb250IiBmaWxsPSIjNDA0MDQwIiBmb250LXNpemU9IjcycHgiIGZvbnQtd2VpZ2h0PSJib2xkIj50ZXN0IGJ1aWxkPC90ZXh0PgoJPC9nPgoJPHN0eWxlPgoJCS5zZWdvZWZvbnQgewoJCQlmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7CgkJfQoJPC9zdHlsZT4KPC9zdmc+Cg=="}}};
			async function extractMedia(target, mediaStructure, token) {
				for (let key in mediaStructure) {
					let value = mediaStructure[key];
					if (typeof value == "object") {
						try {
							await modules.fs.mkdir(target + "/" + key, token);
						} catch {}
						await extractMedia(target + "/" + key, value, token);
					} else await modules.fs.write(target + "/" + key, value, token);
					await modules.fs.chmod(target + "/" + key, "rx", token);
				}
			}
			return await extractMedia(target, mediaStructure, token);
		}
		// ../apps/adduser.js
async function adduserInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "adduser" + ".js";
	let linkPath = target + "/apps/links/" + "adduser" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SET_SECURITY_CHECKS, CSP_OPERATIONS, SET_USER_INFO, SWITCH_USERS_AUTOMATICALLY, FS_LIST_PARTITIONS, FS_READ, FS_WRITE, FS_CHANGE_PERMISSION, FS_BYPASS_PERMISSIONS, GET_USER_INFO, USER_INFO_OTHERS\n// signature: 4324ff1a6d3317443023b9e217aaeb3c44dacf0549bf6d8012de94b5513e6207288c748cea3ebefb431ca02bac837d7cb69ed79ab7b67bcf42265184f31349ea\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"adduser: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (ppos.length < 1) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"ADDUSER_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"ADDUSER_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"ADDUSER_SKIP_PASSWD\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"ADDUSER_SKIP_HOME\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"ADDUSER_HOME\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"ADDUSER_GROUPS\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"adduser: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"NEW_USER_CREATION\")).replace(\"%s\", ppos[0]) + \"\\r\\n\");\n\ttry {\n\t\tlet userData = await availableAPIs.getUserInfo({ desiredUser: ppos[0] });\n\t\tif (userData) throw new Error(\"USERNAME_EXISTS\");\n\t\tlet homeDirectory = pargs[\"home\"] || await availableAPIs.getSystemMount() + \"/home/\" + ppos[0];\n\t\tawait availableAPIs.setUserInfo({\n\t\t\tdesiredUser: ppos[0],\n\t\t\tinfo: {\n\t\t\t\tgroups: [ppos[0], ...(pargs.groups ? (pargs.groups instanceof Array ? pargs.groups : [pargs.groups]) : []) ],\n\t\t\t\thomeDirectory,\n\t\t\t\tsecurityChecks: [],\n\t\t\t\tblankPrivileges: false\n\t\t\t}\n\t\t});\n\t\tif (!pargs[\"skip-home\"]) {\n\t\t\tawait mkrecursive(homeDirectory);\n\t\t\tawait availableAPIs.fs_chown({ path: homeDirectory, newUser: ppos[0] });\n\t\t\tawait availableAPIs.fs_chgrp({ path: homeDirectory, newGrp: ppos[0] });\n\t\t\tawait availableAPIs.fs_chmod({ path: homeDirectory, newPermissions: \"rx\" });\n\t\t}\n\t\tif (pargs[\"skip-passwd\"]) return await availableAPIs.terminate();\n\t\tawait availableAPIs.switchUser(ppos[0]);\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"adduser: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_NEW_PROMPT\") + \"\\r\\n\");\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_PROMPT\"));\n\tlet str = \"\";\n\tlet stage = 0;\n\tlet password = \"\";\n\tonTermData(async function(e) {\n\t\tif (e == \"\\r\") {\n\t\t\tawait availableAPIs.toMyCLI(\"\\r\\n\");\n\t\t\tif (stage == 0) {\n\t\t\t\tpassword = str;\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_CONFIRM_PROMPT\"));\n\t\t\t\tstage = 1;\n\t\t\t\tstr = \"\";\n\t\t\t} else if (stage == 1) {\n\t\t\t\tstage = 2;\n\t\t\t\tif (str == password) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet salt = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"random\",\n\t\t\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(password),\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\tsalt: salt,\n\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\tcspArgument: key\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.setOwnSecurityChecks({\n\t\t\t\t\t\t\tchecks: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: \"pbkdf2\",\n\t\t\t\t\t\t\t\t\thash: u8aToHex(derived),\n\t\t\t\t\t\t\t\t\tsalt: u8aToHex(salt)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tawait availableAPIs.toMyCLI(\"adduser: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t\t\t\t\tawait availableAPIs.terminate();\n\t\t\t\t\t}\n\t\t\t\t\tawait availableAPIs.toMyCLI(\"adduser: \" + await availableAPIs.lookupLocale(\"PASSWD_FEEDBACK\") + \"\\r\\n\");\n\t\t\t\t\tawait availableAPIs.terminate();\n\t\t\t\t} else {\n\t\t\t\t\tawait availableAPIs.toMyCLI(\"adduser: \" + await availableAPIs.lookupLocale(\"PASSWD_MISMATCH\") + \"\\r\\n\");\n\t\t\t\t\tawait availableAPIs.terminate();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (e == '\\u007F') {\n\t\t\tif (str.length > 0) {\n\t\t\t\tstr = str.substr(0, str.length - 1);\n\t\t\t\tawait availableAPIs.toMyCLI('\\b \\b');\n\t\t\t}\n\t\t} else {\n\t\t\tif (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\\u00a0') {\n\t\t\t\tstr += e;\n\t\t\t\tawait availableAPIs.toMyCLI(\"*\");\n\t\t\t}\n\t\t}\n\t});\n})();\n\nasync function onTermData(listener) {\n\twhile (true) {\n\t\tlistener(await availableAPIs.fromMyCLI());\n\t}\n}\nasync function mkrecursive(dir) {\n\tlet slices = dir.split(\"/\");\n\tfor (let i = 2; i <= slices.length; i++) {\n\t\tlet browse = await availableAPIs.fs_ls({ path: slices.slice(0, i - 1).join(\"/\") });\n\t\tif (!browse.includes(slices[i - 1])) await availableAPIs.fs_mkdir({ path: slices.slice(0, i).join(\"/\") });\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/apiTerminal.js
async function apiTerminalInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "apiTerminal" + ".js";
	let linkPath = target + "/apps/links/" + "apiTerminal" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// signature: 816bab5873185b7db84d65b907d01db3c1d6fb049953faf81462d2e38c859529e7293b372bc0ed24fa9154ffa9e3a32d52eb0639782476dde7f9a59d3f681a6b\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait window.availableAPIs.windowTitleSet(await window.availableAPIs.lookupLocale(\"API_TEST_TERM\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tawait availableAPIs.attachCLI();\n\t\n\tfunction parse_cmdline(cmdline) {\n\t\tvar re_next_arg = /^\\s*((?:(?:\"(?:\\\\.|[^\"])*\")|(?:'[^']*')|\\\\.|\\S)+)\\s*(.*)$/;\n\t\tvar next_arg = ['', '', cmdline];\n\t\tvar args = [];\n\t\twhile (next_arg = re_next_arg.exec(next_arg[2])) {\n\t\t\tvar quoted_arg = next_arg[1];\n\t\t\tvar unquoted_arg = \"\";\n\t\t\twhile (quoted_arg.length > 0) {\n\t\t\t\tif (/^\"/.test(quoted_arg)) {\n\t\t\t\t\tvar quoted_part = /^\"((?:\\\\.|[^\"])*)\"(.*)$/.exec(quoted_arg);\n\t\t\t\t\tunquoted_arg += quoted_part[1].replace(/\\\\(.)/g, \"$1\");\n\t\t\t\t\tquoted_arg = quoted_part[2];\n\t\t\t\t} else if (/^'/.test(quoted_arg)) {\n\t\t\t\t\tvar quoted_part = /^'([^']*)'(.*)$/.exec(quoted_arg);\n\t\t\t\t\tunquoted_arg += quoted_part[1];\n\t\t\t\t\tquoted_arg = quoted_part[2];\n\t\t\t\t} else if (/^\\\\/.test(quoted_arg)) {\n\t\t\t\t\tunquoted_arg += quoted_arg[1];\n\t\t\t\t\tquoted_arg = quoted_arg.substring(2);\n\t\t\t\t} else {\n\t\t\t\t\tunquoted_arg += quoted_arg[0];\n\t\t\t\t\tquoted_arg = quoted_arg.substring(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\targs[args.length] = unquoted_arg;\n\t\t}\n\t\treturn args;\n\t}\n\n\tlet str = \"\";\n\tlet default_user = await window.availableAPIs.getUser();\n\tawait availableAPIs.toMyCLI((await window.availableAPIs.lookupLocale(\"TERMINAL_INVITATION\")).replace(\"%s\", (await window.availableAPIs.getVersion())) + \"\\r\\n\\r\\n\");\n\tawait availableAPIs.toMyCLI(default_user + \"@localhost:~\" + (default_user == \"root\" ? \"#\" : \"$\") + \" \");\n\t\n\tonTermData(async function (e) {\n\t\tif (e == \"\\r\") {\n\t\t\tawait availableAPIs.toMyCLI(\"\\r\\n\");\n\t\t\tlet cmdline = [];\n\t\t\ttry {\n\t\t\t\tcmdline = parse_cmdline(str);\n\t\t\t} catch {\n\t\t\t\tawait availableAPIs.toMyCLI(\"> \");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tstr = \"\";\n\t\t\tif (!cmdline.length) {} else if (window.availableAPIs.hasOwnProperty(cmdline[0])) {\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.toMyCLI(JSON.stringify(await window.availableAPIs[cmdline[0]](cmdline.length == 1 ? undefined : (cmdline.length == 2 ? cmdline[1] : [...cmdline.slice(1)]))) + \"\\r\\n\");\n\t\t\t\t} catch (e) {\n\t\t\t\t\tawait availableAPIs.toMyCLI(cmdline[0] + \": \" + e.name + \": \" + e.message + \"\\r\\n\");\n\t\t\t\t}\n\t\t\t} else if (cmdline[0] == \"js_ree\") {\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.toMyCLI(JSON.stringify(eval(cmdline[1])) + \"\\r\\n\");\n\t\t\t\t} catch (e) {\n\t\t\t\t\tawait availableAPIs.toMyCLI(\"js_ree: \" + e.name + \": \" + e.message + \"\\r\\n\");\n\t\t\t\t}\n\t\t\t} else if (cmdline[0] == \"clear\") {\n\t\t\t\tawait availableAPIs.clearMyCLI();\n\t\t\t} else if (cmdline[0] == \"help\") {\n\t\t\t\tawait availableAPIs.toMyCLI(await window.availableAPIs.lookupLocale(\"HELP_TERMINAL_APITEST\"));\n\t\t\t\tfor (let api in window.availableAPIs) await availableAPIs.toMyCLI(api + \"\\r\\n\");\n\t\t\t} else {\n\t\t\t\tawait availableAPIs.toMyCLI((await window.availableAPIs.lookupLocale(\"TERM_COMMAND_NOT_FOUND\")).replace(\"%s\", cmdline[0]) + \"\\r\\n\");\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tdefault_user = await window.availableAPIs.getUser();\n\t\t\t} catch {}\n\t\t\tawait availableAPIs.toMyCLI(default_user + \"@localhost:~\" + (default_user == \"root\" ? \"#\" : \"$\") + \" \");\n\t\t\treturn;\n\t\t} else if (e == '\\u007F') {\n\t\t\tif (str.length > 0) {\n\t\t\t\tstr = str.substr(0, str.length - 1);\n\t\t\t\tawait availableAPIs.toMyCLI('\\b \\b');\n\t\t\t}\n\t\t} else {\n\t\t\tif (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\\u00a0') {\n\t\t\t\tstr += e;\n\t\t\t\tawait availableAPIs.toMyCLI(e);\n\t\t\t}\n\t\t}\n\t});\n})(); \n\nasync function onTermData(listener) {\n\twhile (true) {\n\t\tlistener(await availableAPIs.fromMyCLI());\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/authui.js
async function authuiInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "authui" + ".js";
	let linkPath = target + "/apps/links/" + "authui" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: IPC_SEND_PIPE, GET_LOCALE, GET_THEME, ELEVATE_PRIVILEGES, CSP_OPERATIONS\n// signature: 8c7889c3926d6b70163ee3285f5a9d943a4ecd2db53f7995e1cc7f5156f23db823e9d2fcaf616c2e7f7572a4afeee49bd39980acb24122d5a231dac9ebae4e1f\n// =====END MANIFEST=====\n\nlet ipc;\n(async function() {\n\t// @pcos-app-mode isolatable\n\texec_args = await availableAPIs.getPrivateData() || [];\n\tif (!(exec_args instanceof Array)) return availableAPIs.terminate();\n\tipc = exec_args[0];\n\tif (!ipc) return availableAPIs.terminate();\n\tlet user = exec_args[1];\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"LOG_IN_INVITATION\"));\n\tlet checklist = [ \"IPC_SEND_PIPE\", \"GET_LOCALE\", \"GET_THEME\", \"ELEVATE_PRIVILEGES\", \"CSP_OPERATIONS\" ];\n\tlet privileges = await availableAPIs.getPrivileges();\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tif (privileges.includes(\"IPC_SEND_PIPE\")) await availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: false } });\n\t\treturn availableAPIs.terminate();\n\t}\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet describe = document.createElement(\"b\");\n\tlet form = document.createElement(\"form\");\n\tlet input = document.createElement(\"input\");\n\tlet submit = document.createElement(\"button\");\n\tdocument.body.appendChild(describe);\n\tdocument.body.appendChild(document.createElement(\"br\"));\n\tdocument.body.appendChild(form);\n\tform.appendChild(input);\n\tform.appendChild(submit);\n\tsubmit.innerText = await availableAPIs.lookupLocale(\"ENTER_BUTTON\");\n\tdescribe.innerText = await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\tasync function userSubmit(e) {\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tlet userLogonSession;\n\t\tlet userLogonID;\n\t\tlet desired_username = input.value;\n\t\ttry {\n\t\t\tuserLogonID = await availableAPIs.automatedLogonCreate({ desiredUser: desired_username });\n\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t} catch {\n\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\tinput.type = \"text\";\n\t\t\tinput.disabled = !!user;\n\t\t\tsubmit.disabled = false;\n\t\t\tinput.value = user || \"\";\n\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\treturn;\n\t\t}\n\t\tasync function updateProgress() {\n\t\t\tsubmit.removeEventListener(\"click\", userSubmit);\n\t\t\tinput.value = \"\";\n\t\t\tsubmit.innerText = await availableAPIs.lookupLocale(\"ENTER_BUTTON\");\n\t\t\tif (userLogonSession.success != \"intermediate\") await availableAPIs.automatedLogonDelete(userLogonID);\n\t\t\tif (userLogonSession.success == true) {\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: userLogonSession });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t}\n\t\t\tif (userLogonSession.success == false) {\n\t\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\t\tinput.type = \"text\";\n\t\t\t\tinput.disabled = !!user;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tinput.value = user || \"\";\n\t\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdescribe.innerText = \"[\" + desired_username + \"] \" + userLogonSession.message;\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"RESPONSE_PLACEHOLDER\");\n\t\t\tinput.type = userLogonSession.type == \"password\" ? \"password\" : \"text\";\n\t\t\tinput.disabled = !userLogonSession.wantsUserInput;\n\t\t\tsubmit.disabled = !userLogonSession.wantsUserInput;\n\t\t\tif (userLogonSession.type == \"zkpp_password\") input.type = \"password\";\n\t\t\tif (userLogonSession.type == \"promise\") {\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t}\n\t\t\tif (userLogonSession.type == \"informative\") {\n\t\t\t\tinput.disabled = true;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tsubmit.innerText = \"OK\";\n\t\t\t\tinput.placeholder = \"--->\";\n\t\t\t}\n\t\t\tsubmit.addEventListener(\"click\", async function updater(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tsubmit.removeEventListener(\"click\", updater);\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tif (userLogonSession.type == \"zkpp_password\") {\n\t\t\t\t\t\tlet passwordAsKey = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(input.value),\n\t\t\t\t\t\t\t\talgorithm: \"PBKDF2\",\n\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tlet rngSeed = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseKey: passwordAsKey,\n\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\tcspArgument: passwordAsKey\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\tlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\n\t\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID, input: u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\toperation: \"sign\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tsecretKey: (await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\t\t\t\t\tseed: new Uint8Array(rngSeed)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})).secretKey,\n\t\t\t\t\t\t\t\tmessage: hexToU8A(userLogonSession.challenge)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}))});\n\t\t\t\t\t} else await availableAPIs.automatedLogonInput({ session: userLogonID, input: input.value });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t});\n\t\t}\n\t\tawait updateProgress();\n\t\treturn false;\n\t}\n\tsubmit.addEventListener(\"click\", userSubmit);\n\tif (user) {\n\t\tinput.disabled = true;\n\t\tinput.value = user;\n\t\tuserSubmit({ preventDefault: () => {}, stopImmediatePropagation: () => {}, stopPropagation: () => {} });\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: true } });\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/autoinstaller.js
async function autoinstallerInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "autoinstaller" + ".js";
	let linkPath = target + "/apps/links/" + "autoinstaller" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, RUN_KLVL_CODE, LLDISK_WRITE, LLDISK_READ, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, FS_REMOVE, FS_LIST_PARTITIONS, SYSTEM_SHUTDOWN, FS_CHANGE_PERMISSION, LLDISK_LIST_PARTITIONS, FS_MOUNT, CSP_OPERATIONS, LLDISK_INIT_PARTITIONS\n// signature: c409b57900181f6b072849a2554609fa7edce152c0881af330299cc3d5aee0d4986f1586954ab57e2631b80a23a89faf05ff735265b4365d31914b3f0a829e07\n// =====END MANIFEST=====\nlet onClose = () => availableAPIs.terminate();\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"autoinstaller: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (ppos[0] != \"install\") {\n\t\tawait availableAPIs.toMyCLI(\"Usage: autoinstaller install [options]\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"Automatically installs the OS on the disk.\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--locale=[locale] - Set the locale to the following\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--initdisk - Always initialize disk partitions\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--format - Always format the data partition\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--real-reboot - Do a real reboot, not \\\"kexec\\\".\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--no-restart - Do not restart the system at the end of installation\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--data=[dataPartition] - Specify the data partition (default data)\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t--boot=[bootPartition] - Specify the boot partition (default boot)\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"autoinstaller: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\n\ttry {\n\t\tlet partList = [];\n\t\ttry {\n\t\t\tpartList = await availableAPIs.lldaList();\n\t\t\tif (pargs.initdisk) throw new Error(\"initdisk forced\");\n\t\t} catch {\n\t\t\tawait availableAPIs.lldaInitPartitions();\n\t\t}\n\t\tif (pargs.format || !partList.includes(pargs.data || \"data\")) {\n\t\t\tlet partData = await availableAPIs.lldaRead({ partition: pargs.data || \"data\" });\n\t\t\tlet partId;\n\t\t\ttry {\n\t\t\t\tpartId = partData.id;\n\t\t\t} catch {}\n\t\t\tif (!partId) partId = (await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t})).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\")\n\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\tpartition: pargs.data || \"data\",\n\t\t\t\tdata: {\n\t\t\t\t\tfiles: {},\n\t\t\t\t\tpermissions: {},\n\t\t\t\t\tid: partId\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CREATING_BOOT_PARTITION\") + \"\\r\\n\");\n\t\tawait availableAPIs.lldaWrite({\n\t\t\tpartition: pargs.boot || \"boot\",\n\t\t\tdata: `\n\t\t\t\ttry {\n\t\t\t\t\tconst AsyncFunction = (async () => {}).constructor;\n\t\t\t\t\tlet pre_boot_part = coreExports.disk.partition(${JSON.stringify(pargs.data || \"data\")}).getData();\n\t\t\t\t\tlet pre_boot_modules = pre_boot_part?.files;\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No files were found in the storage partition\");\n\t\t\t\t\t\tthrow new Error(\"No files were found in the storage partition\");\n\t\t\t\t\t}\n\t\t\t\t\tpre_boot_modules = pre_boot_modules[coreExports.bootSection || \"boot\"];\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No boot modules were found\");\n\t\t\t\t\t\tthrow new Error(\"No boot modules were found\");\n\t\t\t\t\t}\n\t\t\t\t\tlet pre_boot_module_list = Object.keys(pre_boot_modules);\n\t\t\t\t\tpre_boot_module_list = pre_boot_module_list.sort((a, b) => a.localeCompare(b));\n\t\t\t\t\tlet pre_boot_module_script = \"\";\n\t\t\t\t\tfor (let module of pre_boot_module_list) {\n\t\t\t\t\t\tif (coreExports.bootMode == \"logboot\") pre_boot_module_script += \"coreExports.tty_bios_api.println(\" + JSON.stringify(module) + \");\\\\n\";\n\t\t\t\t\t\tpre_boot_module_script += await coreExports.idb.readPart(pre_boot_part.id + \"-\" + pre_boot_modules[module]);\n\t\t\t\t\t}\n\t\t\t\t\tawait new AsyncFunction(pre_boot_module_script)();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Boot failed\");\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Press Enter to continue and log this error locally\");\n\t\t\t\t\tawait coreExports.tty_bios_api.inputLine();\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t\t`\n\t\t});\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MOUNTING_DATA_PARTITION\") + \"\\r\\n\");\n\t\tawait availableAPIs.fs_mount({\n\t\t\tmountpoint: \"target\",\n\t\t\tfilesystem: \"PCFSiDBMount\",\n\t\t\tfilesystemOptions: {\n\t\t\t\tpartition: pargs.data || \"data\"\n\t\t\t}\n\t\t});\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHANGING_ROOT_PERMISSIONS\") + \"\\r\\n\");\n\t\tawait availableAPIs.fs_chmod({ path: \"target\", newPermissions: \"rx\" });\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"COPYING_FOLDERS\") + \"\\r\\n\");\n\t\ttry {\n\t\t\tawait recursiveRemove(\"target/boot\");\n\t\t} catch {}\n\t\ttry {\n\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/boot\" });\n\t\t} catch {}\n\t\tawait recursiveCopy((await availableAPIs.getSystemMount()) + \"/boot\", \"target/boot\", true);\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHANGING_BOOT_PERMISSIONS\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PATCHING_FS\") + \"\\r\\n\");\n\t\tlet systemCode = \"let localSystemMount = \\\".storage\\\";\\nlet mountOptions = {\\n\\tpartition: \" + JSON.stringify(pargs.data || \"data\") + \"\\n};\\ntry {\\n\\tmodules.fs.mounts[localSystemMount] = await modules.mounts.PCFSiDBMount(mountOptions);\\n\\tmodules.defaultSystem = localSystemMount;\\n} catch (e) {\\n\\tawait panic(\\\"SYSTEM_PARTITION_MOUNTING_FAILED\\\", { underlyingJS: e, name: \\\"fs.mounts\\\", params: [localSystemMount, mountOptions]});\\n}\\n\";\n\t\tawait availableAPIs.fs_write({ path: \"target/boot/01-fsboot.js\", data: systemCode });\n\t\ttry {\n\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/modules\" });\n\t\t} catch {}\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"SETTING_LOCALE_PREFERENCE\") + \"\\r\\n\");\n\t\tawait availableAPIs.fs_write({ path: \"target/boot/06-localeset.js\", data: \"modules.locales.defaultLocale = \" + JSON.stringify(pargs.locale || await availableAPIs.osLocale()) + \";\\n\" });\n\t\tawait availableAPIs.toMyCLI(\"Installation complete.\\r\\n\");\n\t\tif (!pargs[\"no-restart\"]) await availableAPIs.shutdown({ isReboot: true, isKexec: !pargs[\"real-reboot\"] });\n\t\tawait availableAPIs.terminate();\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"autoinstaller: \" + e.name + \": \" + await availableAPIs.lookupLocale(e.message) + \" (\" + e.message + \")\\r\\n\");\n\t\tawait availableAPIs.terminate();\n\t}\n})();\n\nasync function recursiveCopy(source, destination, permissions) {\n\tlet filesToCopy = await availableAPIs.fs_ls({ path: source });\n\tfor (let sourceFileIndex in filesToCopy) {\n\t\tlet cliSizeCols = 33;\n\t\tlet progressBar = \"=\".repeat(Math.round(sourceFileIndex / filesToCopy.length * (cliSizeCols - 4)));\n\t\tprogressBar += \" \".repeat(cliSizeCols - progressBar.length - 4);\n\t\tprogressBar += (Math.round(sourceFileIndex / filesToCopy.length * 100) + \"%\").padStart(4, \" \");\n\t\tawait availableAPIs.toMyCLI(\"\\r\" + progressBar);\n\t\tlet sourceFile = filesToCopy[sourceFileIndex];\n\t\tlet destinationFile = destination + \"/\" + sourceFile;\n\t\tif (await availableAPIs.fs_isDirectory({ path: source + \"/\" + sourceFile })) {\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_mkdir({ path: destinationFile });\n\t\t\t} catch {}\n\t\t\tawait recursiveCopy(source + \"/\" + sourceFile, destinationFile, permissions);\n\t\t} else {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: destinationFile,\n\t\t\t\tdata: await availableAPIs.fs_read({ path: source + \"/\" + sourceFile })\n\t\t\t});\n\t\t}\n\t\tif (permissions) {\n\t\t\tlet originalPermissions = await availableAPIs.fs_permissions({ path: source + \"/\" + sourceFile });\n\t\t\tawait availableAPIs.fs_chmod({ path: destinationFile, newPermissions: originalPermissions.world });\n\t\t\tawait availableAPIs.fs_chgrp({ path: destinationFile, newGrp: originalPermissions.group });\n\t\t\tawait availableAPIs.fs_chown({ path: destinationFile, newUser: originalPermissions.owner });\n\t\t}\n\t}\n\tawait availableAPIs.toMyCLI(\"\\r\" + \" \".repeat((await availableAPIs.cliSize())[0]) + \"\\r\");\n}\n\nasync function recursiveRemove(target) {\n\tlet filesToRemove = await availableAPIs.fs_ls({ path: target });\n\tfor (let targetFileIndex in filesToRemove) {\n\t\tlet cliSizeCols = 33;\n\t\tlet progressBar = \"=\".repeat(Math.round(targetFileIndex / filesToRemove.length * (cliSizeCols - 4)));\n\t\tprogressBar += \" \".repeat(cliSizeCols - progressBar.length - 4);\n\t\tprogressBar += (Math.round(targetFileIndex / filesToRemove.length * 100) + \"%\").padStart(4, \" \");\n\t\tawait availableAPIs.toMyCLI(\"\\r\" + progressBar);\n\t\tlet targetFile = filesToRemove[targetFileIndex];\n\t\ttargetFile = target + \"/\" + targetFile;\n\t\tif (await availableAPIs.fs_isDirectory({ path: targetFile })) await recursiveRemove(targetFile);\n\t\tawait availableAPIs.fs_rm({ path: targetFile });\n\t}\n\tawait availableAPIs.toMyCLI(\"\\r\" + \" \".repeat((await availableAPIs.cliSize())[0]) + \"\\r\");\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) onClose();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/basiccurl.js
async function basiccurlInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "basiccurl" + ".js";
	let linkPath = target + "/apps/links/" + "basiccurl" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_WRITE, FETCH_SEND, FS_BYPASS_PERMISSIONS, FS_CHANGE_PERMISSION\n// signature: 898f46afaedebb3fd32bd52665162615bcc0b65077796e7c6352429506d4a0a0d7b11ac3530aa92575dd01a361cf5a738501a13bc3a62e2ac0d1e0e522263905\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"basiccurl: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"BASIC_CURL_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"BASIC_CURL_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"basiccurl: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tlet downloadedFile = await availableAPIs.fetchSend({\n\t\t\turl: exec_args[0],\n\t\t\tinit: {}\n\t\t});\n\t\tdownloadedFile = downloadedFile.arrayBuffer;\n\t\tdownloadedFile = new TextDecoder().decode(downloadedFile);\n\t\tawait availableAPIs.fs_write({ path: exec_args[1], data: downloadedFile });\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"basiccurl: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/batteryinfo.js
async function batteryinfoInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "batteryinfo" + ".js";
	let linkPath = target + "/apps/links/" + "batteryinfo" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_BATTERY_STATUS\n// signature: 62d6ff7df3d70d53fde45dc7bc6b40f1533e1a41469ce583a200c1584dacef5bc07e0998452081317463aaf8727db6978150adce32dec1402c5b718412809b80\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"batteryinfo: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n    \n\ttry {\n\t\tlet batteryStatus = await availableAPIs.batteryStatus();\n\t\tif (exec_args[0] == \"--robot\") await availableAPIs.toMyCLI(JSON.stringify(batteryStatus, null, \"\\t\").replaceAll(\"\\n\", \"\\r\\n\") + \"\\r\\n\");\n\t\telse await availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"BATTERY_STATUS_\" + (batteryStatus.charging ? \"CHARGING\" : \"DISCHARGING\")))\n\t\t\t.replace(\"%s\", (batteryStatus.level * 100).toFixed(2))\n\t\t\t.replace(\"%s\", await availableAPIs.ufTimeInc([\n\t\t\t\t(batteryStatus.charging ? batteryStatus.chargingTime : batteryStatus.dischargingTime) * 1000\n\t\t\t])) + \"\\r\\n\");\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"batteryinfo: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/blockuser.js
async function blockuserInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "blockuser" + ".js";
	let linkPath = target + "/apps/links/" + "blockuser" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SET_SECURITY_CHECKS, SWITCH_USERS_AUTOMATICALLY\n// signature: 721788a8343b825ae65274a3e7c042cd5db2ee29dedecb98d6bdbedc0aa514aaf7d2d512b12e2175fa15cd32c040dbf35a423ced7627c5f4c16ffaee6701eabd\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"blockuser: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\tif (pargs.help) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"BLOCKUSER_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"BLOCKUSER_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.terminate();\n\t}\n\ttry {\n\t\tif (ppos[0]) await availableAPIs.switchUser(ppos[0]);\n\t\tawait availableAPIs.setOwnSecurityChecks({ checks: [] });\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"blockuser: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/blogBrowser.js
async function blogBrowserInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "blogBrowser" + ".js";
	let linkPath = target + "/apps/links/" + "blogBrowser" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "BLOG_BROWSER_NAME" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// link: lrn:BLOG_BROWSER_NAME\n// allow: GET_LOCALE, GET_THEME, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, START_TASK, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, IPC_SEND_PIPE, FS_BYPASS_PERMISSIONS, RESOLVE_NAME, CONNFUL_CONNECT, CONNFUL_DISCONNECT, CONNFUL_WRITE, CONNFUL_READ, CONNFUL_ADDRESS_GET, CONNFUL_IDENTITY_GET, GET_USER_INFO\n// signature: a267c646a6ca951d80b35ba2f7a00a2b867b883a19f2f0537c925b0741703b9a602a5a00debef30889b0ae468d266e5442e97995a1ae66d7bf3ba2e1d0b29510\n// =====END MANIFEST=====\nfunction createREE(direction) {\n\tlet ownIframeID = undefined;\n\ttry {\n\t\townIframeID = iframeId;\n\t} catch {}\n\treturn new Promise(function(resolve) {\n\t\tlet iframe = document.createElement(\"iframe\");\n\t\tlet iframeId = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\tlet prefix = ownIframeID ? (ownIframeID + \"_\") : \"\";\n\t\tiframeId = prefix + iframeId;\n\t\tiframe.src = \"data:text/html;base64,\" + btoa(\"<!DOCTYPE HTML>\\n<script>const iframeId = \" + JSON.stringify(iframeId) + \";\\n\" + reed.toString() + \"\\nreed();</script>\");\n\t\tiframe.style.border = \"none\";\n\t\tiframe.setAttribute(\"credentialless\", \"true\");\n\t\tiframe.sandbox = \"allow-scripts\";\n\t\tdirection.appendChild(iframe);\n\t\tlet prezhn = [];\n\t\tlet prerm = [];\n\t\tiframe.addEventListener(\"load\", function s() {\n\t\t\tiframe.removeEventListener(\"load\", s);\n\t\t\treturn resolve({\n\t\t\t\tiframe,\n\t\t\t\texportAPI: function(id, fn) {\n\t\t\t\t\tiframe.contentWindow.postMessage({type: \"export_api\", id: id, iframeId}, \"*\");\n\t\t\t\t\tasync function prezhn_it(e) {\n\t\t\t\t\t\tif (e.data.iframeId != iframeId) return;\n\t\t\t\t\t\tif (e.data.id != id) return;\n\t\t\t\t\t\tif (e.data.type != \"call_api\") return;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\t\t\tresult: await fn({\n\t\t\t\t\t\t\t\t\tcaller: iframeId,\n\t\t\t\t\t\t\t\t\targ: e.data.arg\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\ttype: \"api_response\",\n\t\t\t\t\t\t\t\tresponseToken: e.data.responseToken,\n\t\t\t\t\t\t\t\tiframeId\n\t\t\t\t\t\t\t}, \"*\");\n\t\t\t\t\t\t} catch (er) {\n\t\t\t\t\t\t\te.source.postMessage({\n\t\t\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\t\t\tname: er.name,\n\t\t\t\t\t\t\t\t\tmessage: er.message\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttype: \"api_error\",\n\t\t\t\t\t\t\t\tresponseToken: e.data.responseToken,\n\t\t\t\t\t\t\t\tiframeId\n\t\t\t\t\t\t\t}, \"*\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twindow.addEventListener(\"message\", prezhn_it);\n\t\t\t\t\tprezhn.push(prezhn_it);\n\t\t\t\t},\n\t\t\t\teval: function(code) {\n\t\t\t\t\tlet responseToken = crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\tiframe.contentWindow.postMessage({type: \"run\", code, responseToken, iframeId}, \"*\");\n\t\t\t\t\t\tfunction sel(e) {\n\t\t\t\t\t\t\tif (e.data.iframeId != iframeId) return;\n\t\t\t\t\t\t\tif (e.data.responseToken != responseToken) return;\n\t\t\t\t\t\t\tprezhn = prezhn.filter(x => x != sel);\n\t\t\t\t\t\t\twindow.removeEventListener(\"message\", sel);\n\t\t\t\t\t\t\tif (e.data.type == \"ran_response\")\n\t\t\t\t\t\t\t\tresolve(e.data.result);\n\t\t\t\t\t\t\telse if (e.data.type == \"ran_error\")\n\t\t\t\t\t\t\t\treject(e.data.result);\n\t\t\t\t\t\t};\n\t\t\t\t\t\twindow.addEventListener(\"message\", sel);\n\t\t\t\t\t\tprezhn.push(sel);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tcloseDown: async function() {\n\t\t\t\t\tfor (let i of prerm) await i(this);\n\t\t\t\t\tprerm = [];\n\t\t\t\t\tfor (let i in prezhn) window.removeEventListener(\"message\", prezhn[i]);\n\t\t\t\t\tiframe.remove();\n\t\t\t\t\tiframe = null;\n\t\t\t\t},\n\t\t\t\tbeforeCloseDown: function(fn) {\n\t\t\t\t\tprerm.push(fn);\n\t\t\t\t},\n\t\t\t\tiframeId\n\t\t\t});\n\t\t});\n\t});\n}\nfunction IPv6Decompressor(ip) {\n    let array = ip.split(\":\");\n    array = array.slice(0, 8);\n    let foundTwoOrMoreZeroes = array.indexOf(\"\");\n    while (array.length != 8 && foundTwoOrMoreZeroes !== null) array.splice(foundTwoOrMoreZeroes, 0, \"0000\");\n    array = array.map(a => parseInt(a || \"0\", 16).toString(16).padStart(4, \"0\"));\n    return array.join(\":\");\n}\n(async function() {\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"BLOG_BROWSER_NAME\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.body.innerText = \"\";\n    document.documentElement.style.height = \"100%\";\n\tdocument.documentElement.style.width = \"100%\";\n\tdocument.body.style.height = \"100%\";\n\tdocument.body.style.width = \"100%\";\n\tdocument.body.style.margin = \"0\";\n    let browserContainer = document.createElement(\"div\");\n    let urlBar = document.createElement(\"form\");\n    let urlInput = document.createElement(\"input\");\n    let urlButton = document.createElement(\"button\");\n    let theWebsite = document.createElement(\"div\");\n    browserContainer.style.display = \"flex\";\n    browserContainer.style.flexDirection = \"column\";\n    browserContainer.style.width = \"100%\";\n    browserContainer.style.height = \"100%\";\n    urlBar.style.display = \"flex\";\n    urlBar.style.flexDirection = \"row\";\n    urlBar.style.width = \"100%\";\n    urlInput.style.flexGrow = \"1\";\n    theWebsite.style.flexGrow = \"1\";\n    urlBar.appendChild(urlInput);\n    urlBar.appendChild(urlButton);\n    urlButton.innerText = \"->\";\n    browserContainer.appendChild(urlBar);\n    browserContainer.appendChild(theWebsite);\n    document.body.appendChild(browserContainer);\n    let ree;\n    urlButton.onclick = async function() {\n        urlInput.disabled = true;\n        urlButton.disabled = true;\n        if (ree) ree.closeDown();\n        ree = null;\n        theWebsite.hidden = false;\n        theWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n        try {\n            let url = new URL(urlInput.value);\n\t\t\turlInput.value = url.href;\n            if (url.protocol != \"bdp:\") throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_PROTO\"));\n            if (url.port) throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_GATESET\"));\n\t\t\tif (pargs[\"no-verification\"]) \n\t\t\t\tawait new Promise(async function(ok, ab) {\n\t\t\t\t\tlet allowNoVerify = document.createElement(\"button\");\n\t\t\t\t\tlet abort = document.createElement(\"button\");\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_NOVERIFY\");\n\t\t\t\t\tallowNoVerify.innerText = await availableAPIs.lookupLocale(\"YES\");\n\t\t\t\t\tabort.innerText = await availableAPIs.lookupLocale(\"NO\");\n\t\t\t\t\tallowNoVerify.onclick = async function() {\n\t\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\t\t\t\t\tok();\n\t\t\t\t\t}\n\t\t\t\t\tabort.onclick = async _ => ab(new Error(await availableAPIs.lookupLocale(\"SERVER_SIGNATURE_VERIFICATION_FAILED\")));\n\t\t\t\t\ttheWebsite.appendChild(allowNoVerify);\n\t\t\t\t\ttheWebsite.appendChild(abort);\n\t\t\t\t});\n\t\t\tif (pargs[\"no-sandbox\"]) \n\t\t\t\tawait new Promise(async function(ok, ab) {\n\t\t\t\t\tlet allowNoVerify = document.createElement(\"button\");\n\t\t\t\t\tlet abort = document.createElement(\"button\");\n\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_NOSANDBOX\");\n\t\t\t\t\tallowNoVerify.innerText = await availableAPIs.lookupLocale(\"YES\");\n\t\t\t\t\tabort.innerText = await availableAPIs.lookupLocale(\"NO\");\n\t\t\t\t\tallowNoVerify.onclick = async function() {\n\t\t\t\t\t\ttheWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING\");\n\t\t\t\t\t\tok();\n\t\t\t\t\t}\n\t\t\t\t\tabort.onclick = async _ => ab(new Error(await availableAPIs.lookupLocale(\"PERMISSION_DENIED\")));\n\t\t\t\t\ttheWebsite.appendChild(allowNoVerify);\n\t\t\t\t\ttheWebsite.appendChild(abort);\n\t\t\t\t});\n            let hostname = url.hostname, address;\n            if (url.hostname.includes(\"[\")) {\n                hostname = IPv6Decompressor(url.hostname.slice(1, -1)).replaceAll(\":\", \"\");\n                address = hostname;\n            } else address = await availableAPIs.resolve(hostname);\n            if (!address) throw new Error(await availableAPIs.lookupLocale(\"HOSTNAME_RESOLUTION_FAILED\"));\n            let connection = await availableAPIs.connfulConnect({\n                gate: url.username || \"blog\",\n                address,\n                verifyByDomain: hostname,\n\t\t\t\tkey: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: pargs.key\n\t\t\t\t})).key : undefined,\n\t\t\t\tprivate: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\t\tpath: pargs.key\n\t\t\t\t})).private : undefined,\n\t\t\t\tdoNotVerifyServer: pargs[\"no-verification\"]\n            });\n            await availableAPIs.connfulConnectionSettled(connection);\n            await availableAPIs.connfulWrite({\n                connectionID: connection,\n                data: url.pathname + url.search\n            });\n            let data = await availableAPIs.connfulRead(connection);\n            data = JSON.parse(data);\n\t\t\tlet chunks = [];\n\t\t\ttheWebsite.innerText = (await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING_PROGRESS\")).replace(\"%s\", \"0\").replace(\"%s\", data.length);\n\t\t\twhile (chunks.length != data.length) {\n\t\t\t\tlet newData = await availableAPIs.connfulRead(connection);\n\t\t\t\tnewData = JSON.parse(newData);\n\t\t\t\tchunks[newData.ctr] = newData.chunk;\n\t\t\t\ttheWebsite.innerText = (await availableAPIs.lookupLocale(\"BLOG_BROWSER_LOADING_PROGRESS\")).replace(\"%s\", chunks.length).replace(\"%s\", data.length);\n\t\t\t}\n            try {\n                await availableAPIs.connfulClose(connection);\n            } catch {}\n\t\t\tdata.content = chunks.join(\"\");\n            if (data.type == \"script\") {\n                theWebsite.innerText = \"\";\n                ree = await createREE(browserContainer);\n                ree.iframe.style = \"flex-grow: 1; border: none; overflow: auto;\";\n                theWebsite.hidden = true;\n\t\t\t\tlet passthroughAPIs = [\n\t\t\t\t\t// UI class\n\t\t\t\t\t\"isDarkThemed\", \"locale\", \"osLocale\", \"lookupLocale\", \"installedLocales\",\n\t\t\t\t\t// cryptographic class\n\t\t\t\t\t\"cspOperations\", \"availableCsps\",\n\t\t\t\t\t// connful connections class\n\t\t\t\t\t\"connfulConnect\", \"connfulConnectionSettled\", \"connfulDisconnect\", \"connfulForceDisconnect\", \"connfulWrite\", \"connfulRead\", \"connfulAddressGet\", \"connfulIdentityGet\"\n\t\t\t\t];\n\t\t\t\tif (pargs[\"no-sandbox\"]) passthroughAPIs = Object.keys(availableAPIs);\n\t\t\t\tfor (let api of passthroughAPIs) await ree.exportAPI(api, e => availableAPIs[api](e.arg));\n                await ree.exportAPI(\"terminate\", _ => ree.closeDown());\n                await ree.exportAPI(\"navigate\", function(newUrl) {\n                    urlInput.value = new URL(newUrl.arg, urlInput.value).href;\n                    urlButton.click();\n                    ree.closeDown();\n                });\n                await ree.exportAPI(\"currentLocation\", _ => urlInput.value);\n                ree.beforeCloseDown(async function() {\n                    theWebsite.hidden = false;\n                    theWebsite.innerText = await availableAPIs.lookupLocale(\"BLOG_BROWSER_POSTCLOSE\");\n                });\n                await ree.eval(data.content);\n            } else if (data.type == \"file\") {\n                theWebsite.innerHTML = await availableAPIs.lookupLocale(\"BLOG_BROWSER_FILEPOST\");\n                let ipcPipe = await availableAPIs.createPipe();\n                await availableAPIs.windowVisibility(false);\n                await availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n                let result = await availableAPIs.listenToPipe(ipcPipe);\n                await availableAPIs.closePipe(ipcPipe);\n                await availableAPIs.windowVisibility(true);\n                if (result.success) {\n                    await availableAPIs.fs_write({ path: result.selected, data: data.content });\n                    theWebsite.innerHTML = await availableAPIs.lookupLocale(\"BLOG_BROWSER_DLFILEPOST\");\n                }\n            }\n        } catch (e) {\n\t\t\tif (ree) ree.closeDown();\n\t\t\ttheWebsite.hidden = false;\n            theWebsite.innerText = await availableAPIs.lookupLocale(e.message);\n        }\n        urlInput.disabled = false;\n        urlButton.disabled = false;\n    }\n\tif (ppos[0]) {\n\t\turlInput.value = ppos[0];\n\t\turlButton.click();\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/calculator.js
async function calculatorInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "calculator" + ".js";
	let linkPath = target + "/apps/links/" + "calculator" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "CALC_TITLE" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:CALC_TITLE\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_THEME\n// signature: 8bfbdc7bd9c4d9d587194e159e846576ead17642fae8938271f8cfc8e372ed20708f9443f02104b7dee4e29ae6673e8131033c7521d682dbdf79071a30269ecc\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"CALC_TITLE\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.body.innerText = \"\";\n\tlet pageHeader = document.createElement(\"b\");\n\tlet dividePageHeader = document.createElement(\"hr\");\n\tlet page = document.createElement(\"div\");\n\tdocument.body.appendChild(pageHeader);\n\tdocument.body.appendChild(dividePageHeader);\n\tdocument.body.appendChild(page);\n\tasync function mainPage() {\n\t\tpageHeader.innerText = await availableAPIs.lookupLocale(\"CALC_BASIC_MODE\");\n\t\tpage.innerText = \"\";\n\t\tlet advmode = document.createElement(\"button\");\n\t\tlet add = document.createElement(\"button\");\n\t\tlet subtract = document.createElement(\"button\");\n\t\tlet multiply = document.createElement(\"button\");\n\t\tlet divide = document.createElement(\"button\");\n\t\t\n\t\tadvmode.innerText = await availableAPIs.lookupLocale(\"CALC_ADVMODE_BTN\");\n\t\tadd.innerText = await availableAPIs.lookupLocale(\"CALC_ADD\");\n\t\tsubtract.innerText = await availableAPIs.lookupLocale(\"CALC_SUBTRACT\");\n\t\tmultiply.innerText = await availableAPIs.lookupLocale(\"CALC_MULTIPLY\");\n\t\tdivide.innerText = await availableAPIs.lookupLocale(\"CALC_DIVIDE\");\n\n\t\tadvmode.onclick = advPage;\n\t\tadd.onclick = basicModeActionBuilder(\"ADD\");\n\t\tsubtract.onclick = basicModeActionBuilder(\"SUBTRACT\");\n\t\tmultiply.onclick = basicModeActionBuilder(\"MULTIPLY\");\n\t\tdivide.onclick = basicModeActionBuilder(\"DIVIDE\");\n\t\t\n\t\tpage.appendChild(advmode);\n\t\tpage.appendChild(add);\n\t\tpage.appendChild(subtract);\n\t\tpage.appendChild(multiply);\n\t\tpage.appendChild(divide);\n\t}\n\n\tmainPage();\n\n\tasync function advPage() {\n\t\tpageHeader.innerText = await availableAPIs.lookupLocale(\"CALC_ADVANCED_MODE\");\n\t\tpage.innerText = \"\";\n\t\tlet basicmode = document.createElement(\"button\");\n\t\tlet add = document.createElement(\"button\");\n\t\tlet subtract = document.createElement(\"button\");\n\t\tlet multiply = document.createElement(\"button\");\n\t\tlet divide = document.createElement(\"button\");\n\t\tlet toMixed = document.createElement(\"button\");\n\t\tlet toImproper = document.createElement(\"button\");\n\t\tlet gcd = document.createElement(\"button\");\n\t\tlet factorial = document.createElement(\"button\");\n\t\t\n\t\tbasicmode.innerText = await availableAPIs.lookupLocale(\"CALC_BASICMODE_BTN\");\n\t\tadd.innerText = await availableAPIs.lookupLocale(\"CALC_ADD\");\n\t\tsubtract.innerText = await availableAPIs.lookupLocale(\"CALC_SUBTRACT\");\n\t\tmultiply.innerText = await availableAPIs.lookupLocale(\"CALC_MULTIPLY\");\n\t\tdivide.innerText = await availableAPIs.lookupLocale(\"CALC_DIVIDE\");\n\t\ttoMixed.innerText = await availableAPIs.lookupLocale(\"CALC_TOMIXED_BTN\");\n\t\ttoImproper.innerText = await availableAPIs.lookupLocale(\"CALC_TOIMPR_BTN\");\n\t\tgcd.innerText = await availableAPIs.lookupLocale(\"CALC_GCD\");\n\t\tfactorial.innerText = await availableAPIs.lookupLocale(\"CALC_FACTORIAL\");\n\n\t\tbasicmode.onclick = mainPage;\n\t\tadd.onclick = advancedModeActionBuilder(\"ADD\");\n\t\tsubtract.onclick = advancedModeActionBuilder(\"SUBTRACT\");\n\t\tmultiply.onclick = advancedModeActionBuilder(\"MULTIPLY\");\n\t\tdivide.onclick = advancedModeActionBuilder(\"DIVIDE\");\n\t\ttoMixed.onclick = toMixedPage;\n\t\ttoImproper.onclick = toImproperPage;\n\t\tgcd.onclick = gcdPage;\n\t\tfactorial.onclick = factorialPage;\n\t\t\n\t\tpage.appendChild(basicmode);\n\t\tpage.appendChild(add);\n\t\tpage.appendChild(subtract);\n\t\tpage.appendChild(multiply);\n\t\tpage.appendChild(divide);\n\t\tpage.appendChild(toMixed);\n\t\tpage.appendChild(toImproper);\n\t\tpage.appendChild(gcd);\n\t\tpage.appendChild(factorial);\n\t}\n\n\tfunction basicModeActionBuilder(sign) {\n\t\treturn async function() {\n\t\t\tpage.innerText = \"\";\n\t\t\tpageHeader.innerText = \"\";\n\n\t\t\tlet backButton = document.createElement(\"button\");\n\t\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\t\tlet operand1 = document.createElement(\"input\");\n\t\t\tlet operationSign = document.createElement(\"span\");\n\t\t\tlet operand2 = document.createElement(\"input\");\n\t\t\tlet result = document.createElement(\"input\");\n\t\t\tlet compute = document.createElement(\"button\");\n\t\t\tpageHeader.appendChild(backButton);\n\t\t\tpageHeader.appendChild(pageHeaderText);\n\n\t\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CALC_\" + sign);\n\t\t\tif (sign == \"ADD\") operationSign.innerText = \"+\";\n\t\t\tif (sign == \"SUBTRACT\") operationSign.innerText = \"-\";\n\t\t\tif (sign == \"MULTIPLY\") operationSign.innerText = \"*\";\n\t\t\tif (sign == \"DIVIDE\") operationSign.innerText = \"/\";\n\t\t\tcompute.innerText = \"=\";\n\t\t\toperand1.value = 0;\n\t\t\toperand2.value = 0;\n\t\t\toperand1.placeholder = (await availableAPIs.lookupLocale(\"CALC_OPERAND\")).replace(\"%s\", 1);\n\t\t\toperand2.placeholder = (await availableAPIs.lookupLocale(\"CALC_OPERAND\")).replace(\"%s\", 2);\n\t\t\toperand1.type = \"number\";\n\t\t\toperand2.type = \"number\";\n\t\t\tresult.type = \"number\";\n\t\t\tresult.readOnly = true;\n\n\t\t\tbackButton.innerText = \"<-\";\n\t\t\tbackButton.onclick = mainPage;\n\n\t\t\tpage.appendChild(operand1);\n\t\t\tpage.insertAdjacentText(\"beforeend\", \" \");\n\t\t\tpage.appendChild(operationSign);\n\t\t\tpage.insertAdjacentText(\"beforeend\", \" \");\n\t\t\tpage.appendChild(operand2);\n\t\t\tpage.insertAdjacentText(\"beforeend\", \" \");\n\t\t\tpage.appendChild(compute);\n\t\t\tpage.insertAdjacentText(\"beforeend\", \" \");\n\t\t\tpage.appendChild(result);\n\n\t\t\tcompute.onclick = function() {\n\t\t\t\tif (sign == \"ADD\") result.value = parseInt(operand1.value) + parseInt(operand2.value);\n\t\t\t\tif (sign == \"SUBTRACT\") result.value = parseInt(operand1.value) - parseInt(operand2.value);\n\t\t\t\tif (sign == \"MULTIPLY\") result.value = parseInt(operand1.value) * parseInt(operand2.value);\n\t\t\t\tif (sign == \"DIVIDE\") result.value = parseInt(operand1.value) / parseInt(operand2.value);\n\t\t\t}\n\t\t}\n\t}\n\tfunction advancedModeActionBuilder(sign) {\n\t\treturn async function() {\n\t\t\tpage.innerText = \"\";\n\t\t\tpageHeader.innerText = \"\";\n\n\t\t\tlet backButton = document.createElement(\"button\");\n\t\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\t\tlet container = document.createElement(\"div\");\n\t\t\tlet operand1 = document.createElement(\"div\");\n\t\t\tlet operationSignContainer = document.createElement(\"div\");\n\t\t\tlet operationSign = document.createElement(\"p\");\n\t\t\tlet operand2 = document.createElement(\"div\");\n\t\t\tlet result = document.createElement(\"div\");\n\t\t\tlet compute = document.createElement(\"button\");\n\t\t\tlet operand1Numerator = document.createElement(\"input\");\n\t\t\tlet operand1Denominator = document.createElement(\"input\");\n\t\t\tlet operand2Numerator = document.createElement(\"input\");\n\t\t\tlet operand2Denominator = document.createElement(\"input\");\n\t\t\tlet resultNumerator = document.createElement(\"input\");\n\t\t\tlet resultDenominator = document.createElement(\"input\");\n\t\t\tlet hr1 = document.createElement(\"hr\");\n\t\t\tlet hr2 = document.createElement(\"hr\");\n\t\t\tlet hr3 = document.createElement(\"hr\");\n\t\t\tpageHeader.appendChild(backButton);\n\t\t\tpageHeader.appendChild(pageHeaderText);\n\n\t\t\tcontainer.style = \"display: flex; width: fit-content;\";\n\t\t\toperand1.style = \"display: flex; flex-direction: column;\";\n\t\t\toperationSignContainer.style = \"display: flex; flex-direction: column; padding: 0 4px;\";\n\t\t\toperand2.style = \"display: flex; flex-direction: column;\";\n\t\t\tresult.style = \"display: flex; flex-direction: column;\";\n\t\t\t[hr1, hr2, hr3].map(a => a.style = \"width: 100%;\");\n\n\t\t\toperand1.appendChild(operand1Numerator);\n\t\t\toperand1.appendChild(hr1);\n\t\t\toperand1.appendChild(operand1Denominator);\n\t\t\toperationSignContainer.appendChild(document.createElement(\"div\"));\n\t\t\toperationSignContainer.appendChild(operationSign);\n\t\t\toperand2.appendChild(operand2Numerator);\n\t\t\toperand2.appendChild(hr2);\n\t\t\toperand2.appendChild(operand2Denominator);\n\t\t\tresult.appendChild(resultNumerator);\n\t\t\tresult.appendChild(hr3);\n\t\t\tresult.appendChild(resultDenominator);\n\t\t\tcontainer.appendChild(operand1);\n\t\t\tcontainer.appendChild(operationSignContainer);\n\t\t\tcontainer.appendChild(operand2);\n\t\t\tcontainer.appendChild(compute);\n\t\t\tcontainer.appendChild(result);\n\n\t\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CALC_\" + sign);\n\t\t\tif (sign == \"ADD\") operationSign.innerText = \"+\";\n\t\t\tif (sign == \"SUBTRACT\") operationSign.innerText = \"-\";\n\t\t\tif (sign == \"MULTIPLY\") operationSign.innerText = \"*\";\n\t\t\tif (sign == \"DIVIDE\") operationSign.innerText = \"/\";\n\t\t\tcompute.innerText = \"=\";\n\t\t\tresultNumerator.readOnly = true;\n\t\t\tresultDenominator.readOnly = true;\n\n\t\t\tbackButton.innerText = \"<-\";\n\t\t\tbackButton.onclick = advPage;\n\n\t\t\tpage.appendChild(container);\n\n\t\t\tcompute.onclick = function() {\n\t\t\t\tlet fraction1 = fraction(BigInt(operand1Numerator.value), BigInt(operand1Denominator.value)).simplify();\n\t\t\t\tlet fraction2 = fraction(BigInt(operand2Numerator.value), BigInt(operand2Denominator.value)).simplify();\n\t\t\t\tlet result = fraction1[sign.toLowerCase()](fraction2);\n\t\t\t\tresultNumerator.value = result.numerator;\n\t\t\t\tresultDenominator.value = result.denominator;\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function toMixedPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tlet container = document.createElement(\"div\");\n\t\tlet operand1 = document.createElement(\"div\");\n\t\tlet result = document.createElement(\"div\");\n\t\tlet compute = document.createElement(\"button\");\n\t\tlet operandNumerator = document.createElement(\"input\");\n\t\tlet operandDenominator = document.createElement(\"input\");\n\t\tlet resultWholes = document.createElement(\"input\");\n\t\tlet resultNumerator = document.createElement(\"input\");\n\t\tlet resultDenominator = document.createElement(\"input\");\n\t\tlet hr1 = document.createElement(\"hr\");\n\t\tlet hr2 = document.createElement(\"hr\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\n\t\tcontainer.style = \"display: flex; width: fit-content;\";\n\t\toperand1.style = \"display: flex; flex-direction: column;\";\n\t\tresult.style = \"display: flex; flex-direction: column;\";\n\t\t[hr1, hr2].map(a => a.style = \"width: 100%;\");\n\n\t\toperand1.appendChild(operandNumerator);\n\t\toperand1.appendChild(hr1);\n\t\toperand1.appendChild(operandDenominator);\n\t\tresult.appendChild(resultNumerator);\n\t\tresult.appendChild(hr2);\n\t\tresult.appendChild(resultDenominator);\n\t\tcontainer.appendChild(operand1);\n\t\tcontainer.appendChild(compute);\n\t\tcontainer.appendChild(resultWholes);\n\t\tcontainer.appendChild(result);\n\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CALC_TOMIXED_BTN\");\n\t\tcompute.innerText = \"=\";\n\t\tresultWholes.readOnly = true;\n\t\tresultNumerator.readOnly = true;\n\t\tresultDenominator.readOnly = true;\n\n\t\tbackButton.innerText = \"<-\";\n\t\tbackButton.onclick = advPage;\n\n\t\tpage.appendChild(container);\n\n\t\tcompute.onclick = function() {\n\t\t\tlet fraction1 = fraction(BigInt(operandNumerator.value), BigInt(operandDenominator.value)).simplify();\n\t\t\tlet cleanNum = abs(fraction1.cleanNumerator());\n\t\t\tlet wholes = fraction1.getWholes();\n\t\t\tresultWholes.value = wholes || (fraction1.numerator < 0 ? \"-\" : \"\");\n\t\t\tresultNumerator.value = cleanNum;\n\t\t\tresultDenominator.value = fraction1.denominator;\n\t\t}\n\t}\n\n\tasync function toImproperPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tlet container = document.createElement(\"div\");\n\t\tlet operand1 = document.createElement(\"div\");\n\t\tlet result = document.createElement(\"div\");\n\t\tlet compute = document.createElement(\"button\");\n\t\tlet operandWholes = document.createElement(\"input\");\n\t\tlet operandNumerator = document.createElement(\"input\");\n\t\tlet operandDenominator = document.createElement(\"input\");\n\t\tlet resultNumerator = document.createElement(\"input\");\n\t\tlet resultDenominator = document.createElement(\"input\");\n\t\tlet hr1 = document.createElement(\"hr\");\n\t\tlet hr2 = document.createElement(\"hr\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\n\t\tcontainer.style = \"display: flex; width: fit-content;\";\n\t\toperand1.style = \"display: flex; flex-direction: column;\";\n\t\tresult.style = \"display: flex; flex-direction: column;\";\n\t\t[hr1, hr2].map(a => a.style = \"width: 100%;\");\n\n\t\toperand1.appendChild(operandNumerator);\n\t\toperand1.appendChild(hr1);\n\t\toperand1.appendChild(operandDenominator);\n\t\tresult.appendChild(resultNumerator);\n\t\tresult.appendChild(hr2);\n\t\tresult.appendChild(resultDenominator);\n\t\tcontainer.appendChild(operandWholes);\n\t\tcontainer.appendChild(operand1);\n\t\tcontainer.appendChild(compute);\n\t\tcontainer.appendChild(result);\n\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CALC_TOIMPR_BTN\");\n\t\tcompute.innerText = \"=\";\n\t\tresultNumerator.readOnly = true;\n\t\tresultDenominator.readOnly = true;\n\n\t\tbackButton.innerText = \"<-\";\n\t\tbackButton.onclick = advPage;\n\n\t\tpage.appendChild(container);\n\n\t\tcompute.onclick = function() {\n\t\t\tlet sign = operandWholes.value < 0 ? -1 : 1;\n\t\t\tlet fraction1;\n\t\t\tif (operandWholes.value == \"-\") fraction1 = fraction(-BigInt(operandNumerator.value), BigInt(operandDenominator.value)).simplify();\n\t\t\telse fraction1 = fraction(BigInt(operandDenominator.value) * BigInt(operandWholes.value) + BigInt(operandNumerator.value * sign), BigInt(operandDenominator.value)).simplify();\n\t\t\tresultNumerator.value = fraction1.numerator;\n\t\t\tresultDenominator.value = fraction1.denominator;\n\t\t}\n\t}\n\n\tasync function gcdPage() {\n\t\tpageHeader.innerText = \"\";\n\t\tpage.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tlet operand1 = document.createElement(\"input\");\n\t\tlet operand2 = document.createElement(\"input\");\n\t\tlet result = document.createElement(\"input\");\n\t\tlet compute = document.createElement(\"button\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CALC_GCD_PAGE\");\n\t\tcompute.innerText = \"=\";\n\n\t\toperand1.value = 0;\n\t\toperand2.value = 0;\n\t\toperand1.placeholder = (await availableAPIs.lookupLocale(\"CALC_OPERAND\")).replace(\"%s\", 1);\n\t\toperand2.placeholder = (await availableAPIs.lookupLocale(\"CALC_OPERAND\")).replace(\"%s\", 2);\n\t\tresult.readOnly = true;\n\n\t\tpage.insertAdjacentText(\"beforeend\", \"gcd(\");\n\t\tpage.appendChild(operand1);\n\t\tpage.insertAdjacentText(\"beforeend\", \", \");\n\t\tpage.appendChild(operand2);\n\t\tpage.insertAdjacentText(\"beforeend\", \") \");\n\t\tpage.appendChild(compute);\n\t\tpage.insertAdjacentText(\"beforeend\", \" \");\n\t\tpage.appendChild(result);\n\n\t\tbackButton.onclick = advPage;\n\t\tcompute.onclick = function() {\n\t\t\tresult.value = gcd(BigInt(operand1.value), BigInt(operand2.value));\n\t\t}\n\t}\n\n\tasync function factorialPage() {\n\t\tpageHeader.innerText = \"\";\n\t\tpage.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tlet operand = document.createElement(\"input\");\n\t\tlet result = document.createElement(\"input\");\n\t\tlet compute = document.createElement(\"button\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CALC_FACTORIAL\");\n\t\tcompute.innerText = \"=\";\n\n\t\toperand.value = 0;\n\t\toperand.placeholder = (await availableAPIs.lookupLocale(\"CALC_OPERAND\")).replace(\"%s\", \"\");\n\t\tresult.readOnly = true;\n\n\t\tpage.appendChild(operand);\n\t\tpage.insertAdjacentText(\"beforeend\", \"! \");\n\t\tpage.appendChild(compute);\n\t\tpage.insertAdjacentText(\"beforeend\", \" \");\n\t\tpage.appendChild(result);\n\n\t\tbackButton.onclick = advPage;\n\t\tcompute.onclick = function() {\n\t\t\tlet resultValue = 1n;\n\t\t\tfor (let i = 1n; i <= BigInt(operand.value); i++) resultValue *= i;\n\t\t\tresult.value = resultValue;\n\t\t}\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;\n\n// Fractions\nlet gcd = (a, b) => !abs(b) ? abs(a) : gcd(abs(b), abs(a % b));\nlet abs = (a) => a < 0n ? (a * (-1n)) : a;\n\nfunction fraction(a, b) {\n\tif (typeof a !== \"bigint\") throw new Error(\"Failed to construct fraction\");\n\tif (typeof b !== \"bigint\") throw new Error(\"Failed to construct fraction\");\n\tif (!b) throw new Error(\"Failed to construct fraction\");\n\treturn {\n\t\tnumerator: a,\n\t\tdenominator: b,\n\t\tgetWholes: function() {\n\t\t\treturn a / b;\n\t\t},\n\t\tcleanNumerator: function() {\n\t\t\treturn a % b;\n\t\t},\n\t\tmultiply: function(otherFraction) {\n\t\t\treturn fraction(otherFraction.numerator * a, otherFraction.denominator * b).simplify();\n\t\t},\n\t\tdivide: function(otherFraction) {\n\t\t\treturn fraction(otherFraction.denominator * a, otherFraction.numerator * b).simplify();\n\t\t},\n\t\tadd: function(otherFraction) {\n\t\t\tlet cleanOtherFraction = otherFraction.simplify();\n\t\t\tlet lcm = (cleanOtherFraction.denominator * b) / gcd(cleanOtherFraction.denominator, b);\n\t\t\tlet adaptedNumerator1 = a * (lcm / b);\n\t\t\tlet adaptedNumerator2 = cleanOtherFraction.numerator * (lcm / cleanOtherFraction.denominator);\n\t\t\treturn fraction(adaptedNumerator1 + adaptedNumerator2, lcm).simplify();\n\t\t},\n\t\tsubtract: function(otherFraction) {\n\t\t\tlet cleanOtherFraction = otherFraction.simplify();\n\t\t\tlet lcm = (cleanOtherFraction.denominator * b) / gcd(cleanOtherFraction.denominator, b);\n\t\t\tlet adaptedNumerator1 = a * (lcm / b);\n\t\t\tlet adaptedNumerator2 = cleanOtherFraction.numerator * (lcm / cleanOtherFraction.denominator);\n\t\t\treturn fraction(adaptedNumerator1 - adaptedNumerator2, lcm).simplify();\n\t\t},\n\t\tsimplify: function() {\n\t\t\tlet commonDiv = gcd(a, b);\n\t\t\tif ((a < 0 && b < 0) || (b < 0 && a > 0)) {\n\t\t\t\ta = a * (-1);\n\t\t\t\tb = b * (-1);\n\t\t\t}\n\t\t\treturn fraction(a / commonDiv, b / commonDiv);\n\t\t}\n\t}\n}", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/cat.js
async function catInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "cat" + ".js";
	let linkPath = target + "/apps/links/" + "cat" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_BYPASS_PERMISSIONS\n// signature: 22d8e68b96fd2706d8f3eb140989487e5acacfbf80f5cd1ee294ead321a4367fdc19b60199f3ee11ffd620329516039a582dde86dd6cf46b9421d6a0ebab37c7\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"cat: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CAT_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CAT_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"cat: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tfor (let file of exec_args) {\n\t\ttry {\n\t\t\tlet data = await availableAPIs.fs_read({ path: file });\n\t\t\tawait availableAPIs.toMyCLI(data);\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"cat: \" + file + \": \" + await availableAPIs.lookupLocale(e.message));\n\t\t}\n\t}\n\tawait availableAPIs.toMyCLI(\"\\r\\n\");\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/chgrp.js
async function chgrpInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "chgrp" + ".js";
	let linkPath = target + "/apps/links/" + "chgrp" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_CHANGE_PERMISSION, FS_BYPASS_PERMISSIONS\n// signature: 6d5771cdaec086166d507095d5cfe3f6c3ef6178ee749aec61df2262429d13cf28f9aae2bdf7d33f51aa71b9d10d308c8a5ae8d2ccb519523cf03a65b1353d89\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"chgrp: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHGRP_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHGRP_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"chgrp: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.fs_chgrp({ path: exec_args[1], newGrp: exec_args[0] });\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"chgrp: \" + exec_args[1] + \": \" + await availableAPIs.lookupLocale(e.message)) + \"\\r\\n\";\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/chmod.js
async function chmodInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "chmod" + ".js";
	let linkPath = target + "/apps/links/" + "chmod" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_CHANGE_PERMISSION, FS_BYPASS_PERMISSIONS\n// signature: 706e5ded0fefc554856ad6f1da36e4f80c9daba575c9f1e025d0dd0ee291bc95da6f8e4de9f0d7c4163bd7fca9cadd0d19ac67e480a95280c6b7cdb62f7a4dc5\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"chmod: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHMOD_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHMOD_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"CHMOD_MODE_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"CHMOD_MODE_CONVERT\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"chmod: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.fs_chmod({ path: exec_args[1], newPermissions: exec_args[0] });\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"chmod: \" + exec_args[1] + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/chown.js
async function chownInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "chown" + ".js";
	let linkPath = target + "/apps/links/" + "chown" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_CHANGE_PERMISSION, FS_BYPASS_PERMISSIONS\n// signature: c34a81f50906cf3d66d74dae978b0220ed818ab41ebf184857e10e88407bcba1a956942e641713ac3a7ccddbc6bf69d206d83a4f65310616895719a49eda8e91\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"chown: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHOWN_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CHOWN_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"chown: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.fs_chown({ path: exec_args[1], newUser: exec_args[0] });\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"chown: \" + exec_args[1] + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/consentui.js
async function consentuiInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "consentui" + ".js";
	let linkPath = target + "/apps/links/" + "consentui" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: IPC_SEND_PIPE, GET_LOCALE, GET_THEME, ELEVATE_PRIVILEGES, FS_READ, FS_LIST_PARTITIONS, CSP_OPERATIONS\n// signature: a7123efc50fb7f6b69f9d6f4a9243f60998cd052ad8f4a6dc8687e95bd17e2473fb4c31c72d5d02abc064324af2d42b6857b6bfb6d2ac03e9d1e90708906e3c9\n// =====END MANIFEST=====\n\nlet ipc;\n(async function() {\n\t// @pcos-app-mode isolatable\n\texec_args = await availableAPIs.getPrivateData() || [];\n\tif (!(exec_args instanceof Array)) return availableAPIs.terminate();\n\tipc = exec_args[0];\n\tif (!ipc) return availableAPIs.terminate();\n\tlet user = exec_args[1];\n\ttry {\n\t\tnew Audio(await availableAPIs.fs_read({ path: (await availableAPIs.getSystemMount()) + \"/etc/sounds/ask.aud\" })).play();\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"ACCESS_REQUEST_TITLE\"));\n\tlet checklist = [ \"IPC_SEND_PIPE\", \"GET_LOCALE\", \"GET_THEME\", \"ELEVATE_PRIVILEGES\", \"CSP_OPERATIONS\" ];\n\tlet privileges = await availableAPIs.getPrivileges();\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tif (privileges.includes(\"IPC_SEND_PIPE\")) await availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: false } });\n\t\treturn availableAPIs.terminate();\n\t}\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet describe = document.createElement(\"span\");\n\tlet form = document.createElement(\"form\");\n\tlet input = document.createElement(\"input\");\n\tlet decline = document.createElement(\"button\");\n\tlet submit = document.createElement(\"button\");\n\tlet metadata = JSON.parse(exec_args[2]);\n\tdecline.type = \"button\";\n\tsubmit.type = \"submit\";\n\tdocument.body.appendChild(describe);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tdocument.body.appendChild(form);\n\tform.appendChild(input);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(decline);\n\tform.appendChild(submit);\n\tdescribe.innerText = (await availableAPIs.lookupLocale(\"DESCRIBE_TEMPLATE\")).replace(\"%s\", metadata.path.split(\"/\").pop()).replace(\"%s\", metadata.submittedName || metadata.path.split(\"/\").pop()).replace(\"%s\", metadata.submittedIntent);\n\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\tdecline.innerText = await availableAPIs.lookupLocale(\"DECLINE\");\n\tsubmit.innerText = await availableAPIs.lookupLocale(\"NEXT\");\n\n\tasync function extraData(e) {\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tdescribe.innerText = (await availableAPIs.lookupLocale(\"EXTRA_DESCRIBE_TEMPLATE\")).replace(\"%s\", metadata.path).replace(\"%s\", metadata.submittedName || metadata.path.split(\"/\").pop()).replace(\"%s\", JSON.stringify(metadata.args)).replace(\"%s\", metadata.submittedIntent);\n\t\tdescribe.removeEventListener(\"contextmenu\", extraData);\n\t}\n\n\tdescribe.addEventListener(\"contextmenu\", extraData);\n\n\tasync function userSubmit(e) {\n\t\tdescribe.removeEventListener(\"contextmenu\", extraData);\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tlet userLogonSession;\n\t\tlet userLogonID;\n\t\tlet desired_username = input.value;\n\t\ttry {\n\t\t\tuserLogonID = await availableAPIs.automatedLogonCreate({ desiredUser: desired_username });\n\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t} catch {\n\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\tinput.type = \"text\";\n\t\t\tinput.disabled = !!user;\n\t\t\tsubmit.disabled = false;\n\t\t\tinput.value = user || \"\";\n\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\treturn;\n\t\t}\n\t\tasync function updateProgress() {\n\t\t\tsubmit.removeEventListener(\"click\", userSubmit);\n\t\t\tinput.value = \"\";\n\t\t\tif (userLogonSession.success != \"intermediate\") await availableAPIs.automatedLogonDelete(userLogonID);\n\t\t\tif (userLogonSession.success == true) {\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: userLogonSession });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t}\n\t\t\tif (userLogonSession.success == false) {\n\t\t\t\tdescribe.innerText = await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \" \" + await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\t\t\tinput.type = \"text\";\n\t\t\t\tinput.disabled = !!user;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tinput.value = user || \"\";\n\t\t\t\tsubmit.addEventListener(\"click\", userSubmit);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdescribe.innerText = \"[\" + desired_username + \"] \" + userLogonSession.message;\n\t\t\tinput.placeholder = await availableAPIs.lookupLocale(\"RESPONSE_PLACEHOLDER\");\n\t\t\tinput.type = userLogonSession.type == \"password\" ? \"password\" : \"text\";\n\t\t\tinput.disabled = !userLogonSession.wantsUserInput;\n\t\t\tsubmit.disabled = !userLogonSession.wantsUserInput;\n\t\t\tif (userLogonSession.type == \"zkpp_password\") input.type = \"password\";\n\t\t\tif (userLogonSession.type == \"promise\") {\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t}\n\t\t\tif (userLogonSession.type == \"informative\") {\n\t\t\t\tinput.disabled = true;\n\t\t\t\tsubmit.disabled = false;\n\t\t\t\tinput.placeholder = \"\";\n\t\t\t}\n\t\t\tsubmit.addEventListener(\"click\", async function updater(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tsubmit.removeEventListener(\"click\", updater);\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\ttry {\n\t\t\t\t\tinput.disabled = true;\n\t\t\t\t\tsubmit.disabled = true;\n\t\t\t\t\tif (userLogonSession.type == \"zkpp_password\") {\n\t\t\t\t\t\tlet passwordAsKey = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(input.value),\n\t\t\t\t\t\t\t\talgorithm: \"PBKDF2\",\n\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tlet rngSeed = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseKey: passwordAsKey,\n\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\tcspArgument: passwordAsKey\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\tlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\n\t\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: userLogonID, input: u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\toperation: \"sign\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tsecretKey: (await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\t\t\t\t\tseed: new Uint8Array(rngSeed)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})).secretKey,\n\t\t\t\t\t\t\t\tmessage: hexToU8A(userLogonSession.challenge)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}))});\n\t\t\t\t\t} else await availableAPIs.automatedLogonInput({ session: userLogonID, input: input.value });\n\t\t\t\t\tuserLogonSession = await availableAPIs.automatedLogonGet(userLogonID);\n\t\t\t\t} catch {}\n\t\t\t\treturn await updateProgress();\n\t\t\t});\n\t\t}\n\t\tawait updateProgress();\n\t\treturn false;\n\t}\n\tsubmit.addEventListener(\"click\", userSubmit);\n\tdecline.addEventListener(\"click\", async function() {\n\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: true } });\n\t\tawait availableAPIs.terminate();\n\t});\n\tif (user) {\n\t\tinput.disabled = true;\n\t\tinput.value = user;\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tawait availableAPIs.sendToPipe({ pipe: ipc, data: { success: false, cancelled: true } });\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/cp.js
async function cpInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "cp" + ".js";
	let linkPath = target + "/apps/links/" + "cp" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, FS_CHANGE_PERMISSION\n// signature: 6307462bbc06b3d20a5d970dfb4b477eb23a692b370e60d4076d9b9e7bee26844efd773fac1e64753b382718c0711e18739a7e0dfab3d55d3a82c8d6b6dc2165\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"cp: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CP_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"CP_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"OPT_RECURSIVE_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"OPT_FORCE_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"CP_PERMISSIONS_OPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"cp: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tlet recursive = exec_args.includes(\"--recursive\");\n\tlet force = exec_args.includes(\"--force\");\n\tlet permissions = exec_args.includes(\"--permissions\");\n\tif (recursive) exec_args.splice(exec_args.indexOf(\"--recursive\"), 1);\n\tif (force) exec_args.splice(exec_args.indexOf(\"--force\"), 1);\n\tif (permissions) exec_args.splice(exec_args.indexOf(\"--permissions\"), 1);\n\tif (exec_args.length != 2) {\n\t\tawait availableAPIs.toMyCLI(\"cp: \" + await availableAPIs.lookupLocale(\"ARGUMENT_COUNT_MISMATCH\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\tif (recursive) await recursiveCopy(exec_args[0], exec_args[1], force, permissions);\n\telse {\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: exec_args[1],\n\t\t\t\tdata: await availableAPIs.fs_read({ path: exec_args[0] })\n\t\t\t});\n\t\t\tif (permissions) {\n\t\t\t\tlet originalPermissions = await availableAPIs.fs_permissions({ path: exec_args[0] });\n\t\t\t\tawait availableAPIs.fs_chmod({ path: exec_args[1], newPermissions: originalPermissions.world });\n\t\t\t\tawait availableAPIs.fs_chgrp({ path: exec_args[1], newGrp: originalPermissions.group });\n\t\t\t\tawait availableAPIs.fs_chown({ path: exec_args[1], newUser: originalPermissions.user });\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"cp: \" + exec_args[0] + \" -> \" + exec_args[1] + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t}\n\t}\n\tawait availableAPIs.terminate();\n})();\n\nasync function recursiveCopy(source, destination, force, permissions) {\n\ttry {\n\t\ttry {\n\t\t\tawait availableAPIs.fs_mkdir({ path: destination });\n\t\t} catch {}\n\t\tfor (let sourceFile of await availableAPIs.fs_ls({ path: source })) {\n\t\t\tlet destinationFile = destination + \"/\" + sourceFile;\n\t\t\ttry {\n\t\t\t\tif (await availableAPIs.fs_isDirectory({ path: source + \"/\" + sourceFile }))\n\t\t\t\t\tawait recursiveCopy(source + \"/\" + sourceFile, destinationFile, force, permissions);\n\t\t\t\telse {\n\t\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\t\tpath: destinationFile,\n\t\t\t\t\t\tdata: await availableAPIs.fs_read({ path: source + \"/\" + sourceFile })\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (permissions) {\n\t\t\t\t\tlet originalPermissions = await availableAPIs.fs_permissions({ path: source + \"/\" + sourceFile });\n\t\t\t\t\tawait availableAPIs.fs_chmod({ path: destinationFile, newPermissions: originalPermissions.world });\n\t\t\t\t\tawait availableAPIs.fs_chgrp({ path: destinationFile, newGrp: originalPermissions.group });\n\t\t\t\t\tawait availableAPIs.fs_chown({ path: destinationFile, newUser: originalPermissions.owner });\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tawait availableAPIs.toMyCLI(\"cp: \" + source + \"/\" + sourceFile + \" -> \" + destinationFile + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t\t\tif (!force) return await availableAPIs.terminate();\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"cp: \" + source + \" -> \" + destination + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\tif (!force) return await availableAPIs.terminate();\n\t}\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/crypto.js
async function cryptoInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "crypto" + ".js";
	let linkPath = target + "/apps/links/" + "crypto" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "CRYPTO_TOOLS_TITLE" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:CRYPTO_TOOLS_TITLE\n// signer: automaticSigner\n// allow: FS_WRITE, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, FS_READ, FS_LIST_PARTITIONS, IPC_SEND_PIPE, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS, START_TASK, GET_LOCALE, CSP_OPERATIONS, GET_USER_INFO\n// signature: 05fa98b0ab51de70f94d39a9ab6669de9861c730edd2dda065348ca3eaa2e6aa5486b485c36d6874030e92203f97397f605c6aa14e1e9bbeca0bfd8b667d2909\n// =====END MANIFEST=====\nlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\nlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"CRYPTO_TOOLS_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_WRITE\", \"IPC_CREATE_PIPE\", \"IPC_LISTEN_PIPE\", \"FS_READ\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\", \"START_TASK\", \"GET_LOCALE\", \"CSP_OPERATIONS\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"CRYPTO_TOOLS_NOPERM\");\n\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\tintent: await availableAPIs.lookupLocale(\"CRYPTO_TOOLS_INTENT\"),\n\t\t\tname: await availableAPIs.lookupLocale(\"CRYPTO_TOOLS_TITLE\"),\n\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t});\n\t\tif (!newToken) return;\n\t\tawait availableAPIs.setProcessToken(newToken);\n\t\tawait availableAPIs.revokeToken(currentToken);\n\t\tprivileges = await availableAPIs.getPrivileges();\n\t\tif (!checklist.every(p => privileges.includes(p))) return;\n\t}\n\tdocument.body.innerText = \"\";\n\tlet pageHeader = document.createElement(\"b\");\n\tlet dividePageHeader = document.createElement(\"hr\");\n\tlet page = document.createElement(\"div\");\n\tdocument.body.appendChild(pageHeader);\n\tdocument.body.appendChild(dividePageHeader);\n\tdocument.body.appendChild(page);\n\tasync function mainPage() {\n\t\tpageHeader.innerText = await availableAPIs.lookupLocale(\"CRYPTO_TOOLS_TITLE\");\n\t\tpage.innerText = \"\";\n\t\tlet rng = document.createElement(\"button\");\n\t\tlet hash = document.createElement(\"button\");\n\t\tlet keyGeneration = document.createElement(\"button\");\n\t\tlet encrypt = document.createElement(\"button\");\n\t\tlet decrypt = document.createElement(\"button\");\n\t\tlet sign = document.createElement(\"button\");\n\t\tlet verify = document.createElement(\"button\");\n\t\tlet deriveBits = document.createElement(\"button\");\n\t\t\n\t\trng.innerText = await availableAPIs.lookupLocale(\"CRYPTO_RNG\");\n\t\thash.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH\");\n\t\tkeyGeneration.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN\");\n\t\tencrypt.innerText = await availableAPIs.lookupLocale(\"CRYPTO_ENCRYPT\");\n\t\tdecrypt.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DECRYPT\");\n\t\tsign.innerText = await availableAPIs.lookupLocale(\"CRYPTO_SIGN\");\n\t\tverify.innerText = await availableAPIs.lookupLocale(\"CRYPTO_VERIFY\");\n\t\tderiveBits.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DERIVEBITS\");\n\n\t\trng.onclick = rngPage;\n\t\thash.onclick = hashPage;\n\t\tkeyGeneration.onclick = keyGenPage;\n\t\tencrypt.onclick = encryptPage;\n\t\tdecrypt.onclick = decryptPage;\n\t\tsign.onclick = signPage;\n\t\tverify.onclick = verifyPage;\n\t\tderiveBits.onclick = deriveBitsPage;\n\n\t\tpage.appendChild(rng);\n\t\tpage.appendChild(hash);\n\t\tpage.appendChild(keyGeneration);\n\t\tpage.appendChild(encrypt);\n\t\tpage.appendChild(decrypt);\n\t\tpage.appendChild(sign);\n\t\tpage.appendChild(verify);\n\t\tpage.appendChild(deriveBits);\n\t}\n\n\tmainPage();\n\n\tasync function rngPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthInput = document.createElement(\"input\");\n\t\tlet rngButton = document.createElement(\"button\");\n\t\tlet rngLabel = document.createElement(\"label\");\n\t\tlet rngField = document.createElement(\"textarea\");\n\t\tlet rngSaveButton = document.createElement(\"button\");\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_RNG\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\trngButton.innerText = await availableAPIs.lookupLocale(\"GENERATE\");\n\t\trngLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_RNGOUT_FIELD\");\n\t\trngSaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthInput);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(rngButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(rngLabel);\n\t\tpage.appendChild(rngSaveButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(rngField);\n\n\t\tlengthInput.type = \"number\";\n\t\tlengthInput.value = 256;\n\t\trngField.readOnly = true;\n\n\t\tbackButton.onclick = mainPage;\n\t\trngSaveButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: rngField.value });\n\t\t}\n\t\trngButton.onclick = async function() {\n\t\t\trngField.value = u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(Math.floor(parseInt(lengthInput.value)))\n\t\t\t}));\n\t\t}\n\t}\n\tasync function hashPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet plaintextLabel = document.createElement(\"label\");\n\t\tlet plaintextLoadButton = document.createElement(\"button\");\n\t\tlet plaintextField = document.createElement(\"textarea\");\n\t\tlet plaintextFormatLabel = document.createElement(\"label\");\n\t\tlet plaintextFormatOption = document.createElement(\"select\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet hashButton = document.createElement(\"button\");\n\t\tlet digestLabel = document.createElement(\"label\");\n\t\tlet digestField = document.createElement(\"textarea\");\n\t\tlet digestSaveButton = document.createElement(\"button\");\n\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet textAs = {\n\t\t\tunicode: \"UTF-8\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t}\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH\");\n\t\tplaintextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXT_FIELD\");\n\t\tplaintextLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\tplaintextFormatLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXTAS_FIELD\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\thashButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_ACTION\");\n\t\tdigestLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASHOUT_FIELD\");\n\t\tdigestSaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tpage.appendChild(plaintextLabel);\n\t\tpage.appendChild(plaintextLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextFormatLabel);\n\t\tpage.appendChild(plaintextFormatOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(hashButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(digestLabel);\n\t\tpage.appendChild(digestSaveButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(digestField);\n\n\t\tdigestField.readOnly = true;\n\n\t\tfor (let plaintextFormat in textAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = plaintextFormat;\n\t\t\toption.innerText = textAs[plaintextFormat];\n\t\t\tplaintextFormatOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tbackButton.onclick = mainPage;\n\t\tplaintextLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) plaintextField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tdigestSaveButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: digestField.value });\n\t\t}\n\t\thashButton.onclick = async function() {\n\t\t\tlet data;\n\t\t\tif (plaintextFormatOption.value == \"raw\") data = hexToU8A(plaintextField.value);\n\t\t\tif (plaintextFormatOption.value == \"unicode\") data = new TextEncoder().encode(plaintextField.value);\n\t\t\tlet digest = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"digest\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: hashOption.value,\n\t\t\t\t\tdata\n\t\t\t\t}\n\t\t\t});\n\t\t\tdigestField.value = u8aToHex(new Uint8Array(digest));\n\t\t}\n\t}\n\tasync function keyGenPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet algorithmLabel = document.createElement(\"label\");\n\t\tlet algorithmOption = document.createElement(\"select\");\n\t\tlet modLenLabel = document.createElement(\"label\");\n\t\tlet modLen = document.createElement(\"input\");\n\t\tlet publicExponentLabel = document.createElement(\"label\");\n\t\tlet publicExponent = document.createElement(\"input\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet namedCurveLabel = document.createElement(\"label\");\n\t\tlet namedCurveOption = document.createElement(\"select\");\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthInput = document.createElement(\"input\");\n\t\tlet exportAsLabel = document.createElement(\"label\");\n\t\tlet exportAsOption = document.createElement(\"select\");\n\t\tlet keyUsagesLabel = document.createElement(\"label\");\n\t\tlet generateButton = document.createElement(\"button\");\n\t\tlet publicKeyLabel = document.createElement(\"label\");\n\t\tlet publicKeySave = document.createElement(\"button\");\n\t\tlet publicKeyField = document.createElement(\"textarea\");\n\t\tlet privateKeyLabel = document.createElement(\"label\");\n\t\tlet privateKeySave = document.createElement(\"button\");\n\t\tlet privateKeyField = document.createElement(\"textarea\");\n\t\t\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN\");\n\t\talgorithmLabel.innerText = await availableAPIs.lookupLocale(\"ALGORITHM_FIELD\");\n\t\tmodLenLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_MODLEN_FIELD\");\n\t\tpublicExponentLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PUBEXP_FIELD\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\tnamedCurveLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_NC_FIELD\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\texportAsLabel.innerText = await availableAPIs.lookupLocale(\"EXPORT_AS_FIELD\");\n\t\tkeyUsagesLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEYUSE_FIELD\");\n\t\tgenerateButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_ACTION\");\n\t\tpublicKeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PUBKEY_FIELD\");\n\t\tpublicKeySave.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\t\tprivateKeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PRIVKEY_FIELD\");\n\t\tprivateKeySave.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tlet algorithms = [ \"RSASSA-PKCS1-v1_5\", \"RSA-PSS\", \"RSA-OAEP\", \"ECDSA\", \"ECDH\", \"HMAC\", \"AES-CBC\", \"AES-CTR\", \"AES-GCM\", \"Ed25519\", \"X25519\" ];\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet namedCurves = [ \"P-256\", \"P-384\", \"P-521\" ];\n\t\tlet keyUsages = [ \"encrypt\", \"decrypt\", \"sign\", \"verify\", \"deriveKey\", \"deriveBits\", \"wrapKey\", \"unwrapKey\" ];\n\t\tlet exportAs = {\n\t\t\tjwk: \"JSON Web Key\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t};\n\t\tlet setKeyUsages = Object.fromEntries(keyUsages.map(a => [a, false]));\n\n\t\tpage.appendChild(algorithmLabel);\n\t\tpage.appendChild(algorithmOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(modLenLabel);\n\t\tpage.appendChild(modLen);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(publicExponentLabel);\n\t\tpage.appendChild(publicExponent);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(namedCurveLabel);\n\t\tpage.appendChild(namedCurveOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(exportAsLabel);\n\t\tpage.appendChild(exportAsOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(keyUsagesLabel);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\n\t\tfor (let algorithm of algorithms) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = algorithm;\n\t\t\toption.innerText = algorithm;\n\t\t\talgorithmOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tfor (let curve of namedCurves) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = curve;\n\t\t\toption.innerText = curve;\n\t\t\tnamedCurveOption.appendChild(option);\n\t\t}\n\n\t\tfor (let usage of keyUsages) {\n\t\t\tlet inputCheckBox = document.createElement(\"input\");\n\t\t\tlet label = document.createElement(\"label\");\n\n\t\t\tinputCheckBox.type = \"checkbox\";\n\t\t\tinputCheckBox.id = usage;\n\t\t\tinputCheckBox.onchange = function() {\n\t\t\t\tsetKeyUsages[usage] = inputCheckBox.checked;\n\t\t\t};\n\n\t\t\tlabel.innerText = usage;\n\t\t\tlabel.htmlFor = usage;\n\n\t\t\tpage.appendChild(inputCheckBox);\n\t\t\tpage.appendChild(label);\n\t\t\tpage.appendChild(document.createElement(\"br\"));\n\t\t}\n\n\t\tfor (let exportType in exportAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = exportType;\n\t\t\toption.innerText = exportAs[exportType];\n\t\t\texportAsOption.appendChild(option);\n\t\t}\n\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(generateButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(publicKeyLabel);\n\t\tpage.appendChild(publicKeySave);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(publicKeyField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(privateKeyLabel);\n\t\tpage.appendChild(privateKeySave);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(privateKeyField);\n\n\t\tbackButton.onclick = mainPage;\n\t\tasync function saveKey(type) {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: type == \"private\" ? privateKeyField.value : publicKeyField.value });\n\t\t}\n\n\t\tpublicKeySave.onclick = () => saveKey(\"public\");\n\t\tprivateKeySave.onclick = () => saveKey(\"private\");\n\n\t\tmodLen.type = \"number\";\n\t\tlengthInput.type = \"number\";\n\n\t\tmodLen.value = 2048;\n\t\tlengthInput.value = 256;\n\t\tpublicExponent.value = \"010001\";\n\n\t\tpublicKeyField.readOnly = true;\n\t\tprivateKeyField.readOnly = true;\n\n\t\tgenerateButton.addEventListener(\"click\", async function() {\n\t\t\tpublicKeyField.value = await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_MSG\");\n\t\t\tprivateKeyField.value = await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_MSG\");\n\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"generateKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\tmodulusLength: parseInt(modLen.value),\n\t\t\t\t\t\tpublicExponent: Uint8Array.from(publicExponent.value.match(/.{1,2}/g).map(a => parseInt(a, 16))),\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tlength: parseInt(lengthInput.value),\n\t\t\t\t\t\tnamedCurve: namedCurveOption.value\n\t\t\t\t\t},\n\t\t\t\t\textractable: true,\n\t\t\t\t\tkeyUsages: Object.entries(setKeyUsages).filter(a => a[1]).map(a => a[0])\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet exported = {};\n\t\t\ttry {\n\t\t\t\texported = {\n\t\t\t\t\tprivateKey: await availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"exportKey\",\n\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\tformat: exportAsOption.value,\n\t\t\t\t\t\t\tkey: key.type == \"secret\" ? key : key.privateKey\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tpublicKey: key.type == \"secret\" ? undefined : await availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"exportKey\",\n\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\tformat: exportAsOption.value,\n\t\t\t\t\t\t\tkey: key.publicKey\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t} catch {}\n\t\t\tif (key.type == \"secret\") await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: key\n\t\t\t});\n\t\t\telse {\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key.privateKey\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key.publicKey\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (exportAsOption.value == \"jwk\") {\n\t\t\t\tpublicKeyField.value = JSON.stringify(exported.publicKey || await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_SYMM\"));\n\t\t\t\tprivateKeyField.value = JSON.stringify(exported.privateKey || await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_EXPFAIL\"));\n\t\t\t} else if (exportAsOption.value == \"raw\") {\n\t\t\t\tpublicKeyField.value = u8aToHex(new Uint8Array(exported.publicKey || new ArrayBuffer(0))) || await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_SYMM\");\n\t\t\t\tprivateKeyField.value = u8aToHex(new Uint8Array(exported.privateKey || new ArrayBuffer(0))) || await availableAPIs.lookupLocale(\"CRYPTO_KEYGEN_EXPFAIL\");\n\t\t\t}\n\t\t});\n\t}\n\tasync function encryptPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet plaintextLabel = document.createElement(\"label\");\n\t\tlet plaintextLoadButton = document.createElement(\"button\");\n\t\tlet plaintextField = document.createElement(\"textarea\");\n\t\tlet plaintextFormatLabel = document.createElement(\"label\");\n\t\tlet plaintextFormatOption = document.createElement(\"select\");\n\t\tlet keyLabel = document.createElement(\"label\");\n\t\tlet keyLoadButton = document.createElement(\"button\");\n\t\tlet keyField = document.createElement(\"textarea\");\n\t\tlet algorithmLabel = document.createElement(\"label\");\n\t\tlet algorithmOption = document.createElement(\"select\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet namedCurveLabel = document.createElement(\"label\");\n\t\tlet namedCurveOption = document.createElement(\"select\");\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthInput = document.createElement(\"input\");\n\t\tlet ivLabel = document.createElement(\"label\");\n\t\tlet ivInput = document.createElement(\"input\");\n\t\tlet ivGenerateButton = document.createElement(\"button\");\n\t\tlet counterLabel = document.createElement(\"label\");\n\t\tlet counterInput = document.createElement(\"input\");\n\t\tlet importAsLabel = document.createElement(\"label\");\n\t\tlet importAsOption = document.createElement(\"select\");\n\t\tlet encryptButton = document.createElement(\"button\");\n\t\tlet ciphertextLabel = document.createElement(\"label\");\n\t\tlet ciphertextField = document.createElement(\"textarea\");\n\t\tlet ciphertextSaveButton = document.createElement(\"button\");\n\n\t\tlet algorithms = [ \"RSA-OAEP\", \"AES-CBC\", \"AES-CTR\", \"AES-GCM\" ];\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet namedCurves = [ \"P-256\", \"P-384\", \"P-521\" ];\n\t\tlet importAs = {\n\t\t\tjwk: \"JSON Web Key\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t};\n\t\tlet textAs = {\n\t\t\tunicode: \"UTF-8\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t}\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_ENCRYPT\");\n\t\tplaintextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXT_FIELD\");\n\t\tplaintextLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\tplaintextFormatLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXTAS_FIELD\");\n\t\tkeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEY_FIELD\");\n\t\tkeyLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\talgorithmLabel.innerText = await availableAPIs.lookupLocale(\"ALGORITHM_FIELD\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\tnamedCurveLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_NC_FIELD\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\tivLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_IV_FIELD\");\n\t\tivGenerateButton.innerText = await availableAPIs.lookupLocale(\"REGENERATE\");\n\t\tcounterLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_CTR_FIELD\");\n\t\timportAsLabel.innerText = await availableAPIs.lookupLocale(\"IMPORT_AS_FIELD\");\n\t\tencryptButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_ENCRYPT_ACTION\");\n\t\tciphertextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_CIPHERTEXT_FIELD\");\n\t\tciphertextSaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tpage.appendChild(plaintextLabel);\n\t\tpage.appendChild(plaintextLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextFormatLabel);\n\t\tpage.appendChild(plaintextFormatOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(keyLabel);\n\t\tpage.appendChild(keyLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(keyField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(algorithmLabel);\n\t\tpage.appendChild(algorithmOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(namedCurveLabel);\n\t\tpage.appendChild(namedCurveOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(ivLabel);\n\t\tpage.appendChild(ivInput);\n\t\tpage.appendChild(ivGenerateButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(counterLabel);\n\t\tpage.appendChild(counterInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(importAsLabel);\n\t\tpage.appendChild(importAsOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(encryptButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(ciphertextLabel);\n\t\tpage.appendChild(ciphertextSaveButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(ciphertextField);\n\n\t\tlengthInput.type = \"number\";\n\t\tlengthInput.value = 256;\n\t\tciphertextField.readOnly = true;\n\n\t\tfor (let plaintextFormat in textAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = plaintextFormat;\n\t\t\toption.innerText = textAs[plaintextFormat];\n\t\t\tplaintextFormatOption.appendChild(option);\n\t\t}\n\n\t\tfor (let algorithm of algorithms) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = algorithm;\n\t\t\toption.innerText = algorithm;\n\t\t\talgorithmOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tfor (let curve of namedCurves) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = curve;\n\t\t\toption.innerText = curve;\n\t\t\tnamedCurveOption.appendChild(option);\n\t\t}\n\n\t\tfor (let importType in importAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = importType;\n\t\t\toption.innerText = importAs[importType];\n\t\t\timportAsOption.appendChild(option);\n\t\t}\n\n\t\tbackButton.onclick = mainPage;\n\t\tplaintextLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) plaintextField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tkeyLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) keyField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tciphertextSaveButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: ciphertextField.value });\n\t\t}\n\t\tivGenerateButton.onclick = async function() {\n\t\t\tivInput.value = u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(16)\n\t\t\t}));\n\t\t};\n\t\tencryptButton.onclick = async function() {\n\t\t\tlet keyData, data;\n\t\t\tif (importAsOption.value == \"jwk\") keyData = JSON.parse(keyField.value);\n\t\t\tif (importAsOption.value == \"raw\") keyData = hexToU8A(keyField.value);\n\t\t\tif (plaintextFormatOption.value == \"raw\") data = hexToU8A(plaintextField.value);\n\t\t\tif (plaintextFormatOption.value == \"unicode\") data = new TextEncoder().encode(plaintextField.value);\n\t\t\tlet keyImport = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"importKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tformat: importAsOption.value,\n\t\t\t\t\tkeyData: keyData,\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tnamedCurve: namedCurveOption.value,\n\t\t\t\t\t\tlength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\textractable: false,\n\t\t\t\t\tkeyUsages: [ \"encrypt\" ]\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet ciphertext = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"encrypt\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\tiv: hexToU8A(ivInput.value || \"00\".repeat(16)),\n\t\t\t\t\t\tcounter: hexToU8A(counterInput.value || \"00\".repeat(16)),\n\t\t\t\t\t\tlength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\tkey: keyImport,\n\t\t\t\t\tdata\n\t\t\t\t}\n\t\t\t});\n\t\t\tciphertextField.value = u8aToHex(new Uint8Array(ciphertext));\n\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tkey: keyImport\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tasync function decryptPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet ciphertextLabel = document.createElement(\"label\");\n\t\tlet ciphertextLoadButton = document.createElement(\"button\");\n\t\tlet ciphertextField = document.createElement(\"textarea\");\n\t\tlet keyLabel = document.createElement(\"label\");\n\t\tlet keyLoadButton = document.createElement(\"button\");\n\t\tlet keyField = document.createElement(\"textarea\");\n\t\tlet algorithmLabel = document.createElement(\"label\");\n\t\tlet algorithmOption = document.createElement(\"select\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet namedCurveLabel = document.createElement(\"label\");\n\t\tlet namedCurveOption = document.createElement(\"select\");\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthInput = document.createElement(\"input\");\n\t\tlet ivLabel = document.createElement(\"label\");\n\t\tlet ivInput = document.createElement(\"input\");\n\t\tlet counterLabel = document.createElement(\"label\");\n\t\tlet counterInput = document.createElement(\"input\");\n\t\tlet importAsLabel = document.createElement(\"label\");\n\t\tlet importAsOption = document.createElement(\"select\");\n\t\tlet plaintextFormatLabel = document.createElement(\"label\");\n\t\tlet plaintextFormatOption = document.createElement(\"select\");\n\t\tlet decryptButton = document.createElement(\"button\");\n\t\tlet plaintextLabel = document.createElement(\"label\");\n\t\tlet plaintextField = document.createElement(\"textarea\");\n\t\tlet plaintextSaveButton = document.createElement(\"button\");\n\n\t\tlet algorithms = [ \"RSA-OAEP\", \"AES-CBC\", \"AES-CTR\", \"AES-GCM\" ];\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet namedCurves = [ \"P-256\", \"P-384\", \"P-521\" ];\n\t\tlet importAs = {\n\t\t\tjwk: \"JSON Web Key\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t};\n\t\tlet textAs = {\n\t\t\tunicode: \"UTF-8\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t}\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DECRYPT\");\n\t\tciphertextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_CIPHERTEXT_FIELD\");\n\t\tciphertextLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\tkeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEY_FIELD\");\n\t\tkeyLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\talgorithmLabel.innerText = await availableAPIs.lookupLocale(\"ALGORITHM_FIELD\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\tnamedCurveLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_NC_FIELD\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\tivLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_IV_FIELD\");\n\t\tcounterLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_CTR_FIELD\");\n\t\timportAsLabel.innerText = await availableAPIs.lookupLocale(\"IMPORT_AS_FIELD\");\n\t\tdecryptButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DECRYPT_ACTION\");\n\t\tplaintextFormatLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXTAS_FIELD\");\n\t\tplaintextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXT_FIELD\");\n\t\tplaintextSaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tpage.appendChild(ciphertextLabel);\n\t\tpage.appendChild(ciphertextLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(ciphertextField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(keyLabel);\n\t\tpage.appendChild(keyLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(keyField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(algorithmLabel);\n\t\tpage.appendChild(algorithmOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(namedCurveLabel);\n\t\tpage.appendChild(namedCurveOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(ivLabel);\n\t\tpage.appendChild(ivInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(counterLabel);\n\t\tpage.appendChild(counterInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(importAsLabel);\n\t\tpage.appendChild(importAsOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(decryptButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(plaintextFormatLabel);\n\t\tpage.appendChild(plaintextFormatOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextLabel);\n\t\tpage.appendChild(plaintextSaveButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextField);\n\n\t\tlengthInput.type = \"number\";\n\t\tlengthInput.value = 256;\n\t\tplaintextField.readOnly = true;\n\n\t\tfor (let plaintextFormat in textAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = plaintextFormat;\n\t\t\toption.innerText = textAs[plaintextFormat];\n\t\t\tplaintextFormatOption.appendChild(option);\n\t\t}\n\n\t\tfor (let algorithm of algorithms) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = algorithm;\n\t\t\toption.innerText = algorithm;\n\t\t\talgorithmOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tfor (let curve of namedCurves) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = curve;\n\t\t\toption.innerText = curve;\n\t\t\tnamedCurveOption.appendChild(option);\n\t\t}\n\n\t\tfor (let importType in importAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = importType;\n\t\t\toption.innerText = importAs[importType];\n\t\t\timportAsOption.appendChild(option);\n\t\t}\n\n\t\tbackButton.onclick = mainPage;\n\t\tciphertextLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) ciphertextField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tkeyLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) keyField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tplaintextSaveButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: plaintextField.value });\n\t\t}\n\t\tdecryptButton.onclick = async function() {\n\t\t\tlet keyData;\n\t\t\tif (importAsOption.value == \"jwk\") keyData = JSON.parse(keyField.value);\n\t\t\tif (importAsOption.value == \"raw\") keyData = hexToU8A(keyField.value);\n\t\t\tlet keyImport = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"importKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tformat: importAsOption.value,\n\t\t\t\t\tkeyData: keyData,\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tnamedCurve: namedCurveOption.value,\n\t\t\t\t\t\tlength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\textractable: false,\n\t\t\t\t\tkeyUsages: [ \"decrypt\" ]\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet ciphertext = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"decrypt\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\tiv: hexToU8A(ivInput.value || \"00\".repeat(16)),\n\t\t\t\t\t\tcounter: hexToU8A(counterInput.value || \"00\".repeat(16)),\n\t\t\t\t\t\tlength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\tkey: keyImport,\n\t\t\t\t\tdata: hexToU8A(ciphertextField.value)\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (plaintextFormatOption.value == \"raw\") plaintextField.value = u8aToHex(new Uint8Array(ciphertext));\n\t\t\tif (plaintextFormatOption.value == \"unicode\") plaintextField.value = new TextDecoder().decode(ciphertext);\n\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tkey: keyImport\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tasync function signPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet plaintextLabel = document.createElement(\"label\");\n\t\tlet plaintextLoadButton = document.createElement(\"button\");\n\t\tlet plaintextField = document.createElement(\"textarea\");\n\t\tlet plaintextFormatLabel = document.createElement(\"label\");\n\t\tlet plaintextFormatOption = document.createElement(\"select\");\n\t\tlet keyLabel = document.createElement(\"label\");\n\t\tlet keyLoadButton = document.createElement(\"button\");\n\t\tlet keyField = document.createElement(\"textarea\");\n\t\tlet algorithmLabel = document.createElement(\"label\");\n\t\tlet algorithmOption = document.createElement(\"select\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet namedCurveLabel = document.createElement(\"label\");\n\t\tlet namedCurveOption = document.createElement(\"select\");\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthInput = document.createElement(\"input\");\n\t\tlet importAsLabel = document.createElement(\"label\");\n\t\tlet importAsOption = document.createElement(\"select\");\n\t\tlet signButton = document.createElement(\"button\");\n\t\tlet signatureLabel = document.createElement(\"label\");\n\t\tlet signatureField = document.createElement(\"textarea\");\n\t\tlet signatureSaveButton = document.createElement(\"button\");\n\n\t\tlet algorithms = [ \"RSASSA-PKCS1-v1_5\", \"RSA-PSS\", \"ECDSA\", \"HMAC\", \"Ed25519\" ];\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet namedCurves = [ \"P-256\", \"P-384\", \"P-521\" ];\n\t\tlet importAs = {\n\t\t\tjwk: \"JSON Web Key\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t};\n\t\tlet textAs = {\n\t\t\tunicode: \"UTF-8\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t}\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_SIGN\");\n\t\tplaintextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXT_FIELD\");\n\t\tplaintextLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\tplaintextFormatLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXTAS_FIELD\");\n\t\tkeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEY_FIELD\");\n\t\tkeyLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\talgorithmLabel.innerText = await availableAPIs.lookupLocale(\"ALGORITHM_FIELD\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\tnamedCurveLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_NC_FIELD\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\timportAsLabel.innerText = await availableAPIs.lookupLocale(\"IMPORT_AS_FIELD\");\n\t\tsignButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_SIGN_ACTION\");\n\t\tsignatureLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_SIGNATURE_FIELD\");\n\t\tsignatureSaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tpage.appendChild(plaintextLabel);\n\t\tpage.appendChild(plaintextLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextFormatLabel);\n\t\tpage.appendChild(plaintextFormatOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(keyLabel);\n\t\tpage.appendChild(keyLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(keyField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(algorithmLabel);\n\t\tpage.appendChild(algorithmOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(namedCurveLabel);\n\t\tpage.appendChild(namedCurveOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(importAsLabel);\n\t\tpage.appendChild(importAsOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(signButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(signatureLabel);\n\t\tpage.appendChild(signatureSaveButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(signatureField);\n\n\t\tlengthInput.type = \"number\";\n\t\tlengthInput.value = 256;\n\t\tsignatureField.readOnly = true;\n\n\t\tfor (let plaintextFormat in textAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = plaintextFormat;\n\t\t\toption.innerText = textAs[plaintextFormat];\n\t\t\tplaintextFormatOption.appendChild(option);\n\t\t}\n\n\t\tfor (let algorithm of algorithms) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = algorithm;\n\t\t\toption.innerText = algorithm;\n\t\t\talgorithmOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tfor (let curve of namedCurves) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = curve;\n\t\t\toption.innerText = curve;\n\t\t\tnamedCurveOption.appendChild(option);\n\t\t}\n\n\t\tfor (let importType in importAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = importType;\n\t\t\toption.innerText = importAs[importType];\n\t\t\timportAsOption.appendChild(option);\n\t\t}\n\n\t\tbackButton.onclick = mainPage;\n\t\tplaintextLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) plaintextField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tkeyLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) keyField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tsignatureSaveButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: signatureField.value });\n\t\t}\n\t\tsignButton.onclick = async function() {\n\t\t\tlet keyData, data;\n\t\t\tif (importAsOption.value == \"jwk\") keyData = JSON.parse(keyField.value);\n\t\t\tif (importAsOption.value == \"raw\") keyData = hexToU8A(keyField.value);\n\t\t\tif (plaintextFormatOption.value == \"raw\") data = hexToU8A(plaintextField.value);\n\t\t\tif (plaintextFormatOption.value == \"unicode\") data = new TextEncoder().encode(plaintextField.value);\n\t\t\tlet keyImport = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"importKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tformat: importAsOption.value,\n\t\t\t\t\tkeyData: keyData,\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tnamedCurve: namedCurveOption.value,\n\t\t\t\t\t\tlength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\textractable: false,\n\t\t\t\t\tkeyUsages: [ \"sign\" ]\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet signature = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"sign\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tsaltLength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\tkey: keyImport,\n\t\t\t\t\tdata\n\t\t\t\t}\n\t\t\t});\n\t\t\tsignatureField.value = u8aToHex(new Uint8Array(signature));\n\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tkey: keyImport\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tasync function verifyPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet plaintextLabel = document.createElement(\"label\");\n\t\tlet plaintextLoadButton = document.createElement(\"button\");\n\t\tlet plaintextField = document.createElement(\"textarea\");\n\t\tlet plaintextFormatLabel = document.createElement(\"label\");\n\t\tlet plaintextFormatOption = document.createElement(\"select\");\n\t\tlet signatureLabel = document.createElement(\"label\");\n\t\tlet signatureField = document.createElement(\"textarea\");\n\t\tlet signatureLoadButton = document.createElement(\"button\");\n\t\tlet keyLabel = document.createElement(\"label\");\n\t\tlet keyLoadButton = document.createElement(\"button\");\n\t\tlet keyField = document.createElement(\"textarea\");\n\t\tlet algorithmLabel = document.createElement(\"label\");\n\t\tlet algorithmOption = document.createElement(\"select\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet namedCurveLabel = document.createElement(\"label\");\n\t\tlet namedCurveOption = document.createElement(\"select\");\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthInput = document.createElement(\"input\");\n\t\tlet importAsLabel = document.createElement(\"label\");\n\t\tlet importAsOption = document.createElement(\"select\");\n\t\tlet verifyButton = document.createElement(\"button\");\n\t\tlet verifiedCheckbox = document.createElement(\"input\");\n\t\tlet verifiedLabel = document.createElement(\"label\");\n\n\t\tlet algorithms = [ \"RSASSA-PKCS1-v1_5\", \"RSA-PSS\", \"ECDSA\", \"HMAC\", \"Ed25519\" ];\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet namedCurves = [ \"P-256\", \"P-384\", \"P-521\" ];\n\t\tlet importAs = {\n\t\t\tjwk: \"JSON Web Key\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t};\n\t\tlet textAs = {\n\t\t\tunicode: \"UTF-8\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t}\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_VERIFY\");\n\t\tplaintextLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXT_FIELD\");\n\t\tplaintextLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\tsignatureLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_SIGNATURE_FIELD\");\n\t\tsignatureLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\tplaintextFormatLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PLAINTEXTAS_FIELD\");\n\t\tkeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_KEY_FIELD\");\n\t\tkeyLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\talgorithmLabel.innerText = await availableAPIs.lookupLocale(\"ALGORITHM_FIELD\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\tnamedCurveLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_NC_FIELD\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\timportAsLabel.innerText = await availableAPIs.lookupLocale(\"IMPORT_AS_FIELD\");\n\t\tverifyButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_VERIFY_ACTION\");\n\t\tverifiedLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_VERIFIED_CHECKBOX\");\n\n\t\tpage.appendChild(plaintextLabel);\n\t\tpage.appendChild(plaintextLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(plaintextFormatLabel);\n\t\tpage.appendChild(plaintextFormatOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(signatureLabel);\n\t\tpage.appendChild(signatureLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(signatureField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(keyLabel);\n\t\tpage.appendChild(keyLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(keyField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(algorithmLabel);\n\t\tpage.appendChild(algorithmOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(namedCurveLabel);\n\t\tpage.appendChild(namedCurveOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthInput);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(importAsLabel);\n\t\tpage.appendChild(importAsOption);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(verifyButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(verifiedCheckbox);\n\t\tpage.appendChild(verifiedLabel);\n\n\t\tlengthInput.type = \"number\";\n\t\tverifiedCheckbox.type = \"checkbox\";\n\t\tlengthInput.value = 256;\n\t\tverifiedCheckbox.disabled = true;\n\n\t\tfor (let plaintextFormat in textAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = plaintextFormat;\n\t\t\toption.innerText = textAs[plaintextFormat];\n\t\t\tplaintextFormatOption.appendChild(option);\n\t\t}\n\n\t\tfor (let algorithm of algorithms) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = algorithm;\n\t\t\toption.innerText = algorithm;\n\t\t\talgorithmOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tfor (let curve of namedCurves) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = curve;\n\t\t\toption.innerText = curve;\n\t\t\tnamedCurveOption.appendChild(option);\n\t\t}\n\n\t\tfor (let importType in importAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = importType;\n\t\t\toption.innerText = importAs[importType];\n\t\t\timportAsOption.appendChild(option);\n\t\t}\n\n\t\tbackButton.onclick = mainPage;\n\t\tplaintextLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) plaintextField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tkeyLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) keyField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tsignatureLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) signatureField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tverifyButton.onclick = async function() {\n\t\t\tlet keyData, data;\n\t\t\tif (importAsOption.value == \"jwk\") keyData = JSON.parse(keyField.value);\n\t\t\tif (importAsOption.value == \"raw\") keyData = hexToU8A(keyField.value);\n\t\t\tif (plaintextFormatOption.value == \"raw\") data = hexToU8A(plaintextField.value);\n\t\t\tif (plaintextFormatOption.value == \"unicode\") data = new TextEncoder().encode(plaintextField.value);\n\t\t\tlet keyImport = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"importKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tformat: importAsOption.value,\n\t\t\t\t\tkeyData: keyData,\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tnamedCurve: namedCurveOption.value,\n\t\t\t\t\t\tlength: parseInt(lengthInput.value)\n\t\t\t\t\t},\n\t\t\t\t\textractable: false,\n\t\t\t\t\tkeyUsages: [ \"verify\" ]\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet solution = false;\n\t\t\ttry {\n\t\t\t\tsolution = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"verify\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\t\tsaltLength: parseInt(lengthInput.value)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tkey: keyImport,\n\t\t\t\t\t\tsignature: hexToU8A(signatureField.value),\n\t\t\t\t\t\tdata\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t\tverifiedCheckbox.checked = solution;\n\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tkey: keyImport\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tasync function deriveBitsPage() {\n\t\tpage.innerText = \"\";\n\t\tpageHeader.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet pageHeaderText = document.createElement(\"span\");\n\t\tpageHeader.appendChild(backButton);\n\t\tpageHeader.appendChild(pageHeaderText);\n\t\tlet algorithmLabel = document.createElement(\"label\");\n\t\tlet algorithmOption = document.createElement(\"select\");\n\t\tlet publicKeyLabel = document.createElement(\"label\");\n\t\tlet publicKeyLoadButton = document.createElement(\"button\");\n\t\tlet publicKeyField = document.createElement(\"textarea\");\n\t\tlet hashLabel = document.createElement(\"label\");\n\t\tlet hashOption = document.createElement(\"select\");\n\t\tlet saltLabel = document.createElement(\"label\");\n\t\tlet saltGenerateButton = document.createElement(\"button\");\n\t\tlet saltField = document.createElement(\"textarea\");\n\t\tlet iterationsLabel = document.createElement(\"label\");\n\t\tlet iterationsField = document.createElement(\"input\");\n\t\tlet baseKeyLabel = document.createElement(\"label\");\n\t\tlet baseKeyLoadButton = document.createElement(\"button\");\n\t\tlet baseKeyField = document.createElement(\"textarea\");\n\t\tlet importAsLabel = document.createElement(\"label\");\n\t\tlet importAsOption = document.createElement(\"select\");\n\t\tlet namedCurveLabel = document.createElement(\"label\");\n\t\tlet namedCurveOption = document.createElement(\"select\");\n\t\tlet lengthLabel = document.createElement(\"label\");\n\t\tlet lengthField = document.createElement(\"input\");\n\t\tlet deriveButton = document.createElement(\"button\");\n\t\tlet derivedBitsLabel = document.createElement(\"label\");\n\t\tlet derivedBitsSaveButton = document.createElement(\"button\");\n\t\tlet derivedBitsField = document.createElement(\"textarea\");\n\n\t\tlet algorithms = [ \"ECDH\", \"HKDF\", \"PBKDF2\", \"X25519\" ];\n\t\tlet hashes = [ \"SHA-256\", \"SHA-384\", \"SHA-512\", \"SHA-1\" ];\n\t\tlet namedCurves = [ \"P-256\", \"P-384\", \"P-521\" ];\n\t\tlet importAs = {\n\t\t\tjwk: \"JSON Web Key\",\n\t\t\traw: await availableAPIs.lookupLocale(\"RAW_HEX_DATA\")\n\t\t};\n\n\t\tbackButton.innerText = \"<-\";\n\t\tpageHeaderText.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DERIVEBITS\");\n\t\talgorithmLabel.innerText = await availableAPIs.lookupLocale(\"ALGORITHM_FIELD\");\n\t\tpublicKeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_PUBKEY_FIELD\");\n\t\tpublicKeyLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\thashLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_HASH_FIELD\");\n\t\tsaltLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_SALT_FIELD\");\n\t\tsaltGenerateButton.innerText = await availableAPIs.lookupLocale(\"REGENERATE\");\n\t\titerationsLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_ITERATIONS_FIELD\");\n\t\tbaseKeyLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_BASEKEY_FIELD\");\n\t\tbaseKeyLoadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\timportAsLabel.innerText = await availableAPIs.lookupLocale(\"IMPORT_AS_FIELD\");\n\t\tnamedCurveLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_NC_FIELD\");\n\t\tlengthLabel.innerText = await availableAPIs.lookupLocale(\"LENGTH_FIELD\");\n\t\tderiveButton.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DERIVEBITS_ACTION\");\n\t\tderivedBitsLabel.innerText = await availableAPIs.lookupLocale(\"CRYPTO_DERIVEOUT_FIELD\");\n\t\tderivedBitsSaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\n\t\tpage.appendChild(algorithmLabel);\n\t\tpage.appendChild(algorithmOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(publicKeyLabel);\n\t\tpage.appendChild(publicKeyLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(publicKeyField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(hashLabel);\n\t\tpage.appendChild(hashOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(saltLabel);\n\t\tpage.appendChild(saltGenerateButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(saltField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(iterationsLabel);\n\t\tpage.appendChild(iterationsField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(baseKeyLabel);\n\t\tpage.appendChild(baseKeyLoadButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(baseKeyField);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(importAsLabel);\n\t\tpage.appendChild(importAsOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(namedCurveLabel);\n\t\tpage.appendChild(namedCurveOption);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(lengthLabel);\n\t\tpage.appendChild(lengthField);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(deriveButton);\n\t\tpage.appendChild(document.createElement(\"hr\"));\n\t\tpage.appendChild(derivedBitsLabel);\n\t\tpage.appendChild(derivedBitsSaveButton);\n\t\tpage.appendChild(document.createElement(\"br\"));\n\t\tpage.appendChild(derivedBitsField);\n\n\t\titerationsField.type = \"number\";\n\t\tlengthField.type = \"number\";\n\t\tlengthField.value = 256;\n\t\tderivedBitsField.readOnly = true;\n\n\t\tfor (let algorithm of algorithms) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = algorithm;\n\t\t\toption.innerText = algorithm;\n\t\t\talgorithmOption.appendChild(option);\n\t\t}\n\n\t\tfor (let hash of hashes) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = hash;\n\t\t\toption.innerText = hash;\n\t\t\thashOption.appendChild(option);\n\t\t}\n\n\t\tfor (let curve of namedCurves) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = curve;\n\t\t\toption.innerText = curve;\n\t\t\tnamedCurveOption.appendChild(option);\n\t\t}\n\n\t\tfor (let importType in importAs) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = importType;\n\t\t\toption.innerText = importAs[importType];\n\t\t\timportAsOption.appendChild(option);\n\t\t}\n\n\t\tbackButton.onclick = mainPage;\n\t\tpublicKeyLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) publicKeyField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tbaseKeyLoadButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) baseKeyField.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t}\n\t\tsaltGenerateButton.onclick = async function() {\n\t\t\tsaltField.value = u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(32)\n\t\t\t}));\n\t\t}\n\t\tderivedBitsSaveButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) await availableAPIs.fs_write({ path: result.selected, data: derivedBitsField.value });\n\t\t}\n\t\tderiveButton.onclick = async function() {\n\t\t\tlet baseKeyData, publicKeyData;\n\t\t\tif (importAsOption.value == \"jwk\") {\n\t\t\t\tbaseKeyData = JSON.parse(baseKeyField.value);\n\t\t\t\tpublicKeyData = JSON.parse(publicKeyField.value || \"00\");\n\t\t\t}\n\t\t\tif (importAsOption.value == \"raw\") {\n\t\t\t\tbaseKeyData = hexToU8A(baseKeyField.value);\n\t\t\t\tpublicKeyData = hexToU8A(publicKeyField.value || \"00\");\n\t\t\t}\n\t\t\tlet baseKeyImport = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"importKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tformat: importAsOption.value,\n\t\t\t\t\tkeyData: baseKeyData,\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tnamedCurve: namedCurveOption.value,\n\t\t\t\t\t\tlength: parseInt(lengthField.value)\n\t\t\t\t\t},\n\t\t\t\t\textractable: false,\n\t\t\t\t\tkeyUsages: [ \"deriveBits\" ]\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet publicKeyImport;\n\t\t\tif (publicKeyData.value) {\n\t\t\t\tpublicKeyImport = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\tformat: importAsOption.value,\n\t\t\t\t\t\tkeyData: publicKeyData,\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\t\tnamedCurve: namedCurveOption.value,\n\t\t\t\t\t\t\tlength: parseInt(lengthField.value)\n\t\t\t\t\t\t},\n\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\tkeyUsages: []\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tderivedBitsField.value = u8aToHex(new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"deriveBits\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: {\n\t\t\t\t\t\tname: algorithmOption.value,\n\t\t\t\t\t\tpublic: publicKeyImport,\n\t\t\t\t\t\thash: hashOption.value,\n\t\t\t\t\t\tsalt: hexToU8A(saltField.value),\n\t\t\t\t\t\tinfo: new Uint8Array(),\n\t\t\t\t\t\titerations: parseInt(iterationsField.value),\n\t\t\t\t\t},\n\t\t\t\t\tbaseKey: baseKeyImport,\n\t\t\t\t\tlength: parseInt(lengthField.value)\n\t\t\t\t}\n\t\t\t})));\n\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tkey: baseKeyImport\n\t\t\t\t}\n\t\t\t});\n\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"unloadKey\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\tkey: publicKeyImport\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/date.js
async function dateInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "date" + ".js";
	let linkPath = target + "/apps/links/" + "date" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: NONE\n// signature: 6fca2168bb7d8ba63edaf26a67842f8becd6fd2d8e354c3eaaa638a235a1889c3fcebd0b92eff5d948a0239286fef162bb5fbc417f7835321fb60a2df3bab50b\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tawait availableAPIs.toMyCLI(new Date().toString() + \"\\r\\n\");\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/deluser.js
async function deluserInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "deluser" + ".js";
	let linkPath = target + "/apps/links/" + "deluser" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SET_SECURITY_CHECKS, CSP_OPERATIONS, SET_USER_INFO, FS_LIST_PARTITIONS, FS_READ, FS_BYPASS_PERMISSIONS, FS_REMOVE, GET_USER_INFO, USER_INFO_OTHERS\n// signature: 0f87c499620b61d142b5a9aabf135f8e039403d6c4cfcb241b49641266253680862e57f4d544496248c865dd34b00ed6eb485b27ad0ca19f984434f57f559c58\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"deluser: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\tif (ppos.length < 1) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"DELUSER_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"DELUSER_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"DELUSER_HOMEDIR\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"deluser: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"OLD_USER_DELETION\")).replace(\"%s\", ppos[0]) + \"\\r\\n\");\n\ttry {\n\t\tlet userInfo = await availableAPIs.getUserInfo({ desiredUser: ppos[0] });\n\t\tif (!userInfo) throw new Error(\"ACCESS_FN_FAIL\");\n\t\tawait availableAPIs.setUserInfo({\n\t\t\tdesiredUser: ppos[0],\n\t\t\tinfo: undefined\n\t\t})\n\t\tif (pargs.homedir) await recursiveRemove(userInfo.homeDirectory);\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"deluser: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\treturn await availableAPIs.terminate();\n})();\n\nasync function recursiveRemove(path) {\n\tlet dirList = await availableAPIs.fs_ls({ path });\n\tfor (let fileIndex in dirList) {\n\t\tlet file = dirList[fileIndex];\n\t\tif (await availableAPIs.fs_isDirectory({ path: path + \"/\" + file })) await recursiveRemove(path + \"/\" + file);\n\t\telse await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t}\n\tawait availableAPIs.fs_rm({ path });\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/df.js
async function dfInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "df" + ".js";
	let linkPath = target + "/apps/links/" + "df" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_LIST_PARTITIONS\n// signature: efa3769f1544667b05143ca3c0da7e23954ae2573a20d45de2c252364245ebc8d627e3e13e723d40f12b377c2878a7e9494a1f7baa93e7ed356f4e40dc513c1d\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"df: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tlet human = exec_args.includes(\"-h\") || exec_args.includes(\"--human-readable\");\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"DF_HEADER\") + \"\\r\\n\");\n\tlet estimateStorage = await availableAPIs.estimateStorage();\n\tfor (let medium in estimateStorage) {\n\t\tlet displayedSize = estimateStorage[medium].total;\n\t\tif (human) displayedSize = await availableAPIs.ufInfoUnits([estimateStorage[medium].total, true]);\n\t\tlet displayedUsed = estimateStorage[medium].used;\n\t\tif (human) displayedUsed = await availableAPIs.ufInfoUnits([estimateStorage[medium].used, true]);\n\t\tlet displayedFree = estimateStorage[medium].free;\n\t\tif (human) displayedFree = await availableAPIs.ufInfoUnits([estimateStorage[medium].free, true]);\n\t\tawait availableAPIs.toMyCLI(medium + \"\\t\" + displayedSize + \"\\t\" + displayedUsed + \"\\t\" + displayedFree + \"\\t\" + Math.floor(estimateStorage[medium].used / estimateStorage[medium].total * 100) + \"%\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/diff.js
async function diffInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "diff" + ".js";
	let linkPath = target + "/apps/links/" + "diff" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, PATCH_DIFF\n// signature: e06f426e919155d16e37e94990ce7b50ea1752f805ccd63955414d1a5091a46037b45e2046db30f8980a2b87e1dcd870d5167bd23ba97ce0fe415476b10ef835\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"diff: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"DIFF_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"DIFF_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"diff: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tif (exec_args.length != 3) {\n\t\tawait availableAPIs.toMyCLI(\"diff: \" + await availableAPIs.lookupLocale(\"ARGUMENT_COUNT_MISMATCH\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.fs_write({\n\t\t\tpath: exec_args[2],\n\t\t\tdata: JSON.stringify(await availableAPIs.patchDiff({\n\t\t\t\toperation: \"calcPatch\",\n\t\t\t\targs: [ await availableAPIs.fs_read({ path: exec_args[0] }), await availableAPIs.fs_read({ path: exec_args[1] }) ]\n\t\t\t}))\n\t\t})\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"diff: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/diffupdate.js
async function diffupdateInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "diffupdate" + ".js";
	let linkPath = target + "/apps/links/" + "diffupdate" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, PATCH_DIFF, RESOLVE_NAME, CONNFUL_CONNECT, CONNFUL_READ, CONNFUL_WRITE, CONNFUL_DISCONNECT, FS_LIST_PARTITIONS, CSP_OPERATIONS, START_TASK, LIST_TASKS, GET_UPDATE_SERVICE, CONNFUL_IDENTITY_GET\n// allow: FS_WRITE, RUN_KLVL_CODE, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, GET_LOCALE, FS_LIST_PARTITIONS, SYSTEM_SHUTDOWN, FS_READ, FS_BYPASS_PERMISSIONS\n// signature: 59debaf7dacc8cccc7f65caffe2a92c76da00434b7e11184e0cd0bb75cf27d31731f38bfda4ffd7659c06c584729acb0bbc5d135f9678730215fe8196f86312c\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\ttry {\n\t\tlet etcls = await availableAPIs.fs_ls({\n\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc\"\n\t\t});\n\t\tlet from = \"scratch\";\n\t\tlet originalVersion = \"\";\n\t\tif (etcls.includes(\"diffupdate_cache.js\")) {\n\t\t\toriginalVersion = await availableAPIs.fs_read({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\"\n\t\t\t});\n\t\t\tfrom = originalVersion.split(\"\\n\")[5].match(/\\d\\w+/)[0];\n\t\t}\n\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"CURRENT_OSFILE_VERSION\")).replace(\"%s\", from) + \"\\r\\n\");\n\t\tlet serverDomainOrAddress = ppos[0] || ((await availableAPIs.getUpdateService()) || \"pcosserver.pc\");\n\t\tlet serverAddress = serverDomainOrAddress;\n\t\tif (!serverAddress.includes(\":\")) serverAddress = await availableAPIs.resolve(serverAddress);\n\t\tif (!serverAddress) throw new Error(await availableAPIs.lookupLocale(\"HOSTNAME_RESOLUTION_FAILED\"));\n\t\tserverAddress = serverAddress.replaceAll(\":\", \"\");\n\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"DOWNLOADING_OS_PATCH\")).replace(\"%s\", serverDomainOrAddress).replace(\"%s\", serverAddress.match(/.{1,4}/g).join(\":\")) + \"\\r\\n\");\n\t\tlet connection = await availableAPIs.connfulConnect({\n\t\t\tgate: \"deltaUpdate\",\n\t\t\taddress: serverAddress,\n\t\t\tverifyByDomain: serverDomainOrAddress.includes(\":\") ? serverAddress : serverDomainOrAddress,\n\t\t\tdoNotVerifyServer: pargs[\"fingerprint\"] || pargs[\"no-verification\"] || pargs[\"view-fingerprint\"]\n\t\t});\n\t\tawait availableAPIs.connfulConnectionSettled(connection);\n\t\tif (pargs[\"fingerprint\"] || pargs[\"view-fingerprint\"]) {\n\t\t\tlet identity = await availableAPIs.connfulIdentityGet(connection);\n\t\t\tlet hash = await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"digest\",\n\t\t\t\tcspArgument: {\n\t\t\t\t\talgorithm: \"SHA-256\",\n\t\t\t\t\tdata: new TextEncoder().encode(identity)\n\t\t\t\t}\n\t\t\t});\n\t\t\thash = Array.from(new Uint8Array(hash)).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\tif (pargs[\"view-fingerprint\"]) await availableAPIs.toMyCLI(\"--fingerprint=\" + hash + \"\\r\\n\");\n\t\t\tif (pargs[\"fingerprint\"] != hash) {\n\t\t\t\tawait availableAPIs.connfulDisconnect(connection);\n\t\t\t\tif (!pargs[\"view-fingerprint\"]) await availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"SERVER_SIGNATURE_VERIFICATION_FAILED\") + \"\\r\\n\");\n\t\t\t\treturn await availableAPIs.terminate();\n\t\t\t}\n\t\t}\n\t\tawait availableAPIs.connfulWrite({\n\t\t\tconnectionID: connection,\n\t\t\tdata: JSON.stringify({ from, handlesCtr: true })\n\t\t})\n\t\tlet patch = [];\n\t\twhile (true) {\n\t\t\tlet a = JSON.parse(await availableAPIs.connfulRead(connection));\n\t\t\tif (a.final) break;\n\t\t\tpatch[a.ctr] = a.hunk;\n\t\t\tawait availableAPIs.toMyCLI(\"\\r\" + (await availableAPIs.lookupLocale(\"PATCH_HUNK_COUNT\")).replace(\"%s\", patch.length));\n\t\t}\n\t\tawait availableAPIs.connfulDisconnect(connection);\n\t\tawait availableAPIs.toMyCLI(\"\\r\" + (await availableAPIs.lookupLocale(\"PATCH_HUNK_COUNT\")).replace(\"%s\", patch.length) + \"\\r\\n\");\n\t\tif (patch.length == 0) {\n\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"SYSTEM_UP_TO_DATE\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t\tawait availableAPIs.fs_write({\n\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\",\n\t\t\tdata: (await availableAPIs.patchDiff({\n\t\t\t\toperation: \"applyPatch\",\n\t\t\t\targs: [ originalVersion, patch ]\n\t\t\t})).join(\"\")\n\t\t});\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"HANDOFF_UPDATE\") + \"\\r\\n\");\n\t\tlet task = await availableAPIs.startTask({\n\t\t\tfile: (await availableAPIs.getSystemMount()) + \"/apps/updateos.js\",\n\t\t\targPassed: [ (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\" ],\n\t\t\tsilent: true\n\t\t});\n\t\tawait availableAPIs.waitTermination(task);\n\t\tawait availableAPIs.terminate();\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"diffupdate: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\tawait availableAPIs.terminate();\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/explorer.js
async function explorerInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "explorer" + ".js";
	let linkPath = target + "/apps/links/" + "explorer" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "FILE_EXPLORER" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:FILE_EXPLORER\n// signer: automaticSigner\n// allow: FS_READ, FS_LIST_PARTITIONS, ELEVATE_PRIVILEGES, START_TASK, GET_LOCALE, GET_THEME, MANAGE_TOKENS, FS_REMOVE, FS_BYPASS_PERMISSIONS, FS_UNMOUNT, FS_CHANGE_PERMISSION, FS_MOUNT, GET_FILESYSTEMS, FS_WRITE, LLDISK_LIST_PARTITIONS, GET_USER_INFO\n// signature: 9c1362cbdfc48fc3f4eb76ad105212ed2d38f1a30604f8cc3fd423d60da6ee5f3d06dbb3c21dca3d5faaca51e68e6e0ebce9aba1785cd0c99e59f0e199f6c301\n// =====END MANIFEST=====\nlet globalToken;\nlet cachedIcons = {};\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"FILE_EXPLORER\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_LIST_PARTITIONS\" ];\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"GRANT_FEXP_PERM\");\n\t\tlet button = document.createElement(\"button\");\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"GRANT_PERM\");\n\t\tdocument.body.appendChild(button);\n\t\tif (!privileges.includes(\"ELEVATE_PRIVILEGES\")) {\n\t\t\tbutton.disabled = true;\n\t\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"GRANT_FEXP_PERM_ADM\");\n\t\t\treturn;\n\t\t}\n\t\tawait new Promise(function(resolve) {\n\t\t\tbutton.onclick = async function() {\n\t\t\t\tbutton.disabled = true;\n\t\t\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\t\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_FULL_INTENT\"),\n\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\")\n\t\t\t\t});\n\t\t\t\tbutton.disabled = false;\n\t\t\t\tif (!newToken) return;\n\t\t\t\tif (privileges.includes(\"MANAGE_TOKENS\")) globalToken = await availableAPIs.forkToken(newToken);\n\t\t\t\tawait availableAPIs.setProcessToken(newToken);\n\t\t\t\tawait availableAPIs.revokeToken(currentToken);\n\t\t\t\tprivileges = await availableAPIs.getPrivileges();\n\t\t\t\tif (checklist.every(p => privileges.includes(p))) resolve();\n\t\t\t\telse document.body.innerText = await availableAPIs.lookupLocale(\"GRANT_FEXP_PERM_USR\");\n\t\t\t}\n\t\t});\n\t}\n\tlet hideHiddenFiles = true;\n\ttry {\n\t\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\thideHiddenFiles = (await availableAPIs.fs_read({\n\t\t\tpath: homedir + \"/.hiddenFiles\",\n\t\t})) != \"show\";\n\t} catch {}\n\tdocument.body.innerText = \"\";\n\tlet mainComponent = document.createElement(\"div\");\n\tlet pathInputForm = document.createElement(\"form\");\n\tlet pathElement = document.createElement(\"input\");\n\tlet browseButton = document.createElement(\"button\");\n\tlet displayResult = document.createElement(\"div\");\n\tlet previousDirectory = \"\";\n\tlet clipboard = {\n\t\tpath: \"\",\n\t\tcut: false,\n\t\tselected: false\n\t};\n\tmainComponent.style.display = \"flex\";\n\tmainComponent.style.flexDirection = \"column\";\n\tmainComponent.style.width = \"100%\";\n\tmainComponent.style.height = \"100%\";\n\tmainComponent.style.position = \"absolute\";\n\tmainComponent.style.top = \"0\";\n\tmainComponent.style.left = \"0\";\n\tmainComponent.style.padding = \"8px\";\n\tmainComponent.style.boxSizing = \"border-box\";\n\tdisplayResult.style.flex = \"1\";\n\tbrowseButton.innerText = await availableAPIs.lookupLocale(\"BROWSE_FEXP\");\n\tpathInputForm.appendChild(pathElement);\n\tpathInputForm.appendChild(browseButton);\n\tmainComponent.appendChild(pathInputForm);\n\tmainComponent.appendChild(displayResult);\n\tdocument.body.appendChild(mainComponent);\n\tlet availableIcons = [];\n\ttry {\n\t\tavailableIcons = await availableAPIs.fs_ls({ path: await availableAPIs.getSystemMount() + \"/etc/icons\" });\n\t} catch {}\n\tdisplayResult.oncontextmenu = async function(e) {\n\t\te.stopImmediatePropagation();\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tdisplayResult.innerText = \"\";\n\t\tlet showHiddenFilesToggle = document.createElement(\"button\");\n\t\tshowHiddenFilesToggle.innerText = await availableAPIs.lookupLocale(\"TOGGLE_HIDDEN_FILES\");\n\t\tshowHiddenFilesToggle.addEventListener(\"click\", async function() {\n\t\t\thideHiddenFiles = !hideHiddenFiles;\n\t\t\ttry {\n\t\t\t\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\t\t\tavailableAPIs.fs_write({\n\t\t\t\t\tpath: homedir + \"/.hiddenFiles\",\n\t\t\t\t\tdata: (hideHiddenFiles ? \"hide\" : \"show\")\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t\tbrowse();\n\t\t});\n\t\tdisplayResult.appendChild(showHiddenFilesToggle);\n\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\tif (previousDirectory == \"\") {\n\t\t\tlet mountForm = document.createElement(\"form\");\n\t\t\tlet mountpoint = document.createElement(\"input\");\n\t\t\tlet filesystemOptions = document.createElement(\"select\");\n\t\t\tlet autoGenMountOptions = document.createElement(\"select\");\n\t\t\tlet mountOptions = document.createElement(\"textarea\");\n\t\t\tlet mountButton = document.createElement(\"button\");\n\t\t\tmountpoint.placeholder = await availableAPIs.lookupLocale(\"MOUNTPOINT\");\n\t\t\tlet availableFilesystems = await availableAPIs.supportedFilesystems();\n\t\t\tfor (let filesystem of availableFilesystems) {\n\t\t\t\tlet option = document.createElement(\"option\");\n\t\t\t\toption.value = filesystem;\n\t\t\t\toption.innerText = filesystem;\n\t\t\t\tfilesystemOptions.appendChild(option);\n\t\t\t}\n\t\t\tlet availablePartitions = [];\n\t\t\ttry {\n\t\t\t\tavailablePartitions = await availableAPIs.lldaList();\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t\tlet defaultPartitionOption = document.createElement(\"option\");\n\t\t\tdefaultPartitionOption.value = \"\";\n\t\t\tdefaultPartitionOption.innerText = await availableAPIs.lookupLocale(\"GENERATE_PROMPT\");\n\t\t\tdefaultPartitionOption.selected = true;\n\t\t\tdefaultPartitionOption.disabled = true;\n\t\t\tdefaultPartitionOption.hidden = true;\n\t\t\tautoGenMountOptions.appendChild(defaultPartitionOption);\n\t\t\tfor (let partition of availablePartitions) {\n\t\t\t\tlet option = document.createElement(\"option\");\n\t\t\t\toption.value = partition;\n\t\t\t\toption.innerText = partition;\n\t\t\t\tautoGenMountOptions.appendChild(option);\n\t\t\t}\n\t\t\tautoGenMountOptions.onchange = function() {\n\t\t\t\tmountOptions.value = JSON.stringify({ partition: autoGenMountOptions.value });\n\t\t\t}\n\t\t\tmountOptions.value = \"{}\";\n\t\t\tmountButton.innerText = await availableAPIs.lookupLocale(\"MOUNT_BUTTON\");\n\t\t\tmountButton.onclick = async function() {\n\t\t\t\ttry {\n\t\t\t\t\tlet options = JSON.parse(mountOptions.value);\n\t\t\t\t\tawait availableAPIs.fs_mount({ mountpoint: mountpoint.value, filesystem: filesystemOptions.value, filesystemOptions: options });\n\t\t\t\t\tbrowse();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", e.name + \": \" + e.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmountForm.appendChild(mountpoint);\n\t\t\tmountForm.appendChild(document.createElement(\"br\"));\n\t\t\tmountForm.appendChild(filesystemOptions);\n\t\t\tmountForm.appendChild(document.createElement(\"hr\"));\n\t\t\tmountForm.appendChild(autoGenMountOptions);\n\t\t\tmountForm.appendChild(document.createElement(\"br\"));\n\t\t\tmountForm.appendChild(mountOptions);\n\t\t\tmountForm.appendChild(document.createElement(\"hr\"));\n\t\t\tmountForm.appendChild(mountButton);\n\t\t\tdisplayResult.appendChild(mountForm);\n\t\t} else {\n\t\t\tlet makeDirectoryForm = document.createElement(\"form\");\n\t\t\tlet makeDirectoryInput = document.createElement(\"input\");\n\t\t\tlet makeDirectoryButton = document.createElement(\"button\");\n\t\t\tmakeDirectoryInput.pattern = \"[!-.0-~]+\";\n\t\t\tmakeDirectoryInput.placeholder = await availableAPIs.lookupLocale(\"NEW_DIR_NAME\");\n\t\t\tmakeDirectoryForm.appendChild(makeDirectoryInput);\n\t\t\tmakeDirectoryForm.appendChild(makeDirectoryButton);\n\t\t\tdisplayResult.appendChild(makeDirectoryForm);\n\t\t\tmakeDirectoryButton.innerText = await availableAPIs.lookupLocale(\"MKDIR_BUTTON\");\n\t\t\tmakeDirectoryButton.onclick = async function() {\n\t\t\t\tlet dirName = makeDirectoryInput.value;\n\t\t\t\tif (dirName == \"\") return;\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: previousDirectory + \"/\" + dirName });\n\t\t\t\t\tbrowse();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (clipboard.selected) {\n\t\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\t\t\tlet pasteButton = document.createElement(\"button\");\n\t\t\t\tpasteButton.innerText = await availableAPIs.lookupLocale(\"CLIPBOARD_PASTE\");\n\t\t\t\tpasteButton.onclick = async function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet copyAllowed = await isDirectory(clipboard.path) == \"file\";\n\t\t\t\t\t\tif (!copyAllowed) throw new Error(await availableAPIs.lookupLocale(\"CLIPBOARD_SOURCE_GONE\"));\n\t\t\t\t\t\tlet readFile = await availableAPIs.fs_read({ path: clipboard.path });\n\t\t\t\t\t\tlet basename = clipboard.path.split(\"/\").slice(-1)[0];\n\t\t\t\t\t\tcopyAllowed = await isDirectory(previousDirectory + \"/\" + basename) == \"unknown\";\n\t\t\t\t\t\tif (!copyAllowed) throw new Error(await availableAPIs.lookupLocale(\"CLIPBOARD_CONFLICT\"));\n\t\t\t\t\t\tawait availableAPIs.fs_write({ path: previousDirectory + \"/\" + basename, data: readFile });\n\t\t\t\t\t\tif (clipboard.cut) await availableAPIs.fs_rm({ path: clipboard.path });\n\t\t\t\t\t\tbrowse();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdisplayResult.appendChild(pasteButton);\n\t\t\t}\n\t\t}\n\t}\n\tasync function browse() {\n\t\tlet path = pathElement.value;\n\t\tif (path.endsWith(\"/\")) path = path.substring(0, path.length - 1);\n\t\tdisplayResult.innerText = \"\";\n\t\tif (path == \"\") {\n\t\t\tlet partitions = await availableAPIs.fs_mounts();\n\t\t\tfor (let partition of partitions) {\n\t\t\t\tif (partition.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\topenButton.innerText = partition;\n\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\tpathElement.value = partition;\n\t\t\t\t\tbrowse();\n\t\t\t\t}\n\t\t\t\topenButton.oncontextmenu = async function(e) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tdisplayResult.innerText = \"\";\n\t\t\t\t\tlet unmountButton = document.createElement(\"button\");\n\t\t\t\t\tunmountButton.innerText = await availableAPIs.lookupLocale(\"UNMOUNT_BTN\");\n\t\t\t\t\tunmountButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: partition });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tunmountButton.oncontextmenu = async function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_unmount({ mount: partition, force: true });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(unmountButton);\n\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\n\t\t\t\t\tlet deleteButton = document.createElement(\"button\");\n\t\t\t\t\tlet deleteConfirm = false;\n\t\t\t\t\tdeleteButton.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\t\t\t\tdeleteButton.onclick = async function() {\n\t\t\t\t\t\tif (!deleteConfirm) {\n\t\t\t\t\t\t\tdeleteButton.style.fontWeight = \"bold\";\n\t\t\t\t\t\t\tdeleteConfirm = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait recursiveRemove(partition);\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(deleteButton);\n\n\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"br\"));\n\t\t\t\t\tlet permissions = { owner: \"nobody\", group: \"nobody\", world: \"rx\" };\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpermissions = await availableAPIs.fs_permissions({ path: partition });\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t\tlet chownForm = document.createElement(\"form\");\n\t\t\t\t\tlet chownInput = document.createElement(\"input\");\n\t\t\t\t\tlet chownButton = document.createElement(\"button\");\n\t\t\t\t\tchownInput.value = permissions.owner;\n\t\t\t\t\tchownButton.innerText = await availableAPIs.lookupLocale(\"CHOWN_BUTTON\");\n\t\t\t\t\tchownForm.appendChild(chownInput);\n\t\t\t\t\tchownForm.appendChild(chownButton);\n\t\t\t\t\tdisplayResult.appendChild(chownForm);\n\t\t\t\t\tchownButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_chown({ path: partition, newUser: chownInput.value });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet chgrpForm = document.createElement(\"form\");\n\t\t\t\t\tlet chgrpInput = document.createElement(\"input\");\n\t\t\t\t\tlet chgrpButton = document.createElement(\"button\");\n\t\t\t\t\tchgrpInput.value = permissions.group;\n\t\t\t\t\tchgrpButton.innerText = await availableAPIs.lookupLocale(\"CHGRP_BUTTON\");\n\t\t\t\t\tchgrpForm.appendChild(chgrpInput);\n\t\t\t\t\tchgrpForm.appendChild(chgrpButton);\n\t\t\t\t\tdisplayResult.appendChild(chgrpForm);\n\t\t\t\t\tchgrpButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_chgrp({ path: partition, newGrp: chgrpInput.value });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet chmodForm = document.createElement(\"form\");\n\t\t\t\t\tlet chmodInput = document.createElement(\"input\");\n\t\t\t\t\tlet chmodButton = document.createElement(\"button\");\n\t\t\t\t\tchmodInput.value = permissions.world;\n\t\t\t\t\tchownInput.pattern = \"[rwx]+\";\n\t\t\t\t\tchmodButton.innerText = await availableAPIs.lookupLocale(\"CHMOD_BUTTON\");\n\t\t\t\t\tchmodForm.appendChild(chmodInput);\n\t\t\t\t\tchmodForm.appendChild(chmodButton);\n\t\t\t\t\tdisplayResult.appendChild(chmodForm);\n\t\t\t\t\tchmodButton.onclick = async function() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait availableAPIs.fs_chmod({ path: partition, newPermissions: chmodInput.value });\n\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t}\n\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\t\tlet spaceDisplayer = document.createElement(\"div\");\n\t\t\tlet spaces = await availableAPIs.estimateStorage();\n\t\t\tfor (let space in spaces) {\n\t\t\t\tlet newSpace = document.createElement(\"div\");\n\t\t\t\tnewSpace.innerText = (await availableAPIs.lookupLocale(\"SPACE_SHOWER\")).replace(\"%s\", space).replace(\"%s\", await availableAPIs.ufInfoUnits([spaces[space].used])).replace(\"%s\", await availableAPIs.ufInfoUnits([spaces[space].total])).replace(\"%s\", (spaces[space].used / spaces[space].total * 100).toFixed(2));\n\t\t\t\tspaceDisplayer.appendChild(newSpace);\n\t\t\t}\n\t\t\tdisplayResult.appendChild(spaceDisplayer);\n\t\t\tpreviousDirectory = path;\n\t\t\treturn \"browsed\";\n\t\t}\n\t\ttry {\n\t\t\tlet type = await isDirectory(path);\n\t\t\tif (type == \"directory\") {\n\t\t\t\tlet ls = await availableAPIs.fs_ls({ path: path });\n\t\t\t\tfor (let file of ls) {\n\t\t\t\t\tif (file.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\t\tlet fileIcon = document.createElement(\"img\");\n\t\t\t\t\tfileIcon.style.width = \"12px\";\n\t\t\t\t\tfileIcon.style.height = \"12px\";\n\t\t\t\t\tlet fileType = file.split(\".\").slice(-1)[0];\n\t\t\t\t\tlet isDir = await isDirectory(path + \"/\" + file);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet wantedIcon;\n\t\t\t\t\t\tif (isDir == \"directory\") wantedIcon = \"foldericon.pic\";\n\t\t\t\t\t\telse if (availableIcons.includes(fileType + \".pic\")) wantedIcon = fileType + \".pic\";\n\t\t\t\t\t\telse wantedIcon = \"fileicon.pic\";\n\t\t\t\t\t\tif (!cachedIcons.hasOwnProperty(wantedIcon)) cachedIcons[wantedIcon] = await availableAPIs.fs_read({ path: await availableAPIs.getSystemMount() + \"/etc/icons/\" + wantedIcon });\n\t\t\t\t\t\tfileIcon.src = cachedIcons[wantedIcon];\n\t\t\t\t\t} catch {}\n\t\t\t\t\topenButton.innerText = file;\n\t\t\t\t\topenButton.insertAdjacentElement(\"afterbegin\", fileIcon);\n\t\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\t\tpathElement.value = path + \"/\" + file;\n\t\t\t\t\t\tbrowse();\n\t\t\t\t\t}\n\t\t\t\t\topenButton.oncontextmenu = async function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tdisplayResult.innerText = \"\";\n\t\t\t\t\t\tlet copyAllow = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcopyAllow = isDir == \"file\";\n\t\t\t\t\t\t} catch {}\n\t\t\t\t\t\tif (copyAllow) {\n\t\t\t\t\t\t\tlet copyButton = document.createElement(\"button\");\n\t\t\t\t\t\t\tcopyButton.innerText = await availableAPIs.lookupLocale(\"CLIPBOARD_COPY\");\n\t\t\t\t\t\t\tcopyButton.onclick = async function() {\n\t\t\t\t\t\t\t\tclipboard = {\n\t\t\t\t\t\t\t\t\tpath: path + \"/\" + file,\n\t\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t\t\tcut: false\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdisplayResult.appendChild(copyButton);\n\n\t\t\t\t\t\t\tlet cutButton = document.createElement(\"button\");\n\t\t\t\t\t\t\tcutButton.innerText = await availableAPIs.lookupLocale(\"CLIPBOARD_CUT\");\n\t\t\t\t\t\t\tcutButton.onclick = async function() {\n\t\t\t\t\t\t\t\tclipboard = {\n\t\t\t\t\t\t\t\t\tpath: path + \"/\" + file,\n\t\t\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\t\t\tcut: true\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdisplayResult.appendChild(cutButton);\n\t\t\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"hr\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet deleteButton = document.createElement(\"button\");\n\t\t\t\t\t\tlet deleteConfirm = false;\n\t\t\t\t\t\tdeleteButton.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\t\t\t\t\tdeleteButton.onclick = async function() {\n\t\t\t\t\t\t\tif (!deleteConfirm) {\n\t\t\t\t\t\t\t\tdeleteButton.style.fontWeight = \"bold\";\n\t\t\t\t\t\t\t\tdeleteConfirm = true;\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tlet isDir = await isDirectory(path + \"/\" + file);\n\t\t\t\t\t\t\t\tif (isDir == \"directory\") await recursiveRemove(path + \"/\" + file);\n\t\t\t\t\t\t\t\telse if (isDir == \"file\") await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdisplayResult.appendChild(deleteButton);\n\t\t\t\t\t\tdisplayResult.appendChild(document.createElement(\"br\"));\n\t\t\t\t\t\tlet permissions = { owner: \"nobody\", group: \"nobody\", world: \"rx\" };\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tpermissions = await availableAPIs.fs_permissions({ path: path + \"/\" + file });\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet chownForm = document.createElement(\"form\");\n\t\t\t\t\t\tlet chownInput = document.createElement(\"input\");\n\t\t\t\t\t\tlet chownButton = document.createElement(\"button\");\n\t\t\t\t\t\tchownInput.value = permissions.owner;\n\t\t\t\t\t\tchownButton.innerText = await availableAPIs.lookupLocale(\"CHOWN_BUTTON\");\n\t\t\t\t\t\tchownForm.appendChild(chownInput);\n\t\t\t\t\t\tchownForm.appendChild(chownButton);\n\t\t\t\t\t\tdisplayResult.appendChild(chownForm);\n\t\t\t\t\t\tchownButton.onclick = async function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_chown({ path: path + \"/\" + file, newUser: chownInput.value });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet chgrpForm = document.createElement(\"form\");\n\t\t\t\t\t\tlet chgrpInput = document.createElement(\"input\");\n\t\t\t\t\t\tlet chgrpButton = document.createElement(\"button\");\n\t\t\t\t\t\tchgrpInput.value = permissions.group;\n\t\t\t\t\t\tchgrpButton.innerText = await availableAPIs.lookupLocale(\"CHGRP_BUTTON\");\n\t\t\t\t\t\tchgrpForm.appendChild(chgrpInput);\n\t\t\t\t\t\tchgrpForm.appendChild(chgrpButton);\n\t\t\t\t\t\tdisplayResult.appendChild(chgrpForm);\n\t\t\t\t\t\tchgrpButton.onclick = async function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_chgrp({ path: path + \"/\" + file, newGrp: chgrpInput.value });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet chmodForm = document.createElement(\"form\");\n\t\t\t\t\t\tlet chmodInput = document.createElement(\"input\");\n\t\t\t\t\t\tlet chmodButton = document.createElement(\"button\");\n\t\t\t\t\t\tchmodInput.value = permissions.world;\n\t\t\t\t\t\tchownInput.pattern = \"[rwx]+\";\n\t\t\t\t\t\tchmodButton.innerText = await availableAPIs.lookupLocale(\"CHMOD_BUTTON\");\n\t\t\t\t\t\tchmodForm.appendChild(chmodInput);\n\t\t\t\t\t\tchmodForm.appendChild(chmodButton);\n\t\t\t\t\t\tdisplayResult.appendChild(chmodForm);\n\t\t\t\t\t\tchmodButton.onclick = async function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait availableAPIs.fs_chmod({ path: path + \"/\" + file, newPermissions: chmodInput.value });\n\t\t\t\t\t\t\t\tbrowse();\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t\t}\n\t\t\t\tpreviousDirectory = path;\n\t\t\t} else if (type == \"file\") {\n\t\t\t\tlet hasError = false;\n\t\t\t\tpathElement.value = previousDirectory;\n\t\t\t\tif (path.endsWith(\".js\")) {\n\t\t\t\t\tif (privileges.includes(\"START_TASK\") && privileges.includes(\"ELEVATE_PRIVILEGES\") && privileges.includes(\"MANAGE_TOKENS\")) {\n\t\t\t\t\t\tif (!globalToken) globalToken = await availableAPIs.consentGetToken({\n\t\t\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_INTENT\"),\n\t\t\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\"),\n\t\t\t\t\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (globalToken) {\n\t\t\t\t\t\t\tlet newToken = await availableAPIs.forkToken(globalToken);\n\t\t\t\t\t\t\tawait availableAPIs.startTask({ file: path, token: newToken });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdisplayResult.innerText = await availableAPIs.lookupLocale(\"MORE_PERMISSION_DENIED\");\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (path.endsWith(\".lnk\") && privileges.includes(\"ELEVATE_PRIVILEGES\") && privileges.includes(\"MANAGE_TOKENS\")) {\n\t\t\t\t\tlet file = await availableAPIs.fs_read({ path: path });\n\t\t\t\t\tfile = JSON.parse(file);\n\t\t\t\t\tif (privileges.includes(\"START_TASK\")) {\n\t\t\t\t\t\tif (!globalToken) globalToken = await availableAPIs.consentGetToken({\n\t\t\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_INTENT\"),\n\t\t\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\"),\n\t\t\t\t\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (globalToken) {\n\t\t\t\t\t\t\tlet newToken = await availableAPIs.forkToken(globalToken);\n\t\t\t\t\t\t\tawait availableAPIs.startTask({ file: file.path, argPassed: [ ...(file.args || []) ], token: newToken });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdisplayResult.innerText = await availableAPIs.lookupLocale(\"MORE_PERMISSION_DENIED\");\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet lookUpAssociation = await availableAPIs.fs_ls({ path: await availableAPIs.getSystemMount() + \"/apps/associations\" });\n\t\t\t\t\tlet fileType = path.split(\".\").slice(-1)[0];\n\t\t\t\t\tif (!lookUpAssociation.includes(fileType)) return displayResult.innerText = await availableAPIs.lookupLocale(\"UNKNOWN_FILE_TYPE\");\n\t\t\t\t\tlet file = await availableAPIs.fs_read({ path: await availableAPIs.getSystemMount() + \"/apps/associations/\" + fileType });\n\t\t\t\t\tlet fileLink = JSON.parse(file);\n\t\t\t\t\tif (privileges.includes(\"START_TASK\") && privileges.includes(\"ELEVATE_PRIVILEGES\") && privileges.includes(\"MANAGE_TOKENS\")) {\n\t\t\t\t\t\tif (!globalToken) globalToken = await availableAPIs.consentGetToken({\n\t\t\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"FILE_EXPLORER_INTENT\"),\n\t\t\t\t\t\t\tname: await availableAPIs.lookupLocale(\"FILE_EXPLORER\"),\n\t\t\t\t\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (globalToken) {\n\t\t\t\t\t\t\tlet newToken = await availableAPIs.forkToken(globalToken);\n\t\t\t\t\t\t\tawait availableAPIs.startTask({ file: fileLink.path, argPassed: [ ...(fileLink.args || []), path ], token: newToken });\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdisplayResult.innerText = await availableAPIs.lookupLocale(\"MORE_PERMISSION_DENIED\");\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!hasError) await browse();\n\t\t\t} else {\n\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", (await availableAPIs.lookupLocale(\"UNKNOWN_FS_STRUCT\")).replace(\"%s\", type));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t}\n\t}\n\tif (exec_args[0]) pathElement.value = exec_args[0];\n\tbrowse();\n\tbrowseButton.onclick = browse;\n})();\nasync function recursiveRemove(path) {\n\tlet dirList = await availableAPIs.fs_ls({ path });\n\tfor (let fileIndex in dirList) {\n\t\tlet file = dirList[fileIndex];\n\t\tif (await availableAPIs.fs_isDirectory({ path: path + \"/\" + file })) await recursiveRemove(path + \"/\" + file);\n\t\telse await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t}\n\tawait availableAPIs.fs_rm({ path });\n}\nasync function isDirectory(path) {\n\ttry {\n\t\tlet isDirectoryVar = await availableAPIs.fs_isDirectory({ path });\n\t\treturn isDirectoryVar ? \"directory\" : \"file\";\n\t} catch {\n\t\treturn \"unknown\";\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tif (globalToken) await availableAPIs.revokeToken(globalToken);\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/filePicker.js
async function filePickerInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "filePicker" + ".js";
	let linkPath = target + "/apps/links/" + "filePicker" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: FS_READ, FS_LIST_PARTITIONS, IPC_SEND_PIPE, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS, GET_USER_INFO\n// signature: 4d0eea983ee1124a45aafe8c8a1d97e05b163e861b65cdba24a06eff73d7973b128079e0d2f5802da2041ef46dcb00d931d01868e752f5913b8f4be299760ce2\n// =====END MANIFEST=====\nlet ipcChannel = exec_args[0];\n(async function() {\n\t// @pcos-app-mode isolatable\n\tif (!ipcChannel) return availableAPIs.terminate();\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"FILE_PICKER\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\" ];\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tif (privileges.includes(\"IPC_SEND_PIPE\")) await availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: false, reason: \"permissions\" } });\n\t\treturn availableAPIs.terminate();\n\t}\n\tlet hideHiddenFiles = false;\n\ttry {\n\t\tlet homedir = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory;\n\t\thideHiddenFiles = true;\n\t\thideHiddenFiles = (await availableAPIs.fs_read({\n\t\t\tpath: homedir + \"/.hiddenFiles\",\n\t\t})) != \"show\";\n\t} catch {}\n\tdocument.body.innerText = \"\";\n\tlet mainComponent = document.createElement(\"div\");\n\tlet pathInputForm = document.createElement(\"form\");\n\tlet pathElement = document.createElement(\"input\");\n\tpathElement.value = exec_args[2] || \"\";\n\tlet browseButton = document.createElement(\"button\");\n\tlet displayResult = document.createElement(\"div\");\n\tlet newItemInput = document.createElement(\"input\");\n\tlet newItemBrowse = document.createElement(\"button\");\n\tlet newItemContainer = document.createElement(\"div\");\n\tlet previousDirectory = \"\";\n\tlet isDefaultChoice = true;\n\tmainComponent.style.display = \"flex\";\n\tmainComponent.style.flexDirection = \"column\";\n\tmainComponent.style.width = \"100%\";\n\tmainComponent.style.height = \"100%\";\n\tmainComponent.style.position = \"absolute\";\n\tmainComponent.style.top = \"0\";\n\tmainComponent.style.left = \"0\";\n\tmainComponent.style.padding = \"8px\";\n\tmainComponent.style.boxSizing = \"border-box\";\n\tdisplayResult.style.flex = \"1\";\n\tnewItemBrowse.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\tnewItemContainer.appendChild(document.createElement(\"hr\"));\n\tnewItemContainer.appendChild(newItemInput);\n\tbrowseButton.innerText = await availableAPIs.lookupLocale(\"BROWSE_FEXP\");\n\tnewItemContainer.appendChild(newItemBrowse);\n\tpathInputForm.appendChild(pathElement);\n\tpathInputForm.appendChild(browseButton);\n\tmainComponent.appendChild(pathInputForm);\n\tmainComponent.appendChild(displayResult);\n\tmainComponent.appendChild(newItemContainer);\n\tdocument.body.appendChild(mainComponent);\n\tnewItemContainer.hidden = exec_args[1] != \"save\";\n\tasync function browse() {\n\t\tlet path = pathElement.value;\n\t\tif (path.endsWith(\"/\")) path = path.substring(0, path.length - 1);\n\t\tdisplayResult.innerText = \"\";\n\t\tif (path == \"\") {\n\t\t\tlet partitions = await availableAPIs.fs_mounts();\n\t\t\tfor (let partition of partitions) {\n\t\t\t\tif (partition.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\topenButton.innerText = partition;\n\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\tpathElement.value = partition;\n\t\t\t\t\tbrowse();\n\t\t\t\t}\n\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t}\n\t\t\tpreviousDirectory = path;\n\t\t\treturn \"browsed\";\n\t\t}\n\t\ttry {\n\t\t\tlet type = await isDirectory(path);\n\t\t\tif (type == \"directory\") {\n\t\t\t\tlet ls = await availableAPIs.fs_ls({ path: path });\n\t\t\t\tfor (let file of ls) {\n\t\t\t\t\tif (file.startsWith(\".\") && hideHiddenFiles) continue;\n\t\t\t\t\tlet openButton = document.createElement(\"button\");\n\t\t\t\t\topenButton.innerText = file;\n\t\t\t\t\topenButton.onclick = function() {\n\t\t\t\t\t\tpathElement.value = path + \"/\" + file;\n\t\t\t\t\t\tbrowse();\n\t\t\t\t\t}\n\t\t\t\t\tdisplayResult.appendChild(openButton);\n\t\t\t\t}\n\t\t\t\tpreviousDirectory = path;\n\t\t\t} else if (type == \"file\" || (type == \"unknown\" && exec_args[1] == \"save\")) {\n\t\t\t\tif (isDefaultChoice) {\n\t\t\t\t\tpathElement.value = path.split(\"/\").slice(0, -1).join(\"/\");\n\t\t\t\t\tnewItemInput.value = path.split(\"/\").slice(-1)[0];\n\t\t\t\t\treturn browse();\n\t\t\t\t}\n\t\t\t\tdisplayResult.innerText = \"\";\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: true, selected: path } });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t} else {\n\t\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", (await availableAPIs.lookupLocale(\"UNKNOWN_FS_STRUCT\")).replace(\"%s\", type));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tdisplayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(e.message));\n\t\t}\n\t\tisDefaultChoice = false;\n\t}\n\tbrowse();\n\tbrowseButton.onclick = browse;\n\tnewItemBrowse.onclick = async function() {\n\t\tif (previousDirectory == \"\") return displayResult.innerText = (await availableAPIs.lookupLocale(\"FILE_STRUCT_BROWSE_FAIL\")).replace(\"%s\", await availableAPIs.lookupLocale(\"NO_SAVE_IN_MTN\"));\n\t\tpathElement.value = previousDirectory + \"/\" + newItemInput.value;\n\t\tbrowse();\n\t}\n})();\nasync function isDirectory(path) {\n\ttry {\n\t\tlet isDirectoryVar = await availableAPIs.fs_isDirectory({ path });\n\t\treturn isDirectoryVar ? \"directory\" : \"file\";\n\t} catch {\n\t\treturn \"unknown\";\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\ttry {\n\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: false, reason: \"closed\" } });\n\t\t} catch {}\n\t\tawait window.availableAPIs.terminate();\n\t}\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/format.js
async function formatInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "format" + ".js";
	let linkPath = target + "/apps/links/" + "format" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// allow: GET_LOCALE, LLDISK_LIST_PARTITIONS, LLDISK_WRITE, LLDISK_REMOVE, LLDISK_READ, CSP_OPERATIONS\n// signer: automaticSigner\n// signature: 141cdc9a42b2adf9637e514189642472acf9ab14c4555f6fb084b46ec5df2cde4e75fd5b567db0c59848c207d2aba0b04ef574aff8c903a94f54905cc3cea04c\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"format: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"FORMAT_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"FORMAT_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"FORMAT_FSTYPE\") + \"\\r\\n\")\n\t\tawait availableAPIs.toMyCLI(\"format: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tif (exec_args.length < 2 || exec_args.length > 3) {\n\t\tawait availableAPIs.toMyCLI(\"format: \" + await availableAPIs.lookupLocale(\"ARGUMENT_COUNT_MISMATCH\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\t\n\tlet knownNames;\n\ttry {\n\t\tknownNames = await availableAPIs.lldaList();\n\t\tif (knownNames.includes(exec_args[1]) && exec_args[2] != \"overwrite\") {\n\t\t\tawait availableAPIs.toMyCLI(\"format: \" + await availableAPIs.lookupLocale(\"FORMAT_OVERWRITE_WARN\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\n\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\tif (exec_args[0] == \"pcfs\") {\n\t\t\tlet prevId = (await availableAPIs.lldaRead({ partition: exec_args[1] }))?.id || u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t}));\n\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\tpartition: exec_args[1],\n\t\t\t\tdata: {\n\t\t\t\t\tfiles: {},\n\t\t\t\t\tpermissions: {},\n\t\t\t\t\tid: prevId\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (exec_args[0].startsWith(\"pcfs_crypt\")) {\n\t\t\tlet monokey = exec_args[0].endsWith(\"_monokey\");\n\t\t\tlet prevId = (await availableAPIs.lldaRead({ partition: exec_args[1] }))?.id || u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t}));\n\t\t\tlet salt = u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\tcspProvider: \"basic\",\n\t\t\t\toperation: \"random\",\n\t\t\t\tcspArgument: new Uint8Array(32)\n\t\t\t}));\n\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\tpartition: exec_args[1],\n\t\t\t\tdata: {\n\t\t\t\t\tfiles: {},\n\t\t\t\t\tpermissions: {},\n\t\t\t\t\tid: prevId,\n\t\t\t\t\tcryptodata: {\n\t\t\t\t\t\tpasswordLockingInitial: monokey,\n\t\t\t\t\t\tsalt: salt\n\t\t\t\t\t},\n\t\t\t\t\tencryptedFileTable: exec_args[0].endsWith(\"_filetable_monokey\")\n\t\t\t\t}\n\t\t\t})\n\t\t} else if (exec_args[0].startsWith(\"pcbm:\")) {\n\t\t\tlet diskDataPartition = exec_args[0].split(\":\").slice(1).join(\":\");\n\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\tpartition: exec_args[1],\n\t\t\t\tdata: `try {\n\t\t\t\t\tconst AsyncFunction = (async () => {}).constructor;\n\t\t\t\t\tlet pre_boot_part = coreExports.disk.partition(${JSON.stringify(diskDataPartition)}).getData();\n\t\t\t\t\tlet pre_boot_modules = pre_boot_part?.files;\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No files were found in the storage partition\");\n\t\t\t\t\t\tthrow new Error(\"No files were found in the storage partition\");\n\t\t\t\t\t}\n\t\t\t\t\tpre_boot_modules = pre_boot_modules[coreExports.bootSection || \"boot\"];\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No boot modules were found\");\n\t\t\t\t\t\tthrow new Error(\"No boot modules were found\");\n\t\t\t\t\t}\n\t\t\t\t\tlet pre_boot_module_list = Object.keys(pre_boot_modules);\n\t\t\t\t\tpre_boot_module_list = pre_boot_module_list.sort((a, b) => a.localeCompare(b));\n\t\t\t\t\tlet pre_boot_module_script = \"\";\n\t\t\t\t\tfor (let module of pre_boot_module_list) {\n\t\t\t\t\t\tif (coreExports.bootMode == \"logboot\") pre_boot_module_script += \"coreExports.tty_bios_api.println(\" + JSON.stringify(module) + \");\\\\n\";\n\t\t\t\t\t\tpre_boot_module_script += await coreExports.idb.readPart(pre_boot_part.id + \"-\" + pre_boot_modules[module]);\n\t\t\t\t\t}\n\t\t\t\t\tawait new AsyncFunction(pre_boot_module_script)();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Boot failed\");\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Press Enter to continue and log this error locally\");\n\t\t\t\t\tawait coreExports.tty_bios_api.inputLine();\n\t\t\t\t\tthrow e;\n\t\t\t\t}`\n\t\t\t});\n\t\t} else if (exec_args[0] == \"null\") {\n\t\t\tawait availableAPIs.lldaRemove({\n\t\t\t\tpartition: exec_args[1]\n\t\t\t});\n\t\t} else {\n\t\t\tawait availableAPIs.toMyCLI(\"format: \" + await availableAPIs.lookupLocale(\"FORMAT_UNKNOWN_FSTYPE\") + \"\\r\\n\");\n\t\t}\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"format: \" + e.name + \": \" + await availableAPIs.lookupLocale(e.message) + \" (\" + e.message + \")\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\t\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/initdisk.js
async function initdiskInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "initdisk" + ".js";
	let linkPath = target + "/apps/links/" + "initdisk" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// allow: GET_LOCALE, LLDISK_LIST_PARTITIONS, LLDISK_INIT_PARTITIONS\n// signer: automaticSigner\n// signature: 21b93c16a60a308779ab92fb1131760a7c8fcbb45962fa0a82b2eef95abe83104d74ccd4dce7b661afd3b1a685a5a7c0fddafe5813022210bc13872bea3a2db3\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"initdisk: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"INITDISK_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"INITDISK_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"initdisk: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tif (exec_args.length > 2) {\n\t\tawait availableAPIs.toMyCLI(\"initdisk: \" + await availableAPIs.lookupLocale(\"ARGUMENT_COUNT_MISMATCH\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\t\n\ttry {\n\t\tawait availableAPIs.lldaList();\n\t\tif (exec_args[1] != \"overwrite\") {\n\t\t\tawait availableAPIs.toMyCLI(\"initdisk: \" + await availableAPIs.lookupLocale(\"INITDISK_OVERWRITE_WARN\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t} catch {}\n\t\n\ttry {\n\t\tawait availableAPIs.lldaInitPartitions();\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"initdisk: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/installer.js
async function installerInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "installer" + ".js";
	let linkPath = target + "/apps/links/" + "installer" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_THEME, GET_BUILD, RUN_KLVL_CODE, LLDISK_WRITE, LLDISK_READ, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, FS_REMOVE, FS_LIST_PARTITIONS, SYSTEM_SHUTDOWN, FS_CHANGE_PERMISSION, LLDISK_LIST_PARTITIONS, FS_MOUNT, CSP_OPERATIONS, LLDISK_INIT_PARTITIONS\n// signature: 70e7708b564fd003d8b38a3c07b62b724881cec43967ddc889068aaf77f5e2426c315039a0a46d58c7a3abdc7518788202365eb3670200a4096e5ce1ac568391\n// =====END MANIFEST=====\nlet onClose = () => availableAPIs.terminate();\n(async function() {\n\t// @pcos-app-mode isolatable\n\tlet automatic_configuration = {}; /*{\n\t\tstartInstall: true,\n\t\tacceptEULA: true,\n\t\tpartitioning: {\n\t\t\tdata: \"data\",\n\t\t\tboot: \"boot\",\n\t\t\tformat: true,\n\t\t\tautoInitNewInstalls: true\n\t\t},\n\t\tautoRestart: \"kexec\",\n\t\tdefaultLocale: \"en\"\n\t};*/\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"INSTALL_PCOS\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"GET_BUILD\", \"RUN_KLVL_CODE\", \"LLDISK_WRITE\", \"LLDISK_READ\", \"FS_READ\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"FS_REMOVE\", \"FS_LIST_PARTITIONS\", \"SYSTEM_SHUTDOWN\", \"FS_CHANGE_PERMISSION\", \"LLDISK_LIST_PARTITIONS\", \"FS_MOUNT\", \"CSP_OPERATIONS\", \"LLDISK_INIT_PARTITIONS\" ];\n\tif (!checklist.every(p => privileges.includes(p))) return availableAPIs.terminate();\n\tawait availableAPIs.closeability(false);\n\tawait new Promise(async function(resolve) {\n\t\tlet locales = await availableAPIs.installedLocales();\n\t\tlet localeSelect = document.createElement(\"select\");\n\t\tlet localeZero = document.createElement(\"option\");\n\t\tlocaleZero.value = \"\";\n\t\tlocaleZero.innerText = \"  Language  \";\n\t\tlocaleZero.selected = true;\n\t\tlocaleZero.disabled = true;\n\t\tlocaleZero.hidden = true;\n\t\tlocaleSelect.appendChild(localeZero);\n\t\tfor (let locale of locales) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = locale;\n\t\t\toption.innerText = await availableAPIs.lookupOtherLocale({ key: \"LOCALE_NAME\", locale });\n\t\t\tlocaleSelect.appendChild(option);\n\t\t}\n\t\tlocaleSelect.addEventListener(\"change\", async function() {\n\t\t\tawait availableAPIs.runKlvlCode(\"modules.locales.defaultLocale = \" + JSON.stringify(localeSelect.value));\n\t\t\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"INSTALL_PCOS\"));\n\t\t\tlocaleSelect.remove();\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tresolve();\n\t\t});\n\t\tif (automatic_configuration.defaultLocale) {\n\t\t\tlocaleSelect.value = automatic_configuration.defaultLocale;\n\t\t\tlocaleSelect.dispatchEvent(new Event(\"change\"));\n\t\t}\n\t\tdocument.body.appendChild(localeSelect);\n\t});\n\tonClose = async function() {\n\t\tmainInstallerContent.hidden = true;\n\t\tcloseContent.hidden = false;\n\t\tawait availableAPIs.closeability(false);\n\t}\n\tconst licenseText = `Copyright (c) 2024 PCsoft\nOriginal Source Code Repository: https://github.com/PC-trollbox/pcos3\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n---\nUsed libraries:\n\txterm.js:\n\t\tCopyright (c) 2017-2022, The xterm.js authors (https://github.com/xtermjs/xterm.js/graphs/contributors) (MIT License)\n\t\tCopyright (c) 2014-2017, SourceLair, Private Company (www.sourcelair.com) (MIT License)\n\t\tCopyright (c) 2012-2013, Christopher Jeffrey (MIT License)\n\ttweetnacl.js:\n\t\tPublic domain, https://github.com/dchest/tweetnacl-js\n\tfast-myers-diff (minified and modified):\n\t\tCopyright 2021 Logan R. Kearsley (https://github.com/gliese1337/fast-myers-diff)`;\n\tlet mainInstallerContent = document.createElement(\"div\");\n\tlet closeContent = document.createElement(\"div\");\n\tlet header = document.createElement(\"b\");\n\tlet postHeader = document.createElement(\"br\");\n\tlet description = document.createElement(\"span\");\n\tlet content = document.createElement(\"div\");\n\tlet button = document.createElement(\"button\");\n\tlet liveButton = document.createElement(\"button\");\n\tlet confirmDescription = document.createElement(\"p\");\n\tlet buttonYes = document.createElement(\"button\");\n\tlet buttonNo = document.createElement(\"button\");\n\n\tcloseContent.hidden = true;\n\n\tmainInstallerContent.style = \"position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 8px; box-sizing: border-box;\";\n\tcloseContent.style = \"position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 8px; box-sizing: border-box;\";\n\n\tconfirmDescription.innerText = await availableAPIs.lookupLocale(\"CLOSE_INSTALLER_CONFIRMATION\");\n\tbuttonYes.innerText = await availableAPIs.lookupLocale(\"YES\");\n\tbuttonNo.innerText = await availableAPIs.lookupLocale(\"NO\");\n\theader.innerText = await availableAPIs.lookupLocale(\"INSTALLER_TITLE\");\n\tdescription.innerText = (await availableAPIs.lookupLocale(\"INSTALLER_INVITATION\")).replace(\"%s\", await availableAPIs.getVersion());\n\tbutton.innerText = await availableAPIs.lookupLocale(\"INSTALL_BUTTON\");\n\tliveButton.innerText = await availableAPIs.lookupLocale(\"LIVE_BUTTON\");\n\n\tmainInstallerContent.appendChild(header);\n\tmainInstallerContent.appendChild(postHeader);\n\tmainInstallerContent.appendChild(description);\n\tmainInstallerContent.appendChild(content);\n\tmainInstallerContent.appendChild(button);\n\tmainInstallerContent.appendChild(document.createElement(\"br\"));\n\tmainInstallerContent.appendChild(liveButton);\n\n\tcloseContent.appendChild(confirmDescription);\n\tcloseContent.appendChild(buttonYes);\n\tcloseContent.insertAdjacentText(\"beforeend\", \" \");\n\tcloseContent.appendChild(buttonNo);\n\n\tdocument.body.appendChild(mainInstallerContent);\n\tdocument.body.appendChild(closeContent);\n\n\tbuttonNo.onclick = async function() {\n\t\tmainInstallerContent.hidden = false;\n\t\tcloseContent.hidden = true;\n\t\tawait availableAPIs.closeability(true);\n\t}\n\tbuttonYes.onclick = function() {\n\t\tonClose = () => availableAPIs.terminate();\n\t\tavailableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t}\n\n\tbutton.onclick = async function() {\n\t\theader.remove();\n\t\tpostHeader.remove();\n\t\tliveButton.remove();\n\t\tcontent.innerHTML = \"\";\n\t\tdescription.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW\");\n\t\tlet textareaLicense = document.createElement(\"textarea\");\n\t\ttextareaLicense.readOnly = true;\n\t\ttextareaLicense.style.width = \"100%\";\n\t\ttextareaLicense.style.height = \"100%\";\n\t\tcontent.style.height = \"100%\";\n\t\ttextareaLicense.value = licenseText;\n\t\tcontent.appendChild(textareaLicense);\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW_BTN\");\n\t\tbutton.onclick = async function() {\n\t\t\tcontent.innerHTML = \"\";\n\t\t\tcontent.style.height = \"\";\n\t\t\tdescription.innerText = await availableAPIs.lookupLocale(\"INSTALLER_PARTITIONING\");\n\t\t\tbutton.innerText = await availableAPIs.lookupLocale(\"PARTITIONING_USE\");\n\t\t\tlet partitionDataInput = document.createElement(\"input\");\n\t\t\tlet partitionDataFormat = document.createElement(\"button\");\n\t\t\tlet partitionBootInput = document.createElement(\"input\");\n\t\t\tpartitionDataInput.placeholder = await availableAPIs.lookupLocale(\"PARTITION_DATA\");\n\t\t\tpartitionDataFormat.innerText = await availableAPIs.lookupLocale(\"FORMAT_DATA\");\n\t\t\tpartitionBootInput.placeholder = await availableAPIs.lookupLocale(\"PARTITION_BOOT\");\n\t\t\tpartitionDataInput.value = \"data\";\n\t\t\tpartitionBootInput.value = \"boot\";\n\t\t\tcontent.appendChild(partitionDataInput);\n\t\t\tcontent.insertAdjacentText(\"beforeend\", \" \");\n\t\t\tcontent.appendChild(partitionDataFormat);\n\t\t\tcontent.appendChild(document.createElement(\"br\"));\n\t\t\tcontent.appendChild(partitionBootInput);\n\t\t\tlet initSyncEnd;\n\t\t\tlet initSync = new Promise(_ => initSyncEnd = _);\n\t\t\tpartitionDataFormat.onclick = async function() {\n\t\t\t\tif (!partitionDataInput.value) return await htmlAlert(await availableAPIs.lookupLocale(\"DATA_INPUT_ALERT\"));\n\t\t\t\tlet newInstall = false;\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.lldaList();\n\t\t\t\t} catch {\n\t\t\t\t\tnewInstall = true;\n\t\t\t\t\tif (!automatic_configuration?.partitioning?.autoInitNewInstalls) \n\t\t\t\t\t\tif (!(await htmlConfirm(await availableAPIs.lookupLocale(\"PROMPT_PARTITION_TABLE\")))) return;\n\t\t\t\t\tawait availableAPIs.lldaInitPartitions();\n\t\t\t\t}\n\t\t\t\tlet confirmErasePart = true;\n\t\t\t\tif (!automatic_configuration?.partitioning?.format && !(automatic_configuration?.partitioning?.autoInitNewInstalls && newInstall))\n\t\t\t\t\tconfirmErasePart = await htmlConfirm(await availableAPIs.lookupLocale(\"CONFIRM_PARTITION_ERASE\"));\n\t\t\t\tif (confirmErasePart) {\n\t\t\t\t\tlet partData = await availableAPIs.lldaRead({ partition: partitionDataInput.value });\n\t\t\t\t\tlet partId;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpartId = partData.id;\n\t\t\t\t\t} catch {}\n\t\t\t\t\tif (!partId) partId = (await availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"random\",\n\t\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t\t})).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\")\n\t\t\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\t\t\tpartition: partitionDataInput.value,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tfiles: {},\n\t\t\t\t\t\t\tpermissions: {},\n\t\t\t\t\t\t\tid: partId\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tinitSyncEnd();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tbutton.onclick = async function() {\n\t\t\t\tlet diskDataPartition = partitionDataInput.value;\n\t\t\t\tlet diskBootPartition = partitionBootInput.value;\n\t\t\t\tif (!diskDataPartition) return await htmlAlert(await availableAPIs.lookupLocale(\"DATA_INPUT_ALERT\"));\n\t\t\t\tif (!diskBootPartition) return await htmlAlert(await availableAPIs.lookupLocale(\"BOOT_INPUT_ALERT\"));\n\t\t\t\ttry {\n\t\t\t\t\tif (!(await availableAPIs.lldaList()).includes(diskDataPartition)) throw new Error();\n\t\t\t\t} catch {\n\t\t\t\t\treturn await htmlAlert(await availableAPIs.lookupLocale(\"CANNOT_FIND_PARTITION\"));\n\t\t\t\t}\n\n\t\t\t\tlet tempCopy = Object.keys((await availableAPIs.lldaRead({ partition: diskDataPartition })) || {});\n\t\t\t\tif (!tempCopy.includes(\"files\") || !tempCopy.includes(\"permissions\"))\n\t\t\t\t\tif (!(await htmlConfirm(await availableAPIs.lookupLocale(\"PCFS_DETECTION_ERROR\")))) return;\n\n\t\t\t\ttempCopy = null;\n\t\t\t\tcontent.innerHTML = \"\";\n\t\t\t\tbutton.hidden = true;\n\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"PLEASE_WAIT\"));\n\t\t\t\tawait availableAPIs.closeability(false);\n\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CREATING_BOOT_PARTITION\"));\n\t\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\t\tpartition: diskBootPartition,\n\t\t\t\t\tdata: `\n\t\t\t\ttry {\n\t\t\t\t\tconst AsyncFunction = (async () => {}).constructor;\n\t\t\t\t\tlet pre_boot_part = coreExports.disk.partition(${JSON.stringify(diskDataPartition)}).getData();\n\t\t\t\t\tlet pre_boot_modules = pre_boot_part?.files;\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No files were found in the storage partition\");\n\t\t\t\t\t\tthrow new Error(\"No files were found in the storage partition\");\n\t\t\t\t\t}\n\t\t\t\t\tpre_boot_modules = pre_boot_modules[coreExports.bootSection || \"boot\"];\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No boot modules were found\");\n\t\t\t\t\t\tthrow new Error(\"No boot modules were found\");\n\t\t\t\t\t}\n\t\t\t\t\tlet pre_boot_module_list = Object.keys(pre_boot_modules);\n\t\t\t\t\tpre_boot_module_list = pre_boot_module_list.sort((a, b) => a.localeCompare(b));\n\t\t\t\t\tlet pre_boot_module_script = \"\";\n\t\t\t\t\tfor (let module of pre_boot_module_list) {\n\t\t\t\t\t\tif (coreExports.bootMode == \"logboot\") pre_boot_module_script += \"coreExports.tty_bios_api.println(\" + JSON.stringify(module) + \");\\\\n\";\n\t\t\t\t\t\tpre_boot_module_script += await coreExports.idb.readPart(pre_boot_part.id + \"-\" + pre_boot_modules[module]);\n\t\t\t\t\t}\n\t\t\t\t\tawait new AsyncFunction(pre_boot_module_script)();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Boot failed\");\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Press Enter to continue and log this error locally\");\n\t\t\t\t\tawait coreExports.tty_bios_api.inputLine();\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t\t`});\n\t\t\t\ttry {\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"MOUNTING_DATA_PARTITION\"));\n\t\t\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\t\t\tmountpoint: \"target\",\n\t\t\t\t\t\tfilesystem: \"PCFSiDBMount\",\n\t\t\t\t\t\tfilesystemOptions: {\n\t\t\t\t\t\t\tpartition: diskDataPartition\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CHANGING_ROOT_PERMISSIONS\"));\n\t\t\t\t\tawait availableAPIs.fs_chmod({ path: \"target\", newPermissions: \"rx\" });\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"COPYING_FOLDERS\"));\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait recursiveRemove(\"target/boot\");\n\t\t\t\t\t} catch {}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/boot\" });\n\t\t\t\t\t} catch {}\n\t\t\t\t\tawait recursiveCopy((await availableAPIs.getSystemMount()) + \"/boot\", \"target/boot\", true);\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CHANGING_BOOT_PERMISSIONS\"));\n\t\t\t\t\tcontent.innerHTML = \"\";\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"PATCHING_FS\"));\n\t\t\t\t\tlet systemCode = \"let localSystemMount = \\\".storage\\\";\\nlet mountOptions = {\\n\\tpartition: \" + JSON.stringify(diskDataPartition) + \"\\n};\\ntry {\\n\\tmodules.fs.mounts[localSystemMount] = await modules.mounts.PCFSiDBMount(mountOptions);\\n\\tmodules.defaultSystem = localSystemMount;\\n} catch (e) {\\n\\tawait panic(\\\"SYSTEM_PARTITION_MOUNTING_FAILED\\\", { underlyingJS: e, name: \\\"fs.mounts\\\", params: [localSystemMount, mountOptions]});\\n}\\n\";\n\t\t\t\t\tawait availableAPIs.fs_write({ path: \"target/boot/01-fsboot.js\", data: systemCode });\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/modules\" });\n\t\t\t\t\t} catch {}\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"SETTING_LOCALE_PREFERENCE\"));\n\t\t\t\t\tawait availableAPIs.fs_write({ path: \"target/boot/06-localeset.js\", data: \"modules.locales.defaultLocale = \" + JSON.stringify(await availableAPIs.osLocale()) + \";\\n\" });\n\t\t\t\t\tdescription.innerHTML = await availableAPIs.lookupLocale(\"INSTALLATION_SUCCESSFUL\");\n\t\t\t\t\tif (!automatic_configuration.autoRestart) await availableAPIs.closeability(true);\n\t\t\t\t\tonClose = function() {\n\t\t\t\t\t\tonClose = () => availableAPIs.terminate();\n\t\t\t\t\t\tavailableAPIs.shutdown({\n\t\t\t\t\t\t\tisReboot: true,\n\t\t\t\t\t\t\tisKexec: automatic_configuration.autoRestart == \"kexec\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (automatic_configuration.autoRestart) onClose();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tdescription.innerHTML = await availableAPIs.lookupLocale(\"INSTALLATION_FAILED\");\n\t\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t\t\tonClose = function() {\n\t\t\t\t\t\tonClose = () => availableAPIs.terminate();\n\t\t\t\t\t\tavailableAPIs.shutdown({\n\t\t\t\t\t\t\tisReboot: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (automatic_configuration.partitioning) {\n\t\t\t\tpartitionDataInput.value = automatic_configuration.partitioning.data || \"data\";\n\t\t\t\tpartitionBootInput.value = automatic_configuration.partitioning.boot || \"boot\";\n\t\t\t\tlet newInstall = false;\n\t\t\t\ttry { await availableAPIs.lldaList(); } catch { newInstall = true; }\n\t\t\t\tif (automatic_configuration.partitioning.format || (newInstall && automatic_configuration.partitioning.autoInitNewInstalls)) {\n\t\t\t\t\tpartitionDataFormat.click();\n\t\t\t\t\tawait initSync;\n\t\t\t\t}\n\t\t\t\tbutton.click();\n\t\t\t}\n\t\t}\n\t\tif (automatic_configuration.acceptEULA) button.click();\n\t}\n\tliveButton.onclick = async function() {\n\t\theader.remove();\n\t\tpostHeader.remove();\n\t\tliveButton.remove();\n\t\tcontent.innerHTML = \"\";\n\t\tdescription.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW\");\n\t\tlet textareaLicense = document.createElement(\"textarea\");\n\t\ttextareaLicense.readOnly = true;\n\t\ttextareaLicense.style.width = \"100%\";\n\t\ttextareaLicense.style.height = \"100%\";\n\t\tcontent.style.height = \"100%\";\n\t\ttextareaLicense.value = licenseText;\n\t\tcontent.appendChild(textareaLicense);\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW_BTN\");\n\t\tbutton.onclick = async function() {\n\t\t\tcontent.innerHTML = \"\";\n\t\t\tcontent.style.height = \"\";\n\t\t\tawait availableAPIs.runKlvlCode(`(async function() {\n\t\t\t\tlet appScripts = await modules.fs.read(modules.defaultSystem + \"/boot/15-apps.js\");\n\t\t\t\tlet apps = appScripts.match(/async function (.+)Installer\\\\(target, token\\\\)/g).map(a => a.split(\" \")[2].split(\"(\")[0]);\n\t\t\t\tlet fireAfterInstall = null;\n\t\t\t\tlet firesAfterInstall = new Promise(r => fireAfterInstall = r);\n\t\t\t\tlet installerCode = \"(async function() {\\\\n\" + appScripts + \"\\\\n\";\n\t\t\t\tfor (let app of apps) installerCode += \\`await \\${app}(modules.defaultSystem);\\\\n\\`;\n\t\t\t\tinstallerCode += \"fireAfterInstall(); })();\";\n\t\t\t\teval(installerCode);\n\t\t\t\tawait firesAfterInstall;\n\t\t\t\tawait modules.fs.write(modules.defaultSystem + \"/etc/darkLockScreen\", \"false\");\n\t\t\t\tawait modules.fs.write(modules.defaultSystem + \"/etc/wallpapers/lockscreen.pic\", await modules.fs.read(modules.defaultSystem + \"/etc/wallpapers/pcos-lock-beta.pic\"));\n\t\t\t\tawait modules.fs.write(modules.defaultSystem + \"/root/.wallpaper\", await modules.fs.read(modules.defaultSystem + \"/etc/wallpapers/pcos-beta.pic\"));\n\t\t\t\tawait modules.fs.write(modules.defaultSystem + \"/root/.darkmode\", \"false\");\n\t\t\t\tawait requireLogon();\n\t\t\t})(); null;`);\n\t\t\tawait availableAPIs.terminate();\n\t\t}\n\t}\n\tif (automatic_configuration.startInstall) button.click()\n})();\n\nasync function htmlAlert(msg) {\n\tlet overlay = document.createElement(\"div\");\n\tlet overlayingMessage = document.createElement(\"div\");\n\tlet description = document.createElement(\"span\");\n\tlet buttonAccept = document.createElement(\"button\");\n\toverlay.style = \"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; opacity: 85%;\";\n\toverlayingMessage.style = \"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; padding: 8px; box-sizing: border-box; color: white;\";\n\tdescription.innerText = msg;\n\tbuttonAccept.innerText = \"Ok\";\n\toverlayingMessage.appendChild(description);\n\toverlayingMessage.appendChild(document.createElement(\"hr\"));\n\toverlayingMessage.appendChild(buttonAccept);\n\tdocument.body.appendChild(overlay);\n\tdocument.body.appendChild(overlayingMessage);\n\treturn new Promise(function(resolve) {\n\t\tbuttonAccept.onclick = function() {\n\t\t\toverlay.remove();\n\t\t\toverlayingMessage.remove();\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\nasync function htmlConfirm(msg) {\n\tlet overlay = document.createElement(\"div\");\n\tlet overlayingMessage = document.createElement(\"div\");\n\tlet description = document.createElement(\"span\");\n\tlet buttonAccept = document.createElement(\"button\");\n\tlet buttonDecline = document.createElement(\"button\");\n\toverlay.style = \"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; opacity: 85%;\";\n\toverlayingMessage.style = \"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; padding: 8px; box-sizing: border-box; color: white;\";\n\tdescription.innerText = msg;\n\tbuttonAccept.innerText = await availableAPIs.lookupLocale(\"YES\");\n\tbuttonDecline.innerText = await availableAPIs.lookupLocale(\"NO\");\n\toverlayingMessage.appendChild(description);\n\toverlayingMessage.appendChild(document.createElement(\"hr\"));\n\toverlayingMessage.appendChild(buttonAccept);\n\toverlayingMessage.appendChild(buttonDecline);\n\tdocument.body.appendChild(overlay);\n\tdocument.body.appendChild(overlayingMessage);\n\treturn new Promise(function(resolve) {\n\t\tbuttonAccept.onclick = function() {\n\t\t\toverlay.remove();\n\t\t\toverlayingMessage.remove();\n\t\t\tresolve(true);\n\t\t}\n\t\tbuttonDecline.onclick = function() {\n\t\t\toverlay.remove();\n\t\t\toverlayingMessage.remove();\n\t\t\tresolve(false);\n\t\t}\n\t});\n}\n\nasync function recursiveCopy(source, destination, permissions) {\n\tfor (let sourceFile of await availableAPIs.fs_ls({ path: source })) {\n\t\tlet destinationFile = destination + \"/\" + sourceFile;\n\t\tif (await availableAPIs.fs_isDirectory({ path: source + \"/\" + sourceFile })) {\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_mkdir({ path: destinationFile });\n\t\t\t} catch {}\n\t\t\tawait recursiveCopy(source + \"/\" + sourceFile, destinationFile, permissions);\n\t\t} else {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: destinationFile,\n\t\t\t\tdata: await availableAPIs.fs_read({ path: source + \"/\" + sourceFile })\n\t\t\t});\n\t\t}\n\t\tif (permissions) {\n\t\t\tlet originalPermissions = await availableAPIs.fs_permissions({ path: source + \"/\" + sourceFile });\n\t\t\tawait availableAPIs.fs_chmod({ path: destinationFile, newPermissions: originalPermissions.world });\n\t\t\tawait availableAPIs.fs_chgrp({ path: destinationFile, newGrp: originalPermissions.group });\n\t\t\tawait availableAPIs.fs_chown({ path: destinationFile, newUser: originalPermissions.owner });\n\t\t}\n\t}\n}\n\nasync function recursiveRemove(target) {\n\tfor (let targetFile of await availableAPIs.fs_ls({ path: target })) {\n\t\ttargetFile = target + \"/\" + targetFile;\n\t\tif (await availableAPIs.fs_isDirectory({ path: targetFile })) await recursiveRemove(targetFile);\n\t\tawait availableAPIs.fs_rm({ path: targetFile });\n\t}\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) onClose();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/llda_tool.js
async function llda_toolInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "llda_tool" + ".js";
	let linkPath = target + "/apps/links/" + "llda_tool" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// allow: GET_LOCALE, LLDISK_WRITE, LLDISK_READ, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, LLDISK_LIST_PARTITIONS, LLDISK_REMOVE\n// signer: automaticSigner\n// signature: 4c7491864c27ebb14e24e411fccc16445eff074baa6ff2cfe65bb2d83fb0a080a0e86799b9523f624df68adcc640c54f6712209a79ec6cabbd6974b3bd7908a7\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"llda_tool: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_ACTION_EXPORT\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_ACTION_IMPORT\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_ACTION_IMPORTSTRING\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_ACTION_COPY\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_ACTION_REMOVE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_ACTION_LIST\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LLDA_DISCLAIMER\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"llda_tool: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\n\ttry {\n\t\tif (exec_args[0] == \"export\") {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: exec_args[2],\n\t\t\t\tdata: JSON.stringify(await availableAPIs.lldaRead({ partition: exec_args[1] }))\n\t\t\t});\n\t\t} else if (exec_args[0] == \"import\") {\n\t\t\tawait availableAPIs.lldaWrite({ partition: exec_args[2], data: JSON.parse(await availableAPIs.fs_read({ path: exec_args[1] })) });\n\t\t} else if (exec_args[0] == \"importstring\") {\n\t\t\tawait availableAPIs.lldaWrite({ partition: exec_args[2], data: await availableAPIs.fs_read({ path: exec_args[1] }) });\n\t\t} else if (exec_args[0] == \"copy\") {\n\t\t\tawait availableAPIs.lldaWrite({ partition: exec_args[2], data: await availableAPIs.lldaRead({ partition: exec_args[1] }) });\n\t\t} else if (exec_args[0] == \"remove\") {\n\t\t\tawait availableAPIs.lldaRemove({ partition: exec_args[1] });\n\t\t} else if (exec_args[0] == \"list\") {\n\t\t\tawait availableAPIs.toMyCLI(JSON.stringify(await availableAPIs.lldaList()) + \"\\r\\n\");\n\t\t} else {\n\t\t\tawait availableAPIs.toMyCLI(\"llda_tool: \" + await availableAPIs.lookupLocale(\"LLDA_UNKNOWN_ACTION\") + \"\\r\\n\");\n\t\t}\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"llda_tool: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\t\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/ls.js
async function lsInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "ls" + ".js";
	let linkPath = target + "/apps/links/" + "ls" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_BYPASS_PERMISSIONS, FS_LIST_PARTITIONS\n// signature: 832c0f0bfb0be6d8eec077109368ffab81f15bcb206eace60817b69da85033b79709a7fd2c0705df0850f6126316714e16cb9340d2143358f7fd384b9b57f3c7\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"ls: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LS_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LS_DESCRIPTION\") + \"\\r\\n\");\n\t\tlet sysmount = await availableAPIs.getSystemMount();\n\t\tlet systemLocale = await availableAPIs.lookupLocale(\"MOUNTPOINT_SYSTEM\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"LS_MOUNTPOINT_LIST\") + (await availableAPIs.fs_mounts()).map(a => sysmount == a ? (a + \" [\" + systemLocale + \"]\") : a).join(\", \") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"ls: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tfor (let file of exec_args) {\n\t\ttry {\n\t\t\tlet data = await availableAPIs.fs_ls({ path: file });\n\t\t\tawait availableAPIs.toMyCLI(data.map(a => JSON.stringify(a)).join(\"\\r\\n\") + \"\\r\\n\");\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"ls: \" + file + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t}\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/lsuser.js
async function lsuserInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "lsuser" + ".js";
	let linkPath = target + "/apps/links/" + "lsuser" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_USER_LIST\n// signature: c2f0fdca908df98a4d1907cfc56e6192214bc08bb12beb5ae6ed959cc83cee2aec2b256cd78e27038dc63db8b40bcd91f0d83da69ea08358d6eee03084dbf931\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"lsuser: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\ttry {\n\t\tfor (let user of await availableAPIs.getUsers()) await availableAPIs.toMyCLI(JSON.stringify(user) + \"\\r\\n\");\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"lsuser: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\treturn await availableAPIs.terminate();\n})();\n\nasync function onTermData(listener) {\n\twhile (true) {\n\t\tlistener(await availableAPIs.fromMyCLI());\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/mkdir.js
async function mkdirInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "mkdir" + ".js";
	let linkPath = target + "/apps/links/" + "mkdir" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_WRITE, FS_BYPASS_PERMISSIONS\n// signature: b47ef0f3443bef5c0c2adf6ea771bbe95708cc487e772c57e9f61c0a3709e237f9af04844dce467226a7ee75b37ef76c8615008d11d44cff05a37b9472a47d60\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"mkdir: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MKDIR_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MKDIR_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"mkdir: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.fs_mkdir({\n\t\t\tpath: exec_args[0]\n\t\t});\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"mkdir: \" + exec_args[0] + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/mount.js
async function mountInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "mount" + ".js";
	let linkPath = target + "/apps/links/" + "mount" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_MOUNT, GET_FILESYSTEMS\n// signature: f6e1c479b0e34612f4582b3e3aa93aeb169ae7dd5c3b3c5203e5f2938225eef79fed62b6f32c1be4f83ed3c8268b99f6fd3b280a8816c45c167a457f914b76ae\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"mount: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (ppos.length < 2) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MOUNT_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MOUNT_DESCRIPTION\") + \"\\r\\n\");\n\t\ttry {\n\t\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"MOUNT_KNOWN_FS\")).replace(\"%s\", (await availableAPIs.supportedFilesystems()).join(\", \")) + \"\\r\\n\");\n\t\t} catch {\n\t\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"MOUNT_KNOWN_FS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"UNKNOWN_PLACEHOLDER\")) + \"\\r\\n\");\n\t\t}\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PPART\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PINPA\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PPASS\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PKEY\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PTYPE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PURL\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_PINPI\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"MOUNT_KNOWN_POUPI\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"mount: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\n\ttry {\n\t\tawait availableAPIs.fs_mount({\n\t\t\tmountpoint: ppos[1],\n\t\t\tfilesystem: ppos[0],\n\t\t\tfilesystemOptions: pargs\n\t\t});\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"mount: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/mountinfo.js
async function mountinfoInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "mountinfo" + ".js";
	let linkPath = target + "/apps/links/" + "mountinfo" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_LIST_PARTITIONS, GET_FILESYSTEMS\n// signature: de2d5d5df2a7b34a51478342d5bb3f2abfa511b43ea05b1bf95afc37f0e70c0237b8cbf75cfd077427f51ca403119b7c9c7b150029fedaa770aa800fcc33a918\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"mountinfo: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (ppos.length < 1) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MOUNTINFO_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"MOUNTINFO_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"mountinfo: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\n\ttry {\n\t\tawait availableAPIs.toMyCLI(JSON.stringify(await availableAPIs.fs_mountInfo(ppos[0]), null, \"\\t\").replaceAll(\"\\n\", \"\\r\\n\") + \"\\r\\n\");\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"mountinfo: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/netinfo.js
async function netinfoInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "netinfo" + ".js";
	let linkPath = target + "/apps/links/" + "netinfo" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_NETWORK_ADDRESS, GET_HOSTNAME, GET_UPDATE_SERVICE\n// signature: 221cf321dc018d5d164aa2582b5cf5e5bc3a4443d0eed2c9e8d0a8e4c2b60423f23430e36bdfe98e2c4a370b182b1dbb7f397d4ebf98666c23ac22e7fa5ab562\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"netinfo: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n    \n\ttry {\n\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"NETWORK_ADDRESS_FIELD\")).replace(\"%s\", (await availableAPIs.getNetworkAddress())?.match(/.{1,4}/g)?.join(\":\") || await availableAPIs.lookupLocale(\"UNKNOWN_PLACEHOLDER\")) + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"NETWORK_AUTOHOST_FIELD\")).replace(\"%s\", (await availableAPIs.getHostname() || await availableAPIs.lookupLocale(\"UNKNOWN_PLACEHOLDER\"))) + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"NETWORK_UPDATES_FIELD\")).replace(\"%s\", (await availableAPIs.getUpdateService() || await availableAPIs.lookupLocale(\"UNKNOWN_PLACEHOLDER\"))) + \"\\r\\n\");\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"netinfo: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/networkfs.js
async function networkfsInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "networkfs" + ".js";
	let linkPath = target + "/apps/links/" + "networkfs" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// allow: GET_LOCALE, RESOLVE_NAME, CONNFUL_CONNECT, IPC_CREATE_PIPE, FS_MOUNT, IPC_LISTEN_PIPE, CONNFUL_WRITE, CONNFUL_READ, IPC_SEND_PIPE, FS_READ\n// signer: automaticSigner\n// signature: f8bc6aedeb8a54ac974c18ce446ad07bfc6a7e7ea12436c859d9fba5334c0192b7d2a0765520f9f26cdd1d08dafca6c63c5a5690eb1eea486741ba0fceba94e5\n// =====END MANIFEST=====\nfunction IPv6Decompressor(ip) {\n\tlet array = ip.split(\":\");\n\tarray = array.slice(0, 8);\n\tlet foundTwoOrMoreZeroes = array.indexOf(\"\");\n\twhile (array.length != 8 && foundTwoOrMoreZeroes !== null) array.splice(foundTwoOrMoreZeroes, 0, \"0000\");\n\tarray = array.map(a => parseInt(a || \"0\", 16).toString(16).padStart(4, \"0\"));\n\treturn array.join(\":\");\n}\n(async function() {\n\t// @pcos-app-mode isolatable\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"networkfs: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tawait availableAPIs.attachCLI();\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (ppos.length < 2) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"NETWORKFS_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"NETWORKFS_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"NETWORKFS_NOVERIFY\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"NETWORKFS_KEY\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"networkfs: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\tawait availableAPIs.terminate();\n\t}\n\tlet inPipe, outPipe, conn;\n\ttry {\n\t\tlet url = new URL(ppos[0]);\n\t\tif (url.protocol != \"netfs:\") throw new Error(await availableAPIs.lookupLocale(\"NETWORKFS_PROTO\"));\n\t\tif (url.port) throw new Error(await availableAPIs.lookupLocale(\"BLOG_BROWSER_GATESET\"));\n\t\tlet hostname = url.hostname, address;\n\t\tif (url.hostname.includes(\"[\")) {\n\t\t\thostname = IPv6Decompressor(url.hostname.slice(1, -1)).replaceAll(\":\", \"\");\n\t\t\taddress = hostname;\n\t\t} else address = await availableAPIs.resolve(hostname);\n\t\tif (!address) throw new Error(await availableAPIs.lookupLocale(\"HOSTNAME_RESOLUTION_FAILED\"));\n\t\tconn = await availableAPIs.connfulConnect({\n\t\t\tgate: url.username || \"netfs\",\n\t\t\taddress,\n\t\t\tverifyByDomain: hostname,\n\t\t\tkey: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: pargs.key\n\t\t\t})).key : undefined,\n\t\t\tprivate: pargs.key ? JSON.parse(await availableAPIs.fs_read({\n\t\t\t\tpath: pargs.key\n\t\t\t})).private : undefined,\n\t\t\tdoNotVerifyServer: pargs[\"no-verification\"]\n\t\t});\n\t\tawait availableAPIs.connfulConnectionSettled(conn);\n\t\tinPipe = await availableAPIs.createPipe();\n\t\toutPipe = await availableAPIs.createPipe();\n\t\tlet pipe2conn = (async function() {\n\t\t\twhile (true) {\n\t\t\t\tlet listenToPipe = await availableAPIs.listenToPipe(inPipe);\n\t\t\t\tavailableAPIs.connfulWrite({\n\t\t\t\t\tconnectionID: conn,\n\t\t\t\t\tdata: JSON.stringify(listenToPipe)\n\t\t\t\t});\n\t\t\t}\n\t\t})();\n\t\tlet conn2pipe = (async function() {\n\t\t\twhile (true) {\n\t\t\t\tlet networkListen = await availableAPIs.connfulRead(conn);\n\t\t\t\tavailableAPIs.sendToPipe({\n\t\t\t\t\tpipe: outPipe,\n\t\t\t\t\tdata: JSON.parse(networkListen)\n\t\t\t\t});\n\t\t\t}\n\t\t})();\n\t\tawait availableAPIs.fs_mount({\n\t\t\tmountpoint: ppos[1],\n\t\t\tfilesystem: \"IPCMount\",\n\t\t\tfilesystemOptions: {\n\t\t\t\tinputPipeId: inPipe,\n\t\t\t\toutputPipeId: outPipe\n\t\t\t}\n\t\t});\n\t\tawait Promise.all([pipe2conn, conn2pipe]);\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"networkfs: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/passwd.js
async function passwdInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "passwd" + ".js";
	let linkPath = target + "/apps/links/" + "passwd" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SET_SECURITY_CHECKS, CSP_OPERATIONS, SWITCH_USERS_AUTOMATICALLY\n// signature: ba515ea3ddde644525540417eb42c08d9d7ec137ba50c5021e0a413fc002889869c8174ed884c127bcb005b88a46d7ed394f4ae948c84c60a011f63a0d39875b\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"passwd: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (exec_args[0]) {\n\t\ttry {\n\t\t\tawait availableAPIs.switchUser(exec_args[0]);\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"passwd: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t}\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_NEW_PROMPT\") + \"\\r\\n\");\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_2FACTOR_LOSS_WARN\") + \"\\r\\n\");\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_PROMPT\"));\n\tlet str = \"\";\n\tlet stage = 0;\n\tlet password = \"\";\n\tonTermData(async function(e) {\n\t\tif (e == \"\\r\") {\n\t\t\tawait availableAPIs.toMyCLI(\"\\r\\n\");\n\t\t\tif (stage == 0) {\n\t\t\t\tpassword = str;\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PASSWD_CONFIRM_PROMPT\"));\n\t\t\t\tstage = 1;\n\t\t\t\tstr = \"\";\n\t\t\t} else if (stage == 1) {\n\t\t\t\tstage = 2;\n\t\t\t\tif (str == password) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet salt = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"random\",\n\t\t\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(password),\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\tsalt: salt,\n\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\tcspArgument: key\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.setOwnSecurityChecks({\n\t\t\t\t\t\t\tchecks: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: \"pbkdf2\",\n\t\t\t\t\t\t\t\t\thash: u8aToHex(derived),\n\t\t\t\t\t\t\t\t\tsalt: u8aToHex(salt)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tawait availableAPIs.toMyCLI(\"passwd: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t\t\t\t\tawait availableAPIs.terminate();\n\t\t\t\t\t}\n\t\t\t\t\tawait availableAPIs.toMyCLI(\"passwd: \" + await availableAPIs.lookupLocale(\"PASSWD_FEEDBACK\") + \"\\r\\n\");\n\t\t\t\t\tawait availableAPIs.terminate();\n\t\t\t\t} else {\n\t\t\t\t\tawait availableAPIs.toMyCLI(\"passwd: \" + await availableAPIs.lookupLocale(\"PASSWD_MISMATCH\") + \"\\r\\n\");\n\t\t\t\t\tawait availableAPIs.terminate();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (e == '\\u007F') {\n\t\t\tif (str.length > 0) {\n\t\t\t\tstr = str.substr(0, str.length - 1);\n\t\t\t\tawait availableAPIs.toMyCLI('\\b \\b');\n\t\t\t}\n\t\t} else {\n\t\t\tif (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\\u00a0') {\n\t\t\t\tstr += e;\n\t\t\t\tawait availableAPIs.toMyCLI(\"*\");\n\t\t\t}\n\t\t}\n\t});\n})();\n\nasync function onTermData(listener) {\n\twhile (true) {\n\t\tlistener(await availableAPIs.fromMyCLI());\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/patch.js
async function patchInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "patch" + ".js";
	let linkPath = target + "/apps/links/" + "patch" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, PATCH_DIFF\n// signature: 6d7fde737fd0249ba8a8710ecb66b4778b8052429f904f8435ec07e7c665f4379de59d1d09787062d4e4b5dcfa0bb7362790d80cc77690ad049c3a34eb2a7706\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"patch: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PATCH_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PATCH_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"patch: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tif (exec_args.length != 3) {\n\t\tawait availableAPIs.toMyCLI(\"patch: \" + await availableAPIs.lookupLocale(\"ARGUMENT_COUNT_MISMATCH\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n    try {\n        await availableAPIs.fs_write({\n            path: exec_args[2],\n            data: (await availableAPIs.patchDiff({\n                operation: \"applyPatch\",\n                args: [ await availableAPIs.fs_read({ path: exec_args[0] }), JSON.parse(await availableAPIs.fs_read({ path: exec_args[1] })) ]\n            })).join(\"\")\n        })\n    } catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"patch: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n    }\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/pcosNetwork.js
async function networkInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "pcosNetwork" + ".js";
	let linkPath = target + "/apps/links/" + "pcosNetwork" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "NETCONFIG_TITLE" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:NETCONFIG_TITLE\n// signer: automaticSigner\n// fnName: networkInstaller\n// allow: RELOAD_NETWORK_CONFIG, IDENTIFY_SYSTEM, CSP_OPERATIONS, FS_READ, FS_WRITE, FS_REMOVE, FS_LIST_PARTITIONS, GET_LOCALE, GET_SERVER_URL, LIST_TASKS, GET_THEME, FS_BYPASS_PERMISSIONS\n// signature: ac52ac8c7526369fb9f8270e6d79fba273b74e86851516c9630d4e0a73748e1c2df85b5036b45191c2ea9cf0dfeb2c9c5a6ac887785b0a4f2655144f78fa7fc7\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"NETCONFIG_TITLE\") || \"PCOS Network configurator\");\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"IDENTIFY_SYSTEM\", \"CSP_OPERATIONS\", \"FS_READ\", \"FS_WRITE\", \"FS_LIST_PARTITIONS\", \"GET_LOCALE\", \"GET_SERVER_URL\", \"LIST_TASKS\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\ttry {\n\t\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\t} catch {}\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_DENY\") || \"Insufficient privileges.\";\n\t\treturn;\n\t}\n\tlet existingConfig = {};\n\ttry {\n\t\texistingConfig = JSON.parse(await availableAPIs.fs_read({\n\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/network.json\"\n\t\t}));\n\t} catch {}\n\tlet descriptionNetworkURL = document.createElement(\"span\");\n\tlet descriptionUCBits = document.createElement(\"span\");\n\tlet descriptionHostname = document.createElement(\"span\");\n\tlet descriptionUpdates = document.createElement(\"span\");\n\tlet paramNetworkURL = document.createElement(\"input\");\n\tlet ucBits = document.createElement(\"input\");\n\tlet paramHostname = document.createElement(\"input\");\n\tlet paramUpdates = document.createElement(\"input\");\n\tlet saveBtn = document.createElement(\"button\");\n\tlet updatePredictBtn = document.createElement(\"button\");\n\tlet addressPrediction = document.createElement(\"span\");\n\tlet form = document.createElement(\"form\");\n\tlet originUrl = new URL(await availableAPIs.runningServer());\n\toriginUrl.protocol = \"ws\" + (originUrl.protocol == \"https:\" ? \"s\" : \"\") + \":\";\n\tdescriptionNetworkURL.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_URLF\");\n\tdescriptionUCBits.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_UC\");\n\tdescriptionHostname.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_HOSTNAME\");\n\tdescriptionUpdates.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_UPDATES\");\n\tparamNetworkURL.value = existingConfig.url || originUrl.origin;\n\tucBits.type = \"number\";\n\tucBits.min = 0;\n\tucBits.max = 4294967295;\n\tucBits.value = existingConfig.ucBits;\n\tparamHostname.value = existingConfig.hostname || \"\";\n\tparamUpdates.value = existingConfig.updates || \"pcosserver.pc\";\n\tsaveBtn.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SAVE\");\n\tupdatePredictBtn.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_PREDICT\");\n\tform.appendChild(descriptionNetworkURL);\n\tform.appendChild(paramNetworkURL);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(descriptionUCBits);\n\tform.appendChild(ucBits);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(descriptionHostname);\n\tform.appendChild(paramHostname);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(descriptionUpdates);\n\tform.appendChild(paramUpdates);\n\tform.appendChild(document.createElement(\"br\"));\n\tform.appendChild(saveBtn);\n\tform.appendChild(updatePredictBtn);\n\taddressPrediction.innerText = await availableAPIs.lookupLocale(\"EMPTY_STATUSBAR\");\n\tdocument.body.appendChild(form);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tdocument.body.appendChild(addressPrediction);\n\tsaveBtn.addEventListener(\"click\", async function(e) {\n\t\te.preventDefault();\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/network.json\",\n\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\turl: paramNetworkURL.value,\n\t\t\t\t\tucBits: Math.round(Math.abs(Number(ucBits.value))),\n\t\t\t\t\thostname: paramHostname.value,\n\t\t\t\t\tupdates: paramUpdates.value\n\t\t\t\t}, null, \"\\t\")\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_rm({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/apps/services/networkd.lnk\"\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.reloadNetworkConfig();\n\t\t\t} catch {}\n\t\t\taddressPrediction.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SAVE_OK\");\n\t\t} catch {\n\t\t\taddressPrediction.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SAVE_FAIL\");\n\t\t}\n\t});\n\tupdatePredictBtn.addEventListener(\"click\", function(e) {\n\t\te.preventDefault();\n\t\tupdatePrediction({ addressPrediction, ucBits });\n\t});\n})();\nfunction findInputNumberString(output, chars) {\n\tlet inputNum = 0n;\n\tfor (let i = 0n; i < output.length; i++) {\n\t\tconst charIndex = chars.indexOf(output[i]);\n\t\tif (charIndex === -1) throw new Error(`Invalid character '${output[i]}' in output string`);\n\t\tinputNum = inputNum * BigInt(chars.length) + BigInt(charIndex);\n\t}\n\treturn inputNum;\n}\nfunction generateString(num, chars) {\n\tlet base = BigInt(chars.length), result = '';\n\twhile (num > 0n) result = chars[Number(num % base)] + result, num /= base;\n\treturn result;\n}\n\nasync function updatePrediction(elementInterface) {\n\tlet publicSystemID = await availableAPIs.getPublicSystemID();\n\tif (!publicSystemID) return elementInterface.addressPrediction.innerText = await availableAPIs.lookupLocale(\"NETCONFIG_SYSIDM\");\n\tlet sysIDx = u8aToHex(new Uint8Array(await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"digest\",\n\t\tcspArgument: {\n\t\t\talgorithm: \"SHA-256\",\n\t\t\tdata: hexToU8A(generateString(findInputNumberString(publicSystemID.x, base64Charset), hexCharset))\n\t\t}\n\t}))).padStart(8, \"0\").slice(0, 8);\n\tlet sysIDy = u8aToHex(new Uint8Array(await availableAPIs.cspOperation({\n\t\tcspProvider: \"basic\",\n\t\toperation: \"digest\",\n\t\tcspArgument: {\n\t\t\talgorithm: \"SHA-256\",\n\t\t\tdata: hexToU8A(generateString(findInputNumberString(publicSystemID.y, base64Charset), hexCharset))\n\t\t}\n\t}))).padStart(8, \"0\").slice(0, 8);\n\tlet ucPredict = Math.round(Math.abs(Number(elementInterface.ucBits.value))).toString(16).padStart(8, \"0\").slice(0, 8);\n\treturn elementInterface.addressPrediction.innerText = (\"xxxxxxxx\" + sysIDx + sysIDy + ucPredict).match(/.{1,4}/g).join(\":\");\n}\nlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\nlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\nlet base64Charset = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\";\nlet hexCharset = \"0123456789abcdef\";\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/personalSecurity.js
async function personalSecurityInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "personalSecurity" + ".js";
	let linkPath = target + "/apps/links/" + "personalSecurity" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "PERSONAL_SECURITY_TITLE" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:PERSONAL_SECURITY_TITLE\n// signer: automaticSigner\n// allow: SET_SECURITY_CHECKS, GET_USER_INFO, CSP_OPERATIONS, GET_LOCALE, GET_THEME\n// signature: 6bf25409da8a1d470e2c6dd0e5363ff630783cff8df6d1b56e9026ee47c5aed87868f0afd33cff7ee98265482ad12867b4670f7c46123a781a6bea054def005a\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"SET_SECURITY_CHECKS\", \"GET_USER_INFO\", \"CSP_OPERATIONS\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_DENY\");\n\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\tintent: await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_INTENT\"),\n\t\t\tname: await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_TITLE\"),\n\t\t\tdesiredUser: await availableAPIs.getUser()\n\t\t});\n\t\tif (!newToken) return;\n\t\tawait availableAPIs.setProcessToken(newToken);\n\t\tawait availableAPIs.revokeToken(currentToken);\n\t\tprivileges = await availableAPIs.getPrivileges();\n\t\tif (!checklist.every(p => privileges.includes(p))) return;\n\t}\n\tlet toolbar = document.createElement(\"div\");\n\tlet saveBtn = document.createElement(\"button\");\n\tlet loadBtn = document.createElement(\"button\");\n\tlet addBtn = document.createElement(\"button\");\n\ttoolbar.appendChild(saveBtn);\n\ttoolbar.appendChild(loadBtn);\n\ttoolbar.appendChild(addBtn);\n\tsaveBtn.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\tloadBtn.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\taddBtn.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\tsaveBtn.onclick = async function() {\n\t\tawait availableAPIs.setOwnSecurityChecks({ checks });\n\t\tchecks = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser(), sensitive: true })).securityChecks;\n\t\treparse();\n\t};\n\tloadBtn.onclick = async function() {\n\t\tchecks = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser(), sensitive: true })).securityChecks;\n\t\treparse();\n\t};\n\taddBtn.onclick = function() {\n\t\tadd();\n\t}\n\tdocument.body.appendChild(toolbar);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tlet secCheck = document.createElement(\"div\");\n\tlet types = [\n\t\t\"pbkdf2\",\n\t\t\"informative\",\n\t\t\"informative_deny\",\n\t\t\"timeout\",\n\t\t\"timeout_deny\",\n\t\t\"serverReport\",\n\t\t\"pc-totp\",\n\t\t\"totp\",\n\t\t\"workingHours\",\n\t\t\"zkpp\"\n\t];\n\tlet checks = (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser(), sensitive: true })).securityChecks;\n\n\tlet checkLocales = {\n\t\t\"pbkdf2\": \"PBKDF2_OPTION\",\n\t\t\"informative\": \"INFORMATIVE_MESSAGE_OPTION\",\n\t\t\"informative_deny\": \"INFORMATIVE_MESSAGE_DENY_OPTION\",\n\t\t\"timeout\": \"TIMEOUT_OPTION\",\n\t\t\"timeout_deny\": \"TIMEOUT_DENY_OPTION\",\n\t\t\"serverReport\": \"SERVER_REPORT_OPTION\",\n\t\t\"pc-totp\": \"PCTOTP_OPTION\",\n\t\t\"totp\": \"RFCTOTP_OPTION\",\n\t\t\"workingHours\": \"WORKING_HOURS_OPTION\",\n\t\t\"zkpp\": \"ZKPP_OPTION\"\n\t};\n\n\tasync function reparse() {\n\t\tsecCheck.remove();\n\t\tsecCheck = document.createElement(\"div\");\n\n\t\tfor (let check in checks) {\n\t\t\tlet checkInfo = checks[check];\n\t\t\tlet checkDiv = document.createElement(\"div\");\n\t\t\tcheckDiv.style.display = \"flex\";\n\t\t\tlet checkTitle = document.createElement(\"div\");\n\t\t\tcheckTitle.style.flex = 100;\n\t\t\tlet checkBtns = document.createElement(\"div\");\n\t\t\tcheckTitle.innerText = await availableAPIs.lookupLocale(checkLocales[checkInfo.type]);\n\t\t\tlet btnConfig = document.createElement(\"button\");\n\t\t\tlet btnUp = document.createElement(\"button\");\n\t\t\tlet btnDown = document.createElement(\"button\");\n\t\t\tlet btnDelete = document.createElement(\"button\");\n\t\t\tbtnConfig.innerText = \"*\";\n\t\t\tbtnUp.innerText = \"/\\\\\";\n\t\t\tbtnUp.disabled = check == 0;\n\t\t\tbtnDown.disabled = check == checks.length - 1;\n\t\t\tbtnDown.innerText = \"\\\\/\";\n\t\t\tbtnDelete.innerText = \"x\";\n\t\t\tcheckBtns.appendChild(btnConfig);\n\t\t\tcheckBtns.appendChild(btnUp);\n\t\t\tcheckBtns.appendChild(btnDown);\n\t\t\tcheckBtns.appendChild(btnDelete);\n\t\t\tcheckDiv.appendChild(checkTitle);\n\t\t\tcheckDiv.appendChild(checkBtns);\n\t\t\tbtnDelete.addEventListener(\"click\", function() {\n\t\t\t\tchecks.splice(check, 1);\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tsecCheck.appendChild(checkDiv);\n\t\t\tbtnUp.addEventListener(\"click\", function() {\n\t\t\t\tchecks.splice(check, 1);\n\t\t\t\tchecks.splice(check - 1, 0, checkInfo);\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tbtnDown.addEventListener(\"click\", function() {\n\t\t\t\tchecks.splice(check, 1);\n\t\t\t\tchecks.splice(check - 1 + 2, 0, checkInfo);\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tbtnConfig.addEventListener(\"click\", function() {\n\t\t\t\tcheckConfig(check);\n\t\t\t});\n\t\t}\n\t\tdocument.body.appendChild(secCheck);\n\t}\n\n\tasync function checkConfig(check) {\n\t\tsecCheck.remove();\n\t\tsecCheck = document.createElement(\"div\");\n\t\tlet checkInfo = checks[check];\n\t\tlet checkBack = document.createElement(\"button\");\n\t\tlet checkName = document.createElement(\"b\");\n\t\tcheckBack.innerText = \"<-\";\n\t\tcheckName.innerText = await availableAPIs.lookupLocale(checkLocales[checkInfo.type]);\n\t\tsecCheck.appendChild(checkBack);\n\t\tsecCheck.appendChild(checkName);\n\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\tcheckBack.addEventListener(\"click\", function() {\n\t\t\treparse();\n\t\t});\n\t\tif (checkInfo.type == \"pbkdf2\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"PASSWORD\") + \": \";\n\t\t\tinputBox.type = \"password\";\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tinputAccept.addEventListener(\"click\", async function() {\n\t\t\t\tlet salt = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t});\n\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\tkeyData: new TextEncoder().encode(inputBox.value),\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\tsalt: salt,\n\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\tlength: 256\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key\n\t\t\t\t});\n\t\t\t\tchecks[check] = {\n\t\t\t\t\ttype: \"pbkdf2\",\n\t\t\t\t\thash: u8aToHex(derived),\n\t\t\t\t\tsalt: u8aToHex(salt)\n\t\t\t\t};\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"informative\" || checkInfo.type == \"informative_deny\") {\n\t\t\tlet textarea = document.createElement(\"textarea\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\ttextarea.placeholder = await availableAPIs.lookupLocale(\"MESSAGE_ENTER\");\n\t\t\ttextarea.value = checkInfo.message;\n\t\t\tsecCheck.appendChild(textarea);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].message = textarea.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"timeout\" || checkInfo.type == \"timeout_deny\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"TIMEOUT_FIELD\") + \": \";\n\t\t\tinputBox.type = \"number\";\n\t\t\tinputBox.value = checkInfo.timeout;\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].timeout = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"serverReport\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = \"URL: \";\n\t\t\tinputBox.type = \"text\";\n\t\t\tinputBox.placeholder = \"https://example.org/report\";\n\t\t\tinputBox.value = checkInfo.url;\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].url = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"pc-totp\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet regen = document.createElement(\"button\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"SECRET_FIELD_TXT\") + \": \";\n\t\t\tinputBox.type = \"text\";\n\t\t\tinputBox.value = checkInfo.secret;\n\t\t\tregen.innerText = await availableAPIs.lookupLocale(\"REGENERATE\");\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(regen);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tregen.addEventListener(\"click\", async function() {\n\t\t\t\tlet randomValues = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(32)\n\t\t\t\t});\n\t\t\t\tinputBox.value = Array.from(randomValues).map(x => x.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t});\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].secret = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"totp\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet regen = document.createElement(\"button\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"SECRET_FIELD_HEX\") + \": \";\n\t\t\tinputBox.type = \"text\";\n\t\t\tinputBox.value = checkInfo.secret;\n\t\t\tregen.innerText = await availableAPIs.lookupLocale(\"REGENERATE\");\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(regen);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tregen.addEventListener(\"click\", async function() {\n\t\t\t\tlet randomValues = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(10)\n\t\t\t\t});\n\t\t\t\tinputBox.value = Array.from(randomValues).map(x => x.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t});\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].secret = inputBox.value;\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"workingHours\") {\n\t\t\tlet inputStartDescribe = document.createElement(\"span\");\n\t\t\tlet inputEndDescribe = document.createElement(\"span\");\n\t\t\tlet inputBoxStart = document.createElement(\"input\");\n\t\t\tlet inputBoxEnd = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputStartDescribe.innerText = await availableAPIs.lookupLocale(\"START_TIME_FIELD\") + \": \";\n\t\t\tinputBoxStart.type = \"time\";\n\t\t\tinputBoxStart.step = 1;\n\t\t\tif (checkInfo.start) inputBoxStart.value = String(checkInfo.start.hours).padStart(2, \"0\") + \":\" + String(checkInfo.start.minutes).padStart(2, \"0\") + \":\" + String(checkInfo.start.seconds).padStart(2, \"0\");\n\t\t\tinputEndDescribe.innerText = await availableAPIs.lookupLocale(\"END_TIME_FIELD\") + \": \";\n\t\t\tinputBoxEnd.type = \"time\";\n\t\t\tinputBoxEnd.step = 1;\n\t\t\tif (checkInfo.end) inputBoxEnd.value = String(checkInfo.end.hours).padStart(2, \"0\") + \":\" + String(checkInfo.end.minutes).padStart(2, \"0\") + \":\" + String(checkInfo.end.seconds).padStart(2, \"0\");\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tsecCheck.appendChild(inputStartDescribe);\n\t\t\tsecCheck.appendChild(inputBoxStart);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(inputEndDescribe);\n\t\t\tsecCheck.appendChild(inputBoxEnd);\n\t\t\tsecCheck.appendChild(document.createElement(\"br\"));\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.addEventListener(\"click\", function() {\n\t\t\t\tchecks[check].start = {\n\t\t\t\t\thours: Number(inputBoxStart.value.split(\":\")[0]),\n\t\t\t\t\tminutes: Number(inputBoxStart.value.split(\":\")[1]),\n\t\t\t\t\tseconds: Number(inputBoxStart.value.split(\":\")[2])\n\t\t\t\t};\n\t\t\t\tchecks[check].end = {\n\t\t\t\t\thours: Number(inputBoxEnd.value.split(\":\")[0]),\n\t\t\t\t\tminutes: Number(inputBoxEnd.value.split(\":\")[1]),\n\t\t\t\t\tseconds: Number(inputBoxEnd.value.split(\":\")[2])\n\t\t\t\t};\n\t\t\t\treparse();\n\t\t\t});\n\t\t} else if (checkInfo.type == \"zkpp\") {\n\t\t\tlet inputDescribe = document.createElement(\"span\");\n\t\t\tlet inputBox = document.createElement(\"input\");\n\t\t\tlet inputAccept = document.createElement(\"button\");\n\t\t\tinputDescribe.innerText = await availableAPIs.lookupLocale(\"PASSWORD\") + \": \";\n\t\t\tinputBox.type = \"password\";\n\t\t\tsecCheck.appendChild(inputDescribe);\n\t\t\tsecCheck.appendChild(inputBox);\n\t\t\tsecCheck.appendChild(inputAccept);\n\t\t\tinputAccept.innerText = await availableAPIs.lookupLocale(\"CONFIRM\");\n\t\t\tinputAccept.addEventListener(\"click\", async function() {\n\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\tkeyData: new TextEncoder().encode(inputBox.value),\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\tlength: 256\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key\n\t\t\t\t});\n\t\t\t\tlet publicKey = (await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\tseed: derived\n\t\t\t\t\t}\n\t\t\t\t})).publicKey;\n\t\t\t\tchecks[check] = {\n\t\t\t\t\ttype: \"zkpp\",\n\t\t\t\t\tpublicKey: u8aToHex(publicKey)\n\t\t\t\t};\n\t\t\t\treparse();\n\t\t\t});\n\t\t}\n\t\tdocument.body.appendChild(secCheck);\n\t}\n\n\tasync function add() {\n\t\tsecCheck.remove();\n\t\tsecCheck = document.createElement(\"div\");\n\t\tlet backBtn = document.createElement(\"button\");\n\t\tbackBtn.innerText = \"<-\";\n\t\tbackBtn.addEventListener(\"click\", function() {\n\t\t\treparse();\n\t\t});\n\t\tsecCheck.appendChild(backBtn);\n\t\tfor (let type of types) {\n\t\t\tlet btn = document.createElement(\"button\");\n\t\t\tbtn.innerText = await availableAPIs.lookupLocale(checkLocales[type]);\n\t\t\tbtn.addEventListener(\"click\", function() {\n\t\t\t\tchecks.push({ type });\n\t\t\t\treparse();\n\t\t\t});\n\t\t\tsecCheck.appendChild(btn);\n\t\t}\n\t\tdocument.body.appendChild(secCheck);\n\t}\n\treparse();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/pictureViewer.js
async function pictureInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "pictureViewer" + ".js";
	let linkPath = target + "/apps/links/" + "pictureViewer" + ".lnk";
	let assocs = ["pic"];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// association: pic\n// signer: automaticSigner\n// fnName: pictureInstaller\n// allow: FS_READ, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS\n// signature: bfd3b67a4c22babcade09d203bf16da9c573668dbda22ce5a9fd7e5fbb7c54116401921c3d04a5a145e341a12caa8744ddc07df0602124ad739fd6fd9092172f\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait window.availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"PICTURE_VIEWER\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (exec_args instanceof Array && typeof exec_args[0] == \"string\") {\n\t\tlet path = exec_args[0];\n\t\ttry {\n\t\t\tlet div = document.createElement(\"div\");\n\t\t\tdiv.style = \"background: url(\" + JSON.stringify(await window.availableAPIs.fs_read({ path })) + \")\";\n\t\t\tdiv.style.backgroundSize = \"contain\";\n\t\t\tdiv.style.backgroundRepeat = \"no-repeat\";\n\t\t\tdiv.style.backgroundPosition = \"center\";\n\t\t\tdiv.style.position = \"absolute\";\n\t\t\tdiv.style.top = \"0\";\n\t\t\tdiv.style.left = \"0\";\n\t\t\tdiv.style.width = \"100%\";\n\t\t\tdiv.style.height = \"100%\";\n\t\t\tdiv.style.margin = \"0\";\n\t\t\tdocument.body.appendChild(div);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tdocument.body.innerText = (await availableAPIs.lookupLocale(\"INACCESSIBLE_FILE\")).replace(\"%s\", path);\n\t\t}\n\t} else {\n\t\tdocument.body.innerHTML = await availableAPIs.lookupLocale(\"FILE_NOT_SPECIFIED\");\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n});", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/ping.js
async function pingInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "ping" + ".js";
	let linkPath = target + "/apps/links/" + "ping" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FETCH_SEND, PCOS_NETWORK_PING, RESOLVE_NAME\n// signature: ed8ac82b14cfe8d5f7c16e65ef74c364dcabee56a3a946aad5ab244ccebb6fb134e2d37ec93012680c317f77163e6236d103cf1729dac26a5e6b51bebd18c0a2\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"ping: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PING_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PING_DESCRIPTION\") + \"\\r\\n\")\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"PING_INTERNET_OPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"ping: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tif (exec_args.includes(\"--internet\")) {\n\t\texec_args = exec_args.filter(a => a != \"--internet\");\n\t\tif (!exec_args.length) {\n\t\t\tawait availableAPIs.toMyCLI(\"ping: No URL specified\\r\\n\");\n\t\t\treturn availableAPIs.terminate();\n\t\t}\n\t\tawait availableAPIs.toMyCLI(\"Pinging \" + exec_args[0] + \" via HTTP...\\r\\n\");\n\t\tfor (let i = 1; i <= 4; i++) {\n\t\t\tawait new Promise((resolve) => setTimeout(() => resolve(\"ping\"), 500));\n\t\t\tlet time = performance.now();\n\t\t\ttry {\n\t\t\t\tif ((await Promise.race([availableAPIs.fetchSend({\n\t\t\t\t\turl: exec_args[0],\n\t\t\t\t\tinit: {\n\t\t\t\t\t\tnoArrayBuffer: true,\n\t\t\t\t\t\tmode: \"no-cors\"\n\t\t\t\t\t}\n\t\t\t\t}), new Promise((resolve) => setTimeout(() => resolve(\"timeout\"), 30000))])) == \"timeout\") throw new Error(\"Response timed out\");\n\t\t\t\ttime = performance.now() - time;\n\t\t\t\tawait availableAPIs.toMyCLI(\"http_seq=\" + i + \" time=\" + time.toFixed(2) + \" ms\\r\\n\");\n\t\t\t} catch (e) {\n\t\t\t\ttime = performance.now() - time;\n\t\t\t\tawait availableAPIs.toMyCLI(\"http_seq=\" + i + \" time=\" + time.toFixed(2) + \" ms err=\" + e.name + \": \" + e.message + \"\\r\\n\");\n\t\t\t}\n\t\t}\n\t\treturn availableAPIs.terminate();\n\t}\n\tlet pingedAddress;\n\tif (exec_args[0].includes(\":\")) pingedAddress = exec_args[0].replaceAll(\":\", \"\");\n\telse {\n\t\ttry {\n\t\t\tpingedAddress = await Promise.race([\n\t\t\t\tavailableAPIs.resolve(exec_args[0]),\n\t\t\t\tnew Promise((resolve) => setTimeout(() => resolve(\"timeout\"), 30000))\n\t\t\t])\n\t\t\tif (pingedAddress == \"timeout\") throw new Error(\"Resolution timed out\");\n\t\t\tif (!pingedAddress) throw new Error(\"Could not resolve hostname\");\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"ping: \" + exec_args[0] + \": \" + e.name + \": \" + e.message + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t}\n\tawait availableAPIs.toMyCLI(\"Pinging \" + exec_args[0] + \" (\" + pingedAddress.match(/.{1,4}/g).join(\":\") + \") via PCOS Network...\\r\\n\");\n\tfor (let i = 1; i <= 4; i++) {\n\t\tawait new Promise((resolve) => setTimeout(() => resolve(\"ping\"), 500));\n\t\tlet time = performance.now();\n\t\ttry {\n\t\t\tlet race = await Promise.race([availableAPIs.networkPing(pingedAddress), new Promise((resolve) => setTimeout(() => resolve(\"timeout\"), 30000))]);\n\t\t\tif (race == \"timeout\") throw new Error(\"Response timed out\");\n\t\t\ttime = performance.now() - time;\n\t\t\tawait availableAPIs.toMyCLI(\"count=\" + i + \" time=\" + time.toFixed(2) + \" ms\\r\\n\");\n\t\t} catch (e) {\n\t\t\ttime = performance.now() - time;\n\t\t\tawait availableAPIs.toMyCLI(\"count=\" + i + \" time=\" + time.toFixed(2) + \" ms err=\" + e.name + \": \" + e.message + \"\\r\\n\");\n\t\t}\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/pivot_root.js
async function pivot_rootInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "pivot_root" + ".js";
	let linkPath = target + "/apps/links/" + "pivot_root" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SET_DEFAULT_SYSTEM\n// signature: 2a758bdb5ecbb0c0b48a4d7846c7375f8802fcc2520ea17b68d35d184561cfd5d8f7c4517a61efc2fcdc22ff8e1de18ae2d12cc8d444a3c641414592a08ab01c\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"pivot_root: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PIVOT_ROOT_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"PIVOT_ROOT_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"pivot_root: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tawait availableAPIs.setSystemMount(exec_args[0]);\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/power.js
async function powerInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "power" + ".js";
	let linkPath = target + "/apps/links/" + "power" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SYSTEM_SHUTDOWN\n// signature: 74fe61b91e4441d95a73716f0cdbc12bf928be103ed7b847fe68eb6c84df92f3728bb7a6d39d46b9ab6619c49baafa938fcee04de1b0f731bd113655bfaa304f\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"power: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tawait availableAPIs.attachCLI();\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (pargs.help) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"POWER_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"POWER_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"POWER_FORCE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"POWER_KEXEC\") + \"\\r\\n\");\n\t\tawait availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: ppos[0] == \"reboot\" || ppos[0] == \"r\" || ppos[0] == \"restart\" || ppos[0] == \"kexec\" || ppos[0] == \"k\" || pargs.kexec,\n\t\t\tisKexec: pargs.kexec || ppos[0] == \"kexec\" || ppos[0] == \"k\",\n\t\t\tforce: pargs.force\n\t\t});\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"power: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/renetworkd.js
async function renetworkdInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "renetworkd" + ".js";
	let linkPath = target + "/apps/links/" + "renetworkd" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, RELOAD_NETWORK_CONFIG\n// signature: fb969f731f72ccbd04a2f2a1059a1fc7e3597bb7d729b3b9503fe03579a43525c1d220d5480a9850199c131c99efa351b89c1ca92f745f4fad8f53f638968a10\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"renetworkd: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\ttry {\n\t\tawait availableAPIs.reloadNetworkConfig();\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"renetworkd: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/rm.js
async function rmInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "rm" + ".js";
	let linkPath = target + "/apps/links/" + "rm" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_BYPASS_PERMISSIONS, FS_CHANGE_PERMISSION, FS_REMOVE\n// signature: 199e054674da50094034b1cabbbc3de6a1f89d47dad7980e98f80163f0c3f092794a01b53d35b3ea66aa879888192d14b74c71b23deada4c8eea3c68bf17d651\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"rm: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"RM_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"RM_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"OPT_RECURSIVE_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"OPT_FORCE_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"rm: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\tlet recursive = exec_args.includes(\"--recursive\");\n\tlet force = exec_args.includes(\"--force\");\n\tif (recursive) exec_args.splice(exec_args.indexOf(\"--recursive\"), 1);\n\tif (force) exec_args.splice(exec_args.indexOf(\"--force\"), 1);\n\tif (exec_args.length != 1) {\n\t\tawait availableAPIs.toMyCLI(\"rm: \" + await availableAPIs.lookupLocale(\"ARGUMENT_COUNT_MISMATCH\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\tif (recursive) await recursiveRemove(exec_args[0], force);\n\telse {\n\t\ttry {\n\t\t\tawait availableAPIs.fs_rm({ path: exec_args[0] });\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"rm: \" + exec_args[0] + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t}\n\t}\n\tawait availableAPIs.terminate();\n})();\n\nasync function recursiveRemove(target, force) {\n\ttry {\n\t\tfor (let targetFile of await availableAPIs.fs_ls({ path: target })) {\n\t\t\ttargetFile = target + \"/\" + targetFile;\n\t\t\ttry {\n\t\t\t\tif (await availableAPIs.fs_isDirectory({ path: targetFile })) await recursiveRemove(targetFile, force);\n\t\t\t\telse await availableAPIs.fs_rm({ path: targetFile });\n\t\t\t} catch (e) {\n\t\t\t\tawait availableAPIs.toMyCLI(\"rm: \" + targetFile + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t\t\tif (!force) return await availableAPIs.terminate();\n\t\t\t}\n\t\t}\n\t\tawait availableAPIs.fs_rm({ path: target });\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"rm: \" + target + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\tif (!force) return await availableAPIs.terminate();\n\t}\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/runKlvlCode.js
async function runKlvlCodeInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "runKlvlCode" + ".js";
	let linkPath = target + "/apps/links/" + "runKlvlCode" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_READ, FS_BYPASS_PERMISSIONS, RUN_KLVL_CODE\n// signature: c00ea849c95e19c0ad22fd41cbc50130fb38668a0b34aec3ef1326aa7560c3747c8e99198545d47dde3135f50795582c8c8264b6bfd5c2b8e943e8b160ad9990\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"runKlvlCode: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"RKL_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"RKL_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"runKlvlCode: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.toMyCLI(JSON.stringify(await availableAPIs.runKlvlCode(await availableAPIs.fs_read({ path: exec_args[0] }))) + \"\\r\\n\");\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"runKlvlCode: \" + file + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.toMyCLI(\"\\r\\n\");\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/secondstage.js
async function secondstageInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "secondstage" + ".js";
	let linkPath = target + "/apps/links/" + "secondstage" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_THEME, CSP_OPERATIONS, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, FS_LIST_PARTITIONS, SET_USER_INFO, RUN_KLVL_CODE, FS_CHANGE_PERMISSION, FS_REMOVE, SYSTEM_SHUTDOWN, GET_SERVER_URL\n// signature: cd805a3527cc611ad3cfb249a8cc0cde49efe0ced793b451d4766b67bbf2db53804a2b34c4bf808489cde570a9b15df1296593022d20611d3b98996de8429c3d\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SET_UP_PCOS\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"CSP_OPERATIONS\", \"FS_READ\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"FS_LIST_PARTITIONS\", \"SET_USER_INFO\", \"RUN_KLVL_CODE\", \"FS_CHANGE_PERMISSION\", \"FS_REMOVE\", \"SYSTEM_SHUTDOWN\", \"GET_SERVER_URL\" ];\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"SETUP_FAILED\");\n\t\treturn;\n\t}\n\tawait availableAPIs.closeability(false);\n\tlet networkDefaultURL = new URL(await availableAPIs.runningServer());\n\tnetworkDefaultURL.protocol = \"ws\" + (networkDefaultURL.protocol == \"https:\" ? \"s\" : \"\") + \":\";\n\tnetworkDefaultURL.pathname = \"\";\n\tconst networkSymbols = \"abcdefghijklmnopqrstuvwxyz0123456789_-\";\n\tlet automatic_configuration = {\n\t\t/*startSetup: true,*/\n\t\tcreateAccount: {\n\t\t\t/*password: \"password\",\n\t\t\tdarkMode: true,\n\t\t\tcreate: true,\n\t\t\tdefaultLocale: \"en\",*/\n\t\t\tusername: \"root\",\n\t\t\tlockUsername: true,\n\t\t\tonlyOnNewInstall: true\n\t\t},\n\t\tupdateOSLink: true,\n\t\tappHarden: {\n\t\t\trequireSignature: true,\n\t\t\trequireAllowlist: true\n\t\t},\n\t\tnetwork: {\n\t\t\turl: networkDefaultURL.toString(),\n\t\t\tucBits: 1,\n\t\t\thostname: new Array(16).fill(0).map(a => networkSymbols[Math.floor(Math.random() * networkSymbols.length)]).join(\"\"),\n\t\t\tupdates: \"pcosserver.pc\"\n\t\t},\n\t\tautoClose: true,\n\t\trestartOnClose: \"kexec\"\n\t};\n\tlet defaultSystem = await availableAPIs.getSystemMount();\n\tlet header = document.createElement(\"b\");\n\tlet postHeader = document.createElement(\"br\");\n\tlet description = document.createElement(\"span\");\n\tlet content = document.createElement(\"div\");\n\tlet button = document.createElement(\"button\");\n\theader.innerText = await availableAPIs.lookupLocale(\"INSTALLER_TITLE\");\n\tdescription.innerText = await availableAPIs.lookupLocale(\"LET_SETUP_SYSTEM\");\n\tbutton.innerText = await availableAPIs.lookupLocale(\"SET_UP\");\n\tdocument.body.appendChild(header);\n\tdocument.body.appendChild(postHeader);\n\tdocument.body.appendChild(description);\n\tdocument.body.appendChild(content);\n\tdocument.body.appendChild(button);\n\tbutton.onclick = async function() {\n\t\theader.remove();\n\t\tpostHeader.remove();\n\t\tcontent.innerHTML = \"\";\n\t\tdescription.innerText = await availableAPIs.lookupLocale(\"LET_CREATE_ACCOUNT\");\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"CREATE\");\n\t\tlet useraccountname = document.createElement(\"input\");\n\t\tlet useraccountpassword = document.createElement(\"input\");\n\t\tlet darkmode = document.createElement(\"input\");\n\t\tlet darkmode_lb = document.createElement(\"label\");\n\t\tlet language = document.createElement(\"select\");\n\t\tlet language_lb = document.createElement(\"label\");\n\t\tuseraccountname.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\tuseraccountpassword.placeholder = await availableAPIs.lookupLocale(\"PASSWORD\");\n\t\tuseraccountpassword.type = \"password\";\n\t\tdarkmode.type = \"checkbox\";\n\t\tdarkmode.id = \"darkmode\";\n\t\tlanguage.id = \"language\";\n\t\tdarkmode_lb.innerText = await availableAPIs.lookupLocale(\"DARK_MODE\");\n\t\tdarkmode_lb.htmlFor = \"darkmode\";\n\t\tlanguage_lb.innerText = await availableAPIs.lookupLocale(\"LANGUAGE_SELECT\");\n\t\tlanguage_lb.htmlFor = \"language\";\n\t\tcontent.appendChild(useraccountname);\n\t\tcontent.appendChild(document.createElement(\"br\"));\n\t\tcontent.appendChild(useraccountpassword);\n\t\tcontent.appendChild(document.createElement(\"br\"));\n\t\tcontent.appendChild(darkmode);\n\t\tcontent.appendChild(darkmode_lb);\n\t\tcontent.appendChild(document.createElement(\"br\"));\n\t\tcontent.appendChild(language_lb);\n\t\tcontent.appendChild(language);\n\t\tlet locales = await availableAPIs.installedLocales();\n\t\tfor (let locale of locales) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = locale;\n\t\t\toption.innerText = await availableAPIs.lookupOtherLocale({ key: \"LOCALE_NAME\", locale });\n\t\t\tlanguage.appendChild(option);\n\t\t}\n\t\tlanguage.value = await availableAPIs.osLocale();\n\t\tbutton.onclick = async function() {\n\t\t\tlet username = useraccountname.value;\n\t\t\tlet password = useraccountpassword.value;\n\t\t\tif (!username) return;\n\t\t\tif (username.includes(\"/\")) return;\n\t\t\tif (!password) return;\n\t\t\tlet homedir = username == \"root\" ? (defaultSystem + \"/root\") : (defaultSystem + \"/home/\" + username);\n\t\t\tlet darkModeChecked = darkmode.checked;\n\t\t\tcontent.innerHTML = \"\";\n\t\t\tbutton.hidden = true;\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"INSTALLING_SYSTEM_APPHARDEN\"));\n\t\t\tif (automatic_configuration.appHarden) await availableAPIs.fs_write({\n\t\t\t\tpath: defaultSystem + \"/etc/appHarden\",\n\t\t\t\tdata: JSON.stringify(automatic_configuration.appHarden)\n\t\t\t});\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"INSTALLING_NET_CONF\"));\n\t\t\tif (automatic_configuration.network) await availableAPIs.fs_write({\n\t\t\t\tpath: defaultSystem + \"/etc/network.json\",\n\t\t\t\tdata: JSON.stringify(automatic_configuration.network)\n\t\t\t})\n\t\t\tif (!(automatic_configuration?.createAccount?.onlyOnNewInstall && exec_args.includes(\"usersConfigured\"))) {\n\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CREATING_USER\"));\n\t\t\t\tlet salt = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"random\",\n\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t});\n\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\tlet key = await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\tkeyData: new TextEncoder().encode(password),\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\tkeyUsages: [\"deriveBits\", \"deriveKey\"]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet derived = new Uint8Array(await availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\tsalt: salt,\n\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbaseKey: key,\n\t\t\t\t\t\tlength: 256\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\tcspArgument: key\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.setUserInfo({\n\t\t\t\t\tdesiredUser: username,\n\t\t\t\t\tinfo: {\n\t\t\t\t\t\tsecurityChecks: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: \"pbkdf2\",\n\t\t\t\t\t\t\t\thash: u8aToHex(derived),\n\t\t\t\t\t\t\t\tsalt: u8aToHex(salt)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tgroups: [ username, \"users\" ],\n\t\t\t\t\t\thomeDirectory: homedir,\n\t\t\t\t\t\tblankPrivileges: false\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CREATING_USER_HOME\"));\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_mkdir({ path: defaultSystem + \"/home\" });\n\t\t\t} catch {}\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_mkdir({ path: homedir });\n\t\t\t} catch {}\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_mkdir({ path: homedir + \"/desktop\" });\n\t\t\t} catch {}\n\t\t\tawait availableAPIs.fs_chown({ path: homedir, newUser: username });\n\t\t\tawait availableAPIs.fs_chgrp({ path: homedir, newGrp: username });\n\t\t\tawait availableAPIs.fs_chmod({ path: homedir, newPermissions: \"rx\" });\n\t\t\tawait availableAPIs.fs_chown({ path: homedir + \"/desktop\", newUser: username });\n\t\t\tawait availableAPIs.fs_chgrp({ path: homedir + \"/desktop\", newGrp: username });\n\t\t\tawait availableAPIs.fs_chmod({ path: homedir + \"/desktop\", newPermissions: \"rx\" });\n\t\t\tif (automatic_configuration.updateOSLink) {\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: homedir + \"/desktop/updateos.lnk\",\n\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\tlocaleReferenceName: \"UPDATE_BUTTON\",\n\t\t\t\t\t\tpath: defaultSystem + \"/apps/diffupdate.js\"\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.fs_chown({ path: homedir + \"/desktop/updateos.lnk\", newUser: username });\n\t\t\t\tawait availableAPIs.fs_chgrp({ path: homedir + \"/desktop/updateos.lnk\", newGrp: username });\n\t\t\t\tawait availableAPIs.fs_chmod({ path: homedir + \"/desktop/updateos.lnk\", newPermissions: \"rx\" });\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"INSTALLING_WP2U\"));\n\t\t\tif (!(automatic_configuration?.createAccount?.onlyOnNewInstall && exec_args.includes(\"usersConfigured\"))) {\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\t\tpath: homedir + \"/.wallpaper\",\n\t\t\t\t\t\tdata: await availableAPIs.fs_read({\n\t\t\t\t\t\t\tpath: defaultSystem + \"/etc/wallpapers/pcos\" + (darkModeChecked ? \"-dark\" : \"\") + \"-beta.pic\"\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t\tawait availableAPIs.fs_chown({ path: homedir + \"/.wallpaper\", newUser: username });\n\t\t\t\t\tawait availableAPIs.fs_chgrp({ path: homedir + \"/.wallpaper\", newGrp: username });\n\t\t\t\t\tawait availableAPIs.fs_chmod({ path: homedir + \"/.wallpaper\", newPermissions: \"rx\" });\n\t\t\t\t} catch {}\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"INSTALLING_WP2L\"));\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: defaultSystem + \"/etc/wallpapers/lockscreen.pic\",\n\t\t\t\t\tdata: await availableAPIs.fs_read({ path: defaultSystem + \"/etc/wallpapers/pcos-lock-beta.pic\" })\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"INSTALLING_DARKMODE\"));\n\t\t\tif (!(automatic_configuration?.createAccount?.onlyOnNewInstall && exec_args.includes(\"usersConfigured\"))) {\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: homedir + \"/.darkmode\",\n\t\t\t\t\tdata: darkModeChecked.toString()\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.fs_chown({ path: homedir + \"/.darkmode\", newUser: username });\n\t\t\t\tawait availableAPIs.fs_chgrp({ path: homedir + \"/.darkmode\", newGrp: username });\n\t\t\t\tawait availableAPIs.fs_chmod({ path: homedir + \"/.darkmode\", newPermissions: \"rx\" });\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"SETTING_LOCALE_PREFERENCE\"));\n\t\t\tif (!(automatic_configuration?.createAccount?.onlyOnNewInstall && exec_args.includes(\"usersConfigured\"))) {\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: homedir + \"/.locale\",\n\t\t\t\t\tdata: language.value\n\t\t\t\t});\n\t\t\t\tawait availableAPIs.fs_chown({ path: homedir + \"/.locale\", newUser: username });\n\t\t\t\tawait availableAPIs.fs_chgrp({ path: homedir + \"/.locale\", newGrp: username });\n\t\t\t\tawait availableAPIs.fs_chmod({ path: homedir + \"/.locale\", newPermissions: \"rx\" });\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"INSTALLING_DARKMODE2L\"));\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: defaultSystem + \"/etc/darkLockScreen\",\n\t\t\t\tdata: \"false\"\n\t\t\t});\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"REMOVING_2STAGE\"));\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_rm({ path: defaultSystem + \"/boot/17-installer-secondstage.js\" });\n\t\t\t\tawait availableAPIs.fs_rm({ path: defaultSystem + \"/apps/secondstage.js\" });\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(\"Failed to remove secondstage\", e);\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"REMOVING_SETUP_STATE\"));\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_rm({ path: defaultSystem + \"/boot/01-setup-state.js\" });\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(\"Failed to remove setup state\", e);\n\t\t\t}\n\t\t\tawait availableAPIs.runKlvlCode(\"delete modules.settingUp;\");\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"REMOVING_INSTALLERS\"));\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_rm({ path: defaultSystem + \"/boot/15-apps.js\" });\n\t\t\t\tawait availableAPIs.fs_rm({ path: defaultSystem + \"/apps/autoinstaller.js\" });\n\t\t\t\tawait availableAPIs.fs_rm({ path: defaultSystem + \"/apps/installer.js\" });\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(\"Failed to remove installers\", e);\n\t\t\t}\n\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"PATCHING_LOGON\"));\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: defaultSystem + \"/boot/14-logon-requirement-enforce.js\",\n\t\t\t\tdata: \"requireLogon();\\n\"\n\t\t\t});\n\t\t\tdescription.innerHTML = await availableAPIs.lookupLocale(\"SETUP_SUCCESSFUL\");\n\t\t\tif (!automatic_configuration.autoClose) await availableAPIs.closeability(true);\n\t\t\tif (automatic_configuration.autoClose) {\n\t\t\t\tif (automatic_configuration.restartOnClose) return availableAPIs.shutdown({ isReboot: true, isKexec: automatic_configuration.restartOnClose == \"kexec\" });\n\t\t\t\tawait availableAPIs.terminate();\n\t\t\t}\n\t\t}\n\t\tif (automatic_configuration.createAccount) {\n\t\t\tuseraccountname.value = automatic_configuration.createAccount.username || useraccountname.value;\n\t\t\tuseraccountpassword.value = automatic_configuration.createAccount.password || \"\";\n\t\t\tdarkmode.checked = automatic_configuration.createAccount.darkMode || darkmode.checked;\n\t\t\tlanguage.value = automatic_configuration.createAccount.defaultLocale || language.value;\n\t\t\tuseraccountname.disabled = automatic_configuration.createAccount.lockUsername;\n\t\t\tif (automatic_configuration.createAccount.lockUsername) useraccountname.title = await availableAPIs.lookupLocale(\"PROVISIONED_PREFERENCE\");\n\t\t\tif (automatic_configuration.createAccount.create) button.click();\n\t\t\telse if (automatic_configuration.createAccount.onlyOnNewInstall && exec_args.includes(\"usersConfigured\")) {\n\t\t\t\tuseraccountpassword.value = useraccountpassword.value || crypto.getRandomValues(new Uint8Array(64)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\t\tbutton.click();\n\t\t\t}\n\t\t}\n\t}\n\tif (automatic_configuration.startSetup) button.click();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\tawait window.availableAPIs.terminate();\n\t}\n});", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/startMenu.js
async function startMenuInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "startMenu" + ".js";
	let linkPath = target + "/apps/links/" + "startMenu" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: FS_READ, FS_LIST_PARTITIONS, IPC_SEND_PIPE, IPC_LISTEN_PIPE, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS, SYSTEM_SHUTDOWN, GET_USER_INFO, LOGOUT, GET_SCREEN_INFO, GRAB_ATTENTION, LULL_SYSTEM\n// signature: b711f0d715979b1fd4168aa68017ce93c5e30d66655824786c7b3b140d85738ab91f03d477df3cc5593bf81c475ca70e61eac78cb8c94c404f7a4fe7a6950dc5\n// =====END MANIFEST=====\nlet ipcChannel;\nlet shouldShutdown = false;\nlet visibilityState = true;\nlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\nlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n(async function() {\n\t// @pcos-app-mode isolatable\n\tipcChannel = await availableAPIs.getPrivateData();\n\tif (!ipcChannel) return availableAPIs.terminate();\n\tawait visibility(false);\n\tawait window.availableAPIs.windowTitleSet(await window.availableAPIs.lookupLocale(\"START_MENU\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"FS_READ\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\", \"IPC_LISTEN_PIPE\" ];\n\tif (!checklist.every(p => privileges.includes(p))) return availableAPIs.terminate();\n\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { success: true } });\n\tdocument.body.innerText = \"\";\n\tlet logoutButton = document.createElement(\"button\");\n\tlogoutButton.innerText = (await availableAPIs.lookupLocale(\"LOG_OUT_BUTTON\")).replace(\"%s\", await availableAPIs.getUser());\n\tdocument.body.appendChild(logoutButton);\n\tlogoutButton.onclick = async function() {\n\t\tshouldShutdown = true;\n\t\tawait visibility(false);\n\t\tawait availableAPIs.logOut(await availableAPIs.getUser());\n\t}\n\tlet lockButton = document.createElement(\"button\");\n\tlockButton.innerText = await availableAPIs.lookupLocale(\"LOCK_BUTTON\");\n\tdocument.body.appendChild(lockButton);\n\tlockButton.onclick = async function() {\n\t\tawait visibility(false);\n\t\tawait availableAPIs.lock();\n\t}\n\tif (privileges.includes(\"SYSTEM_SHUTDOWN\")) {\n\t\tlet shutoff = document.createElement(\"button\");\n\t\tshutoff.innerText = await availableAPIs.lookupLocale(\"TURN_OFF_BUTTON\");\n\t\tdocument.body.appendChild(shutoff);\n\t\tshutoff.onclick = async function() {\n\t\t\tshouldShutdown = true;\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.shutdown({ isReboot: false });\n\t\t}\n\t\tlet reboot = document.createElement(\"button\");\n\t\treboot.innerText = await availableAPIs.lookupLocale(\"RESTART_BUTTON\");\n\t\tdocument.body.appendChild(reboot);\n\t\treboot.onclick = async function() {\n\t\t\tshouldShutdown = true;\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.shutdown({ isReboot: true, isKexec: true });\n\t\t}\n\t\treboot.oncontextmenu = async function(e) {\n\t\t\te.stopImmediatePropagation();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tshouldShutdown = true;\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.shutdown({ isReboot: true, isKexec: false });\n\t\t}\n\t}\n\tif (privileges.includes(\"LULL_SYSTEM\")) {\n\t\tlet lull = document.createElement(\"button\");\n\t\tlull.innerText = await availableAPIs.lookupLocale(\"LULL_SYSTEM\");\n\t\tdocument.body.appendChild(lull);\n\t\tlull.onclick = async function() {\n\t\t\tawait visibility(false);\n\t\t\tawait availableAPIs.lull();\n\t\t}\n\t}\n\ttry {\n\t\tlet enumeration = await availableAPIs.fs_ls({ path: (await availableAPIs.getSystemMount()) + \"/apps/links\" });\n\t\tfor (let app of enumeration) {\n\t\t\tlet appLink = await availableAPIs.fs_read({ path: (await availableAPIs.getSystemMount()) + \"/apps/links/\" + app });\n\t\t\tappLink = JSON.parse(appLink);\n\t\t\tif (appLink.disabled) continue;\n\t\t\tlet appBtn = document.createElement(\"button\");\n\t\t\tappBtn.innerText = (appLink.localeReferenceName ? await availableAPIs.lookupLocale(appLink.localeReferenceName) : null) || (appLink.localeDatabaseName ? (appLink.localeDatabaseName[navigator.language.slice(0, 2).toLowerCase()] || appLink.localeDatabaseName[await availableAPIs.osLocale()]) : null) || appLink.name;\n\t\t\tappBtn.title = await availableAPIs.lookupLocale(\"PROVISIONED_PREFERENCE\");\n\t\t\tappBtn.onclick = async function() {\n\t\t\t\tawait visibility(false);\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { run: appLink } });\n\t\t\t}\n\t\t\tdocument.body.appendChild(appBtn);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(\"Failed to enumerate system app links\", e);\n\t}\n\ttry {\n\t\tlet enumeration = await availableAPIs.fs_ls({ path: (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory + \"/.applinks\" });\n\t\tfor (let app of enumeration) {\n\t\t\tlet appLink = await availableAPIs.fs_read({ path: (await availableAPIs.getUserInfo({ desiredUser: await availableAPIs.getUser() })).homeDirectory + \"/.applinks/\" + app });\n\t\t\tappLink = JSON.parse(appLink);\n\t\t\tif (appLink.disabled) continue;\n\t\t\tlet appBtn = document.createElement(\"button\");\n\t\t\tappBtn.innerText = (appLink.localeReferenceName ? await availableAPIs.lookupLocale(appLink.localeReferenceName) : null) || (appLink.localeDatabaseName ? (appLink.localeDatabaseName[navigator.language.slice(0, 2).toLowerCase()] || appLink.localeDatabaseName[await availableAPIs.osLocale()]) : null) || appLink.name;\n\t\t\tappBtn.onclick = async function() {\n\t\t\t\tawait visibility(false);\n\t\t\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { run: appLink } });\n\t\t\t}\n\t\t\tdocument.body.appendChild(appBtn);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(\"Failed to enumerate user app links\", e);\n\t}\n\n\tonresize = shapeshift;\n\n\twhile (true) {\n\t\tlet listen = await availableAPIs.listenToPipe(ipcChannel);\n\t\tif (listen.open) {\n\t\t\tawait visibility();\n\t\t\tshapeshift();\n\t\t}\n\t}\n})();\n\nasync function visibility(wantedState) {\n\tif (!wantedState) wantedState = !visibilityState;\n\tif (wantedState == visibilityState) return;\n\tawait availableAPIs.windowVisibility(wantedState);\n\tvisibilityState = wantedState;\n}\n\nasync function shapeshift() {\n\tlet screenInfo = await availableAPIs.getScreenInfo();\n\tlet winSize = await availableAPIs.windowSize();\n\tawait availableAPIs.windowRelocate([ screenInfo.height - (winSize.height / 2) - 35 - 8, winSize.width / 2 + 8 ]);\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) {\n\t\tawait visibility(false);\n\t\tawait availableAPIs.sendToPipe({ pipe: ipcChannel, data: { dying: true } });\n\t\tawait availableAPIs.terminate();\n\t}\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/sysAdmin.js
async function sysadminInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "sysAdmin" + ".js";
	let linkPath = target + "/apps/links/" + "sysAdmin" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "SYSADMIN_TOOLS_TITLE" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:SYSADMIN_TOOLS_TITLE\n// signer: automaticSigner\n// fnName: sysadminInstaller\n// allow: SYSTEM_SHUTDOWN, FETCH_SEND, LLDISK_WRITE, RUN_KLVL_CODE, FS_READ, FS_WRITE, FS_LIST_PARTITIONS, GET_LOCALE, GET_THEME, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, FS_BYPASS_PERMISSIONS, LLDISK_READ, LLDISK_LIST_PARTITIONS, LLDISK_INIT_PARTITIONS, LLDISK_REMOVE, LLDISK_IDB_READ, LLDISK_IDB_WRITE, LLDISK_IDB_REMOVE, LLDISK_IDB_LIST, LLDISK_IDB_SYNC, IPC_SEND_PIPE, START_TASK, FS_REMOVE, FS_MOUNT, SET_FIRMWARE, PATCH_DIFF, RESOLVE_NAME, CONNFUL_CONNECT, CONNFUL_READ, CONNFUL_WRITE, CONNFUL_DISCONNECT, CSP_OPERATIONS, GET_UPDATE_SERVICE, GET_USER_INFO\n// signature: 5e08056a3e462f65f188dc1113629a036a90dea825b757a79c613e2d567b21d99d25445c6a1261b223efef1c6fbbbc2ccbc65937135b68898c2d4dc7015517b2\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tlet container = document.createElement(\"div\");\n\tlet extraActivities = document.createElement(\"div\");\n\tlet osReinstallButton = document.createElement(\"button\");\n\tlet fsckOrderButton = document.createElement(\"button\");\n\tlet fsckDiscardButton = document.createElement(\"button\");\n\tlet wipeSystemButton = document.createElement(\"button\");\n\tlet updateSystemButton = document.createElement(\"button\");\n\tlet updateFirmwareButton = document.createElement(\"button\");\n\tlet imagingButton = document.createElement(\"button\");\n\tlet changeLocale = document.createElement(\"button\");\n\tosReinstallButton.innerText = await availableAPIs.lookupLocale(\"REINSTALL_BUTTON\");\n\tfsckOrderButton.innerText = await availableAPIs.lookupLocale(\"FSCK_BUTTON\");\n\tfsckDiscardButton.innerText = await availableAPIs.lookupLocale(\"DISCARD_BUTTON\");\n\twipeSystemButton.innerText = await availableAPIs.lookupLocale(\"SWIPE_BUTTON\");\n\tupdateSystemButton.innerText = await availableAPIs.lookupLocale(\"UPDATE_BUTTON\");\n\tupdateFirmwareButton.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_BUTTON\");\n\timagingButton.innerText = await availableAPIs.lookupLocale(\"SYSTEM_IMAGING\");\n\tchangeLocale.innerText = await availableAPIs.lookupLocale(\"CHANGE_LOCALE\");\n\tosReinstallButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"CSP_OPERATIONS\", \"PATCH_DIFF\", \"RESOLVE_NAME\", \"CONNFUL_CONNECT\", \"CONNFUL_READ\", \"CONNFUL_WRITE\", \"CONNFUL_DISCONNECT\", \"LLDISK_WRITE\", \"SYSTEM_SHUTDOWN\", \"FS_READ\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOADING\");\n\t\tlet osArchive;\n\t\ttry {\n\t\t\tlet etcls = await availableAPIs.fs_ls({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc\"\n\t\t\t});\n\t\t\tlet from = \"scratch\";\n\t\t\tlet originalVersion = \"\";\n\t\t\tif (etcls.includes(\"diffupdate_cache.js\")) {\n\t\t\t\toriginalVersion = await availableAPIs.fs_read({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\"\n\t\t\t\t});\n\t\t\t\tfrom = originalVersion.split(\"\\n\")[5].match(/\\d\\w+/)[0];\n\t\t\t}\n\t\t\tlet serverDomainOrAddress = exec_args[0] || ((await availableAPIs.getUpdateService()) || \"pcosserver.pc\");\n\t\t\tlet serverAddress = serverDomainOrAddress;\n\t\t\tif (!serverAddress.includes(\":\")) serverAddress = await availableAPIs.resolve(serverAddress);\n\t\t\tserverAddress = serverAddress.replaceAll(\":\", \"\");\n\t\t\textraActivities.innerText = (await availableAPIs.lookupLocale(\"DOWNLOADING_OS_PATCH\")).replace(\"%s\", serverDomainOrAddress).replace(\"%s\", serverAddress.match(/.{1,4}/g).join(\":\"));\n\t\t\tlet connection = await availableAPIs.connfulConnect({\n\t\t\t\tgate: \"deltaUpdate\",\n\t\t\t\taddress: serverAddress,\n\t\t\t\tverifyByDomain: serverDomainOrAddress\n\t\t\t});\n\t\t\tawait availableAPIs.connfulConnectionSettled(connection);\n\t\t\tawait availableAPIs.connfulWrite({\n\t\t\t\tconnectionID: connection,\n\t\t\t\tdata: JSON.stringify({ from, handlesCtr: true })\n\t\t\t})\n\t\t\tlet patch = [];\n\t\t\twhile (true) {\n\t\t\t\tlet a = JSON.parse(await availableAPIs.connfulRead(connection));\n\t\t\t\textraActivities.innerText = (await availableAPIs.lookupLocale(\"PATCH_HUNK_COUNT\")).replace(\"%s\", patch.length);\n\t\t\t\tif (a.final) break;\n\t\t\t\tpatch[a.ctr] = a.hunk;\n\t\t\t}\n\t\t\tawait availableAPIs.connfulDisconnect(connection);\n\t\t\tosArchive = (await availableAPIs.patchDiff({\n\t\t\t\toperation: \"applyPatch\",\n\t\t\t\targs: [ originalVersion, patch ]\n\t\t\t})).join(\"\");\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\",\n\t\t\t\tdata: osArchive\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tconsole.error(e);\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOAD_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"REINSTALL_SETTING\");\n\t\tawait availableAPIs.lldaWrite({\n\t\t\tpartition: \"boot\",\n\t\t\tdata: osArchive\n\t\t});\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\tfsckOrderButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"SYSTEM_SHUTDOWN\", \"FS_WRITE\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG\");\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/.fsck\",\n\t\t\t\tdata: \"recover\"\n\t\t\t});\n\t\t} catch {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\tfsckDiscardButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"SYSTEM_SHUTDOWN\", \"FS_WRITE\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG\");\n\t\ttry {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/.fsck\",\n\t\t\t\tdata: \"discard\"\n\t\t\t});\n\t\t} catch {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SETTING_FSCK_FLAG_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\twipeSystemButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"FS_REMOVE\", \"FS_MOUNT\", \"FS_READ\", \"LLDISK_IDB_READ\", \"LLDISK_IDB_WRITE\", \"LLDISK_IDB_REMOVE\", \"LLDISK_IDB_LIST\", \"LLDISK_IDB_SYNC\", \"SYSTEM_SHUTDOWN\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tcontainer.hidden = true;\n\t\tawait availableAPIs.closeability(false);\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"WIPING_SYSTEM\");\n\t\ttry {\n\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\tmountpoint: \"pref\",\n\t\t\t\tfilesystem: \"preferenceMount\",\n\t\t\t\tfilesystemOptions: {}\n\t\t\t});\n\t\t\tlet prefOpts = await availableAPIs.fs_ls({ path: \"pref\" });\n\t\t\tfor (let prefOpt of prefOpts) await availableAPIs.fs_rm({ path: \"pref/\" + prefOpt });\n\t\t\tlet idb_keys = await availableAPIs.lldaIDBList();\n\t\t\tfor (let key of idb_keys) {\n\t\t\t\tlet partLen = (await availableAPIs.lldaIDBRead({ key })).length;\n\t\t\t\tlet randomness = \"\";\n\t\t\t\twhile (randomness.length < partLen) {\n\t\t\t\t\tlet remainingBytes = Math.round((partLen - randomness.length) / 2);\n\t\t\t\t\tif (remainingBytes > 65536) remainingBytes = 65536;\n\t\t\t\t\trandomness += crypto.getRandomValues(new Uint8Array(remainingBytes)).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\");\n\t\t\t\t}\n\t\t\t\tawait availableAPIs.lldaIDBWrite({ key, value: randomness });\n\t\t\t\tawait availableAPIs.lldaIDBSync();\n\t\t\t\tawait availableAPIs.lldaIDBRemove({ key });\n\t\t\t\tawait availableAPIs.lldaIDBSync();\n\t\t\t}\n\t\t\t\n\t\t\tawait availableAPIs.shutdown({});\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tconsole.error(e);\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"WIPING_SYSTEM_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t});\n\tupdateSystemButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"CSP_OPERATIONS\", \"PATCH_DIFF\", \"RESOLVE_NAME\", \"CONNFUL_CONNECT\", \"CONNFUL_READ\", \"CONNFUL_WRITE\", \"CONNFUL_DISCONNECT\", \"FS_WRITE\", \"RUN_KLVL_CODE\", \"IPC_CREATE_PIPE\", \"IPC_LISTEN_PIPE\", \"SYSTEM_SHUTDOWN\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOADING\");\n\t\tlet osArchive;\n\t\ttry {\n\t\t\tlet etcls = await availableAPIs.fs_ls({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc\"\n\t\t\t});\n\t\t\tlet from = \"scratch\";\n\t\t\tlet originalVersion = \"\";\n\t\t\tif (etcls.includes(\"diffupdate_cache.js\")) {\n\t\t\t\toriginalVersion = await availableAPIs.fs_read({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\"\n\t\t\t\t});\n\t\t\t\tfrom = originalVersion.split(\"\\n\")[5].match(/\\d\\w+/)[0];\n\t\t\t}\n\t\t\tlet serverDomainOrAddress = exec_args[0] || ((await availableAPIs.getUpdateService()) || \"pcosserver.pc\");\n\t\t\tlet serverAddress = serverDomainOrAddress;\n\t\t\tif (!serverAddress.includes(\":\")) serverAddress = await availableAPIs.resolve(serverAddress);\n\t\t\tserverAddress = serverAddress.replaceAll(\":\", \"\");\n\t\t\textraActivities.innerText = (await availableAPIs.lookupLocale(\"DOWNLOADING_OS_PATCH\")).replace(\"%s\", serverDomainOrAddress).replace(\"%s\", serverAddress.match(/.{1,4}/g).join(\":\"));\n\t\t\tlet connection = await availableAPIs.connfulConnect({\n\t\t\t\tgate: \"deltaUpdate\",\n\t\t\t\taddress: serverAddress,\n\t\t\t\tverifyByDomain: serverDomainOrAddress\n\t\t\t});\n\t\t\tawait availableAPIs.connfulConnectionSettled(connection);\n\t\t\tawait availableAPIs.connfulWrite({\n\t\t\t\tconnectionID: connection,\n\t\t\t\tdata: JSON.stringify({ from, handlesCtr: true })\n\t\t\t})\n\t\t\tlet patch = [];\n\t\t\twhile (true) {\n\t\t\t\tlet a = JSON.parse(await availableAPIs.connfulRead(connection));\n\t\t\t\textraActivities.innerText = (await availableAPIs.lookupLocale(\"PATCH_HUNK_COUNT\")).replace(\"%s\", patch.length);\n\t\t\t\tif (a.final) break;\n\t\t\t\tpatch[a.ctr] = a.hunk;\n\t\t\t}\n\t\t\tawait availableAPIs.connfulDisconnect(connection);\n\t\t\tif (patch.length == 0) {\n\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSTEM_UP_TO_DATE\");\n\t\t\t\tcontainer.hidden = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tosArchive = (await availableAPIs.patchDiff({\n\t\t\t\toperation: \"applyPatch\",\n\t\t\t\targs: [ originalVersion, patch ]\n\t\t\t})).join(\"\");\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/etc/diffupdate_cache.js\",\n\t\t\t\tdata: osArchive\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tconsole.error(e);\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOAD_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\tlet files = osArchive.split(/\\/\\/ [0-9]+-.+.js\\n/g).slice(1);\n\t\tlet names = osArchive.match(/\\/\\/ [0-9]+-.+.js/g);\n\t\tlet appIndex = names.indexOf(\"// \" + \"1\" + \"5-ap\" + \"ps.js\");\n\t\tlet apps = files[appIndex].match(/async function (.+)Installer\\(target, token\\)/g).map(a => a.split(\" \")[2].split(\"(\")[0]);\n\t\tapps.splice(apps.indexOf(\"autoinstallerInstaller\"), 1);\n\t\tapps.splice(apps.indexOf(\"installerInstaller\"), 1);\n\t\tapps.splice(apps.indexOf(\"secondstageInstaller\"), 1);\n\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\tlet pipeResult = availableAPIs.listenToPipe(ipcPipe);\n\t\tlet installerCode = \"\";\n\t\tfor (let app of apps) installerCode += `await ${app}(modules.defaultSystem, ${JSON.stringify(await availableAPIs.getProcessToken())});\\n`;\n\t\tawait availableAPIs.runKlvlCode(`(async function() {\n\t\t\ttry {\n\t\t\t\t${files[appIndex]}\n\t\t\t\t${installerCode}\n\t\t\t\tmodules.ipc.send(${JSON.stringify(ipcPipe)}, true);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\tmodules.ipc.send(${JSON.stringify(ipcPipe)}, false);\n\t\t\t}\n\t\t})();`);\n\t\tpipeResult = await pipeResult;\n\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\tif (!pipeResult) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATE_EXTRA_FAIL\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\tfiles.splice(appIndex, 1);\n\t\tnames.splice(appIndex, 1);\n\t\tlet installerIndex = names.indexOf(\"// 1\" + \"0\" + \"-ins\" + \"taller.js\");\n\t\tfiles.splice(installerIndex, 1);\n\t\tnames.splice(installerIndex, 1);\n\t\tlet secondStageIndex = names.indexOf(\"// 1\" + \"7\" + \"-instal\" + \"ler-seconds\" + \"tage.js\");\n\t\tfiles.splice(secondStageIndex, 1);\n\t\tnames.splice(secondStageIndex, 1);\n\t\tfor (let file in files) {\n\t\t\tlet name = names[file].split(\" \").slice(1).join(\" \");\n\t\t\tlet content = files[file];\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/\" + name,\n\t\t\t\t\tdata: content\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATE_BOOT_FAIL\");\n\t\t\t\tcontainer.hidden = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true,\n\t\t\tisKexec: true\n\t\t});\n\t});\n\tupdateFirmwareButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"FETCH_SEND\", \"SYSTEM_SHUTDOWN\", \"SET_FIRMWARE\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.closeability(false);\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOADING\");\n\t\tlet fwArchive;\n\t\ttry {\n\t\t\tfwArchive = await availableAPIs.fetchSend({\n\t\t\t\turl: \"/init.js\",\n\t\t\t\tinit: {}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tconsole.error(e);\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOAD_FAILED\");\n\t\t\tcontainer.hidden = false;\n\t\t\treturn;\n\t\t}\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_DECODING\");\n\t\tfwArchive = fwArchive.arrayBuffer;\n\t\tfwArchive = new TextDecoder().decode(fwArchive);\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"UPDATEFW_SETTING\");\n\t\tawait availableAPIs.setFirmware(fwArchive);\n\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"RESTARTING\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t});\n\timagingButton.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"GET_THEME\", \"LLDISK_READ\", \"LLDISK_WRITE\", \"LLDISK_LIST_PARTITIONS\", \"LLDISK_INIT_PARTITIONS\", \"LLDISK_REMOVE\", \"LLDISK_IDB_READ\", \"LLDISK_IDB_WRITE\", \"LLDISK_IDB_REMOVE\", \"LLDISK_IDB_LIST\", \"LLDISK_IDB_SYNC\", \"FS_READ\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"SYSTEM_SHUTDOWN\", \"FS_LIST_PARTITIONS\", \"IPC_SEND_PIPE\", \"GET_LOCALE\", \"IPC_CREATE_PIPE\", \"IPC_LISTEN_PIPE\", \"START_TASK\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SYSTEM_IMAGING\"));\n\t\timaging();\n\t});\n\tchangeLocale.addEventListener(\"click\", async function() {\n\t\tlet checklist = [ \"GET_THEME\", \"GET_LOCALE\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"RUN_KLVL_CODE\", \"FS_LIST_PARTITIONS\" ];\n\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SYSADMIN_TOOLS_PRIVFAIL\");\n\t\t\treturn;\n\t\t}\n\t\tcontainer.hidden = true;\n\t\textraActivities.innerText = \"\";\n\t\tlet locales = await availableAPIs.installedLocales();\n\t\tlet localeSelect = document.createElement(\"select\");\n\t\tlet localeZero = document.createElement(\"option\");\n\t\tlocaleZero.value = \"\";\n\t\tlocaleZero.innerText = \"  Language  \";\n\t\tlocaleZero.selected = true;\n\t\tlocaleZero.disabled = true;\n\t\tlocaleZero.hidden = true;\n\t\tlocaleSelect.appendChild(localeZero);\n\t\tfor (let locale of locales) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = locale;\n\t\t\toption.innerText = await availableAPIs.lookupOtherLocale({ key: \"LOCALE_NAME\", locale });\n\t\t\tlocaleSelect.appendChild(option);\n\t\t}\n\t\tlocaleSelect.addEventListener(\"change\", async function() {\n\t\t\tawait availableAPIs.runKlvlCode(\"modules.locales.defaultLocale = \" + JSON.stringify(localeSelect.value));\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/06-localeset.js\", \n\t\t\t\tdata: \"modules.locales.defaultLocale = \" + JSON.stringify(await availableAPIs.osLocale()) + \";\\n\"\n\t\t\t});\n\t\t\tlocaleSelect.remove();\n\t\t\tcontainer.hidden = false;\n\t\t\textraActivities.innerText = await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\");\n\t\t});\n\t\textraActivities.appendChild(localeSelect);\n\t});\n\tcontainer.appendChild(fsckOrderButton);\n\tcontainer.appendChild(fsckDiscardButton);\n\tcontainer.appendChild(osReinstallButton);\n\tcontainer.appendChild(wipeSystemButton);\n\tcontainer.appendChild(updateSystemButton);\n\tcontainer.appendChild(updateFirmwareButton);\n\tcontainer.appendChild(imagingButton);\n\tcontainer.appendChild(changeLocale);\n\tdocument.body.appendChild(container);\n\tdocument.body.appendChild(extraActivities);\n})();\nfunction imaging() {\n\tasync function mainPage() {\n\t\tdocument.body.innerText = \"\";\n\t\tlet create = document.createElement(\"button\");\n\t\tlet restore = document.createElement(\"button\");\n\t\tcreate.innerText = await availableAPIs.lookupLocale(\"CREATE_IMAGE\");\n\t\trestore.innerText = await availableAPIs.lookupLocale(\"RESTORE_IMAGE\");\n\t\tcreate.onclick = createPage;\n\t\trestore.onclick = restorePage;\n\t\tdocument.body.appendChild(create);\n\t\tdocument.body.appendChild(restore);\n\t}\n\n\tasync function createPage() {\n\t\tdocument.body.innerText = \"\";\n\t\tlet backBtn = document.createElement(\"button\");\n\t\tlet pageTitle = document.createElement(\"span\");\n\t\tlet selectedFileLabel = document.createElement(\"label\");\n\t\tlet selectedFile = document.createElement(\"input\");\n\t\tlet selectedFileButton = document.createElement(\"button\");\n\t\tlet createBtn = document.createElement(\"button\");\n\t\tlet progressBar = document.createElement(\"progress\");\n\t\tlet outcome = document.createElement(\"span\");\n\t\tbackBtn.innerText = \"<-\";\n\t\tpageTitle.innerText = await availableAPIs.lookupLocale(\"CREATE_IMAGE\");\n\t\tselectedFileLabel.innerText = await availableAPIs.lookupLocale(\"SELECT_FILE_PROMPT\");\n\t\tselectedFileButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\t\tcreateBtn.innerText = await availableAPIs.lookupLocale(\"CREATE_IMAGE\");\n\t\toutcome.innerText = await availableAPIs.lookupLocale(\"EMPTY_STATUSBAR\");\n\t\tprogressBar.hidden = true;\n\t\tdocument.body.appendChild(backBtn);\n\t\tdocument.body.appendChild(pageTitle);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(selectedFileLabel);\n\t\tdocument.body.appendChild(selectedFile);\n\t\tdocument.body.appendChild(selectedFileButton);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(createBtn);\n\t\tdocument.body.appendChild(progressBar);\n\t\tdocument.body.appendChild(outcome);\n\n\t\tbackBtn.onclick = mainPage;\n\t\tselectedFileButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) selectedFile.value = result.selected;\n\t\t}\n\n\t\tcreateBtn.onclick = async function() {\n\t\t\tbackBtn.disabled = true;\n\t\t\tselectedFile.disabled = true;\n\t\t\tselectedFileButton.disabled = true;\n\t\t\tcreateBtn.disabled = true;\n\t\t\tprogressBar.hidden = false;\n\t\t\toutcome.hidden = true;\n\t\t\tprogressBar.max = 0;\n\t\t\tprogressBar.value = 0;\n\t\t\tawait availableAPIs.closeability(false);\n\n\t\t\tasync function stopProduction(oc) {\n\t\t\t\tbackBtn.disabled = false;\n\t\t\t\tselectedFile.disabled = false;\n\t\t\t\tselectedFileButton.disabled = false;\n\t\t\t\tcreateBtn.disabled = false;\n\t\t\t\tprogressBar.hidden = true;\n\t\t\t\toutcome.hidden = false;\n\t\t\t\toutcome.innerText = oc;\n\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t}\n\n\t\t\tif (selectedFile.value == \"\") return stopProduction(await availableAPIs.lookupLocale(\"FILE_NOT_SPECIFIED\"));\n\t\t\tlet image = { metadata: {}, data: {} };\n\t\t\tlet subImage = [];\n\t\t\ttry { subImage = await availableAPIs.lldaList(); progressBar.max = subImage.length;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_PARTITIONS_FAILED\")); }\n\t\t\tfor (let partition of subImage) try { image.metadata[partition] = await availableAPIs.lldaRead({ partition }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction((await availableAPIs.lookupLocale(\"READING_PARTITION_FAILED\")).replace(\"%s\", partition)); }\n\t\t\ttry { subImage = await availableAPIs.lldaIDBList(); progressBar.max += subImage.length;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_DATA_FAILED\")); } \n\t\t\tfor (let dataPart of subImage) try { image.data[dataPart] = await availableAPIs.lldaIDBRead({ key: dataPart }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"READING_DATA_FAILED\")); }\n\t\t\tsubImage = [];\n\t\t\ttry { await availableAPIs.fs_write({ path: selectedFile.value, data: JSON.stringify(image) });\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"WRITING_IMAGE_FAILED\")); }\n\t\t\tstopProduction(await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\"));\n\t\t}\n\t}\n\n\tasync function restorePage() {\n\t\tdocument.body.innerText = \"\";\n\t\tlet backBtn = document.createElement(\"button\");\n\t\tlet pageTitle = document.createElement(\"span\");\n\t\tlet selectedFileLabel = document.createElement(\"label\");\n\t\tlet selectedFile = document.createElement(\"input\");\n\t\tlet selectedFileButton = document.createElement(\"button\");\n\t\tlet rebootOnRestore = document.createElement(\"input\");\n\t\tlet rebootOnRestoreLabel = document.createElement(\"label\");\n\t\tlet mergeFlag = document.createElement(\"input\");\n\t\tlet mergeFlagLabel = document.createElement(\"label\");\n\t\tlet restoreBtn = document.createElement(\"button\");\n\t\tlet progressBar = document.createElement(\"progress\");\n\t\tlet outcome = document.createElement(\"span\");\n\t\tbackBtn.innerText = \"<-\";\n\t\tpageTitle.innerText = await availableAPIs.lookupLocale(\"RESTORE_IMAGE\");\n\t\tselectedFileLabel.innerText = await availableAPIs.lookupLocale(\"SELECT_FILE_PROMPT\");\n\t\tselectedFileButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\t\trestoreBtn.innerText = await availableAPIs.lookupLocale(\"RESTORE_IMAGE\");\n\t\trebootOnRestoreLabel.innerText = await availableAPIs.lookupLocale(\"REBOOT_ON_RESTORE\");\n\t\tmergeFlagLabel.innerText = await availableAPIs.lookupLocale(\"MERGE_STATES\");\n\t\toutcome.innerText = await availableAPIs.lookupLocale(\"EMPTY_STATUSBAR\");\n\t\trebootOnRestore.type = \"checkbox\";\n\t\tmergeFlag.type = \"checkbox\";\n\t\trebootOnRestore.id = \"rebootOnRestore\";\n\t\tmergeFlag.id = \"mergeFlag\";\n\t\trebootOnRestoreLabel.htmlFor = \"rebootOnRestore\";\n\t\tmergeFlagLabel.htmlFor = \"mergeFlag\";\n\t\tprogressBar.hidden = true;\n\t\tdocument.body.appendChild(backBtn);\n\t\tdocument.body.appendChild(pageTitle);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(selectedFileLabel);\n\t\tdocument.body.appendChild(selectedFile);\n\t\tdocument.body.appendChild(selectedFileButton);\n\t\tdocument.body.appendChild(document.createElement(\"br\"));\n\t\tdocument.body.appendChild(rebootOnRestore);\n\t\tdocument.body.appendChild(rebootOnRestoreLabel);\n\t\tdocument.body.appendChild(document.createElement(\"br\"));\n\t\tdocument.body.appendChild(mergeFlag);\n\t\tdocument.body.appendChild(mergeFlagLabel);\n\t\tdocument.body.appendChild(document.createElement(\"hr\"));\n\t\tdocument.body.appendChild(restoreBtn);\n\t\tdocument.body.appendChild(progressBar);\n\t\tdocument.body.appendChild(outcome);\n\n\t\tbackBtn.onclick = mainPage;\n\t\tselectedFileButton.onclick = async function() {\n\t\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\t\tawait availableAPIs.windowVisibility(false);\n\t\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\"] });\n\t\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\t\tawait availableAPIs.windowVisibility(true);\n\t\t\tif (result.success) selectedFile.value = result.selected;\n\t\t}\n\n\t\trestoreBtn.onclick = async function() {\n\t\t\tbackBtn.disabled = true;\n\t\t\tselectedFile.disabled = true;\n\t\t\tselectedFileButton.disabled = true;\n\t\t\trestoreBtn.disabled = true;\n\t\t\trebootOnRestore.disabled = true;\n\t\t\tmergeFlag.disabled = true;\n\t\t\toutcome.hidden = true;\n\t\t\tprogressBar.hidden = false;\n\t\t\tprogressBar.max = 0;\n\t\t\tprogressBar.value = 0;\n\t\t\tawait availableAPIs.closeability(false);\n\n\t\t\tasync function stopProduction(oc) {\n\t\t\t\tbackBtn.disabled = false;\n\t\t\t\tselectedFile.disabled = false;\n\t\t\t\tselectedFileButton.disabled = false;\n\t\t\t\trestoreBtn.disabled = false;\n\t\t\t\trebootOnRestore.disabled = false;\n\t\t\t\tmergeFlag.disabled = false;\n\t\t\t\toutcome.hidden = false;\n\t\t\t\tprogressBar.hidden = true;\n\t\t\t\toutcome.innerText = oc;\n\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t}\n\n\t\t\tif (selectedFile.value == \"\") return stopProduction(await availableAPIs.lookupLocale(\"FILE_NOT_SPECIFIED\"));\n\t\t\ttry { await availableAPIs.lldaList();\n\t\t\t\t} catch { await availableAPIs.lldaInitPartitions(); }\n\n\t\t\tlet image;\n\t\t\ttry { image = JSON.parse(await availableAPIs.fs_read({ path: selectedFile.value }));\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"READING_IMAGE_FAILED\")); }\n\n\t\t\tprogressBar.max += Object.keys(image.metadata).length + Object.keys(image.data).length;\n\t\t\tfor (let partition in image.metadata) try { await availableAPIs.lldaWrite({ partition, data: image.metadata[partition] }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction((await availableAPIs.lookupLocale(\"WRITING_PARTITION_FAILED\")).replace(\"%s\", partition)); }\n\t\t\tfor (let dataPart in image.data) try { await availableAPIs.lldaIDBWrite({ key: dataPart, value: image.data[dataPart] }); progressBar.value++;\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"WRITING_DATA_FAILED\")); }\n\t\t\t\n\t\t\tif (!mergeFlag.checked) {\n\t\t\t\tlet currentSubImage = [];\n\t\t\t\ttry { currentSubImage = (await availableAPIs.lldaList()).filter(a => !Object.keys(image.metadata).includes(a)); progressBar.max += currentSubImage.length;\n\t\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_PARTITIONS_FAILED\")); }\n\t\t\t\tfor (let partition of currentSubImage) try { await availableAPIs.lldaRemove({ partition }); progressBar.value++;\n\t\t\t\t\t} catch { return stopProduction((await availableAPIs.lookupLocale(\"DELETING_PARTITION_FAILED\")).replace(\"%s\", partition)); }\n\t\t\t\t\n\t\t\t\ttry { currentSubImage = (await availableAPIs.lldaIDBList()).filter(a => !Object.keys(image.data).includes(a)); progressBar.max += currentSubImage.length;\n\t\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"LISTING_DATA_FAILED\")); }\n\t\t\t\tfor (let dataPart of currentSubImage) try { await availableAPIs.lldaIDBRemove({ key: dataPart }); progressBar.value++;\n\t\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"DELETING_DATA_FAILED\")); }\n\t\t\t\tcurrentSubImage = [];\n\t\t\t}\n\n\t\t\ttry { await availableAPIs.lldaIDBSync();\n\t\t\t} catch {}\n\n\t\t\tif (rebootOnRestore.checked) try { await availableAPIs.shutdown({ isReboot: true });\n\t\t\t\t} catch { return stopProduction(await availableAPIs.lookupLocale(\"SHUTTING_DOWN_FAILED\")); }\n\t\t\tstopProduction(await availableAPIs.lookupLocale(\"SUCCESSFUL_OP\"));\n\t\t}\n\t}\n\tmainPage();\n}\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/systemSecurity.js
async function systemSecurityInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "systemSecurity" + ".js";
	let linkPath = target + "/apps/links/" + "systemSecurity" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "SYSTEM_SECURITY_TITLE" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:SYSTEM_SECURITY_TITLE\n// signer: automaticSigner\n// allow: GET_USER_INFO, USER_INFO_OTHERS, SENSITIVE_USER_INFO_OTHERS, SET_USER_INFO, GET_LOCALE, GET_THEME, CSP_OPERATIONS, SET_SECURITY_CHECKS, FS_LIST_PARTITIONS, FS_READ, FS_REMOVE, FS_WRITE, FS_CHANGE_PERMISSION, START_TASK, FS_BYPASS_PERMISSIONS, MANAGE_TOKENS, SWITCH_USERS_AUTOMATICALLY, ELEVATE_PRIVILEGES, GET_USER_LIST\n// signature: 1278c806759b031bd1aec801c86159860abf676d9e83a4f344391ea2076ebf79d3de97cc48aa2d3a695475950fea52de2a9d827983ad4376a9338419f1f5d5d5\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_TITLE\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"GET_USER_INFO\", \"USER_INFO_OTHERS\", \"SENSITIVE_USER_INFO_OTHERS\", \"SET_USER_INFO\", \"FS_LIST_PARTITIONS\", \"FS_READ\", \"FS_REMOVE\", \"FS_WRITE\", \"FS_CHANGE_PERMISSION\", \"START_TASK\", \"FS_BYPASS_PERMISSIONS\", \"MANAGE_TOKENS\", \"SWITCH_USERS_AUTOMATICALLY\", \"ELEVATE_PRIVILEGES\", \"GET_USER_LIST\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_DENY\");\n\t\tlet currentToken = await availableAPIs.getProcessToken();\n\t\tlet newToken = await availableAPIs.consentGetToken({\n\t\t\tintent: await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_INTENT\"),\n\t\t\tname: await availableAPIs.lookupLocale(\"SYSTEM_SECURITY_TITLE\"),\n\t\t});\n\t\tif (!newToken) return;\n\t\tawait availableAPIs.setProcessToken(newToken);\n\t\tawait availableAPIs.revokeToken(currentToken);\n\t\tprivileges = await availableAPIs.getPrivileges();\n\t\tif (!checklist.every(p => privileges.includes(p))) return;\n\t}\n\tdocument.body.innerText = \"\";\n\tlet pageHeader = document.createElement(\"b\");\n\tlet actionSpecificField = document.createElement(\"div\");\n\tdocument.body.appendChild(pageHeader);\n\tdocument.body.appendChild(document.createElement(\"hr\"));\n\tdocument.body.appendChild(actionSpecificField);\n\tlet username, userData;\n\tasync function main() {\n\t\tusername = null;\n\t\tuserData = null;\n\t\tactionSpecificField.innerText = \"\";\n\t\tlet usernameField = document.createElement(\"input\");\n\t\tlet editButton = document.createElement(\"button\");\n\t\tpageHeader.innerText = await availableAPIs.lookupLocale(\"USERNAME_PROMPT\");\n\t\teditButton.innerText = await availableAPIs.lookupLocale(\"EDIT\");\n\t\tusernameField.placeholder = await availableAPIs.lookupLocale(\"USERNAME\");\n\t\tactionSpecificField.appendChild(usernameField);\n\t\tactionSpecificField.appendChild(editButton);\n\t\tactionSpecificField.appendChild(document.createElement(\"hr\"));\n\t\tfor (let user of await availableAPIs.getUsers()) {\n\t\t\tlet userButton = document.createElement(\"button\");\n\t\t\tuserButton.innerText = user;\n\t\t\tuserButton.addEventListener(\"click\", async function() {\n\t\t\t\tusernameField.value = user;\n\t\t\t\teditButton.click();\n\t\t\t});\n\t\t\tactionSpecificField.appendChild(userButton);\n\t\t}\n\t\teditButton.addEventListener(\"click\", async function() {\n\t\t\tif (!usernameField.value) return;\n\t\t\tusername = usernameField.value;\n\t\t\tuserData = await availableAPIs.getUserInfo({ desiredUser: username, sensitive: true });\n\t\t\tif (!userData) {\n\t\t\t\tuserData = {\n\t\t\t\t\tgroups: [username],\n\t\t\t\t\thomeDirectory: await availableAPIs.getSystemMount() + \"/home/\" + username,\n\t\t\t\t\tsecurityChecks: [],\n\t\t\t\t\tblankPrivileges: false\n\t\t\t\t};\n\t\t\t\tawait availableAPIs.setUserInfo({ desiredUser: username, info: userData });\n\t\t\t}\n\t\t\tuserEditPage();\n\t\t});\n\t}\n\n\tasync function userEditPage() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = username;\n\t\tlet homeDirectoryChanger = document.createElement(\"button\");\n\t\tlet securityChecksButton = document.createElement(\"button\");\n\t\tlet groupChanger = document.createElement(\"button\");\n\t\tlet privilegeSetButton = document.createElement(\"button\");\n\t\tlet removeButton = document.createElement(\"button\");\n\t\tlet leaveButton = document.createElement(\"button\");\n\t\thomeDirectoryChanger.innerText = await availableAPIs.lookupLocale(\"USER_HOMEDIR\");\n\t\tsecurityChecksButton.innerText = await availableAPIs.lookupLocale(\"PERSONAL_SECURITY_TITLE\");\n\t\tgroupChanger.innerText = await availableAPIs.lookupLocale(\"USER_GROUPS\");\n\t\tprivilegeSetButton.innerText = await availableAPIs.lookupLocale(\"USER_EXT_PRIVILEGES\");\n\t\tremoveButton.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tleaveButton.innerText = await availableAPIs.lookupLocale(\"EXIT\");\n\t\thomeDirectoryChanger.addEventListener(\"click\", changeHomeDir);\n\t\tsecurityChecksButton.addEventListener(\"click\", async function() {\n\t\t\tawait availableAPIs.switchUser(username);\n\t\t\tawait availableAPIs.startTask({\n\t\t\t\tfile: await availableAPIs.getSystemMount() + \"/apps/personalSecurity.js\",\n\t\t\t\targPassed: []\n\t\t\t});\n\t\t\tawait availableAPIs.terminate();\n\t\t});\n\t\tgroupChanger.addEventListener(\"click\", changeGroups);\n\t\tprivilegeSetButton.addEventListener(\"click\", privilegeSet);\n\t\tremoveButton.addEventListener(\"click\", removeUser);\n\t\tleaveButton.addEventListener(\"click\", main);\n\t\tactionSpecificField.appendChild(homeDirectoryChanger);\n\t\tactionSpecificField.appendChild(securityChecksButton);\n\t\tactionSpecificField.appendChild(groupChanger);\n\t\tactionSpecificField.appendChild(privilegeSetButton);\n\t\tactionSpecificField.appendChild(removeButton);\n\t\tactionSpecificField.appendChild(leaveButton);\n\t}\n\n\tasync function changeHomeDir() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"USER_HOMEDIR\");\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet homeDirectoryField = document.createElement(\"input\");\n\t\tlet changeButton = document.createElement(\"button\");\n\t\tlet createButton = document.createElement(\"button\");\n\t\tlet status = document.createElement(\"div\");\n\t\tbackButton.innerText = \"<-\";\n\t\tchangeButton.innerText = await availableAPIs.lookupLocale(\"EDIT\");\n\t\tcreateButton.innerText = await availableAPIs.lookupLocale(\"CREATE_HD\");\n\t\thomeDirectoryField.value = userData.homeDirectory;\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\tchangeButton.addEventListener(\"click\", async function() {\n\t\t\tif (!homeDirectoryField.value) return;\n\t\t\tuserData.homeDirectory = homeDirectoryField.value;\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tuserEditPage();\n\t\t});\n\t\tcreateButton.addEventListener(\"click\", async function() {\n\t\t\ttry {\n\t\t\t\tawait mkrecursive(homeDirectoryField.value);\n\t\t\t\tawait availableAPIs.fs_chown({ path: homeDirectoryField.value, newUser: username });\n\t\t\t\tawait availableAPIs.fs_chgrp({ path: homeDirectoryField.value, newGrp: userData.groups[0] || username });\n\t\t\t\tawait availableAPIs.fs_chmod({ path: homeDirectoryField.value, newPermissions: \"rx\" });\n\t\t\t\tstatus.innerText = await availableAPIs.lookupLocale(\"CREATING_HD_OK\");\n\t\t\t} catch {\n\t\t\t\tstatus.innerText = await availableAPIs.lookupLocale(\"CREATING_HD_FAIL\");\n\t\t\t}\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(homeDirectoryField);\n\t\tactionSpecificField.appendChild(changeButton);\n\t\tactionSpecificField.appendChild(createButton);\n\t\tactionSpecificField.appendChild(status);\n\t}\n\n\tasync function changeGroups() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"USER_GROUPS\");\n\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet addGroup = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\taddGroup.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\taddGroup.addEventListener(\"click\", addGroupAction);\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(addGroup);\n\n\t\tfor (let group in userData.groups) {\n\t\t\tlet groupInfo = userData.groups[group];\n\t\t\tlet groupDiv = document.createElement(\"div\");\n\t\t\tgroupDiv.style.display = \"flex\";\n\t\t\tlet groupNameDiv = document.createElement(\"div\");\n\t\t\tgroupNameDiv.style.flex = 100;\n\t\t\tlet groupBtns = document.createElement(\"div\");\n\t\t\tgroupNameDiv.innerText = groupInfo;\n\t\t\tlet btnUp = document.createElement(\"button\");\n\t\t\tlet btnDown = document.createElement(\"button\");\n\t\t\tlet btnDelete = document.createElement(\"button\");\n\t\t\tbtnUp.innerText = \"/\\\\\";\n\t\t\tbtnUp.disabled = group == 0;\n\t\t\tbtnDown.disabled = group == userData.groups.length - 1;\n\t\t\tbtnDown.innerText = \"\\\\/\";\n\t\t\tbtnDelete.innerText = \"x\";\n\t\t\tgroupBtns.appendChild(btnUp);\n\t\t\tgroupBtns.appendChild(btnDown);\n\t\t\tgroupBtns.appendChild(btnDelete);\n\t\t\tgroupDiv.appendChild(groupNameDiv);\n\t\t\tgroupDiv.appendChild(groupBtns);\n\t\t\tbtnDelete.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.groups.splice(group, 1);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tchangeGroups();\n\t\t\t});\n\t\t\tactionSpecificField.appendChild(groupDiv);\n\t\t\tbtnUp.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.groups.splice(group, 1);\n\t\t\t\tuserData.groups.splice(group - 1, 0, groupInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tchangeGroups();\n\t\t\t});\n\t\t\tbtnDown.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.groups.splice(group, 1);\n\t\t\t\tuserData.groups.splice(group - 1 + 2, 0, groupInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tchangeGroups();\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function addGroupAction() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet groupNameField = document.createElement(\"input\");\n\t\tlet createButton = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\tcreateButton.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\t\tbackButton.addEventListener(\"click\", changeGroups);\n\t\tcreateButton.addEventListener(\"click\", async function() {\n\t\t\tuserData.groups.push(groupNameField.value);\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tchangeGroups();\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(groupNameField);\n\t\tactionSpecificField.appendChild(createButton);\n\t}\n\n\tasync function removeUser() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet removeWithHomedir = document.createElement(\"button\");\n\t\tlet removeAlone = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\tremoveWithHomedir.innerText = await availableAPIs.lookupLocale(\"REMOVE_USER_WITH_HD\");\n\t\tremoveAlone.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\tremoveWithHomedir.addEventListener(\"click\", async function() {\n\t\t\trecursiveRemove(userData.homeDirectory);\n\t\t\tawait availableAPIs.setUserInfo({\n\t\t\t\tdesiredUser: username,\n\t\t\t\tinfo: undefined\n\t\t\t});\n\t\t\tmain();\n\t\t});\n\t\tremoveAlone.addEventListener(\"click\", async function() {\n\t\t\tawait availableAPIs.setUserInfo({\n\t\t\t\tdesiredUser: username,\n\t\t\t\tinfo: undefined\n\t\t\t});\n\t\t\tmain();\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(removeWithHomedir);\n\t\tactionSpecificField.appendChild(removeAlone);\n\t}\n\n\tasync function privilegeSet() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tpageHeader.innerText = \"[\" + username + \"] \" + await availableAPIs.lookupLocale(\"USER_EXT_PRIVILEGES\");\n\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet addPrivilege = document.createElement(\"button\");\n\t\tlet removeAll = document.createElement(\"button\");\n\t\tlet warning = document.createElement(\"b\");\n\t\tlet blankPrivsCheck = document.createElement(\"input\");\n\t\tlet blankPrivsCheckLabel = document.createElement(\"label\");\n\t\tbackButton.innerText = \"<-\";\n\t\taddPrivilege.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\t\tremoveAll.innerText = await availableAPIs.lookupLocale(\"REMOVE_BTN\");\n\t\tblankPrivsCheck.type = \"checkbox\";\n\t\tblankPrivsCheck.id = \"blankPrivCheck\";\n\t\tblankPrivsCheckLabel.innerText = await availableAPIs.lookupLocale(\"BLANK_PRIVILEGE_FLAG\");\n\t\tblankPrivsCheckLabel.htmlFor = \"blankPrivCheck\";\n\t\tblankPrivsCheck.checked = userData.blankPrivileges;\n\t\twarning.innerText = await availableAPIs.lookupLocale(\"WARNING_PRIVILEGES\");\n\n\t\tbackButton.addEventListener(\"click\", userEditPage);\n\t\taddPrivilege.addEventListener(\"click\", addPrivilegeAction);\n\t\tremoveAll.addEventListener(\"click\", async function() {\n\t\t\tuserData.additionalPrivilegeSet = undefined;\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tprivilegeSet();\n\t\t})\n\t\tblankPrivsCheck.addEventListener(\"change\", async function() {\n\t\t\tuserData.blankPrivileges = blankPrivsCheck.checked;\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t})\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(addPrivilege);\n\t\tactionSpecificField.appendChild(removeAll);\n\t\tactionSpecificField.appendChild(blankPrivsCheck);\n\t\tactionSpecificField.appendChild(blankPrivsCheckLabel);\n\t\tactionSpecificField.appendChild(document.createElement(\"br\"));\n\t\tactionSpecificField.appendChild(warning);\n\n\t\tif (!userData.additionalPrivilegeSet) userData.additionalPrivilegeSet = [];\n\t\tfor (let privilege in userData.additionalPrivilegeSet) {\n\t\t\tlet privilegeInfo = userData.additionalPrivilegeSet[privilege];\n\t\t\tlet privilegeDiv = document.createElement(\"div\");\n\t\t\tprivilegeDiv.style.display = \"flex\";\n\t\t\tlet privilegeNameDiv = document.createElement(\"div\");\n\t\t\tprivilegeNameDiv.style.flex = 100;\n\t\t\tlet privilegeBtns = document.createElement(\"div\");\n\t\t\tprivilegeNameDiv.innerText = privilegeInfo;\n\t\t\tlet btnUp = document.createElement(\"button\");\n\t\t\tlet btnDown = document.createElement(\"button\");\n\t\t\tlet btnDelete = document.createElement(\"button\");\n\t\t\tbtnUp.innerText = \"/\\\\\";\n\t\t\tbtnUp.disabled = privilege == 0;\n\t\t\tbtnDown.disabled = privilege == userData.additionalPrivilegeSet.length - 1;\n\t\t\tbtnDown.innerText = \"\\\\/\";\n\t\t\tbtnDelete.innerText = \"x\";\n\t\t\tprivilegeBtns.appendChild(btnUp);\n\t\t\tprivilegeBtns.appendChild(btnDown);\n\t\t\tprivilegeBtns.appendChild(btnDelete);\n\t\t\tprivilegeDiv.appendChild(privilegeNameDiv);\n\t\t\tprivilegeDiv.appendChild(privilegeBtns);\n\t\t\tbtnDelete.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege, 1);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tprivilegeSet();\n\t\t\t});\n\t\t\tactionSpecificField.appendChild(privilegeDiv);\n\t\t\tbtnUp.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege, 1);\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege - 1, 0, privilegeInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tprivilegeSet();\n\t\t\t});\n\t\t\tbtnDown.addEventListener(\"click\", async function() {\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege, 1);\n\t\t\t\tuserData.additionalPrivilegeSet.splice(privilege - 1 + 2, 0, privilegeInfo);\n\t\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\t\tprivilegeSet();\n\t\t\t});\n\t\t}\n\t}\n\n\tasync function addPrivilegeAction() {\n\t\tactionSpecificField.innerText = \"\";\n\t\tlet backButton = document.createElement(\"button\");\n\t\tlet privilegeNameField = document.createElement(\"input\");\n\t\tlet createButton = document.createElement(\"button\");\n\t\tbackButton.innerText = \"<-\";\n\t\tcreateButton.innerText = await availableAPIs.lookupLocale(\"ADD_BTN\");\n\t\tbackButton.addEventListener(\"click\", privilegeSet);\n\t\tcreateButton.addEventListener(\"click\", async function() {\n\t\t\tif (!userData.additionalPrivilegeSet) userData.additionalPrivilegeSet = [];\n\t\t\tuserData.additionalPrivilegeSet.push(...(privilegeNameField.value.match(/[A-Z_]+/g) || []));\n\t\t\tuserData.additionalPrivilegeSet = Array.from(new Set(userData.additionalPrivilegeSet));\n\t\t\tawait availableAPIs.setUserInfo({desiredUser: username, info: userData});\n\t\t\tprivilegeSet();\n\t\t});\n\t\tactionSpecificField.appendChild(backButton);\n\t\tactionSpecificField.appendChild(privilegeNameField);\n\t\tactionSpecificField.appendChild(createButton);\n\t}\n\n\tasync function mkrecursive(dir) {\n\t\tlet slices = dir.split(\"/\");\n\t\tfor (let i = 2; i <= slices.length; i++) {\n\t\t\tlet browse = await availableAPIs.fs_ls({ path: slices.slice(0, i - 1).join(\"/\") });\n\t\t\tif (!browse.includes(slices[i - 1])) await availableAPIs.fs_mkdir({ path: slices.slice(0, i).join(\"/\") });\n\t\t}\n\t}\n\n\tasync function recursiveRemove(path) {\n\t\tlet dirList = await availableAPIs.fs_ls({ path });\n\t\tfor (let fileIndex in dirList) {\n\t\t\tlet file = dirList[fileIndex];\n\t\t\tif (await availableAPIs.fs_isDirectory({ path: path + \"/\" + file })) await recursiveRemove(path + \"/\" + file);\n\t\t\telse await availableAPIs.fs_rm({ path: path + \"/\" + file });\n\t\t}\n\t\tawait availableAPIs.fs_rm({ path });\n\t}\n\tmain();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/taskManager.js
async function taskMgrInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "taskManager" + ".js";
	let linkPath = target + "/apps/links/" + "taskManager" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "TASK_MANAGER" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:TASK_MANAGER\n// signer: automaticSigner\n// fnName: taskMgrInstaller\n// allow: LIST_TASKS, SIGNAL_TASK, GET_LOCALE, GET_THEME, TASK_BYPASS_PERMISSIONS\n// signature: 854f182a509c4ef9f8a0dd8726838e1fc91636347d745e47fb9779869dab1386da72d9ac8b85f442305f14e3aae56d3f8890483ea9ecaf90b5b8b551af7b6e0a\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"TASK_MANAGER\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"LIST_TASKS\", \"SIGNAL_TASK\" ];\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tdocument.body.innerText = (await availableAPIs.lookupLocale(\"TMGR_PERMISSION\")).replace(\"%s\", checklist.join(\", \"));\n\t\treturn;\n\t}\n\tlet styleElement = document.createElement(\"style\");\n\tstyleElement.innerText = `th, td { border: 1px solid black; }\n\ttable { overflow: scroll; min-width: 100%; width: max-content; }`;\n\tdocument.head.appendChild(styleElement);\n\tlet table = document.createElement(\"table\");\n\tlet thead = document.createElement(\"thead\");\n\tlet theadRow = document.createElement(\"tr\");\n\tlet thBasename = document.createElement(\"th\");\n\tlet thUser = document.createElement(\"th\");\n\tlet thTerminate = document.createElement(\"th\");\n\tlet thFP = document.createElement(\"th\");\n\tlet thArgs = document.createElement(\"th\");\n\tlet tbody = document.createElement(\"tbody\");\n\tthBasename.innerText = await availableAPIs.lookupLocale(\"BASENAME_TASK\");\n\tthUser.innerText = await availableAPIs.lookupLocale(\"USER_TASK\");\n\tthTerminate.innerText = await availableAPIs.lookupLocale(\"TERMINATE_TASK\");\n\tthFP.innerText = await availableAPIs.lookupLocale(\"FULL_PATH_TASK\");\n\tthArgs.innerText = await availableAPIs.lookupLocale(\"ARGUMENTS_TASK\");\n\ttheadRow.appendChild(thBasename);\n\ttheadRow.appendChild(thUser);\n\ttheadRow.appendChild(thTerminate);\n\ttheadRow.appendChild(thFP);\n\ttheadRow.appendChild(thArgs);\n\tthead.appendChild(theadRow);\n\ttable.appendChild(thead);\n\ttable.appendChild(tbody);\n\tdocument.body.appendChild(table);\n\tasync function refresh() {\n\t\tlet prevtb = tbody;\n\t\tlet newtb = document.createElement(\"tbody\");\n\t\tlet tasks = await availableAPIs.listTasks();\n\t\tfor (let task of tasks) {\n\t\t\tlet tr = document.createElement(\"tr\");\n\t\t\tlet tdBasename = document.createElement(\"td\");\n\t\t\tlet tdUser = document.createElement(\"td\");\n\t\t\tlet tdTerminate = document.createElement(\"td\");\n\t\t\tlet tdFP = document.createElement(\"td\");\n\t\t\tlet tdArgs = document.createElement(\"td\");\n\t\t\tlet taskInfo;\n\t\t\ttry {\n\t\t\t\ttaskInfo = await availableAPIs.taskInfo(task);\n\t\t\t} catch {}\n\t\t\tif (!taskInfo) continue;\n\t\t\tlet terminateBtn = document.createElement(\"button\");\n\t\t\ttdBasename.innerText = taskInfo.file.split(\"/\").slice(-1)[0];\n\t\t\ttdUser.innerText = taskInfo.runBy;\n\t\t\ttdFP.innerText = taskInfo.file;\n\t\t\ttdArgs.innerText = \"[\" + (taskInfo.arg || []).map(a => JSON.stringify(a)).join(\", \") + \"]\";\n\t\t\tterminateBtn.innerText = await availableAPIs.lookupLocale(\"TERMINATE_TASK\");\n\t\t\tterminateBtn.addEventListener(\"click\", async function() {\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.signalTask({ taskId: task, signal: 15 });\n\t\t\t\t} catch {}\n\t\t\t});\n\t\t\tterminateBtn.addEventListener(\"contextmenu\", async function(e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.signalTask({ taskId: task, signal: 9 });\n\t\t\t\t} catch {}\n\t\t\t});\n\t\t\ttdTerminate.appendChild(terminateBtn);\n\t\t\ttr.appendChild(tdBasename);\n\t\t\ttr.appendChild(tdUser);\n\t\t\ttr.appendChild(tdTerminate);\n\t\t\ttr.appendChild(tdFP);\n\t\t\ttr.appendChild(tdArgs);\n\t\t\tnewtb.appendChild(tr);\n\t\t}\n\t\ttable.appendChild(newtb);\n\t\tprevtb.remove();\n\t\ttbody = newtb;\n\t\tsetTimeout(refresh, 1000);\n\t}\n\tawait refresh();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/terminal.js
async function terminalInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "terminal" + ".js";
	let linkPath = target + "/apps/links/" + "terminal" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	lrn = "REAL_TERMINAL_NAME" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// allow: GET_LOCALE, FS_LIST_PARTITIONS, FS_READ, MANAGE_TOKENS, ELEVATE_PRIVILEGES, FS_BYPASS_PERMISSIONS, START_TASK, START_BACKGROUND_TASK, CLI_MODIFICATIONS, GET_BUILD, LIST_TASKS, TASK_BYPASS_PERMISSIONS, CSP_OPERATIONS\n// link: lrn:REAL_TERMINAL_NAME\n// signer: automaticSigner\n// signature: c2f79ba6e638f413673dcffdd98cc24b195041be6eb31b0893ce91d127fe8ccf3af7400114fe4b6f3a8ca2a6e3a66482170c03d8dbdf43fe3fd7c249c2a10489\n// =====END MANIFEST=====\nlet user_spawn_token = null;\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"GET_LOCALE\", \"FS_LIST_PARTITIONS\", \"FS_READ\", \"MANAGE_TOKENS\", \"ELEVATE_PRIVILEGES\", \"START_TASK\", \"CLI_MODIFICATIONS\", \"GET_BUILD\", \"LIST_TASKS\", \"CSP_OPERATIONS\" ];\n\tprivileges = await availableAPIs.getPrivileges();\n\tif (!checklist.every(p => privileges.includes(p))) {\n\t\tawait availableAPIs.toMyCLI(\"terminal: Critical permissions were denied. Press any key to exit.\\r\\n\");\n\t\tawait availableAPIs.fromMyCLI();\n\t\treturn await availableAPIs.terminate();\n\t}\n\tawait window.availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"REAL_TERMINAL_NAME\"));\n\t\n\tfunction parse_cmdline(cmdline) {\n\t\tvar re_next_arg = /^\\s*((?:(?:\"(?:\\\\.|[^\"])*\")|(?:'[^']*')|\\\\.|\\S)+)\\s*(.*)$/;\n\t\tvar next_arg = ['', '', cmdline];\n\t\tvar args = [];\n\t\twhile (next_arg = re_next_arg.exec(next_arg[2])) {\n\t\t\tvar quoted_arg = next_arg[1];\n\t\t\tvar unquoted_arg = \"\";\n\t\t\twhile (quoted_arg.length > 0) {\n\t\t\t\tif (/^\"/.test(quoted_arg)) {\n\t\t\t\t\tvar quoted_part = /^\"((?:\\\\.|[^\"])*)\"(.*)$/.exec(quoted_arg);\n\t\t\t\t\tunquoted_arg += quoted_part[1].replace(/\\\\(.)/g, \"$1\");\n\t\t\t\t\tquoted_arg = quoted_part[2];\n\t\t\t\t} else if (/^'/.test(quoted_arg)) {\n\t\t\t\t\tvar quoted_part = /^'([^']*)'(.*)$/.exec(quoted_arg);\n\t\t\t\t\tunquoted_arg += quoted_part[1];\n\t\t\t\t\tquoted_arg = quoted_part[2];\n\t\t\t\t} else if (/^\\\\/.test(quoted_arg)) {\n\t\t\t\t\tunquoted_arg += quoted_arg[1];\n\t\t\t\t\tquoted_arg = quoted_arg.substring(2);\n\t\t\t\t} else {\n\t\t\t\t\tunquoted_arg += quoted_arg[0];\n\t\t\t\t\tquoted_arg = quoted_arg.substring(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\targs[args.length] = unquoted_arg;\n\t\t}\n\t\treturn args;\n\t}\n\n\tlet str = \"\";\n\tlet default_user = await window.availableAPIs.getUser();\n\tlet defaultPath = await availableAPIs.getSystemMount() + \"/apps\";\n\tlet pathsForBinaries = [ defaultPath ];\n\tlet otherProcessAttached = false;\n\tlet graphic = false;\n\tlet su_stage = -1;\n\tlet suSession = null;\n\tlet hideInputMask = \"\";\n\tlet hideInput = false;\n\t\n\tasync function systemVersion() {\n\t\tawait availableAPIs.toMyCLI((await window.availableAPIs.lookupLocale(\"TERMINAL_INVITATION\")).replace(\"%s\", (await window.availableAPIs.getVersion())) + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI((await window.availableAPIs.lookupLocale(\"SYSTEM_BUILT_AT\")).replace(\"%s\", (new Date(await window.availableAPIs.getBuildTime())).toISOString()) + \"\\r\\n\");\t\n\t}\n\n\tawait systemVersion();\n\tawait availableAPIs.toMyCLI(\"\\r\\n\" + default_user + (privileges.includes(\"FS_BYPASS_PERMISSIONS\") ? \"#\" : \"$\") + \" \");\n\t\n\tonTermData(async function self(e, why) {\n\t\tif (otherProcessAttached) return await availableAPIs.typeIntoOtherCLI({\n\t\t\ttaskId: otherProcessAttached,\n\t\t\ttext: e,\n\t\t\thuman: true\n\t\t});\n\t\tif (e == \"\\r\") {\n\t\t\tif (why != \"su\") await availableAPIs.toMyCLI(\"\\r\\n\");\n\t\t\tif (su_stage > -1) {\n\t\t\t\tif (su_stage == 0) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsuSession = await availableAPIs.automatedLogonCreate({ desiredUser: str });\n\t\t\t\t\t\tsu_stage = 1;\n\t\t\t\t\t} catch {\n\t\t\t\t\t\tsu_stage = -1;\n\t\t\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \"\\r\\n\");\n\t\t\t\t\t}\n\t\t\t\t\tstr = \"\";\n\t\t\t\t}\n\t\t\t\twhile (su_stage >= 1) {\n\t\t\t\t\totherProcessAttached = true;\n\t\t\t\t\tif (su_stage == 2) {\n\t\t\t\t\t\tlet prompt = await availableAPIs.automatedLogonGet(suSession);\n\t\t\t\t\t\tif (prompt.type == \"zkpp_password\") {\n\t\t\t\t\t\t\tlet passwordAsKey = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\t\toperation: \"importKey\",\n\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\tformat: \"raw\",\n\t\t\t\t\t\t\t\t\tkeyData: new TextEncoder().encode(str),\n\t\t\t\t\t\t\t\t\talgorithm: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\textractable: false,\n\t\t\t\t\t\t\t\t\tkeyUsages: [\"deriveBits\"]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tlet rngSeed = await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\t\toperation: \"deriveBits\",\n\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\talgorithm: {\n\t\t\t\t\t\t\t\t\t\tname: \"PBKDF2\",\n\t\t\t\t\t\t\t\t\t\tsalt: new Uint8Array(32),\n\t\t\t\t\t\t\t\t\t\titerations: 100000,\n\t\t\t\t\t\t\t\t\t\thash: \"SHA-256\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tbaseKey: passwordAsKey,\n\t\t\t\t\t\t\t\t\tlength: 256\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\t\t\toperation: \"unloadKey\",\n\t\t\t\t\t\t\t\tcspArgument: passwordAsKey\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tlet u8aToHex = (u8a) => Array.from(u8a).map(a => a.toString(16).padStart(2, \"0\")).join(\"\");\n\t\t\t\t\t\t\tlet hexToU8A = (hex) => Uint8Array.from(hex.match(/.{1,2}/g).map(a => parseInt(a, 16)));\n\t\t\t\t\t\t\tawait availableAPIs.automatedLogonInput({ session: suSession, input: u8aToHex(await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\t\toperation: \"sign\",\n\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\tsecretKey: (await availableAPIs.cspOperation({\n\t\t\t\t\t\t\t\t\t\tcspProvider: \"tweetnacl\",\n\t\t\t\t\t\t\t\t\t\toperation: \"deriveKey\",\n\t\t\t\t\t\t\t\t\t\tcspArgument: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"sign\",\n\t\t\t\t\t\t\t\t\t\t\tseed: new Uint8Array(rngSeed)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})).secretKey,\n\t\t\t\t\t\t\t\t\tmessage: hexToU8A(prompt.challenge)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}))});\n\t\t\t\t\t\t} else await availableAPIs.automatedLogonInput({ session: suSession, input: str });\n\t\t\t\t\t}\n\t\t\t\t\totherProcessAttached = false;\n\t\t\t\t\tstr = \"\";\n\t\t\t\t\thideInput = false;\n\t\t\t\t\thideInputMask = \"\";\n\t\t\t\t\tlet prompt = await availableAPIs.automatedLogonGet(suSession);\n\t\t\t\t\tawait availableAPIs.toMyCLI(prompt.message);\n\t\t\t\t\tsu_stage = 2;\n\t\t\t\t\tif (prompt.success != \"intermediate\") {\n\t\t\t\t\t\tawait availableAPIs.toMyCLI(\"\\r\\n\");\n\t\t\t\t\t\tsu_stage = -1;\n\t\t\t\t\t\tif (prompt.success) {\n\t\t\t\t\t\t\tuser_spawn_token = prompt.token;\n\t\t\t\t\t\t\tlet processToken = await availableAPIs.getProcessToken();\n\t\t\t\t\t\t\tawait availableAPIs.setProcessToken(await availableAPIs.forkToken(user_spawn_token));\n\t\t\t\t\t\t\tprivileges = await availableAPIs.getPrivileges();\n\t\t\t\t\t\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\t\t\t\t\t\tawait availableAPIs.toMyCLI(\"terminal: Critical permissions were denied. Press any key to exit.\\r\\n\");\n\t\t\t\t\t\t\t\tawait availableAPIs.fromMyCLI();\n\t\t\t\t\t\t\t\treturn await availableAPIs.terminate();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tawait availableAPIs.revokeToken(processToken);\n\t\t\t\t\t\t\tawait availableAPIs.automatedLogonDelete(suSession);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (prompt.wantsUserInput || prompt.type == \"informative\") {\n\t\t\t\t\t\tif (prompt.wantsUserInput) await availableAPIs.toMyCLI(\": \");\n\t\t\t\t\t\thideInput = prompt.type == \"password\" || prompt.type == \"informative\" || prompt.type == \"zkpp_password\";\n\t\t\t\t\t\thideInputMask = (prompt.type == \"password\" || prompt.type == \"zkpp_password\") ? \"*\" : \"\";\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (su_stage != -1) await availableAPIs.toMyCLI(\"\\r\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet cmdline = [];\n\t\t\ttry {\n\t\t\t\tcmdline = parse_cmdline(str);\n\t\t\t} catch {\n\t\t\t\tawait availableAPIs.toMyCLI(\"> \");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tstr = \"\";\n\t\t\tif (cmdline[0] == \"sugraph\") {\n\t\t\t\totherProcessAttached = true;\n\t\t\t\tlet authui = await availableAPIs.consentGetToken({\n\t\t\t\t\tintent: await availableAPIs.lookupLocale(\"REAL_TERMINAL_INTENT\"),\n\t\t\t\t\tname: await availableAPIs.lookupLocale(\"REAL_TERMINAL_NAME\"),\n\t\t\t\t\tdesiredUser: cmdline[1]\n\t\t\t\t});\n\t\t\t\tif (authui) {\n\t\t\t\t\tuser_spawn_token = authui;\n\t\t\t\t\tlet processToken = await availableAPIs.getProcessToken();\n\t\t\t\t\tawait availableAPIs.setProcessToken(await availableAPIs.forkToken(user_spawn_token));\n\t\t\t\t\tprivileges = await availableAPIs.getPrivileges();\n\t\t\t\t\tif (!checklist.every(p => privileges.includes(p))) {\n\t\t\t\t\t\tawait availableAPIs.toMyCLI(\"terminal: Critical permissions were denied. Press any key to exit.\\r\\n\");\n\t\t\t\t\t\tawait availableAPIs.fromMyCLI();\n\t\t\t\t\t\treturn await availableAPIs.terminate();\n\t\t\t\t\t}\n\t\t\t\t\tawait availableAPIs.revokeToken(processToken);\n\t\t\t\t} else await availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \"\\r\\n\");\n\t\t\t\totherProcessAttached = false;\n\t\t\t} else if (cmdline[0] == \"su\") {\n\t\t\t\tif (!cmdline[1]) {\n\t\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"USERNAME\") + \": \");\n\t\t\t\t\treturn su_stage = 0;\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsuSession = await availableAPIs.automatedLogonCreate({ desiredUser: cmdline[1] });\n\t\t\t\t\t\tsu_stage = 1;\n\t\t\t\t\t\treturn self(\"\\r\", \"su\");\n\t\t\t\t\t} catch {\n\t\t\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"AUTH_FAILED\") + \"\\r\\n\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (cmdline[0] == \"graphic\") {\n\t\t\t\tif (!cmdline[1]) await availableAPIs.toMyCLI(\"graphic: \" + graphic + \"\\r\\n\");\n\t\t\t\telse {\n\t\t\t\t\tgraphic = cmdline[1] == \"true\" || cmdline[1] == \"on\" || cmdline[1] == \"1\" || cmdline[1] == \"yes\" || cmdline[1] == \"enable\";\n\t\t\t\t}\n\t\t\t} else if (cmdline[0] == \"pushpath\") {\n\t\t\t\tif (cmdline[1]) pathsForBinaries.push(cmdline[1]);\n\t\t\t} else if (cmdline[0] == \"resetpath\") {\n\t\t\t\tpathsForBinaries = [ defaultPath ];\n\t\t\t} else if (cmdline[0] == \"lspath\") {\n\t\t\t\tawait availableAPIs.toMyCLI(pathsForBinaries.map(a => JSON.stringify(a)).join(\", \") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"REAL_TERMINAL_DEFAULT_PATH_FIELD\")).replace(\"%s\", JSON.stringify(defaultPath)) + \"\\r\\n\");\n\t\t\t} else if (cmdline[0] == \"clear\") await availableAPIs.clearMyCLI();\n\t\t\telse if (cmdline[0] == \"exit\") await availableAPIs.terminate();\n\t\t\telse if (cmdline[0] == \"ver\") await systemVersion();\n\t\t\telse if (cmdline[0] == \"help\") {\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_BUILTIN_LIST\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_VER_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_HELP_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_CLEAR_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_SUGRAPH_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_SU_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_GRAPHIC_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_PUSHPATH_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_RESETPATH_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_LSPATH_USEDESC\") + \"\\r\\n\");\n\t\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REAL_TERMINAL_EXIT_USEDESC\") + \"\\r\\n\");\n\t\t\t} else if (!cmdline.length) {} else {\n\t\t\t\tlet runFile;\n\t\t\t\ttry {\n\t\t\t\t\tif (!await availableAPIs.fs_isDirectory({ path: cmdline[0] })) runFile = cmdline[0];\n\t\t\t\t} catch {}\n\t\t\t\tfor (let path of pathsForBinaries) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet ls = await availableAPIs.fs_ls({ path });\n\t\t\t\t\t\tif (ls.includes(cmdline[0]) || ls.includes(cmdline[0] + \".js\")) {\n\t\t\t\t\t\t\tlet extensioned = ls.includes(cmdline[0] + \".js\")\n\t\t\t\t\t\t\trunFile = path + \"/\" + cmdline[0] + (extensioned ? \".js\" : \"\");\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch {}\n\t\t\t\t}\n\t\t\t\tif (runFile) {\n\t\t\t\t\tif (user_spawn_token) {\n\t\t\t\t\t\tlet forkedToken = await availableAPIs.forkToken(user_spawn_token);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\totherProcessAttached = true;\n\t\t\t\t\t\t\tlet spawnedTask = await availableAPIs.startTask({\n\t\t\t\t\t\t\t\tfile: runFile,\n\t\t\t\t\t\t\t\targPassed: cmdline.slice(1),\n\t\t\t\t\t\t\t\trunInBackground: !graphic,\n\t\t\t\t\t\t\t\tsilent: true,\n\t\t\t\t\t\t\t\ttoken: forkedToken\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait availableAPIs.waitForOtherCLI({ taskId: spawnedTask, bypass: forkedToken });\n\t\t\t\t\t\t\totherProcessAttached = spawnedTask;\n\t\t\t\t\t\t\t(async function() {\n\t\t\t\t\t\t\t\twhile (otherProcessAttached) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tlet otherData = await availableAPIs.getOtherCLIData({ taskId: spawnedTask, bypass: forkedToken });\n\t\t\t\t\t\t\t\t\t\tif (otherData.type == \"write\") availableAPIs.toMyCLI(otherData.data);\n\t\t\t\t\t\t\t\t\t\telse if (otherData.type == \"consoleClear\") availableAPIs.clearMyCLI();\n\t\t\t\t\t\t\t\t\t} catch {}\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t})();\n\t\t\t\t\t\t\tawait availableAPIs.waitTermination(spawnedTask);\n\t\t\t\t\t\t\totherProcessAttached = false;\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\totherProcessAttached = false;\n\t\t\t\t\t\t\tawait availableAPIs.toMyCLI(runFile + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else await availableAPIs.toMyCLI((await availableAPIs.lookupLocale(\"REAL_TERMINAL_LOGON_REQUIRED\")).replace(\"%s\", default_user) + \"\\r\\n\");\n\t\t\t\t} else await availableAPIs.toMyCLI((await window.availableAPIs.lookupLocale(\"TERM_COMMAND_NOT_FOUND\")).replace(\"%s\", cmdline[0]) + \"\\r\\n\");\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tdefault_user = await window.availableAPIs.getUser();\n\t\t\t} catch {}\n\t\t\tawait availableAPIs.toMyCLI(default_user + (privileges.includes(\"FS_BYPASS_PERMISSIONS\") ? \"#\" : \"$\") + \" \");\n\t\t\treturn;\n\t\t} else if (e == '\\u007F') {\n\t\t\tif (str.length > 0) {\n\t\t\t\tstr = str.substr(0, str.length - 1);\n\t\t\t\tawait availableAPIs.toMyCLI('\\b \\b');\n\t\t\t}\n\t\t} else {\n\t\t\tif (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\\u00a0') {\n\t\t\t\tstr += e;\n\t\t\t\tawait availableAPIs.toMyCLI(hideInput ? hideInputMask : e);\n\t\t\t}\n\t\t}\n\t});\n})(); \n\nasync function onTermData(listener) {\n\twhile (true) {\n\t\tlistener(await availableAPIs.fromMyCLI());\n\t}\n}\naddEventListener(\"signal\", async function(e) {\n\ttry { await availableAPIs.revokeToken(user_spawn_token); } catch {}\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/textEditor.js
async function textEditorInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "textEditor" + ".js";
	let linkPath = target + "/apps/links/" + "textEditor" + ".lnk";
	let assocs = ["txt"];
	let lrn, name;
	
	lrn = "TEXT_EDITOR" || undefined;
	name = "" || undefined;
	await modules.fs.write(linkPath, JSON.stringify({
		path: appPath,
		localeReferenceName: lrn,
		name
	}), token);
	await modules.fs.chmod(linkPath, "rx", token);
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// link: lrn:TEXT_EDITOR\n// association: txt\n// signer: automaticSigner\n// allow: FS_READ, FS_WRITE, FS_LIST_PARTITIONS, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, GET_LOCALE, GET_THEME, START_TASK, IPC_SEND_PIPE, FS_BYPASS_PERMISSIONS, GET_USER_INFO\n// signature: 416a32214f672f3bd2edf721390300595aa7de1a5a2a043aec3a04c9ec8aeadf2cf70141f2f2304d3ddbe2ffe4e4d12ad1afacc75c0d130e888d2e5eddee9346\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"TEXT_EDITOR\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.documentElement.style.height = \"100%\";\n\tdocument.documentElement.style.width = \"100%\";\n\tdocument.body.style.height = \"100%\";\n\tdocument.body.style.width = \"100%\";\n\tdocument.body.style.margin = \"0\";\n\tlet flexContainer = document.createElement(\"div\");\n\tlet buttonContainer = document.createElement(\"div\");\n\tlet loadButton = document.createElement(\"button\");\n\tlet saveButton = document.createElement(\"button\");\n\tlet statusMessage = document.createElement(\"span\");\n\tlet data = document.createElement(\"textarea\");\n\tlet hr = document.createElement(\"hr\");\n\tlet hrContainer = document.createElement(\"div\");\n\tlet lastFile = \"\";\n\tloadButton.innerText = await availableAPIs.lookupLocale(\"LOAD_BTN\");\n\tsaveButton.innerText = await availableAPIs.lookupLocale(\"SAVE_BTN\");\n\tflexContainer.style.display = \"flex\";\n\tflexContainer.style.flexDirection = \"column\";\n\tflexContainer.style.width = \"100%\";\n\tflexContainer.style.height = \"100%\";\n\tdata.style.flexGrow = 1000;\n\tdata.style.resize = \"none\";\n\tif (await availableAPIs.isDarkThemed()) {\n\t\tdata.style.backgroundColor = \"#2b2a33\";\n\t\tdata.style.color = \"white\";\n\t}\n\tbuttonContainer.appendChild(loadButton);\n\tbuttonContainer.appendChild(saveButton);\n\tbuttonContainer.appendChild(statusMessage);\n\thrContainer.appendChild(hr);\n\tflexContainer.appendChild(buttonContainer);\n\tflexContainer.appendChild(hrContainer);\n\tflexContainer.appendChild(data);\n\tdocument.body.appendChild(flexContainer);\n\ttry {\n\t\tif (exec_args[0]) {\n\t\t\tdata.value = await availableAPIs.fs_read({ path: exec_args[0] });\n\t\t\tlastFile = exec_args[0];\n\t\t\tstatusMessage.innerText = exec_args[0].split(\"/\").pop();\n\t\t}\n\t} catch (e) {\n\t\tstatusMessage.innerText = e.name + \": \" + e.message;\n\t}\n\tloadButton.onclick = async function() {\n\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\tawait availableAPIs.windowVisibility(false);\n\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"load\", lastFile] });\n\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\tawait availableAPIs.windowVisibility(true);\n\t\ttry {\n\t\t\tif (result.success) {\n\t\t\t\tdata.value = await availableAPIs.fs_read({ path: result.selected });\n\t\t\t\tlastFile = result.selected;\n\t\t\t\tstatusMessage.innerText = result.selected.split(\"/\").pop();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tstatusMessage.innerText = e.name + \": \" + e.message;\n\t\t}\n\t}\n\tsaveButton.onclick = async function() {\n\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\tawait availableAPIs.windowVisibility(false);\n\t\tawait availableAPIs.startTask({ file: (await availableAPIs.getSystemMount()) + \"/apps/filePicker.js\", argPassed: [ipcPipe, \"save\", lastFile] });\n\t\tlet result = await availableAPIs.listenToPipe(ipcPipe);\n\t\tawait availableAPIs.closePipe(ipcPipe);\n\t\tawait availableAPIs.windowVisibility(true);\n\t\ttry {\n\t\t\tif (result.success) {\n\t\t\t\tawait availableAPIs.fs_write({ path: result.selected, data: data.value });\n\t\t\t\tlastFile = result.selected;\n\t\t\t\tstatusMessage.innerText = result.selected.split(\"/\").pop();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tstatusMessage.innerText = e.name + \": \" + e.message;\n\t\t}\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/umount.js
async function umountInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "umount" + ".js";
	let linkPath = target + "/apps/links/" + "umount" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_UNMOUNT, GET_FILESYSTEMS\n// signature: 968f91bf6721278125cfce515a2a32f06191209da3148b3ea08ade8f2c8fd6d8eb901ac8a2b70cc56e1732833fa0891594008b9ae75ec0b813905200c4f5c234\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"umount: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\n\tif (ppos.length < 1) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UMOUNT_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UMOUNT_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"UMOUNT_OPT_SYNCONLY\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"\\t\" + await availableAPIs.lookupLocale(\"UMOUNT_OPT_FORCE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"umount: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\n\ttry {\n\t\tawait availableAPIs[\"fs_\" + (pargs[\"sync-only\"] == true ? \"sync\" : \"unmount\")]({\n\t\t\tmount: ppos[0],\n\t\t\tforce: pargs.force\n\t\t});\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"umount: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); ", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/updatefw.js
async function updatefwInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "updatefw" + ".js";
	let linkPath = target + "/apps/links/" + "updatefw" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: FETCH_SEND, SET_FIRMWARE, SYSTEM_SHUTDOWN, GET_LOCALE, FS_READ, FS_BYPASS_PERMISSIONS\n// signature: ad278318f263dbaa668246eef345109ae8a2061333e8f2fe73a4cfe8b88cf116b3e350a128351700b572934d8163a887462a1ffaa2f1056ebe834e82944f2ac8\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"updatefw: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOADING\") + \"\\r\\n\");\n\tlet fwArchive;\n\tif (!exec_args.length) {\n\t\ttry {\n\t\t\tfwArchive = await availableAPIs.fetchSend({\n\t\t\t\turl: \"/init.js\",\n\t\t\t\tinit: {}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOAD_FAILED\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t} else {\n\t\ttry {\n\t\t\tfwArchive = { arrayBuffer: new TextEncoder().encode(await availableAPIs.fs_read({\n\t\t\t\tpath: exec_args[0]\n\t\t\t})) };\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATEFW_DOWNLOAD_FAILED\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t}\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATEFW_DECODING\") + \"\\r\\n\");\n\tfwArchive = fwArchive.arrayBuffer;\n\tfwArchive = new TextDecoder().decode(fwArchive);\n\ttry {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATEFW_SETTING\") + \"\\r\\n\");\n\t\tawait availableAPIs.setFirmware(fwArchive);\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"RESTARTING\") + \"\\r\\n\");\n\t\tawait availableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"updatefw: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/updateos.js
async function updateosInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "updateos" + ".js";
	let linkPath = target + "/apps/links/" + "updateos" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: FETCH_SEND, FS_WRITE, RUN_KLVL_CODE, IPC_CREATE_PIPE, IPC_LISTEN_PIPE, GET_LOCALE, FS_LIST_PARTITIONS, SYSTEM_SHUTDOWN, FS_READ, FS_BYPASS_PERMISSIONS\n// signature: 429828e19f9c2c8e72740961ec0da0cb224d9bdadce493fe2f62e59e366e380307333a429b1a071dff207f7bcc7206465c0fc9894badb8589a59eea75188b7c9\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"updateos: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tlet pargs = {};\n\tlet ppos = [];\n\tfor (let arg of exec_args) {\n\t\tif (arg.startsWith(\"--\")) {\n\t\t\tlet key = arg.split(\"=\")[0].slice(2);\n\t\t\tlet value = arg.split(\"=\").slice(1).join(\"=\");\n\t\t\tif (arg.split(\"=\")[1] == null) value = true;\n\t\t\tif (pargs.hasOwnProperty(key)) {\n\t\t\t\tlet ogValues = pargs[key];\n\t\t\t\tif (ogValues instanceof Array) pargs[key] = [ ...ogValues, value ];\n\t\t\t\telse pargs[key] = [ ogValues, value ];\n\t\t\t} else pargs[key] = value;\n\t\t} else ppos.push(arg);\n\t}\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOADING\") + \"\\r\\n\");\n\tlet osArchive;\n\tif (!ppos[0]) {\n\t\ttry {\n\t\t\tosArchive = await availableAPIs.fetchSend({\n\t\t\t\turl: ppos.url || \"/os.js\",\n\t\t\t\tinit: {}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOAD_FAILED\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t} else {\n\t\ttry {\n\t\t\tosArchive = { arrayBuffer: new TextEncoder().encode(await availableAPIs.fs_read({\n\t\t\t\tpath: exec_args[0]\n\t\t\t})) };\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REINSTALL_DOWNLOAD_FAILED\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t}\n\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"REINSTALL_DECODING\") + \"\\r\\n\");\n\tosArchive = osArchive.arrayBuffer;\n\tosArchive = new TextDecoder().decode(osArchive);\n\tlet files = osArchive.split(/\\/\\/ [0-9]+-.+.js\\n/g).slice(1);\n\tlet names = osArchive.match(/\\/\\/ [0-9]+-.+.js/g);\n\tlet appIndex = names.indexOf(\"// \" + \"1\" + \"5-ap\" + \"ps.js\");\n\tlet apps = files[appIndex].match(/async function (.+)Installer\\(target, token\\)/g).map(a => a.split(\" \")[2].split(\"(\")[0]);\n\tapps.splice(apps.indexOf(\"autoinstallerInstaller\"), 1);\n\tapps.splice(apps.indexOf(\"installerInstaller\"), 1);\n\tapps.splice(apps.indexOf(\"secondstageInstaller\"), 1);\n\tlet pipeResult = false;\n\ttry {\n\t\tlet ipcPipe = await availableAPIs.createPipe();\n\t\tpipeResult = availableAPIs.listenToPipe(ipcPipe);\n\t\tlet installerCode = \"\";\n\t\tfor (let app of apps) installerCode += `await ${app}(modules.defaultSystem, ${JSON.stringify(await availableAPIs.getProcessToken())});\\n`;\n\t\tawait availableAPIs.runKlvlCode(`(async function() {\n\t\t\ttry {\n\t\t\t\t${files[appIndex]}\n\t\t\t\t${installerCode}\n\t\t\t\tmodules.ipc.send(${JSON.stringify(ipcPipe)}, true);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\tmodules.ipc.send(${JSON.stringify(ipcPipe)}, false);\n\t\t\t}\n\t\t})();`);\n\t\tpipeResult = await pipeResult;\n\t\tawait availableAPIs.closePipe(ipcPipe);\n\t} catch {}\n\tif (!pipeResult) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATE_EXTRA_FAIL\") + \"\\r\\n\");\n\t\treturn await availableAPIs.terminate();\n\t}\n\tfiles.splice(appIndex, 1);\n\tnames.splice(appIndex, 1);\n\tlet installerIndex = names.indexOf(\"// 1\" + \"0\" + \"-ins\" + \"taller.js\");\n\tfiles.splice(installerIndex, 1);\n\tnames.splice(installerIndex, 1);\n\tlet secondStageIndex = names.indexOf(\"// 1\" + \"7\" + \"-instal\" + \"ler-seconds\" + \"tage.js\");\n\tfiles.splice(secondStageIndex, 1);\n\tnames.splice(secondStageIndex, 1);\n\tfor (let file in files) {\n\t\tlet name = names[file].split(\" \").slice(1).join(\" \");\n\t\tlet content = files[file];\n\t\ttry {\n\t\t\tawait availableAPIs.toMyCLI(\"\\t/boot/\" + name + \"\\r\\n\");\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/boot/\" + name,\n\t\t\t\tdata: content\n\t\t\t});\n\t\t} catch {\n\t\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"UPDATE_BOOT_FAIL\") + \"\\r\\n\");\n\t\t\treturn await availableAPIs.terminate();\n\t\t}\n\t}\n\tif (!pargs[\"no-reboot\"]) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"RESTARTING\") + \"\\r\\n\");\n\t\ttry {\n\t\t\tawait availableAPIs.shutdown({\n\t\t\t\tisReboot: true,\n\t\t\t\tisKexec: true\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tawait availableAPIs.toMyCLI(\"updateos: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t\t}\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/uptime.js
async function uptimeInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "uptime" + ".js";
	let linkPath = target + "/apps/links/" + "uptime" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, SYSTEM_UPTIME\n// signature: 3d09bf8b6600e004f24643628b090104df448d885046a1b4c57eda2c0db48ee20c810c972c28ce076ef5cc855714f29e82be3c79af96466f1cdb92a4620cdeba\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"uptime: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\ttry {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.ufTimeInc([ await availableAPIs.systemUptime() ]) + \"\\r\\n\");\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"uptime: \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/videoPlayer.js
async function videoPlayerInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "videoPlayer" + ".js";
	let linkPath = target + "/apps/links/" + "videoPlayer" + ".lnk";
	let assocs = ["vid","aud"];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// association: vid, aud\n// signer: automaticSigner\n// allow: FS_READ, GET_LOCALE, GET_THEME, FS_BYPASS_PERMISSIONS\n// signature: c25fc92323cf43c149e72becd0e54881e8027769550b6f21fd66a2dba7aec414c6b08aa2e8fed439e1a92f1c375dd4356d4adc76a29b470a93854c061daba418\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait window.availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"VIDEO_PLAYER\"));\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tdocument.body.innerHTML = \"<video controls id='video' style='width: 100%; height: 100%; position: absolute; top: 0; left: 0'></video>\";\n\tlet video = document.getElementById(\"video\");\n\tif (exec_args instanceof Array && typeof exec_args[0] == \"string\") {\n\t\tlet path = exec_args[0];\n\t\tlet url;\n\t\ttry {\n\t\t\turl = await window.availableAPIs.fs_read({ path });\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tdocument.body.innerText = (await availableAPIs.lookupLocale(\"INACCESSIBLE_FILE\")).replace(\"%s\", path);\n\t\t}\n\t\tvideo.src = url;\n\t} else {\n\t\tdocument.body.innerHTML = await availableAPIs.lookupLocale(\"FILE_NOT_SPECIFIED\");\n\t}\n})();\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n});", token);
	await modules.fs.chmod(appPath, "rx", token);
}
// ../apps/write.js
async function writeInstaller(target, token) {
	let neededApps = await modules.fs.ls(target + "/", token);
	if (!neededApps.includes("apps")) await modules.fs.mkdir(target + "/apps", token);
	await modules.fs.chmod(target + "/apps", "rx", token);
	let neededAppsLinks = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsLinks.includes("links")) await modules.fs.mkdir(target + "/apps/links", token);
	await modules.fs.chmod(target + "/apps/links", "rx", token);
	let neededAppsAssocs = await modules.fs.ls(target + "/apps", token);
	if (!neededAppsAssocs.includes("associations")) await modules.fs.mkdir(target + "/apps/associations", token);
	await modules.fs.chmod(target + "/apps/associations", "rx", token);
	let appPath = target + "/apps/" + "write" + ".js";
	let linkPath = target + "/apps/links/" + "write" + ".lnk";
	let assocs = [];
	let lrn, name;
	
	for (let assoc of assocs) {
		await modules.fs.write(target + "/apps/associations/" + assoc, JSON.stringify({
			path: appPath,
			localeReferenceName: lrn,
			name
		}), token);
		await modules.fs.chmod(target + "/apps/associations/" + assoc, "rx", token);
	}
	await modules.fs.write(appPath, "// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, FS_WRITE, FS_BYPASS_PERMISSIONS\n// signature: 21f666052a2ae9c7729dca89dacee29a274a04e98e8d8d3c893568cbac6b5d6fbdfe2ef9c5db0b5ee6917a9e2a4a7f9771d4aa3c3e0410a13555d5f03b1c47a0\n// =====END MANIFEST=====\n(async function() {\n\t// @pcos-app-mode isolatable\n\tawait availableAPIs.windowVisibility(false);\n\tawait availableAPIs.attachCLI();\n\tif (!(await availableAPIs.getPrivileges()).includes(\"GET_LOCALE\")) { await availableAPIs.toMyCLI(\"write: Locale permission denied\\r\\n\");\n\t\treturn await availableAPIs.terminate();\t}\n\tif (!exec_args.length) {\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"WRITE_USAGE\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(await availableAPIs.lookupLocale(\"WRITE_DESCRIPTION\") + \"\\r\\n\");\n\t\tawait availableAPIs.toMyCLI(\"write: \" + await availableAPIs.lookupLocale(\"NO_ARGUMENTS\") + \"\\r\\n\");\n\t\treturn availableAPIs.terminate();\n\t}\n\ttry {\n\t\tawait availableAPIs.fs_write({\n\t\t\tpath: exec_args[0],\n\t\t\tdata: exec_args[1]\n\t\t});\n\t} catch (e) {\n\t\tawait availableAPIs.toMyCLI(\"write: \" + exec_args[0] + \": \" + await availableAPIs.lookupLocale(e.message) + \"\\r\\n\");\n\t}\n\tawait availableAPIs.terminate();\n})();\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) await window.availableAPIs.terminate();\n}); null;", token);
	await modules.fs.chmod(appPath, "rx", token);
}

// 17-installer-secondstage.js
async function secondstage() {
	// @pcos-app-mode native
	let window = modules.window;
	let windowDiv = window(modules.session.active);
	windowDiv.closeButton.classList.toggle("hidden", true);
	let krnlDiv = document.createElement("div");
	let description = document.createElement("span");
	let progressBar = document.createElement("progress");
	progressBar.id = "secondStageProgress";
	krnlDiv.style.padding = "8px";
	krnlDiv.appendChild(description);
	krnlDiv.appendChild(document.createElement("hr"));
	krnlDiv.appendChild(progressBar);
	windowDiv.content.appendChild(krnlDiv);
	let appScripts = await modules.fs.read(modules.defaultSystem + "/boot/15-apps.js");
	let apps = appScripts.match(/async function (.+)Installer\(target, token\)/g).map(a => a.split(" ")[2].split("(")[0]);
	progressBar.max = apps.length;
	progressBar.value = 0;
	description.innerHTML = modules.locales.get("INSTALLING_PCOS").replace("%s", modules.locales.get("INSTALLING_APPS"));
	let fireAfterInstall = null;
	let firesAfterInstall = new Promise(r => fireAfterInstall = r);
	let installerCode = "(async function() {"
	for (let app of apps) installerCode += `await ${app}(modules.defaultSystem); secondStageProgress.value++;\n`;
	installerCode += "fireAfterInstall(); })();";
	eval(installerCode);
	await firesAfterInstall;
	progressBar.removeAttribute("max");
	progressBar.removeAttribute("value");
	description.innerHTML = modules.locales.get("INSTALLING_PCOS").replace("%s", modules.locales.get("ACCESS_REQUEST_TITLE"));
	let token;
	let usersConfigured = await modules.users.configured();
	if (usersConfigured) {
		token = await new Promise(async function(resolve) {
			let consentui = await modules.consentui(modules.session.systemSession, {
				path: modules.defaultSystem + "/apps/secondstage.js",
				args: [ "usersConfigured" ],
				intent: modules.locales.get("SECONDSTAGE_INSTALLER_INTENT"),
				name: modules.locales.get("SET_UP_PCOS")
			});
			consentui.hook(async function(msg) {
				if (msg.success) return resolve(msg.token);
				modules.restart(true);
			});
		});
	} else {
		await modules.users.init();
		token = await modules.tokens.generate();
		await modules.tokens.userInitialize(token, "root");
	}
	krnlDiv.remove();
	let taskId = await modules.tasks.exec(modules.defaultSystem + "/apps/secondstage.js", [ usersConfigured ? "usersConfigured" : "" ], windowDiv, token, false);
	await modules.tasks.waitTermination(taskId);
	requireLogon();
}
// 99-finished.js
function systemKillWaiter() {
	// @pcos-app-mode native
	modules.startupWindow.windowDiv.remove();
	return new Promise(function(resolve) {
		modules.killSystem = resolve;
	});
}
return await systemKillWaiter();