{"backend":{"files":{"apps":{"installer.js":"0d51473fb5bcadde5b8f38274c38b339c48d473341624bdc9819c32a2e6ff19eb19354cfd4b20d08b0d89ffeda8568344c9c61ca48982133bb60d5db5647d394"}},"permissions":{"apps/installer.js":{"world":"rx"},"apps/":{"world":"rx"},"":{"world":"rx"}}},"files":{"0d51473fb5bcadde5b8f38274c38b339c48d473341624bdc9819c32a2e6ff19eb19354cfd4b20d08b0d89ffeda8568344c9c61ca48982133bb60d5db5647d394":"// =====BEGIN MANIFEST=====\n// signer: automaticSigner\n// allow: GET_LOCALE, GET_THEME, GET_BUILD, RUN_KLVL_CODE, LLDISK_WRITE, LLDISK_READ, FS_READ, FS_WRITE, FS_BYPASS_PERMISSIONS, FS_REMOVE, FS_LIST_PARTITIONS, SYSTEM_SHUTDOWN, FS_CHANGE_PERMISSION, LLDISK_LIST_PARTITIONS, FS_MOUNT, CSP_OPERATIONS, LLDISK_INIT_PARTITIONS, IPC_SEND_PIPE\n// signature: 9550d78e56dec27174964b41d9dca8ac30edb4766a3b2cd5f797eb50d93ce94339a7f284dacd9aa63dad00154f9ce412a7c4754635b5a449581a3155d8d9710b\n// =====END MANIFEST=====\nlet onClose = () => availableAPIs.terminate();\n(async function() {\n\t// @pcos-app-mode isolatable\n\tlet automatic_configuration = {}; /*{\n\t\tstartInstall: true,\n\t\tacceptEULA: true,\n\t\tpartitioning: {\n\t\t\tdata: \"data\",\n\t\t\tboot: \"boot\",\n\t\t\tformat: true,\n\t\t\tautoInitNewInstalls: true\n\t\t},\n\t\tautoRestart: \"kexec\",\n\t\tdefaultLocale: \"en\"\n\t};*/\n\tdocument.body.style.fontFamily = \"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif\";\n\tif (await availableAPIs.isDarkThemed()) document.body.style.color = \"white\";\n\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"INSTALL_PCOS\"));\n\tlet privileges = await availableAPIs.getPrivileges();\n\tlet checklist = [ \"GET_BUILD\", \"RUN_KLVL_CODE\", \"LLDISK_WRITE\", \"LLDISK_READ\", \"FS_READ\", \"FS_WRITE\", \"FS_BYPASS_PERMISSIONS\", \"FS_REMOVE\", \"FS_LIST_PARTITIONS\", \"SYSTEM_SHUTDOWN\", \"FS_CHANGE_PERMISSION\", \"LLDISK_LIST_PARTITIONS\", \"FS_MOUNT\", \"CSP_OPERATIONS\", \"LLDISK_INIT_PARTITIONS\" ];\n\tif (!checklist.every(p => privileges.includes(p))) return availableAPIs.terminate();\n\tlet installed_modules = [\n\t\t\"50-bootable.fs\", \"50-core.fs\", \"50-diff.fs\", \"00-keys.fs\", \"50-pcos-icons.fs\", \"50-pcos-sounds.fs\", \"50-pcos-wallpapers.fs\", \"50-tweetnacl.fs\",\n\t\t\"50-xterm.fs\"\n\t];\n\tawait availableAPIs.closeability(false);\n\tawait new Promise(async function(resolve) {\n\t\tlet locales = await availableAPIs.installedLocales();\n\t\tlet localeSelect = document.createElement(\"select\");\n\t\tlet localeZero = document.createElement(\"option\");\n\t\tlocaleZero.value = \"\";\n\t\tlocaleZero.innerText = \" ðŸŒ Language ðŸŒ \";\n\t\tlocaleZero.selected = true;\n\t\tlocaleZero.disabled = true;\n\t\tlocaleZero.hidden = true;\n\t\tlocaleSelect.appendChild(localeZero);\n\t\tfor (let locale of locales) {\n\t\t\tlet option = document.createElement(\"option\");\n\t\t\toption.value = locale;\n\t\t\toption.innerText = await availableAPIs.lookupOtherLocale({ key: \"LOCALE_NAME\", locale });\n\t\t\tlocaleSelect.appendChild(option);\n\t\t}\n\t\tlocaleSelect.addEventListener(\"change\", async function() {\n\t\t\tawait availableAPIs.runKlvlCode(\"modules.locales.defaultLocale = \" + JSON.stringify(localeSelect.value));\n\t\t\tinstalled_modules.push(\"50-locale-\" + localeSelect.value + \".fs\");\n\t\t\tawait availableAPIs.windowTitleSet(await availableAPIs.lookupLocale(\"INSTALL_PCOS\"));\n\t\t\tlocaleSelect.remove();\n\t\t\tawait availableAPIs.closeability(true);\n\t\t\tresolve();\n\t\t});\n\t\tif (automatic_configuration.defaultLocale) {\n\t\t\tlocaleSelect.value = automatic_configuration.defaultLocale;\n\t\t\tlocaleSelect.dispatchEvent(new Event(\"change\"));\n\t\t}\n\t\tdocument.body.appendChild(localeSelect);\n\t});\n\tonClose = async function() {\n\t\tmainInstallerContent.hidden = true;\n\t\tcloseContent.hidden = false;\n\t\tawait availableAPIs.closeability(false);\n\t}\n\tconst licenseText = `Copyright (c) 2024 PCsoft\nOriginal Source Code Repository: https://github.com/PC-trollbox/pcos3\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n---\nUsed libraries:\n\txterm.js:\n\t\tCopyright (c) 2017-2022, The xterm.js authors (https://github.com/xtermjs/xterm.js/graphs/contributors) (MIT License)\n\t\tCopyright (c) 2014-2017, SourceLair, Private Company (www.sourcelair.com) (MIT License)\n\t\tCopyright (c) 2012-2013, Christopher Jeffrey (MIT License)\n\ttweetnacl.js:\n\t\tPublic domain, https://github.com/dchest/tweetnacl-js\n\tfast-myers-diff (minified and modified):\n\t\tCopyright 2021 Logan R. Kearsley (https://github.com/gliese1337/fast-myers-diff)`;\n\tlet mainInstallerContent = document.createElement(\"div\");\n\tlet closeContent = document.createElement(\"div\");\n\tlet header = document.createElement(\"b\");\n\tlet postHeader = document.createElement(\"br\");\n\tlet description = document.createElement(\"span\");\n\tlet content = document.createElement(\"div\");\n\tlet button = document.createElement(\"button\");\n\tlet liveButton = document.createElement(\"button\");\n\tlet confirmDescription = document.createElement(\"p\");\n\tlet buttonYes = document.createElement(\"button\");\n\tlet buttonNo = document.createElement(\"button\");\n\n\tcloseContent.hidden = true;\n\n\tmainInstallerContent.style = \"position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 8px; box-sizing: border-box;\";\n\tcloseContent.style = \"position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 8px; box-sizing: border-box;\";\n\n\tconfirmDescription.innerText = await availableAPIs.lookupLocale(\"CLOSE_INSTALLER_CONFIRMATION\");\n\tbuttonYes.innerText = await availableAPIs.lookupLocale(\"YES\");\n\tbuttonNo.innerText = await availableAPIs.lookupLocale(\"NO\");\n\theader.innerText = await availableAPIs.lookupLocale(\"INSTALLER_TITLE\");\n\tdescription.innerText = (await availableAPIs.lookupLocale(\"INSTALLER_INVITATION\")).replace(\"%s\", await availableAPIs.getVersion());\n\tbutton.innerText = await availableAPIs.lookupLocale(\"INSTALL_BUTTON\");\n\tliveButton.innerText = await availableAPIs.lookupLocale(\"LIVE_BUTTON\");\n\n\tmainInstallerContent.appendChild(header);\n\tmainInstallerContent.appendChild(postHeader);\n\tmainInstallerContent.appendChild(description);\n\tmainInstallerContent.appendChild(content);\n\tmainInstallerContent.appendChild(button);\n\tmainInstallerContent.appendChild(document.createElement(\"br\"));\n\tmainInstallerContent.appendChild(liveButton);\n\n\tcloseContent.appendChild(confirmDescription);\n\tcloseContent.appendChild(buttonYes);\n\tcloseContent.insertAdjacentText(\"beforeend\", \" \");\n\tcloseContent.appendChild(buttonNo);\n\n\tdocument.body.appendChild(mainInstallerContent);\n\tdocument.body.appendChild(closeContent);\n\n\tbuttonNo.onclick = async function() {\n\t\tmainInstallerContent.hidden = false;\n\t\tcloseContent.hidden = true;\n\t\tawait availableAPIs.closeability(true);\n\t}\n\tbuttonYes.onclick = function() {\n\t\tonClose = () => availableAPIs.terminate();\n\t\tavailableAPIs.shutdown({\n\t\t\tisReboot: true\n\t\t});\n\t}\n\n\tbutton.onclick = async function() {\n\t\theader.remove();\n\t\tpostHeader.remove();\n\t\tliveButton.remove();\n\t\tcontent.innerHTML = \"\";\n\t\tdescription.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW\");\n\t\tlet textareaLicense = document.createElement(\"textarea\");\n\t\ttextareaLicense.readOnly = true;\n\t\ttextareaLicense.style.width = \"100%\";\n\t\ttextareaLicense.style.height = \"100%\";\n\t\tcontent.style.height = \"100%\";\n\t\ttextareaLicense.value = licenseText;\n\t\tcontent.appendChild(textareaLicense);\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW_BTN\");\n\t\tbutton.onclick = async function() {\n\t\t\tcontent.innerHTML = \"\";\n\t\t\tcontent.style.height = \"\";\n\t\t\tdescription.innerText = await availableAPIs.lookupLocale(\"INSTALLER_PARTITIONING\");\n\t\t\tbutton.innerText = await availableAPIs.lookupLocale(\"PARTITIONING_USE\");\n\t\t\tlet partitionDataInput = document.createElement(\"input\");\n\t\t\tlet partitionDataFormat = document.createElement(\"button\");\n\t\t\tlet partitionBootInput = document.createElement(\"input\");\n\t\t\tpartitionDataInput.placeholder = await availableAPIs.lookupLocale(\"PARTITION_DATA\");\n\t\t\tpartitionDataFormat.innerText = await availableAPIs.lookupLocale(\"FORMAT_DATA\");\n\t\t\tpartitionBootInput.placeholder = await availableAPIs.lookupLocale(\"PARTITION_BOOT\");\n\t\t\tpartitionDataInput.value = \"data\";\n\t\t\tpartitionBootInput.value = \"boot\";\n\t\t\tcontent.appendChild(partitionDataInput);\n\t\t\tcontent.insertAdjacentText(\"beforeend\", \" \");\n\t\t\tcontent.appendChild(partitionDataFormat);\n\t\t\tcontent.appendChild(document.createElement(\"br\"));\n\t\t\tcontent.appendChild(partitionBootInput);\n\t\t\tlet initSyncEnd;\n\t\t\tlet initSync = new Promise(_ => initSyncEnd = _);\n\t\t\tpartitionDataFormat.onclick = async function() {\n\t\t\t\tif (!partitionDataInput.value) return await htmlAlert(await availableAPIs.lookupLocale(\"DATA_INPUT_ALERT\"));\n\t\t\t\tlet newInstall = false;\n\t\t\t\ttry {\n\t\t\t\t\tawait availableAPIs.lldaList();\n\t\t\t\t} catch {\n\t\t\t\t\tnewInstall = true;\n\t\t\t\t\tif (!automatic_configuration?.partitioning?.autoInitNewInstalls) \n\t\t\t\t\t\tif (!(await htmlConfirm(await availableAPIs.lookupLocale(\"PROMPT_PARTITION_TABLE\")))) return;\n\t\t\t\t\tawait availableAPIs.lldaInitPartitions();\n\t\t\t\t}\n\t\t\t\tlet confirmErasePart = true;\n\t\t\t\tif (!automatic_configuration?.partitioning?.format && !(automatic_configuration?.partitioning?.autoInitNewInstalls && newInstall))\n\t\t\t\t\tconfirmErasePart = await htmlConfirm(await availableAPIs.lookupLocale(\"CONFIRM_PARTITION_ERASE\"));\n\t\t\t\tif (confirmErasePart) {\n\t\t\t\t\tlet partData = await availableAPIs.lldaRead({ partition: partitionDataInput.value });\n\t\t\t\t\tlet partId;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpartId = partData.id;\n\t\t\t\t\t} catch {}\n\t\t\t\t\tif (!partId) partId = (await availableAPIs.cspOperation({\n\t\t\t\t\t\tcspProvider: \"basic\",\n\t\t\t\t\t\toperation: \"random\",\n\t\t\t\t\t\tcspArgument: new Uint8Array(64)\n\t\t\t\t\t})).reduce((a, b) => a + b.toString(16).padStart(2, \"0\"), \"\")\n\t\t\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\t\t\tpartition: partitionDataInput.value,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tfiles: {},\n\t\t\t\t\t\t\tpermissions: {},\n\t\t\t\t\t\t\tid: partId\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tinitSyncEnd();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tbutton.onclick = async function() {\n\t\t\t\tlet diskDataPartition = partitionDataInput.value;\n\t\t\t\tlet diskBootPartition = partitionBootInput.value;\n\t\t\t\tif (!diskDataPartition) return await htmlAlert(await availableAPIs.lookupLocale(\"DATA_INPUT_ALERT\"));\n\t\t\t\tif (!diskBootPartition) return await htmlAlert(await availableAPIs.lookupLocale(\"BOOT_INPUT_ALERT\"));\n\t\t\t\ttry {\n\t\t\t\t\tif (!(await availableAPIs.lldaList()).includes(diskDataPartition)) throw new Error();\n\t\t\t\t} catch {\n\t\t\t\t\treturn await htmlAlert(await availableAPIs.lookupLocale(\"CANNOT_FIND_PARTITION\"));\n\t\t\t\t}\n\n\t\t\t\tlet tempCopy = Object.keys((await availableAPIs.lldaRead({ partition: diskDataPartition })) || {});\n\t\t\t\tif (!tempCopy.includes(\"files\") || !tempCopy.includes(\"permissions\"))\n\t\t\t\t\tif (!(await htmlConfirm(await availableAPIs.lookupLocale(\"PCFS_DETECTION_ERROR\")))) return;\n\n\t\t\t\ttempCopy = null;\n\t\t\t\tcontent.innerHTML = \"\";\n\t\t\t\tbutton.hidden = true;\n\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"PLEASE_WAIT\"));\n\t\t\t\tawait availableAPIs.closeability(false);\n\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CREATING_BOOT_PARTITION\"));\n\t\t\t\tawait availableAPIs.lldaWrite({\n\t\t\t\t\tpartition: diskBootPartition,\n\t\t\t\t\tdata: `\n\t\t\t\ttry {\n\t\t\t\t\tconst AsyncFunction = (async () => {}).constructor;\n\t\t\t\t\tlet pre_boot_part = coreExports.disk.partition(${JSON.stringify(diskDataPartition)}).getData();\n\t\t\t\t\tlet pre_boot_modules = pre_boot_part?.files;\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No files were found in the storage partition\");\n\t\t\t\t\t\tthrow new Error(\"No files were found in the storage partition\");\n\t\t\t\t\t}\n\t\t\t\t\tpre_boot_modules = pre_boot_modules[coreExports.bootSection || \"boot\"];\n\t\t\t\t\tif (!pre_boot_modules) {\n\t\t\t\t\t\tcoreExports.tty_bios_api.println(\"No boot modules were found\");\n\t\t\t\t\t\tthrow new Error(\"No boot modules were found\");\n\t\t\t\t\t}\n\t\t\t\t\tlet pre_boot_module_list = Object.keys(pre_boot_modules);\n\t\t\t\t\tpre_boot_module_list = pre_boot_module_list.sort((a, b) => a.localeCompare(b));\n\t\t\t\t\tlet pre_boot_module_script = \"\";\n\t\t\t\t\tfor (let module of pre_boot_module_list) {\n\t\t\t\t\t\tif (coreExports.bootMode == \"logboot\") pre_boot_module_script += \"coreExports.tty_bios_api.println(\" + JSON.stringify(module) + \");\\\\n\";\n\t\t\t\t\t\tpre_boot_module_script += await coreExports.idb.readPart(pre_boot_part.id + \"-\" + pre_boot_modules[module]);\n\t\t\t\t\t}\n\t\t\t\t\tawait new AsyncFunction(pre_boot_module_script)();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Boot failed\");\n\t\t\t\t\tcoreExports.tty_bios_api.println(\"Press Enter to continue and log this error locally\");\n\t\t\t\t\tawait coreExports.tty_bios_api.inputLine();\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t\t`});\n\t\t\t\ttry {\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"MOUNTING_DATA_PARTITION\"));\n\t\t\t\t\tawait availableAPIs.fs_mount({\n\t\t\t\t\t\tmountpoint: \"target\",\n\t\t\t\t\t\tfilesystem: \"PCFSiDBMount\",\n\t\t\t\t\t\tfilesystemOptions: {\n\t\t\t\t\t\t\tpartition: diskDataPartition\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CHANGING_ROOT_PERMISSIONS\"));\n\t\t\t\t\tawait availableAPIs.fs_chmod({ path: \"target\", newPermissions: \"rx\" });\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"COPYING_FOLDERS\"));\n\t\t\t\t\ttry {\n\t\t\t\t\t\trecursiveRemove(\"target/modules\");\n\t\t\t\t\t} catch {}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/modules\" });\n\t\t\t\t\t} catch {}\n\t\t\t\t\tlet modules = await availableAPIs.fs_ls({ path: (await availableAPIs.getSystemMount()) + \"/modules\" });\n\t\t\t\t\tfor (let module of installed_modules) {\n\t\t\t\t\t\tif (!modules.includes(module)) throw new Error(\"Module required (\" + module + \")\");\n\t\t\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\t\t\tpath: \"target/modules/\" + module,\n\t\t\t\t\t\t\tdata: await availableAPIs.fs_read({\n\t\t\t\t\t\t\t\tpath: (await availableAPIs.getSystemMount()) + \"/modules/\" + module\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"CREATING_DIRECTORY_STRUCTURE\"));\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/apps\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/apps/associations\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/apps/links\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/boot\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/etc\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/etc/wallpapers\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/etc/icons\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/etc/sounds\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/etc/keys\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/etc/security\" });\n\t\t\t\t\t\tawait availableAPIs.fs_chmod({\n\t\t\t\t\t\t\tpath: \"target/etc/security\",\n\t\t\t\t\t\t\tnewPermissions: \"\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/root\" });\n\t\t\t\t\t\tawait availableAPIs.fs_mkdir({ path: \"target/home\" });\n\t\t\t\t\t} catch {}\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"PATCHING_FS\"));\n\t\t\t\t\tlet systemCode = \"let localSystemMount = \\\".storage\\\";\\nlet mountOptions = {\\n\\tpartition: \" + JSON.stringify(diskDataPartition) + \"\\n};\\ntry {\\n\\tmodules.fs.mounts[localSystemMount] = await modules.mounts.PCFSiDBMount(mountOptions);\\n\\tmodules.defaultSystem = localSystemMount;\\n} catch (e) {\\n\\tawait panic(\\\"SYSTEM_PARTITION_MOUNTING_FAILED\\\", { underlyingJS: e, name: \\\"fs.mounts\\\", params: [localSystemMount, mountOptions]});\\n}\\n\";\n\t\t\t\t\tawait availableAPIs.fs_write({ path: \"target/boot/01-fsboot.js\", data: systemCode });\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"SETTING_LOCALE_PREFERENCE\"));\n\t\t\t\t\tawait availableAPIs.fs_write({ path: \"target/boot/06-localeset.js\", data: \"modules.locales.defaultLocale = \" + JSON.stringify(await availableAPIs.osLocale()) + \";\\n\" });\n\t\t\t\t\tdescription.innerHTML = (await availableAPIs.lookupLocale(\"INSTALLING_PCOS\")).replace(\"%s\", await availableAPIs.lookupLocale(\"GENERATING_KERNEL\"));\n\t\t\t\t\tlet entireBoot = [];\n\t\t\t\t\tlet bootFiles = await availableAPIs.fs_ls({ path: \"target/boot\" });\n\t\t\t\t\tif (bootFiles.includes(\"00-compiled.js\")) bootFiles.splice(bootFiles.indexOf(\"00-compiled.js\"), 1);\n\t\t\t\t\tif (bootFiles.includes(\"99-zzpatchfinisher.js\")) bootFiles.splice(bootFiles.indexOf(\"99-zzpatchfinisher.js\"), 1);\n\t\t\t\t\tfor (let bootFile of bootFiles) {\n\t\t\t\t\t\tentireBoot.push([ bootFile, await availableAPIs.fs_read({\n\t\t\t\t\t\t\tpath: \"target/boot/\" + bootFile\n\t\t\t\t\t\t}) ]);\n\t\t\t\t\t}\n\t\t\t\t\tmodules = await availableAPIs.fs_ls({ path: \"target/modules\" });\n\t\t\t\t\tfor (let module of modules) {\n\t\t\t\t\t\tlet moduleFile = JSON.parse(await availableAPIs.fs_read({ path: \"target/modules/\" + module }));\n\t\t\t\t\t\tfor (let bootFile in (moduleFile.backend.files.boot || []))\n\t\t\t\t\t\t\tentireBoot.push([ bootFile, moduleFile.files[moduleFile.backend.files.boot[bootFile]] ]);\n\t\t\t\t\t}\n\t\t\t\t\tentireBoot = entireBoot.sort((a, b) => a[0].localeCompare(b[0]))\n\t\t\t\t\t\t.map(a => \"// modules/.../boot/\" + a[0] + \"\\n\" + a[1]).join(\"\\n\");\n\t\t\t\t\tawait availableAPIs.fs_write({\n\t\t\t\t\t\tpath: \"target/boot/00-compiled.js\",\n\t\t\t\t\t\tdata: entireBoot + \"\\nreturn;/*\"\n\t\t\t\t\t});\n\t\t\t\t\tawait availableAPIs.fs_write({ path: \"target/boot/99-zzpatchfinisher.js\", data: \"*/\" });\n\t\t\t\t\tdescription.innerHTML = await availableAPIs.lookupLocale(\"INSTALLATION_SUCCESSFUL\");\n\t\t\t\t\tif (!automatic_configuration.autoRestart) await availableAPIs.closeability(true);\n\t\t\t\t\tonClose = function() {\n\t\t\t\t\t\tonClose = () => availableAPIs.terminate();\n\t\t\t\t\t\tavailableAPIs.shutdown({\n\t\t\t\t\t\t\tisReboot: true,\n\t\t\t\t\t\t\tisKexec: automatic_configuration.autoRestart == \"kexec\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (automatic_configuration.autoRestart) onClose();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tdescription.innerHTML = await availableAPIs.lookupLocale(\"INSTALLATION_FAILED\");\n\t\t\t\t\tawait availableAPIs.closeability(true);\n\t\t\t\t\tonClose = function() {\n\t\t\t\t\t\tonClose = () => availableAPIs.terminate();\n\t\t\t\t\t\tavailableAPIs.shutdown({\n\t\t\t\t\t\t\tisReboot: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (automatic_configuration.partitioning) {\n\t\t\t\tpartitionDataInput.value = automatic_configuration.partitioning.data || \"data\";\n\t\t\t\tpartitionBootInput.value = automatic_configuration.partitioning.boot || \"boot\";\n\t\t\t\tlet newInstall = false;\n\t\t\t\ttry { await availableAPIs.lldaList(); } catch { newInstall = true; }\n\t\t\t\tif (automatic_configuration.partitioning.format || (newInstall && automatic_configuration.partitioning.autoInitNewInstalls)) {\n\t\t\t\t\tpartitionDataFormat.click();\n\t\t\t\t\tawait initSync;\n\t\t\t\t}\n\t\t\t\tbutton.click();\n\t\t\t}\n\t\t}\n\t\tif (automatic_configuration.acceptEULA) button.click();\n\t}\n\tliveButton.onclick = async function() {\n\t\theader.remove();\n\t\tpostHeader.remove();\n\t\tliveButton.remove();\n\t\tcontent.innerHTML = \"\";\n\t\tdescription.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW\");\n\t\tlet textareaLicense = document.createElement(\"textarea\");\n\t\ttextareaLicense.readOnly = true;\n\t\ttextareaLicense.style.width = \"100%\";\n\t\ttextareaLicense.style.height = \"100%\";\n\t\tcontent.style.height = \"100%\";\n\t\ttextareaLicense.value = licenseText;\n\t\tcontent.appendChild(textareaLicense);\n\t\tbutton.innerText = await availableAPIs.lookupLocale(\"RIGHT_REVIEW_BTN\");\n\t\tbutton.onclick = async function() {\n\t\t\tcontent.innerHTML = \"\";\n\t\t\tcontent.style.height = \"\";\n\t\t\tawait availableAPIs.sendToPipe({\n\t\t\t\tpipe: exec_args[0],\n\t\t\t\tdata: true\n\t\t\t});\n\t\t\tawait availableAPIs.terminate();\n\t\t}\n\t}\n\tif (automatic_configuration.startInstall) button.click()\n})();\n\nasync function htmlAlert(msg) {\n\tlet overlay = document.createElement(\"div\");\n\tlet overlayingMessage = document.createElement(\"div\");\n\tlet description = document.createElement(\"span\");\n\tlet buttonAccept = document.createElement(\"button\");\n\toverlay.style = \"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; opacity: 85%;\";\n\toverlayingMessage.style = \"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; padding: 8px; box-sizing: border-box; color: white;\";\n\tdescription.innerText = msg;\n\tbuttonAccept.innerText = \"Ok\";\n\toverlayingMessage.appendChild(description);\n\toverlayingMessage.appendChild(document.createElement(\"hr\"));\n\toverlayingMessage.appendChild(buttonAccept);\n\tdocument.body.appendChild(overlay);\n\tdocument.body.appendChild(overlayingMessage);\n\treturn new Promise(function(resolve) {\n\t\tbuttonAccept.onclick = function() {\n\t\t\toverlay.remove();\n\t\t\toverlayingMessage.remove();\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\nasync function htmlConfirm(msg) {\n\tlet overlay = document.createElement(\"div\");\n\tlet overlayingMessage = document.createElement(\"div\");\n\tlet description = document.createElement(\"span\");\n\tlet buttonAccept = document.createElement(\"button\");\n\tlet buttonDecline = document.createElement(\"button\");\n\toverlay.style = \"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; opacity: 85%;\";\n\toverlayingMessage.style = \"position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; padding: 8px; box-sizing: border-box; color: white;\";\n\tdescription.innerText = msg;\n\tbuttonAccept.innerText = await availableAPIs.lookupLocale(\"YES\");\n\tbuttonDecline.innerText = await availableAPIs.lookupLocale(\"NO\");\n\toverlayingMessage.appendChild(description);\n\toverlayingMessage.appendChild(document.createElement(\"hr\"));\n\toverlayingMessage.appendChild(buttonAccept);\n\toverlayingMessage.appendChild(buttonDecline);\n\tdocument.body.appendChild(overlay);\n\tdocument.body.appendChild(overlayingMessage);\n\treturn new Promise(function(resolve) {\n\t\tbuttonAccept.onclick = function() {\n\t\t\toverlay.remove();\n\t\t\toverlayingMessage.remove();\n\t\t\tresolve(true);\n\t\t}\n\t\tbuttonDecline.onclick = function() {\n\t\t\toverlay.remove();\n\t\t\toverlayingMessage.remove();\n\t\t\tresolve(false);\n\t\t}\n\t});\n}\n\nasync function recursiveCopy(source, destination, permissions) {\n\tfor (let sourceFile of await availableAPIs.fs_ls({ path: source })) {\n\t\tlet destinationFile = destination + \"/\" + sourceFile;\n\t\tif (await availableAPIs.fs_isDirectory({ path: source + \"/\" + sourceFile })) {\n\t\t\ttry {\n\t\t\t\tawait availableAPIs.fs_mkdir({ path: destinationFile });\n\t\t\t} catch {}\n\t\t\tawait recursiveCopy(source + \"/\" + sourceFile, destinationFile, permissions);\n\t\t} else {\n\t\t\tawait availableAPIs.fs_write({\n\t\t\t\tpath: destinationFile,\n\t\t\t\tdata: await availableAPIs.fs_read({ path: source + \"/\" + sourceFile })\n\t\t\t});\n\t\t}\n\t\tif (permissions) {\n\t\t\tlet originalPermissions = await availableAPIs.fs_permissions({ path: source + \"/\" + sourceFile });\n\t\t\tawait availableAPIs.fs_chmod({ path: destinationFile, newPermissions: originalPermissions.world });\n\t\t\tawait availableAPIs.fs_chgrp({ path: destinationFile, newGrp: originalPermissions.group });\n\t\t\tawait availableAPIs.fs_chown({ path: destinationFile, newUser: originalPermissions.owner });\n\t\t}\n\t}\n}\n\nasync function recursiveRemove(target) {\n\tfor (let targetFile of await availableAPIs.fs_ls({ path: target })) {\n\t\ttargetFile = target + \"/\" + targetFile;\n\t\tif (await availableAPIs.fs_isDirectory({ path: targetFile })) await recursiveRemove(targetFile);\n\t\tawait availableAPIs.fs_rm({ path: targetFile });\n\t}\n}\n\naddEventListener(\"signal\", async function(e) {\n\tif (e.detail == 15) onClose();\n}); "},"buildInfo":{"for":"1309","when":1750449300422,"signer":"moduleSigner","critical":false,"signature":"06d52a64c964ebdf38eead16c80cddf6a75535fac5f1857374dc89be0ae90e517d8764a569960887f6d9da58ee9a087fbbea9418300bcb29e122c22d45f0f2c8"}}